<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OrbitHQ — Your Artist Command Center</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@200;300;400;500;600&family=Space+Mono:wght@400;700&display=swap');

:root {
  --void: #020408;
  --deep-space: #060d1f;
  --accent-cyan: #00e5ff;
  --accent-blue: #2979ff;
  --accent-purple: #7c4dff;
  --accent-magenta: #e040fb;
  --accent-green: #00e676;
  --star-white: #e8eaf6;
  --ghost: rgba(255,255,255,0.06);
  --glass: rgba(10,22,40,0.85);
  --glass-border: rgba(0,229,255,0.15);
  --sidebar-w: 260px;
  --topbar-h: 36px;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }
body { background:var(--void); color:var(--star-white); font-family:'Exo 2',sans-serif; overflow-x:hidden; -webkit-font-smoothing:antialiased; }
#starfield { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:0; pointer-events:none; }

/* ══ LOGIN ══ */
.login-overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1000; display:none; justify-content:center; align-items:center; background:var(--void); }
.login-overlay.active { display:flex; animation:fadeIn 0.5s ease; }
.login-box { position:relative; z-index:10; background:rgba(8,10,14,0.72); border:1px solid rgba(255,255,255,0.08); width:420px; backdrop-filter:blur(12px); animation:stationMaterialize 1s ease 0.3s both; box-shadow:0 0 40px rgba(0,0,0,0.5); overflow:hidden; }
.login-box::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.08) 3px,rgba(0,0,0,0.08) 4px); pointer-events:none; z-index:50; }
.terminal-header { background:rgba(255,255,255,0.03); border-bottom:1px solid rgba(255,255,255,0.06); padding:0.6rem 1rem; display:flex; justify-content:space-between; align-items:center; }
.terminal-header-left { display:flex; align-items:center; gap:0.5rem; }
.terminal-dot { width:6px; height:6px; border-radius:50%; background:rgba(255,255,255,0.25); animation:termBlink 3s ease infinite; }
.terminal-dot:nth-child(2) { animation-delay:0.5s; background:rgba(255,255,255,0.15); }
.terminal-dot:nth-child(3) { animation-delay:1s; background:rgba(255,255,255,0.15); }
.terminal-title { font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:3px; text-transform:uppercase; color:rgba(255,255,255,0.3); }
.terminal-status { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:2px; color:rgba(255,255,255,0.15); }
.terminal-body { padding:1.8rem 2rem 2rem; }
.login-logo { font-family:'Orbitron',monospace; font-size:1.6rem; font-weight:800; letter-spacing:8px; text-align:center; margin-bottom:0.3rem; color:rgba(255,255,255,0.85); }
.login-subtitle { font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:3px; text-transform:uppercase; text-align:center; color:rgba(255,255,255,0.2); margin-bottom:0.8rem; }
.terminal-readout { font-family:'Space Mono',monospace; font-size:0.55rem; color:rgba(255,255,255,0.18); letter-spacing:1px; margin-bottom:1.5rem; line-height:1.8; border-top:1px solid rgba(255,255,255,0.05); border-bottom:1px solid rgba(255,255,255,0.05); padding:0.6rem 0; }
.terminal-readout span { color:rgba(255,255,255,0.35); }
.login-field { margin-bottom:1rem; }
.login-field label { display:block; font-family:'Space Mono',monospace; font-size:0.6rem; letter-spacing:2px; text-transform:uppercase; color:rgba(255,255,255,0.3); margin-bottom:0.4rem; }
.login-field label::before { content:'> '; color:rgba(255,255,255,0.15); }
.login-field input { width:100%; padding:0.75rem 0.8rem; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.8); font-family:'Space Mono',monospace; font-size:0.85rem; letter-spacing:2px; outline:none; transition:all 0.3s ease; caret-color:rgba(255,255,255,0.6); }
.login-field input:focus { border-color:rgba(255,255,255,0.2); background:rgba(255,255,255,0.05); }
.login-field input::placeholder { color:rgba(255,255,255,0.1); font-family:'Space Mono',monospace; letter-spacing:2px; }
.login-btn { width:100%; padding:0.85rem; margin-top:0.8rem; font-family:'Space Mono',monospace; font-size:0.7rem; font-weight:700; letter-spacing:4px; text-transform:uppercase; background:rgba(255,255,255,0.06); color:rgba(255,255,255,0.7); border:1px solid rgba(255,255,255,0.12); cursor:pointer; transition:all 0.3s ease; }
.login-btn:hover { background:rgba(255,255,255,0.1); border-color:rgba(255,255,255,0.25); color:rgba(255,255,255,0.9); }
@keyframes shake{0%,100%{transform:translateX(0)}15%{transform:translateX(-8px)}30%{transform:translateX(8px)}45%{transform:translateX(-5px)}60%{transform:translateX(5px)}75%{transform:translateX(-2px)}90%{transform:translateX(2px)}}
/* ── ORBITAL CONFIRMATION SYSTEM ── */
/* ── IDENTITY RESIDUE ENGINE ── */
#orbResidue { position:fixed; top:0; left:0; width:100%; height:100%; z-index:99998; pointer-events:none; display:none; }
#orbResidue.active { display:block; }
#orbResCanvas { width:100%; height:100%; }
.orb-confirm{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:99999;pointer-events:none;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s ease}
.orb-confirm.active{opacity:1}
.orb-confirm-inner{position:relative;display:flex;align-items:center;justify-content:center}
.orb-confirm-text{font-family:'Orbitron',monospace;font-weight:800;font-size:1.1rem;letter-spacing:8px;text-transform:uppercase;position:relative;white-space:nowrap;opacity:0}
.orb-confirm-scanline{position:absolute;top:0;left:-5%;width:110%;height:100%;pointer-events:none;overflow:hidden;opacity:0}
.orb-confirm-scanline::after{content:'';position:absolute;top:-100%;left:0;width:100%;height:40%;background:linear-gradient(180deg,transparent,currentColor 50%,transparent);opacity:0.08;animation:orbScan 1.5s linear infinite}
.orb-confirm-glow{position:absolute;top:50%;left:50%;width:300px;height:300px;border-radius:50%;transform:translate(-50%,-50%) scale(0);filter:blur(80px);opacity:0;transition:none}
.orb-confirm-hline{position:absolute;top:50%;left:50%;height:2px;transform:translate(-50%,-50%);opacity:0;border-radius:1px}
@keyframes orbScan{0%{top:-40%}100%{top:100%}}

.login-btn.docking { animation:crtDockPulse 0.8s ease infinite; }
.login-divider { display:flex; align-items:center; gap:1rem; margin:1.2rem 0; }
.login-divider::before,.login-divider::after { content:''; flex:1; height:1px; background:rgba(255,255,255,0.05); }
.login-divider span { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:3px; color:rgba(255,255,255,0.1); }
.login-signup { text-align:center; font-family:'Space Mono',monospace; font-size:0.65rem; color:rgba(255,255,255,0.2); letter-spacing:1px; }
.login-signup a { color:rgba(255,255,255,0.45); text-decoration:none; font-weight:700; border-bottom:1px solid rgba(255,255,255,0.1); transition:all 0.3s ease; }
.login-signup a:hover { color:rgba(255,255,255,0.8); }
.terminal-footer { border-top:1px solid rgba(255,255,255,0.04); padding:0.5rem 1rem; display:flex; justify-content:space-between; font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:2px; color:rgba(255,255,255,0.12); text-transform:uppercase; }

/* ══ DOCKING ══ */
.dock-transition { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:2000; display:none; justify-content:center; align-items:center; background:var(--void); flex-direction:column; gap:2rem; }
.dock-transition.active { display:flex; animation:fadeIn 0.3s ease; }
.dock-text { font-family:'Space Mono',monospace; font-size:0.7rem; letter-spacing:6px; text-transform:uppercase; color:var(--accent-cyan); opacity:0; animation:dockTextReveal 0.5s ease 0.5s both; position:relative; z-index:1; }
.dock-bar-container { width:200px; height:2px; background:rgba(0,229,255,0.1); border-radius:2px; overflow:hidden; opacity:0; animation:dockTextReveal 0.5s ease 0.7s both; position:relative; z-index:1; }
.dock-bar { height:100%; width:0%; background:linear-gradient(90deg,var(--accent-cyan),var(--accent-purple)); animation:dockLoad 2s ease 0.9s both; }

/* ══════════════════════════════════
   APP SHELL
══════════════════════════════════ */
.app { position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:3000; display:flex; }
.app.hidden { display:none; }
.app.active { display:flex; animation:fadeIn 0.5s ease; }

/* ══ SIDEBAR ══ */
.sidebar { width:var(--sidebar-w); background:rgba(6,13,31,0.97); border-right:1px solid var(--glass-border); padding:1.5rem 0; display:flex; flex-direction:column; flex-shrink:0; position:relative; z-index:10; }
.sidebar-logo-wrap { padding:0 1.5rem 1.2rem; border-bottom:1px solid rgba(0,229,255,0.08); margin-bottom:0.5rem; }
.sidebar-logo { font-family:'Orbitron',monospace; font-weight:800; font-size:1.2rem; letter-spacing:5px; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.sidebar-logo-sub { font-family:'Space Mono',monospace; font-size:0.48rem; letter-spacing:3px; color:rgba(232,234,246,0.2); text-transform:uppercase; margin-top:0.2rem; }
.sidebar-nav { flex:1; overflow-y:auto; padding:0.5rem 0; }
.sidebar-nav::-webkit-scrollbar { width:2px; }
.sidebar-nav::-webkit-scrollbar-thumb { background:rgba(0,229,255,0.15); border-radius:2px; }
.nav-section-label { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:4px; text-transform:uppercase; color:rgba(232,234,246,0.15); padding:1rem 1.5rem 0.4rem; }
.nav-item { display:flex; align-items:center; gap:0.75rem; padding:0.65rem 1.5rem; cursor:pointer; transition:all 0.2s ease; font-size:0.82rem; font-weight:400; color:rgba(232,234,246,0.4); letter-spacing:0.3px; border-left:2px solid transparent; position:relative; }
.nav-item:hover { background:rgba(0,229,255,0.04); color:rgba(232,234,246,0.75); border-left-color:rgba(0,229,255,0.2); }
.nav-item.active { background:rgba(0,229,255,0.07); color:var(--accent-cyan); border-left-color:var(--accent-cyan); }
.nav-item .ni { font-size:0.95rem; width:18px; text-align:center; flex-shrink:0; }
.nav-item .badge { margin-left:auto; font-family:'Space Mono',monospace; font-size:0.48rem; padding:0.15rem 0.4rem; background:rgba(0,229,255,0.1); border:1px solid rgba(0,229,255,0.2); border-radius:2px; color:var(--accent-cyan); letter-spacing:1px; }
.nav-item .badge.soon { background:rgba(124,77,255,0.1); border-color:rgba(124,77,255,0.2); color:var(--accent-purple); }
.sidebar-footer { border-top:1px solid rgba(0,229,255,0.08); padding:1rem 1.5rem 0; }
.user-card { display:flex; align-items:center; gap:0.75rem; }
.user-avatar { width:34px; height:34px; border-radius:50%; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-purple)); display:flex; align-items:center; justify-content:center; font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:700; flex-shrink:0; }
.user-name { font-size:0.82rem; font-weight:500; color:rgba(232,234,246,0.75); }
.user-tier { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:2px; color:var(--accent-cyan); text-transform:uppercase; margin-top:0.1rem; }
.undock-btn { margin-top:0.75rem; width:100%; padding:0.5rem; font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:3px; text-transform:uppercase; background:transparent; color:rgba(232,234,246,0.2); border:1px solid rgba(232,234,246,0.08); cursor:pointer; transition:all 0.2s ease; }
.undock-btn:hover { color:rgba(232,234,246,0.5); border-color:rgba(232,234,246,0.2); }

/* ══ MAIN COLUMN ══ */
.main-column { flex:1; display:flex; flex-direction:column; overflow:hidden; }

/* ══ LOCATION BAR (Item 2) ══ */
.location-bar { height:var(--topbar-h); background:rgba(6,13,31,0.9); border-bottom:1px solid rgba(0,229,255,0.08); display:flex; align-items:center; padding:0 1.5rem; gap:0.5rem; flex-shrink:0; z-index:5; }
.loc-segment { font-family:'Space Mono',monospace; font-size:0.52rem; letter-spacing:2px; text-transform:uppercase; color:rgba(232,234,246,0.2); }
.loc-segment.active { color:var(--accent-cyan); }
.loc-sep { font-size:0.5rem; color:rgba(232,234,246,0.12); }
.loc-status { margin-left:auto; display:flex; align-items:center; gap:0.4rem; font-family:'Space Mono',monospace; font-size:0.48rem; letter-spacing:2px; color:rgba(232,234,246,0.2); }
.loc-dot { width:5px; height:5px; border-radius:50%; flex-shrink:0; }
.loc-dot.green { background:var(--accent-green); box-shadow:0 0 6px rgba(0,230,118,0.5); animation:statusPulse 2s ease infinite; }
.loc-dot.yellow { background:#ffeb3b; animation:statusPulse 2s ease infinite; }

/* ══ CONTENT AREA ══ */
.content-area { flex:1; overflow:hidden; position:relative; }

/* ══ WARP FLASH OVERLAY (Item 1) ══ */
.warp-flash { position:absolute; top:0; left:0; width:100%; height:100%; z-index:100; pointer-events:none; opacity:0; background:radial-gradient(ellipse at center, rgba(0,229,255,0.15) 0%, transparent 70%); }
.warp-flash.fire { animation:warpFlash 0.4s ease forwards; }

/* ══ ROOMS ══ */
.room { position:absolute; top:0; left:0; width:100%; height:100%; overflow-y:auto; padding:2rem 2.5rem 4rem; opacity:0; transform:translateX(30px); pointer-events:none; transition:opacity 0.3s ease, transform 0.3s ease; }
.room.active { opacity:1; transform:translateX(0); pointer-events:all; }
.room.exiting { opacity:0; transform:translateX(-20px); }
.room::-webkit-scrollbar { width:4px; }
.room::-webkit-scrollbar-thumb { background:rgba(0,229,255,0.15); border-radius:2px; }

/* ══ BOOT SEQUENCE (Item 3) ══ */
.boot-section { opacity:0; transform:translateY(12px); }
.boot-section.booted { opacity:1; transform:translateY(0); transition:opacity 0.4s ease, transform 0.4s ease; }

/* ══ ROOM HEADER ══ */
.room-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:2rem; }
.room-label { font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:4px; text-transform:uppercase; color:var(--accent-cyan); opacity:0.7; margin-bottom:0.4rem; }
.room-title { font-family:'Orbitron',monospace; font-size:1.4rem; font-weight:700; letter-spacing:2px; }
.room-subtitle { font-size:0.82rem; color:rgba(232,234,246,0.35); font-weight:300; margin-top:0.3rem; }
.room-status { display:flex; align-items:center; gap:0.5rem; font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:2px; color:rgba(232,234,246,0.3); margin-top:0.3rem; }
.status-dot { width:6px; height:6px; border-radius:50%; flex-shrink:0; }
.status-dot.green { background:var(--accent-green); box-shadow:0 0 8px rgba(0,230,118,0.5); animation:statusPulse 2s ease infinite; }
.status-dot.yellow { background:#ffeb3b; box-shadow:0 0 8px rgba(255,235,59,0.4); animation:statusPulse 2s ease infinite; }

/* ══════════════════════════════════
   DASHBOARD
══════════════════════════════════ */
.stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:1rem; margin-bottom:1.5rem; }
.stat-card { background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; padding:1.4rem 1.5rem; position:relative; overflow:hidden; transition:border-color 0.2s; cursor:default; }
.stat-card:hover { border-color:rgba(0,229,255,0.3); }
.stat-card::after { content:''; position:absolute; top:0; left:0; width:100%; height:2px; }
.stat-card:nth-child(1)::after { background:linear-gradient(90deg,var(--accent-cyan),transparent); }
.stat-card:nth-child(2)::after { background:linear-gradient(90deg,var(--accent-blue),transparent); }
.stat-card:nth-child(3)::after { background:linear-gradient(90deg,var(--accent-purple),transparent); }
.stat-card:nth-child(4)::after { background:linear-gradient(90deg,var(--accent-magenta),transparent); }
.stat-label { font-family:'Space Mono',monospace; font-size:0.52rem; letter-spacing:2px; text-transform:uppercase; color:rgba(232,234,246,0.3); margin-bottom:0.7rem; }
.stat-value { font-family:'Orbitron',monospace; font-size:1.7rem; font-weight:700; color:var(--star-white); line-height:1; }
.stat-change { font-size:0.72rem; margin-top:0.5rem; }
.stat-change.up { color:var(--accent-green); }
.stat-change.neutral { color:rgba(232,234,246,0.3); }
.plat-row { display:flex; gap:0.4rem; margin-top:0.6rem; flex-wrap:wrap; }
.plat-pill { font-family:'Space Mono',monospace; font-size:0.42rem; padding:0.15rem 0.4rem; border-radius:2px; letter-spacing:1px; }
.pp-spotify { background:rgba(29,185,84,0.12); color:#1db954; border:1px solid rgba(29,185,84,0.2); }
.pp-apple { background:rgba(252,56,56,0.1); color:#fc3838; border:1px solid rgba(252,56,56,0.15); }
.pp-yt { background:rgba(255,0,0,0.1); color:#ff4444; border:1px solid rgba(255,0,0,0.15); }
.pp-ig { background:rgba(225,48,108,0.1); color:#e1306c; border:1px solid rgba(225,48,108,0.2); }
.pp-tt { background:rgba(255,255,255,0.05); color:#ccc; border:1px solid rgba(255,255,255,0.1); }
.pp-cyan { background:rgba(0,229,255,0.1); color:var(--accent-cyan); border:1px solid rgba(0,229,255,0.2); cursor:pointer; }

.dash-grid-main { display:grid; grid-template-columns:1fr 1fr 1fr; gap:1rem; margin-bottom:1.5rem; }
.panel { background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; padding:1.4rem; }
.panel-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.2rem; }
.panel-title { font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:600; letter-spacing:2px; color:var(--accent-cyan); }
.panel-badge { font-family:'Space Mono',monospace; font-size:0.48rem; padding:0.2rem 0.5rem; border:1px solid rgba(0,229,255,0.2); border-radius:2px; color:rgba(232,234,246,0.3); letter-spacing:1px; }
.panel-badge.live { border-color:rgba(0,230,118,0.3); color:var(--accent-green); animation:statusPulse 2s ease infinite; }

.mini-chart { display:flex; align-items:flex-end; gap:3px; height:60px; margin-bottom:0.8rem; }
.chart-bar { flex:1; border-radius:2px 2px 0 0; background:rgba(0,229,255,0.2); transition:background 0.2s; }
.chart-bar:hover { background:rgba(0,229,255,0.5); }
.chart-bar.highlight { background:rgba(0,229,255,0.5); }
.chart-labels { display:flex; justify-content:space-between; }
.chart-label { font-family:'Space Mono',monospace; font-size:0.42rem; color:rgba(232,234,246,0.2); }

.activity-feed { display:flex; flex-direction:column; gap:0.6rem; }
.activity-item { display:flex; align-items:flex-start; gap:0.75rem; padding:0.7rem; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); border-radius:3px; transition:border-color 0.2s; }
.activity-item:hover { border-color:rgba(0,229,255,0.1); }
.activity-icon { font-size:0.9rem; flex-shrink:0; }
.activity-dot { width:5px; height:5px; border-radius:50%; flex-shrink:0; margin-top:0.35rem; }
.activity-dot.c { background:var(--accent-cyan); } .activity-dot.p { background:var(--accent-purple); } .activity-dot.g { background:var(--accent-green); } .activity-dot.m { background:var(--accent-magenta); }
.activity-text { font-size:0.78rem; color:rgba(232,234,246,0.6); line-height:1.4; }
.activity-text strong { color:rgba(232,234,246,0.85); font-weight:500; }
.activity-time { font-family:'Space Mono',monospace; font-size:0.48rem; color:rgba(232,234,246,0.2); letter-spacing:1px; margin-top:0.2rem; }

.quick-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; }
.quick-btn { display:flex; align-items:center; gap:0.6rem; padding:0.7rem 0.8rem; background:rgba(0,229,255,0.03); border:1px solid rgba(0,229,255,0.08); border-radius:3px; cursor:pointer; transition:all 0.2s ease; }
.quick-btn:hover { border-color:rgba(0,229,255,0.2); background:rgba(0,229,255,0.07); transform:translateY(-1px); }
.quick-btn span { font-size:0.73rem; color:rgba(232,234,246,0.5); }

.dash-grid-bottom { display:grid; grid-template-columns:2fr 1fr; gap:1rem; }
.goals-list { display:flex; flex-direction:column; gap:0.8rem; }
.goal-item {}
.goal-top { display:flex; justify-content:space-between; margin-bottom:0.4rem; }
.goal-name { font-size:0.78rem; color:rgba(232,234,246,0.6); }
.goal-pct { font-family:'Space Mono',monospace; font-size:0.6rem; color:var(--accent-cyan); }
.goal-bar-bg { height:3px; background:rgba(255,255,255,0.06); border-radius:2px; overflow:hidden; }
.goal-bar-fill { height:100%; border-radius:2px; background:linear-gradient(90deg,var(--accent-cyan),var(--accent-blue)); }
.goal-bar-fill.p { background:linear-gradient(90deg,var(--accent-purple),var(--accent-magenta)); }
.goal-bar-fill.g { background:linear-gradient(90deg,var(--accent-green),var(--accent-cyan)); }
.intel-list { display:flex; flex-direction:column; gap:0.7rem; }
.intel-item { padding:0.8rem; border-left:2px solid; background:rgba(255,255,255,0.02); }
.intel-item:nth-child(1) { border-color:var(--accent-cyan); } .intel-item:nth-child(2) { border-color:var(--accent-purple); } .intel-item:nth-child(3) { border-color:var(--accent-magenta); }
.intel-time { font-family:'Space Mono',monospace; font-size:0.48rem; color:rgba(232,234,246,0.2); letter-spacing:1px; margin-bottom:0.3rem; }
.intel-text { font-size:0.78rem; color:rgba(232,234,246,0.5); line-height:1.5; }
.intel-tag { display:inline-block; font-family:'Space Mono',monospace; font-size:0.42rem; padding:0.1rem 0.35rem; border-radius:2px; margin-top:0.3rem; letter-spacing:1px; }
.intel-tag.d { background:rgba(0,229,255,0.1); color:var(--accent-cyan); }
.intel-tag.p { background:rgba(124,77,255,0.1); color:var(--accent-purple); }
.intel-tag.o { background:rgba(0,230,118,0.1); color:var(--accent-green); }

/* ══════════════════════════════════
   IDENTITY LAB
══════════════════════════════════ */
.identity-grid { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
.identity-card { background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; padding:1.5rem; }
.identity-card.full { grid-column:1/-1; }
.card-title { font-family:'Orbitron',monospace; font-size:0.7rem; font-weight:600; letter-spacing:2px; color:var(--accent-cyan); margin-bottom:0.3rem; }
.card-sub { font-size:0.75rem; color:rgba(232,234,246,0.3); margin-bottom:1.2rem; }
.platform-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:0.6rem; }
.ptile { display:flex; flex-direction:column; align-items:center; gap:0.5rem; padding:1rem 0.5rem; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06); border-radius:4px; cursor:pointer; transition:all 0.2s ease; position:relative; overflow:hidden; }
.ptile:hover { border-color:rgba(255,255,255,0.15); transform:translateY(-2px); }
.ptile.connected { border-color:rgba(0,230,118,0.2); background:rgba(0,230,118,0.03); }
.ptile.connected:hover { border-color:rgba(0,230,118,0.4); }
.ptile.expanded { grid-column:span 2; border-color:rgba(0,229,255,0.3); background:rgba(0,229,255,0.04); }
.ptile.expanded:hover { transform:none; }
.ptile-icon { font-size:1.4rem; }
.ptile-name { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:2px; text-transform:uppercase; color:rgba(232,234,246,0.4); }
.ptile-status { font-size:0.6rem; color:rgba(232,234,246,0.2); }
.ptile.connected .ptile-status { color:var(--accent-green); }
.ptile-input-wrap { display:none; width:100%; padding:0.4rem 0.3rem 0; gap:0.3rem; align-items:center; }
.ptile.expanded .ptile-input-wrap { display:flex; }
.ptile-url { flex:1; background:rgba(0,0,0,0.3); border:1px solid rgba(0,229,255,0.2); border-radius:3px; padding:0.35rem 0.5rem; color:var(--text-primary); font-family:'Space Mono',monospace; font-size:0.55rem; outline:none; transition:border-color 0.2s; }
.ptile-url:focus { border-color:rgba(0,229,255,0.5); }
.ptile-url::placeholder { color:rgba(232,234,246,0.15); }
.ptile-save-btn { background:rgba(0,230,118,0.15); border:1px solid rgba(0,230,118,0.3); color:var(--accent-green); border-radius:3px; padding:0.3rem 0.6rem; cursor:pointer; font-size:0.65rem; transition:all 0.2s; }
.ptile-save-btn:hover { background:rgba(0,230,118,0.25); }
.conn-badge { position:absolute; top:0.4rem; right:0.4rem; width:8px; height:8px; border-radius:50%; background:var(--accent-green); box-shadow:0 0 6px rgba(0,230,118,0.5); display:none; }
.ptile.connected .conn-badge { display:block; }
.form-row { margin-bottom:1rem; }
.form-label { font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:2px; text-transform:uppercase; color:rgba(232,234,246,0.3); display:flex; justify-content:space-between; margin-bottom:0.4rem; }
.form-label span { color:rgba(232,234,246,0.15); }
.form-input { width:100%; padding:0.7rem 0.9rem; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.07); color:rgba(232,234,246,0.8); font-family:'Exo 2',sans-serif; font-size:0.85rem; outline:none; transition:all 0.2s ease; resize:none; }
.form-input:focus { border-color:rgba(0,229,255,0.25); background:rgba(255,255,255,0.05); }
.form-input::placeholder { color:rgba(232,234,246,0.15); }
.genre-row { display:flex; flex-wrap:wrap; gap:0.4rem; margin-top:0.5rem; }
.genre-tag { font-family:'Space Mono',monospace; font-size:0.5rem; padding:0.3rem 0.7rem; border-radius:2px; letter-spacing:1px; border:1px solid rgba(0,229,255,0.2); color:rgba(0,229,255,0.7); background:rgba(0,229,255,0.05); cursor:pointer; transition:all 0.2s; }
.genre-tag.active { background:rgba(0,229,255,0.15); border-color:var(--accent-cyan); color:var(--accent-cyan); }
.genre-add { font-family:'Space Mono',monospace; font-size:0.5rem; padding:0.3rem 0.7rem; border-radius:2px; letter-spacing:1px; border:1px dashed rgba(255,255,255,0.1); color:rgba(232,234,246,0.2); background:transparent; cursor:pointer; transition:all 0.2s; }
.genre-add:hover { border-color:rgba(255,255,255,0.3); color:rgba(232,234,246,0.5); }
.links-list { display:flex; flex-direction:column; gap:0.5rem; margin-bottom:1rem; }
.link-row { display:flex; align-items:center; gap:0.6rem; padding:0.6rem 0.8rem; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); border-radius:3px; }
.link-icon { font-size:0.9rem; width:20px; text-align:center; flex-shrink:0; }
.link-label { font-size:0.75rem; color:rgba(232,234,246,0.6); flex:1; }
.link-url { font-family:'Space Mono',monospace; font-size:0.55rem; color:rgba(232,234,246,0.25); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:160px; }
.link-actions { display:flex; gap:0.3rem; }
.lab { font-family:'Space Mono',monospace; font-size:0.45rem; padding:0.2rem 0.4rem; background:transparent; border:1px solid rgba(255,255,255,0.08); color:rgba(232,234,246,0.3); cursor:pointer; transition:all 0.2s; letter-spacing:1px; }
.lab:hover { border-color:rgba(0,229,255,0.3); color:var(--accent-cyan); }
.add-link-btn { width:100%; padding:0.65rem; font-family:'Space Mono',monospace; font-size:0.6rem; letter-spacing:3px; text-transform:uppercase; background:transparent; color:rgba(232,234,246,0.25); border:1px dashed rgba(255,255,255,0.1); cursor:pointer; transition:all 0.2s; }
.add-link-btn:hover { border-color:rgba(0,229,255,0.25); color:rgba(0,229,255,0.6); }
.profile-preview { background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.06); border-radius:8px; padding:1.5rem; text-align:center; }
.preview-avatar { width:64px; height:64px; border-radius:50%; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-purple)); margin:0 auto 0.8rem; display:flex; align-items:center; justify-content:center; font-family:'Orbitron',monospace; font-size:1.2rem; font-weight:700; }
.preview-name { font-family:'Orbitron',monospace; font-size:1rem; font-weight:700; letter-spacing:2px; margin-bottom:0.3rem; }
.preview-handle { font-family:'Space Mono',monospace; font-size:0.6rem; color:var(--accent-cyan); letter-spacing:2px; margin-bottom:0.6rem; }
.preview-bio { font-size:0.75rem; color:rgba(232,234,246,0.4); line-height:1.6; margin-bottom:1rem; }
.preview-genres { display:flex; justify-content:center; gap:0.4rem; flex-wrap:wrap; margin-bottom:1rem; }
.preview-genre { font-family:'Space Mono',monospace; font-size:0.48rem; padding:0.2rem 0.5rem; border:1px solid rgba(0,229,255,0.2); color:rgba(0,229,255,0.6); border-radius:2px; letter-spacing:1px; }
.preview-links { display:flex; justify-content:center; gap:0.6rem; }
.preview-link-icon { font-size:1.1rem; opacity:0.6; transition:opacity 0.2s; cursor:pointer; }
.preview-link-icon:hover { opacity:1; }
.preview-label { font-family:'Space Mono',monospace; font-size:0.45rem; color:rgba(232,234,246,0.15); margin-top:0.8rem; letter-spacing:2px; text-transform:uppercase; }
.action-row { display:flex; gap:0.7rem; margin-top:1.2rem; }
.btn-primary { font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:600; letter-spacing:2px; padding:0.7rem 1.5rem; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-blue)); color:var(--void); border:none; border-radius:2px; cursor:pointer; transition:all 0.3s ease; text-transform:uppercase; }
.btn-primary:hover { transform:translateY(-1px); box-shadow:0 0 20px rgba(0,229,255,0.3); }
.btn-secondary { font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:600; letter-spacing:2px; padding:0.7rem 1.5rem; background:transparent; color:rgba(232,234,246,0.5); border:1px solid rgba(232,234,246,0.15); border-radius:2px; cursor:pointer; transition:all 0.3s ease; text-transform:uppercase; }
.btn-secondary:hover { border-color:var(--accent-cyan); color:var(--accent-cyan); }

/* ══════════════════════════════════
   STATS EXPLORER
══════════════════════════════════ */
.stats-connect-banner { background:rgba(0,229,255,0.04); border:1px solid rgba(0,229,255,0.12); border-radius:4px; padding:1.2rem 1.5rem; display:flex; align-items:center; justify-content:space-between; margin-bottom:1.5rem; }
.banner-text { font-size:0.82rem; color:rgba(232,234,246,0.5); }
.banner-text strong { color:rgba(232,234,246,0.85); }
.stats-grid-top { display:grid; grid-template-columns:repeat(3,1fr); gap:1rem; margin-bottom:1.5rem; }
.stat-big { background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; padding:1.5rem; text-align:center; position:relative; overflow:hidden; }
.stat-big::after { content:''; position:absolute; top:0; left:0; right:0; height:2px; }
.stat-big:nth-child(1)::after { background:linear-gradient(90deg,transparent,var(--accent-cyan),transparent); }
.stat-big:nth-child(2)::after { background:linear-gradient(90deg,transparent,var(--accent-purple),transparent); }
.stat-big:nth-child(3)::after { background:linear-gradient(90deg,transparent,var(--accent-magenta),transparent); }
.stat-big-num { font-family:'Orbitron',monospace; font-size:2.2rem; font-weight:800; margin-bottom:0.3rem; }
.stat-big-label { font-family:'Space Mono',monospace; font-size:0.52rem; letter-spacing:3px; text-transform:uppercase; color:rgba(232,234,246,0.3); margin-bottom:0.5rem; }
.stat-big-change { font-size:0.75rem; }
.stat-big-change.up { color:var(--accent-green); }
.stat-big-change.down { color:#ff5252; }
.stats-grid-mid { display:grid; grid-template-columns:2fr 1fr; gap:1rem; margin-bottom:1.5rem; }
.platform-breakdown { display:flex; flex-direction:column; gap:0.7rem; }
.pb-row { display:flex; align-items:center; gap:0.8rem; }
.pb-icon { font-size:1rem; width:24px; text-align:center; flex-shrink:0; }
.pb-name { font-size:0.78rem; color:rgba(232,234,246,0.5); width:80px; flex-shrink:0; }
.pb-bar-bg { flex:1; height:4px; background:rgba(255,255,255,0.06); border-radius:2px; overflow:hidden; }
.pb-bar-fill { height:100%; border-radius:2px; }
.pb-val { font-family:'Space Mono',monospace; font-size:0.58rem; color:rgba(232,234,246,0.4); width:48px; text-align:right; flex-shrink:0; }
.top-songs { display:flex; flex-direction:column; gap:0.6rem; }
.song-row { display:flex; align-items:center; gap:0.7rem; padding:0.6rem; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); border-radius:3px; }
.song-num { font-family:'Space Mono',monospace; font-size:0.55rem; color:rgba(232,234,246,0.2); width:16px; text-align:center; flex-shrink:0; }
.song-art { width:32px; height:32px; border-radius:2px; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-purple)); flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:0.8rem; }
.song-info { flex:1; }
.song-title { font-size:0.78rem; color:rgba(232,234,246,0.7); }
.song-streams { font-family:'Space Mono',monospace; font-size:0.52rem; color:rgba(232,234,246,0.25); margin-top:0.1rem; }
.song-trend { font-size:0.7rem; }
.song-trend.up { color:var(--accent-green); }

/* ══ COMING SOON ══ */
.coming-soon-room { display:flex; flex-direction:column; align-items:center; justify-content:center; height:70vh; text-align:center; }
.cs-icon { font-size:3rem; margin-bottom:1.5rem; opacity:0.4; }
.cs-title { font-family:'Orbitron',monospace; font-size:1rem; font-weight:600; letter-spacing:3px; color:rgba(232,234,246,0.4); margin-bottom:0.5rem; }
.cs-sub { font-size:0.8rem; color:rgba(232,234,246,0.2); }
.cs-badge { margin-top:1rem; font-family:'Space Mono',monospace; font-size:0.55rem; padding:0.3rem 0.8rem; border:1px solid rgba(124,77,255,0.3); color:var(--accent-purple); letter-spacing:2px; border-radius:2px; }

/* ══ MOBILE BOTTOM NAV (Item 5) ══ */
.mobile-nav { display:none; position:fixed; bottom:0; left:0; right:0; z-index:500; background:rgba(6,13,31,0.97); border-top:1px solid var(--glass-border); padding:0.5rem 0 calc(0.5rem + env(safe-area-inset-bottom)); }
.mobile-nav-inner { display:flex; justify-content:space-around; }
.mobile-nav-item { display:flex; flex-direction:column; align-items:center; gap:0.2rem; padding:0.4rem 1rem; cursor:pointer; transition:all 0.2s; }
.mobile-nav-item .mni { font-size:1.2rem; }
.mobile-nav-item .mnl { font-family:'Space Mono',monospace; font-size:0.42rem; letter-spacing:2px; text-transform:uppercase; color:rgba(232,234,246,0.25); }
.mobile-nav-item.active .mnl { color:var(--accent-cyan); }
.mobile-nav-item.active .mni { filter:drop-shadow(0 0 4px rgba(0,229,255,0.5)); }
.mobile-more-menu { display:none; position:fixed; bottom:72px; left:0; right:0; z-index:499; background:rgba(6,13,31,0.98); border-top:1px solid var(--glass-border); padding:1rem 1.5rem; }
.mobile-more-menu.open { display:block; animation:slideUp 0.2s ease; }
.mobile-more-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:0.8rem; }
.mobile-more-item { display:flex; flex-direction:column; align-items:center; gap:0.3rem; padding:0.8rem; background:rgba(0,229,255,0.03); border:1px solid rgba(0,229,255,0.08); border-radius:4px; cursor:pointer; }
.mobile-more-item .mmi-icon { font-size:1.2rem; }
.mobile-more-item .mmi-label { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:1px; text-transform:uppercase; color:rgba(232,234,246,0.35); text-align:center; }

/* ══ KEYFRAMES ══ */
@keyframes fadeIn { from{opacity:0}to{opacity:1} }
@keyframes stationMaterialize { from{opacity:0;transform:scale(0.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)} }
@keyframes termBlink { 0%,100%{opacity:1}50%{opacity:0.3} }
@keyframes crtDockPulse { 0%,100%{background:rgba(255,255,255,0.06)}50%{background:rgba(255,255,255,0.15);box-shadow:0 0 25px rgba(255,255,255,0.08)} }
@keyframes dockTextReveal { from{opacity:0}to{opacity:1} }
@keyframes dockLoad { from{width:0%}to{width:100%} }
@keyframes statusPulse { 0%,100%{opacity:1}50%{opacity:0.4} }
@keyframes warpFlash { 0%{opacity:0}20%{opacity:1}100%{opacity:0} }
@keyframes slideUp { from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)} }

/* ══════════════════════════════════
   ROYALTY COMMAND ROOM
══════════════════════════════════ */

/* ── Hero Revenue Banner ── */
.rc-hero { background:linear-gradient(135deg,rgba(0,229,255,0.06) 0%,rgba(124,77,255,0.06) 100%); border:1px solid rgba(0,229,255,0.15); border-radius:6px; padding:2rem 2.5rem; margin-bottom:1.5rem; position:relative; overflow:hidden; }
.rc-hero::before { content:''; position:absolute; top:-40px; right:-40px; width:200px; height:200px; background:radial-gradient(circle, rgba(0,229,255,0.08) 0%, transparent 70%); pointer-events:none; }
.rc-hero-label { font-family:'Space Mono',monospace; font-size:0.52rem; letter-spacing:4px; text-transform:uppercase; color:rgba(0,229,255,0.6); margin-bottom:0.6rem; }
.rc-hero-amount { font-family:'Orbitron',monospace; font-size:3rem; font-weight:900; background:linear-gradient(135deg,#00e5ff,#ff4081); -webkit-background-clip:text; -webkit-text-fill-color:transparent; line-height:1; margin-bottom:0.4rem; transition:all 0.6s ease; }
.rc-hero-sub { font-size:0.85rem; color:rgba(232,234,246,0.45); margin-bottom:1.5rem; }
.rc-hero-sub strong { color:rgba(232,234,246,0.8); }

/* Progress ring + bar */
.rc-progress-row { display:flex; align-items:center; gap:1.5rem; }
.rc-ring-wrap { position:relative; width:72px; height:72px; flex-shrink:0; }
.rc-ring-svg { transform:rotate(-90deg); }
.rc-ring-bg { fill:none; stroke:rgba(255,255,255,0.06); stroke-width:5; }
.rc-ring-fill { fill:none; stroke-width:5; stroke-linecap:round; stroke-dasharray:201; stroke-dashoffset:201; transition:stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1); }
.rc-ring-center { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; }
.rc-ring-pct { font-family:'Orbitron',monospace; font-size:0.75rem; font-weight:700; color:var(--accent-cyan); line-height:1; }
.rc-ring-label { font-family:'Space Mono',monospace; font-size:0.38rem; letter-spacing:1px; color:rgba(232,234,246,0.25); }
.rc-progress-info { flex:1; }
.rc-progress-text { font-size:0.82rem; color:rgba(232,234,246,0.5); margin-bottom:0.6rem; }
.rc-progress-text strong { color:rgba(232,234,246,0.9); }
.rc-progress-bar-bg { height:6px; background:rgba(255,255,255,0.06); border-radius:3px; overflow:hidden; margin-bottom:0.4rem; }
.rc-progress-bar-fill { height:100%; border-radius:3px; background:linear-gradient(90deg,var(--accent-cyan),var(--accent-purple)); transition:width 1.2s cubic-bezier(0.4,0,0.2,1); }
.rc-progress-counts { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:2px; color:rgba(232,234,246,0.25); }

/* ── Stream Input Panel ── */
.rc-input-banner { background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.07); border-radius:4px; padding:1.2rem 1.5rem; margin-bottom:1.5rem; display:flex; align-items:center; gap:1.5rem; flex-wrap:wrap; }
.rc-input-label { font-family:'Space Mono',monospace; font-size:0.52rem; letter-spacing:3px; text-transform:uppercase; color:rgba(232,234,246,0.3); white-space:nowrap; }
.rc-stream-inputs { display:flex; align-items:center; gap:0.8rem; flex-wrap:wrap; flex:1; }
.rc-input-group { display:flex; flex-direction:column; gap:0.3rem; }
.rc-input-sublabel { font-family:'Space Mono',monospace; font-size:0.42rem; letter-spacing:2px; color:rgba(232,234,246,0.2); }
.rc-stream-input { width:120px; padding:0.5rem 0.7rem; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.09); color:rgba(232,234,246,0.85); font-family:'Orbitron',monospace; font-size:0.8rem; letter-spacing:1px; outline:none; border-radius:2px; transition:all 0.2s; }
.rc-stream-input:focus { border-color:rgba(0,229,255,0.3); background:rgba(0,229,255,0.04); }
.rc-calc-btn { font-family:'Space Mono',monospace; font-size:0.55rem; letter-spacing:2px; padding:0.6rem 1.2rem; background:linear-gradient(135deg,rgba(0,229,255,0.15),rgba(124,77,255,0.15)); border:1px solid rgba(0,229,255,0.2); color:var(--accent-cyan); cursor:pointer; transition:all 0.2s; border-radius:2px; white-space:nowrap; }
.rc-calc-btn:hover { background:linear-gradient(135deg,rgba(0,229,255,0.25),rgba(124,77,255,0.25)); box-shadow:0 0 15px rgba(0,229,255,0.15); }

/* ── Registration Grid ── */
.rc-section-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
.rc-section-title { font-family:'Orbitron',monospace; font-size:0.7rem; font-weight:600; letter-spacing:2px; color:rgba(232,234,246,0.6); }
.rc-section-note { font-family:'Space Mono',monospace; font-size:0.48rem; letter-spacing:1px; color:rgba(232,234,246,0.2); }

.rc-reg-grid { display:flex; flex-direction:column; gap:0.6rem; margin-bottom:1.5rem; }

.rc-reg-row { display:flex; align-items:center; gap:1rem; padding:1rem 1.2rem; background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; transition:all 0.25s ease; position:relative; overflow:hidden; cursor:default; }
.rc-reg-row::before { content:''; position:absolute; left:0; top:0; bottom:0; width:3px; background:rgba(255,255,255,0.06); transition:all 0.3s ease; }
.rc-reg-row.status-registered::before { background:var(--accent-green); box-shadow:0 0 8px rgba(0,230,118,0.4); }
.rc-reg-row.status-pending::before { background:#ffeb3b; box-shadow:0 0 8px rgba(255,235,59,0.3); }
.rc-reg-row.status-locked { opacity:0.7; }
.rc-reg-row.status-locked:hover { opacity:1; border-color:rgba(0,229,255,0.2); }
.rc-reg-row.status-registered { border-color:rgba(0,230,118,0.12); background:rgba(0,230,118,0.03); }
.rc-reg-row.status-pending { border-color:rgba(255,235,59,0.12); background:rgba(255,235,59,0.02); }

.rc-reg-icon { font-size:1.4rem; width:36px; text-align:center; flex-shrink:0; }
.rc-reg-info { flex:1; min-width:0; }
.rc-reg-name { font-size:0.85rem; font-weight:500; color:rgba(232,234,246,0.85); margin-bottom:0.15rem; }
.rc-reg-desc { font-family:'Space Mono',monospace; font-size:0.48rem; letter-spacing:1px; color:rgba(232,234,246,0.25); }

.rc-reg-revenue { text-align:right; flex-shrink:0; min-width:110px; }
.rc-reg-amount { font-family:'Orbitron',monospace; font-size:0.95rem; font-weight:700; transition:all 0.5s ease; }
.rc-reg-amount.claimed { color:var(--accent-green); }
.rc-reg-amount.unlockable { color:var(--accent-cyan); }
.rc-reg-amount.locked-amt { color:rgba(232,234,246,0.2); }
.rc-reg-period { font-family:'Space Mono',monospace; font-size:0.42rem; letter-spacing:1px; color:rgba(232,234,246,0.2); margin-top:0.1rem; }

.rc-reg-action { flex-shrink:0; }
.rc-reg-btn { font-family:'Space Mono',monospace; font-size:0.52rem; letter-spacing:2px; padding:0.5rem 1rem; cursor:pointer; border-radius:2px; transition:all 0.2s; white-space:nowrap; }
.rc-reg-btn.btn-register { background:linear-gradient(135deg,rgba(0,229,255,0.12),rgba(41,121,255,0.12)); border:1px solid rgba(0,229,255,0.25); color:var(--accent-cyan); }
.rc-reg-btn.btn-register:hover { background:linear-gradient(135deg,rgba(0,229,255,0.22),rgba(41,121,255,0.22)); box-shadow:0 0 12px rgba(0,229,255,0.2); transform:translateY(-1px); }
.rc-reg-btn.btn-registered { background:rgba(0,230,118,0.08); border:1px solid rgba(0,230,118,0.2); color:var(--accent-green); cursor:default; }
.rc-reg-btn.btn-pending { background:rgba(255,235,59,0.06); border:1px solid rgba(255,235,59,0.2); color:#ffeb3b; cursor:default; }

.rc-reg-status-badge { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:2px; display:flex; align-items:center; gap:0.3rem; margin-top:0.3rem; }
.rc-reg-status-badge.green { color:var(--accent-green); }
.rc-reg-status-badge.yellow { color:#ffeb3b; }
.rc-reg-status-badge.dim { color:rgba(232,234,246,0.2); }

/* Unlock animation */
.rc-reg-row.just-unlocked { animation:rcUnlock 0.8s ease; }
@keyframes rcUnlock { 0%{box-shadow:0 0 0 rgba(0,229,255,0)} 30%{box-shadow:0 0 30px rgba(0,229,255,0.3),inset 0 0 30px rgba(0,229,255,0.05)} 100%{box-shadow:0 0 0 rgba(0,229,255,0)} }

/* ── Split Sheet Tracker ── */
.rc-split-grid { display:flex; flex-direction:column; gap:0.7rem; margin-bottom:1.5rem; }
.rc-split-card { background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; overflow:hidden; }
.rc-split-card-head { display:flex; align-items:center; gap:0.8rem; padding:0.9rem 1.2rem; border-bottom:1px solid rgba(255,255,255,0.04); cursor:pointer; }
.rc-split-card-head:hover { background:rgba(255,255,255,0.02); }
.rc-split-track-name { font-size:0.82rem; font-weight:500; color:rgba(232,234,246,0.8); flex:1; }
.rc-split-streams { font-family:'Space Mono',monospace; font-size:0.52rem; color:rgba(232,234,246,0.3); }
.rc-split-warn { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:1px; padding:0.2rem 0.5rem; border-radius:2px; }
.rc-split-warn.warn { background:rgba(255,235,59,0.08); border:1px solid rgba(255,235,59,0.2); color:#ffeb3b; }
.rc-split-warn.ok { background:rgba(0,230,118,0.06); border:1px solid rgba(0,230,118,0.15); color:var(--accent-green); }
.rc-split-chevron { font-size:0.7rem; color:rgba(232,234,246,0.2); transition:transform 0.2s; }
.rc-split-card.open .rc-split-chevron { transform:rotate(180deg); }
.rc-split-body { display:none; padding:1rem 1.2rem; }
.rc-split-card.open .rc-split-body { display:block; }
.rc-split-collaborators { display:flex; flex-direction:column; gap:0.5rem; margin-bottom:0.8rem; }
.rc-split-collab-row { display:flex; align-items:center; gap:0.8rem; }
.rc-split-collab-avatar { width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-purple)); display:flex; align-items:center; justify-content:center; font-family:'Orbitron',monospace; font-size:0.55rem; font-weight:700; flex-shrink:0; }
.rc-split-collab-name { font-size:0.78rem; color:rgba(232,234,246,0.65); flex:1; }
.rc-split-collab-role { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:1px; color:rgba(232,234,246,0.25); }
.rc-split-collab-pct { font-family:'Orbitron',monospace; font-size:0.8rem; font-weight:700; color:rgba(232,234,246,0.55); min-width:36px; text-align:right; }
.rc-split-pct-bar { height:3px; background:rgba(255,255,255,0.04); border-radius:2px; overflow:hidden; margin-top:0.6rem; display:flex; gap:2px; }
.rc-split-pct-seg { height:100%; border-radius:2px; }
.rc-split-actions-row { display:flex; gap:0.5rem; margin-top:0.8rem; }
.rc-split-tag { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:1px; padding:0.2rem 0.5rem; border-radius:2px; }
.rc-split-tag.notfiled { background:rgba(255,82,82,0.08); border:1px solid rgba(255,82,82,0.2); color:#ff5252; }
.rc-split-tag.filed { background:rgba(0,230,118,0.06); border:1px solid rgba(0,230,118,0.15); color:var(--accent-green); }

/* ── Summary Footer ── */
.rc-summary { display:grid; grid-template-columns:repeat(3,1fr); gap:1rem; margin-top:1.5rem; }
.rc-summary-card { background:var(--glass); border:1px solid var(--glass-border); border-radius:4px; padding:1.2rem; text-align:center; }
.rc-summary-card.highlight { border-color:rgba(0,229,255,0.2); background:rgba(0,229,255,0.03); }
.rc-summary-num { font-family:'Orbitron',monospace; font-size:1.4rem; font-weight:700; margin-bottom:0.3rem; }
.rc-summary-label { font-family:'Space Mono',monospace; font-size:0.48rem; letter-spacing:2px; text-transform:uppercase; color:rgba(232,234,246,0.25); }

/* ══════════════════════════════════
   ROSTER VIEW
══════════════════════════════════ */
.roster-bar {
  display: flex;
  align-items: center;
  gap: 0;
  background: rgba(2,4,8,0.97);
  border-bottom: 1px solid rgba(255,64,129,0.2);
  padding: 0 1.5rem;
  height: 44px;
  flex-shrink: 0;
  position: relative;
  z-index: 5;
}
.roster-bar-label {
  font-family: 'Space Mono', monospace;
  font-size: 0.48rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: rgba(255,64,129,0.6);
  margin-right: 1rem;
  white-space: nowrap;
  flex-shrink: 0;
}
.roster-chips {
  display: flex;
  gap: 0.4rem;
  overflow-x: auto;
  flex: 1;
  scrollbar-width: none;
}
.roster-chips::-webkit-scrollbar { display: none; }
.roster-chip {
  display: flex;
  align-items: center;
  gap: 0.45rem;
  padding: 0.3rem 0.85rem;
  border: 1px solid rgba(255,255,255,0.07);
  background: transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
  border-radius: 2px;
  position: relative;
}
.roster-chip:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.14); }
.roster-chip.active { border-color: rgba(255,64,129,0.5); background: rgba(255,64,129,0.07); }
.roster-chip.active::after { content:''; position:absolute; bottom:-1px; left:0; right:0; height:2px; background:#ff4081; }
.rc-avatar { width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.52rem; font-weight:700; font-family:'Space Mono',monospace; flex-shrink:0; }
.rc-chip-name { font-family:'Space Mono',monospace; font-size:0.58rem; letter-spacing:1px; color:rgba(232,234,246,0.5); }
.roster-chip.active .rc-chip-name { color:rgba(232,234,246,0.9); }
.rc-chip-tier { font-family:'Space Mono',monospace; font-size:0.42rem; letter-spacing:1px; padding:0.1rem 0.35rem; border-radius:2px; opacity:0.8; }
.rc-chip-tier.independent { background:rgba(0,230,118,0.15); color:#00e676; }
.rc-chip-tier.indie { background:rgba(0,229,255,0.12); color:#00e5ff; }
.rc-chip-tier.signed { background:rgba(124,77,255,0.15); color:#7c4dff; }
.rc-chip-tier.superstar { background:rgba(255,64,129,0.15); color:#ff4081; }
.roster-bar-actions { margin-left:0.75rem; display:flex; gap:0.5rem; flex-shrink:0; }
.roster-add-btn { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:2px; padding:0.3rem 0.7rem; background:transparent; border:1px solid rgba(255,64,129,0.3); color:rgba(255,64,129,0.7); cursor:pointer; transition:all 0.2s ease; border-radius:2px; }
.roster-add-btn:hover { background:rgba(255,64,129,0.08); border-color:rgba(255,64,129,0.5); color:#ff4081; }
.roster-mode-badge { font-family:'Space Mono',monospace; font-size:0.42rem; letter-spacing:2px; text-transform:uppercase; padding:0.25rem 0.6rem; border:1px solid rgba(255,64,129,0.25); color:rgba(255,64,129,0.5); border-radius:2px; }

/* Artist Context Banner */
.artist-context-banner {
  display: flex;
  align-items: center;
  gap: 1.2rem;
  background: rgba(255,64,129,0.04);
  border: 1px solid rgba(255,64,129,0.15);
  border-radius: 4px;
  padding: 0.9rem 1.2rem;
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}
.artist-context-banner::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--artist-color, #ff4081), transparent);
  opacity: 0.6;
}
.acb-avatar { width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1rem; font-weight:700; font-family:'Orbitron',monospace; flex-shrink:0; }
.acb-info { flex:1; }
.acb-name { font-family:'Orbitron',monospace; font-size:0.9rem; font-weight:700; letter-spacing:2px; margin-bottom:0.2rem; }
.acb-meta { font-family:'Space Mono',monospace; font-size:0.5rem; letter-spacing:2px; color:rgba(232,234,246,0.35); }
.acb-stats { display:flex; gap:1.5rem; flex-shrink:0; }
.acb-stat { text-align:center; }
.acb-stat-val { font-family:'Orbitron',monospace; font-size:0.78rem; font-weight:700; letter-spacing:1px; }
.acb-stat-label { font-family:'Space Mono',monospace; font-size:0.42rem; letter-spacing:2px; color:rgba(232,234,246,0.3); margin-top:0.1rem; }
.acb-label-badge { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:2px; padding:0.25rem 0.65rem; border-radius:2px; flex-shrink:0; }

/* Roster Overview Room */
.roster-overview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}
.roster-card {
  background: var(--glass);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  padding: 1.2rem;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}
.roster-card:hover { border-color: rgba(255,255,255,0.15); transform: translateY(-1px); }
.roster-card.active-artist { border-color: rgba(255,64,129,0.4); }
.roster-card::after { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:var(--artist-stripe, transparent); }
.rc-head { display:flex; align-items:center; gap:0.75rem; margin-bottom:0.9rem; }
.rc-head-avatar { width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.85rem; font-weight:700; font-family:'Orbitron',monospace; flex-shrink:0; }
.rc-head-info .rc-head-name { font-family:'Orbitron',monospace; font-size:0.75rem; font-weight:700; letter-spacing:2px; }
.rc-head-info .rc-head-label { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:2px; color:rgba(232,234,246,0.3); margin-top:0.1rem; }
.rc-stats-row { display:flex; gap:1rem; margin-bottom:0.8rem; }
.rc-mini-stat { flex:1; }
.rc-mini-stat-val { font-family:'Orbitron',monospace; font-size:0.7rem; font-weight:600; }
.rc-mini-stat-label { font-family:'Space Mono',monospace; font-size:0.4rem; letter-spacing:2px; color:rgba(232,234,246,0.3); margin-top:0.1rem; }
.rc-reg-bar { height:3px; background:rgba(255,255,255,0.06); border-radius:2px; margin-bottom:0.6rem; overflow:hidden; }
.rc-reg-bar-fill { height:100%; border-radius:2px; transition:width 0.4s ease; }
.rc-card-footer { display:flex; justify-content:space-between; align-items:center; }
.rc-card-status { font-family:'Space Mono',monospace; font-size:0.44rem; letter-spacing:2px; color:rgba(232,234,246,0.3); }
.rc-card-btn { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:1px; padding:0.25rem 0.6rem; background:transparent; border:1px solid rgba(255,255,255,0.1); color:rgba(232,234,246,0.4); cursor:pointer; border-radius:2px; transition:all 0.2s ease; }
.rc-card-btn:hover { border-color:rgba(255,255,255,0.25); color:rgba(232,234,246,0.8); }

.roster-summary-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}
.roster-sum-card {
  background: var(--glass);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  padding: 1rem 1.2rem;
  text-align: center;
}
.roster-sum-val { font-family:'Orbitron',monospace; font-size:1rem; font-weight:700; margin-bottom:0.3rem; }
.roster-sum-label { font-family:'Space Mono',monospace; font-size:0.45rem; letter-spacing:3px; text-transform:uppercase; color:rgba(232,234,246,0.3); }

@keyframes artistSwitch {
  0% { opacity:1; transform:translateX(0); }
  25% { opacity:0; transform:translateX(-8px); }
  75% { opacity:0; transform:translateX(8px); }
  100% { opacity:1; transform:translateX(0); }
}
.switching { animation: artistSwitch 0.35s ease; }

/* ══════════════════════════════════
   THE VAULT — CATALOG / PLAQUE WALL
══════════════════════════════════ */
.vault-wall {
  position: relative;
  padding: 0 0 2rem;
}

/* Wall texture background on the plaque section */
.plaque-hall {
  position: relative;
  padding: 2rem 0;
  margin-bottom: 2rem;
  border-radius: 4px;
  overflow: hidden;
}
.plaque-hall::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,0.013) 0px, rgba(255,255,255,0.013) 1px,
      transparent 1px, transparent 60px
    ),
    repeating-linear-gradient(
      0deg,
      rgba(255,255,255,0.013) 0px, rgba(255,255,255,0.013) 1px,
      transparent 1px, transparent 60px
    );
  pointer-events: none;
  z-index: 0;
}
.plaque-hall-label {
  font-family: 'Space Mono', monospace;
  font-size: 0.5rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: rgba(232,234,246,0.2);
  margin-bottom: 1.2rem;
  padding: 0 0.5rem;
  position: relative;
  z-index: 1;
}
.plaque-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 1.2rem;
  position: relative;
  z-index: 1;
}

/* Individual plaque */
.plaque {
  position: relative;
  cursor: pointer;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  transform-origin: bottom center;
}
.plaque:hover {
  transform: translateY(-6px) scale(1.02);
}
.plaque:hover .plaque-frame {
  box-shadow:
    0 20px 50px rgba(0,0,0,0.7),
    0 0 0 1px rgba(255,255,255,0.12),
    inset 0 1px 0 rgba(255,255,255,0.1);
}
.plaque-frame {
  background: linear-gradient(160deg, #1a1408 0%, #0e0c06 40%, #181410 100%);
  border: 1px solid rgba(255,210,100,0.2);
  border-radius: 3px;
  padding: 1rem 1rem 0.8rem;
  box-shadow:
    0 8px 24px rgba(0,0,0,0.6),
    0 0 0 1px rgba(255,210,100,0.08),
    inset 0 1px 0 rgba(255,210,100,0.08);
  transition: box-shadow 0.25s ease;
  position: relative;
  overflow: hidden;
}
.plaque-frame::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,210,100,0.4), transparent);
}
.plaque-frame::after {
  content: '';
  position: absolute;
  bottom: 0; left: 10%; right: 10%;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,210,100,0.15), transparent);
}

/* Plaque type indicator */
.plaque-type-bar {
  height: 3px;
  border-radius: 2px;
  margin-bottom: 0.8rem;
  position: relative;
  overflow: hidden;
}
.plaque-type-bar::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
  animation: plaqueSheen 3s ease infinite;
}
@keyframes plaqueSheen {
  0% { transform: translateX(-100%); }
  60%, 100% { transform: translateX(100%); }
}

.plaque-cover {
  width: 100%;
  aspect-ratio: 1;
  background: var(--cover-bg, linear-gradient(135deg, #2a2a2a, #111));
  border-radius: 2px;
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  position: relative;
  overflow: hidden;
}
.plaque-cover-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(160deg, rgba(255,255,255,0.05) 0%, transparent 60%);
}
.plaque-streams-badge {
  position: absolute;
  bottom: 4px;
  right: 4px;
  background: rgba(0,0,0,0.75);
  border: 1px solid rgba(255,210,100,0.2);
  font-family: 'Space Mono', monospace;
  font-size: 0.38rem;
  letter-spacing: 1px;
  color: rgba(255,210,100,0.8);
  padding: 0.15rem 0.35rem;
  border-radius: 2px;
}
.plaque-title {
  font-family: 'Orbitron', monospace;
  font-size: 0.58rem;
  font-weight: 700;
  letter-spacing: 1px;
  color: rgba(255,230,150,0.9);
  margin-bottom: 0.2rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.plaque-meta {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.3);
  margin-bottom: 0.5rem;
  display: flex;
  justify-content: space-between;
}
.plaque-certification {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-family: 'Space Mono', monospace;
  font-size: 0.45rem;
  letter-spacing: 2px;
}
.cert-icon {
  font-size: 0.75rem;
}
.cert-text {
  color: rgba(255,210,100,0.7);
}
.cert-text.platinum { color: rgba(220,230,245,0.8); }
.cert-text.diamond { color: rgba(150,220,255,0.9); }

/* Plaque wall shadow / mounting effect */
.plaque-shadow {
  height: 8px;
  background: radial-gradient(ellipse at 50% 0%, rgba(0,0,0,0.5) 0%, transparent 70%);
  margin-top: -2px;
}

/* Release detail panel — slides in from right */
.vault-detail-panel {
  position: fixed;
  top: 0;
  right: -560px;
  width: 520px;
  height: 100vh;
  background: rgba(8,12,22,0.98);
  border-left: 1px solid rgba(255,210,100,0.15);
  z-index: 4000;
  display: flex;
  flex-direction: column;
  transition: right 0.35s cubic-bezier(0.4,0,0.2,1);
  backdrop-filter: blur(20px);
  overflow-y: auto;
}
.vault-detail-panel.open {
  right: 0;
}
.vault-detail-panel::-webkit-scrollbar { width: 2px; }
.vault-detail-panel::-webkit-scrollbar-thumb { background: rgba(255,210,100,0.15); }

.vdp-header {
  padding: 1.5rem 1.5rem 1rem;
  border-bottom: 1px solid rgba(255,210,100,0.08);
  flex-shrink: 0;
}
.vdp-close {
  font-family: 'Space Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 3px;
  color: rgba(255,210,100,0.4);
  cursor: pointer;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: color 0.2s;
}
.vdp-close:hover { color: rgba(255,210,100,0.8); }
.vdp-cover-row {
  display: flex;
  gap: 1.2rem;
  align-items: flex-start;
}
.vdp-cover {
  width: 80px;
  height: 80px;
  border-radius: 3px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  border: 1px solid rgba(255,210,100,0.1);
  position: relative;
  overflow: hidden;
}
.vdp-title {
  font-family: 'Orbitron', monospace;
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 2px;
  color: rgba(255,230,150,0.95);
  margin-bottom: 0.3rem;
}
.vdp-artist {
  font-family: 'Space Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  color: rgba(232,234,246,0.4);
  margin-bottom: 0.5rem;
}
.vdp-cert-row {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}
.vdp-cert-pill {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 2px;
  padding: 0.2rem 0.5rem;
  border-radius: 2px;
  border: 1px solid rgba(255,210,100,0.2);
  color: rgba(255,210,100,0.7);
  background: rgba(255,210,100,0.05);
}
.vdp-cert-pill.platinum {
  border-color: rgba(200,210,230,0.25);
  color: rgba(200,210,230,0.8);
  background: rgba(200,210,230,0.05);
}
.vdp-cert-pill.diamond {
  border-color: rgba(130,210,255,0.3);
  color: rgba(130,210,255,0.9);
  background: rgba(130,210,255,0.05);
}

.vdp-body {
  padding: 1.2rem 1.5rem;
  flex: 1;
}
.vdp-section {
  margin-bottom: 1.5rem;
}
.vdp-section-label {
  font-family: 'Space Mono', monospace;
  font-size: 0.48rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: rgba(255,210,100,0.5);
  margin-bottom: 0.7rem;
  padding-bottom: 0.4rem;
  border-bottom: 1px solid rgba(255,210,100,0.07);
}
.vdp-stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
}
.vdp-stat {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 3px;
  padding: 0.65rem 0.75rem;
}
.vdp-stat-val {
  font-family: 'Orbitron', monospace;
  font-size: 0.85rem;
  font-weight: 700;
  color: rgba(255,230,150,0.9);
  margin-bottom: 0.2rem;
}
.vdp-stat-label {
  font-family: 'Space Mono', monospace;
  font-size: 0.4rem;
  letter-spacing: 2px;
  color: rgba(232,234,246,0.3);
}

/* Vault filter bar */
.vault-filter-bar {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  align-items: center;
}
.vault-filter-btn {
  font-family: 'Space Mono', monospace;
  font-size: 0.48rem;
  letter-spacing: 2px;
  padding: 0.3rem 0.7rem;
  border: 1px solid rgba(255,255,255,0.08);
  background: transparent;
  color: rgba(232,234,246,0.35);
  cursor: pointer;
  transition: all 0.2s ease;
  border-radius: 2px;
}
.vault-filter-btn:hover { border-color: rgba(255,210,100,0.25); color: rgba(255,210,100,0.7); }
.vault-filter-btn.active {
  background: rgba(255,210,100,0.08);
  border-color: rgba(255,210,100,0.3);
  color: rgba(255,210,100,0.9);
}
.vault-filter-sep {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  color: rgba(255,255,255,0.1);
}
.vault-label-toggle {
  margin-left: auto;
  font-family: 'Space Mono', monospace;
  font-size: 0.48rem;
  letter-spacing: 2px;
  padding: 0.3rem 0.7rem;
  border: 1px solid rgba(255,64,129,0.25);
  background: transparent;
  color: rgba(255,64,129,0.6);
  cursor: pointer;
  transition: all 0.2s ease;
  border-radius: 2px;
}
.vault-label-toggle.active {
  background: rgba(255,64,129,0.08);
  border-color: rgba(255,64,129,0.4);
  color: #ff4081;
}

/* ══════════════════════════════════
   THE STUDIO — COLLABORATION HUB
══════════════════════════════════ */
.studio-room {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

/* Session cards */
.session-grid {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}
.session-card {
  background: rgba(10,16,30,0.85);
  border: 1px solid rgba(0,229,255,0.08);
  border-radius: 4px;
  overflow: hidden;
  transition: border-color 0.2s ease;
  cursor: pointer;
}
.session-card:hover { border-color: rgba(0,229,255,0.2); }
.session-card.active-session { border-color: rgba(0,229,255,0.35); }

.session-header {
  padding: 1rem 1.2rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}
.session-status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.session-status-dot.needs-review { background: #ffeb3b; box-shadow: 0 0 6px #ffeb3b; animation: blink 2s ease infinite; }
.session-status-dot.in-progress { background: #00e5ff; box-shadow: 0 0 6px #00e5ff; }
.session-status-dot.approved { background: #00e676; box-shadow: 0 0 6px #00e676; }
.session-status-dot.delivered { background: #7c4dff; box-shadow: 0 0 6px #7c4dff; }
.session-status-dot.open { background: rgba(232,234,246,0.3); }

@keyframes blink { 0%,100% { opacity:1; } 50% { opacity:0.3; } }

.session-info { flex: 1; }
.session-name {
  font-family: 'Orbitron', monospace;
  font-size: 0.78rem;
  font-weight: 600;
  letter-spacing: 1px;
  margin-bottom: 0.15rem;
  color: rgba(232,234,246,0.9);
}
.session-meta {
  font-family: 'Space Mono', monospace;
  font-size: 0.45rem;
  letter-spacing: 2px;
  color: rgba(232,234,246,0.3);
}
.session-participants {
  display: flex;
  gap: -4px;
}
.session-participant-avatar {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: 2px solid rgba(6,13,31,0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.5rem;
  font-weight: 700;
  font-family: 'Space Mono', monospace;
  margin-left: -6px;
  flex-shrink: 0;
}
.session-participant-avatar:first-child { margin-left: 0; }

.session-status-pill {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 2px;
  padding: 0.2rem 0.5rem;
  border-radius: 2px;
  white-space: nowrap;
}
.session-status-pill.needs-review { background: rgba(255,235,59,0.12); border: 1px solid rgba(255,235,59,0.25); color: #ffeb3b; }
.session-status-pill.in-progress { background: rgba(0,229,255,0.08); border: 1px solid rgba(0,229,255,0.2); color: #00e5ff; }
.session-status-pill.approved { background: rgba(0,230,118,0.1); border: 1px solid rgba(0,230,118,0.2); color: #00e676; }
.session-status-pill.delivered { background: rgba(124,77,255,0.1); border: 1px solid rgba(124,77,255,0.2); color: #7c4dff; }
.session-status-pill.open { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); color: rgba(232,234,246,0.4); }

/* Expanded session body */
.session-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease, padding 0.35s ease;
  border-top: 0px solid rgba(0,229,255,0.08);
}
.session-card.open .session-body {
  max-height: 800px;
  padding: 1rem 1.2rem 1.2rem;
  border-top-width: 1px;
}

/* File delivery timeline */
.delivery-timeline {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin-bottom: 1rem;
  position: relative;
}
.delivery-timeline::before {
  content: '';
  position: absolute;
  left: 13px;
  top: 20px;
  bottom: 20px;
  width: 1px;
  background: rgba(0,229,255,0.1);
}
.delivery-step {
  display: flex;
  align-items: flex-start;
  gap: 0.85rem;
  padding: 0.6rem 0;
  position: relative;
}
.delivery-step-dot {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6rem;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(6,13,31,0.9);
  z-index: 1;
  position: relative;
}
.delivery-step-dot.done { border-color: rgba(0,230,118,0.4); color: #00e676; background: rgba(0,230,118,0.08); }
.delivery-step-dot.active { border-color: rgba(255,235,59,0.4); color: #ffeb3b; background: rgba(255,235,59,0.08); animation: blink 2s ease infinite; }
.delivery-step-dot.pending { border-color: rgba(255,255,255,0.07); color: rgba(232,234,246,0.2); }

.delivery-step-content { flex: 1; padding-top: 0.2rem; }
.delivery-step-title {
  font-family: 'Space Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.7);
  margin-bottom: 0.15rem;
}
.delivery-step-title.done { color: rgba(232,234,246,0.4); text-decoration: line-through; }
.delivery-step-title.active { color: rgba(232,234,246,0.9); }
.delivery-step-detail {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.25);
}
.delivery-step-detail.active { color: rgba(0,229,255,0.7); }

/* File list */
.session-files {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  margin-bottom: 0.8rem;
}
.session-file {
  display: flex;
  align-items: center;
  gap: 0.7rem;
  padding: 0.55rem 0.8rem;
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 3px;
  transition: all 0.2s ease;
}
.session-file:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.08); }
.session-file-icon {
  font-size: 1rem;
  flex-shrink: 0;
}
.session-file-info { flex: 1; }
.session-file-name {
  font-family: 'Space Mono', monospace;
  font-size: 0.52rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.7);
  margin-bottom: 0.1rem;
}
.session-file-meta {
  font-family: 'Space Mono', monospace;
  font-size: 0.4rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.25);
}
.session-file-tag {
  font-family: 'Space Mono', monospace;
  font-size: 0.4rem;
  letter-spacing: 1px;
  padding: 0.15rem 0.4rem;
  border-radius: 2px;
}
.session-file-tag.mix { background: rgba(0,229,255,0.1); color: #00e5ff; border: 1px solid rgba(0,229,255,0.2); }
.session-file-tag.stems { background: rgba(124,77,255,0.1); color: #7c4dff; border: 1px solid rgba(124,77,255,0.2); }
.session-file-tag.master { background: rgba(0,230,118,0.1); color: #00e676; border: 1px solid rgba(0,230,118,0.2); }
.session-file-tag.ref { background: rgba(255,235,59,0.1); color: #ffeb3b; border: 1px solid rgba(255,235,59,0.2); }
.session-file-download {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 1px;
  padding: 0.25rem 0.5rem;
  border: 1px solid rgba(255,255,255,0.08);
  background: transparent;
  color: rgba(232,234,246,0.35);
  cursor: pointer;
  border-radius: 2px;
  transition: all 0.2s ease;
}
.session-file-download:hover { border-color: rgba(0,229,255,0.3); color: #00e5ff; }

/* Session action buttons */
.session-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.75rem;
}
.session-btn {
  font-family: 'Space Mono', monospace;
  font-size: 0.5rem;
  letter-spacing: 2px;
  padding: 0.45rem 0.9rem;
  border-radius: 2px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.session-btn.primary {
  background: rgba(0,229,255,0.1);
  border: 1px solid rgba(0,229,255,0.3);
  color: #00e5ff;
}
.session-btn.primary:hover { background: rgba(0,229,255,0.18); }
.session-btn.approve {
  background: rgba(0,230,118,0.1);
  border: 1px solid rgba(0,230,118,0.3);
  color: #00e676;
}
.session-btn.approve:hover { background: rgba(0,230,118,0.18); }
.session-btn.secondary {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.08);
  color: rgba(232,234,246,0.4);
}
.session-btn.secondary:hover { border-color: rgba(255,255,255,0.2); color: rgba(232,234,246,0.7); }

/* New session CTA */
.new-session-cta {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem 1.2rem;
  background: rgba(0,229,255,0.03);
  border: 1px dashed rgba(0,229,255,0.15);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.new-session-cta:hover { background: rgba(0,229,255,0.06); border-color: rgba(0,229,255,0.3); }
.new-session-cta-text {
  font-family: 'Space Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  color: rgba(0,229,255,0.6);
}

/* Studio role cards */
.studio-role-row {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}
.studio-role-card {
  padding: 1rem;
  background: var(--glass);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
}
.studio-role-title {
  font-family: 'Space Mono', monospace;
  font-size: 0.52rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: rgba(232,234,246,0.5);
  margin-bottom: 0.35rem;
}
.studio-role-name {
  font-family: 'Orbitron', monospace;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 1px;
  margin-bottom: 0.25rem;
}
.studio-role-spec {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.3);
}

/* ══════════════════════════════════
   PRICING ROOM
══════════════════════════════════ */
.pricing-room {
  max-width: 960px;
}

/* Role selector tabs */
.pricing-role-tabs {
  display: flex;
  gap: 0;
  margin-bottom: 2rem;
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 4px;
  overflow: hidden;
}
.pricing-role-tab {
  flex: 1;
  padding: 0.75rem 1rem;
  font-family: 'Space Mono', monospace;
  font-size: 0.52rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s ease;
  border-right: 1px solid rgba(255,255,255,0.06);
  color: rgba(232,234,246,0.3);
}
.pricing-role-tab:last-child { border-right: none; }
.pricing-role-tab:hover { background: rgba(255,255,255,0.03); color: rgba(232,234,246,0.6); }
.pricing-role-tab.active {
  background: rgba(0,229,255,0.07);
  color: #00e5ff;
  position: relative;
}
.pricing-role-tab.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: #00e5ff;
}
.pricing-role-tab .tab-icon { font-size: 1rem; display: block; margin-bottom: 0.3rem; }

/* Base tier cards */
.pricing-base-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}
.pricing-tier-card {
  background: var(--glass);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  padding: 1.5rem;
  position: relative;
  transition: all 0.2s ease;
  cursor: pointer;
}
.pricing-tier-card:hover { border-color: rgba(255,255,255,0.15); transform: translateY(-2px); }
.pricing-tier-card.selected {
  border-color: var(--tier-color, #00e5ff);
  background: rgba(0,229,255,0.04);
}
.pricing-tier-card.featured {
  border-color: rgba(0,229,255,0.3);
}
.pricing-tier-card.featured::before {
  content: 'MOST POPULAR';
  position: absolute;
  top: -1px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Space Mono', monospace;
  font-size: 0.38rem;
  letter-spacing: 3px;
  padding: 0.2rem 0.75rem;
  background: #00e5ff;
  color: #020408;
  border-radius: 0 0 3px 3px;
  font-weight: 700;
}
.pricing-tier-name {
  font-family: 'Orbitron', monospace;
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 3px;
  margin-bottom: 0.3rem;
  color: rgba(232,234,246,0.5);
}
.pricing-tier-card.selected .pricing-tier-name { color: var(--tier-color, #00e5ff); }
.pricing-tier-price {
  font-family: 'Orbitron', monospace;
  font-size: 1.6rem;
  font-weight: 800;
  letter-spacing: -1px;
  margin-bottom: 0.2rem;
}
.pricing-tier-period {
  font-family: 'Space Mono', monospace;
  font-size: 0.45rem;
  letter-spacing: 2px;
  color: rgba(232,234,246,0.3);
  margin-bottom: 1rem;
}
.pricing-tier-features {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  margin-bottom: 1.2rem;
}
.pricing-tier-feature {
  font-family: 'Space Mono', monospace;
  font-size: 0.47rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.5);
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}
.pricing-tier-feature::before {
  content: '—';
  color: rgba(255,255,255,0.2);
  flex-shrink: 0;
}
.pricing-tier-feature.included::before { content: '✓'; color: #00e676; }
.pricing-tier-feature.excluded {
  opacity: 0.35;
  text-decoration: line-through;
}
.pricing-tier-feature.excluded::before { content: '×'; color: rgba(255,255,255,0.2); }
.pricing-select-btn {
  width: 100%;
  padding: 0.65rem;
  font-family: 'Space Mono', monospace;
  font-size: 0.52rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  border-radius: 2px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid rgba(255,255,255,0.1);
  background: transparent;
  color: rgba(232,234,246,0.5);
}
.pricing-tier-card.selected .pricing-select-btn {
  background: rgba(0,229,255,0.1);
  border-color: rgba(0,229,255,0.3);
  color: #00e5ff;
}

/* Add-on cards */
.pricing-addons-label {
  font-family: 'Space Mono', monospace;
  font-size: 0.5rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: rgba(232,234,246,0.2);
  margin-bottom: 0.75rem;
}
.pricing-addons-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 0.75rem;
  margin-bottom: 2rem;
}
.addon-card {
  background: var(--glass);
  border: 1px solid var(--glass-border);
  border-radius: 4px;
  padding: 1.1rem 1.2rem;
  display: flex;
  gap: 0.9rem;
  align-items: flex-start;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}
.addon-card:hover { border-color: rgba(255,255,255,0.12); }
.addon-card.selected { border-color: var(--addon-color, #ff4081); background: rgba(255,64,129,0.04); }
.addon-check {
  width: 18px;
  height: 18px;
  border-radius: 3px;
  border: 1px solid rgba(255,255,255,0.15);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6rem;
  margin-top: 0.1rem;
  transition: all 0.2s ease;
}
.addon-card.selected .addon-check {
  background: var(--addon-color, #ff4081);
  border-color: var(--addon-color, #ff4081);
  color: #fff;
}
.addon-info { flex: 1; }
.addon-name {
  font-family: 'Orbitron', monospace;
  font-size: 0.65rem;
  font-weight: 600;
  letter-spacing: 1px;
  margin-bottom: 0.2rem;
}
.addon-desc {
  font-family: 'Space Mono', monospace;
  font-size: 0.43rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.35);
  margin-bottom: 0.5rem;
  line-height: 1.7;
}
.addon-price {
  font-family: 'Orbitron', monospace;
  font-size: 0.75rem;
  font-weight: 700;
}
.addon-period {
  font-family: 'Space Mono', monospace;
  font-size: 0.4rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.3);
}

/* Pricing summary bar */
.pricing-summary {
  position: sticky;
  bottom: 1rem;
  background: rgba(8,12,22,0.97);
  border: 1px solid rgba(0,229,255,0.2);
  border-radius: 4px;
  padding: 1rem 1.5rem;
  display: flex;
  align-items: center;
  gap: 2rem;
  backdrop-filter: blur(20px);
  box-shadow: 0 8px 40px rgba(0,0,0,0.6);
}
.pricing-summary-total {
  flex: 1;
}
.pricing-summary-label {
  font-family: 'Space Mono', monospace;
  font-size: 0.45rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: rgba(232,234,246,0.3);
  margin-bottom: 0.2rem;
}
.pricing-summary-amount {
  font-family: 'Orbitron', monospace;
  font-size: 1.4rem;
  font-weight: 800;
  color: #00e5ff;
}
.pricing-summary-breakdown {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.3);
  margin-top: 0.15rem;
}
.pricing-cta-btn {
  font-family: 'Space Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  padding: 0.75rem 2rem;
  background: linear-gradient(135deg, #00e5ff, #2979ff);
  color: #020408;
  border: none;
  border-radius: 2px;
  cursor: pointer;
  font-weight: 700;
  transition: all 0.2s ease;
  white-space: nowrap;
}
.pricing-cta-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(0,229,255,0.3); }
.pricing-save-badge {
  font-family: 'Space Mono', monospace;
  font-size: 0.42rem;
  letter-spacing: 2px;
  padding: 0.2rem 0.5rem;
  background: rgba(0,230,118,0.1);
  border: 1px solid rgba(0,230,118,0.2);
  color: #00e676;
  border-radius: 2px;
  white-space: nowrap;
}

/* Role description panel */
.role-description {
  padding: 1rem 1.2rem;
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 4px;
  margin-bottom: 1.5rem;
  display: none;
}
.role-description.visible { display: block; }
.role-desc-title {
  font-family: 'Orbitron', monospace;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 2px;
  margin-bottom: 0.35rem;
}
.role-desc-text {
  font-family: 'Space Mono', monospace;
  font-size: 0.48rem;
  letter-spacing: 1px;
  color: rgba(232,234,246,0.4);
  line-height: 1.8;
}

/* ══ RESPONSIVE ══ */
@media (max-width:768px) {
  .sidebar { display:none; }
  .main-column { padding-bottom:72px; }
  .mobile-nav { display:block; }
  .room { padding:1.2rem 1rem 5rem; }
  .location-bar { padding:0 1rem; }
  .stats-row { grid-template-columns:1fr 1fr; }
  .dash-grid-main { grid-template-columns:1fr; }
  .dash-grid-bottom { grid-template-columns:1fr; }
  .identity-grid { grid-template-columns:1fr; }
  .platform-grid { grid-template-columns:repeat(3,1fr); }
  .stats-grid-top { grid-template-columns:1fr; }
  .stats-grid-mid { grid-template-columns:1fr; }
  .room-header { flex-direction:column; gap:0.5rem; }
  .rc-hero-amount { font-size:2rem; }
  .rc-progress-row { flex-direction:column; align-items:flex-start; }
  .rc-stream-inputs { flex-direction:column; }
  .rc-reg-row { flex-wrap:wrap; gap:0.7rem; }
  .rc-reg-revenue { min-width:80px; }
  .rc-summary { grid-template-columns:1fr; }
  /* Vault mobile */
  .plaque-grid { grid-template-columns:repeat(2,1fr); gap:0.75rem; }
  .vault-detail-panel { width:100vw; right:-100vw; }
  .vault-filter-bar { gap:0.35rem; }
  .vault-label-toggle { margin-left:0; width:100%; margin-top:0.3rem; }
  .vdp-stats-grid { grid-template-columns:repeat(2,1fr); }
  /* Studio mobile */
  .studio-role-row { grid-template-columns:1fr 1fr; }
  .session-header { flex-wrap:wrap; gap:0.5rem; }
  .session-participants { display:none; }
  .session-actions { flex-wrap:wrap; }
  .session-btn { font-size:0.45rem; padding:0.4rem 0.7rem; }
  /* Pricing mobile */
  .pricing-base-grid { grid-template-columns:1fr; gap:0.75rem; }
  .pricing-role-tabs { overflow-x:auto; }
  .pricing-role-tab { min-width:70px; padding:0.5rem 0.5rem; font-size:0.42rem; }
  .pricing-addons-grid { grid-template-columns:1fr; }
  .pricing-summary { flex-direction:column; gap:0.75rem; align-items:flex-start; }
  .pricing-cta-btn { width:100%; text-align:center; }
  .roster-overview-grid { grid-template-columns:1fr; }
  .roster-sum-cards { grid-template-columns:1fr 1fr; }
}
@media (max-width:480px) {
  .stats-row { grid-template-columns:1fr; }
  .platform-grid { grid-template-columns:repeat(2,1fr); }
  .quick-grid { grid-template-columns:1fr; }
  .plaque-grid { grid-template-columns:repeat(2,1fr); gap:0.5rem; }
  .pricing-base-grid { grid-template-columns:1fr; }
  .studio-role-row { grid-template-columns:1fr; }
  .roster-sum-cards { grid-template-columns:1fr; }
}

/* ══════════════════════════════════
   PORTAL CAROUSEL LOBBY
══════════════════════════════════ */
.carousel-lobby{position:fixed;inset:0;z-index:3500;display:none;background:var(--void);}
.carousel-lobby.active{display:block;}
#lobbyCanvas{position:absolute;inset:0;width:100%;height:100%;z-index:1;}
.cl-vignette{position:absolute;inset:0;z-index:2;pointer-events:none;background:radial-gradient(ellipse 70% 70% at 38% 48%, transparent 40%, rgba(2,4,8,.7) 100%);}
.info-panel{position:absolute;z-index:20;pointer-events:none;right:7%;top:50%;transform:translateY(-50%);width:300px;opacity:0;transition:opacity .5s ease .2s;}
.info-panel.visible{opacity:1;pointer-events:auto;}
.ip-badge{display:inline-block;font-family:'Space Mono',monospace;font-size:.45rem;letter-spacing:3px;text-transform:uppercase;padding:.25rem .7rem;border:1px solid rgba(255,255,255,.08);margin-bottom:1rem;}
.ip-name{font-family:'Orbitron',monospace;font-size:2rem;font-weight:700;letter-spacing:3px;line-height:1.15;margin-bottom:.5rem;background:linear-gradient(180deg,rgba(232,234,246,.95),rgba(232,234,246,.6));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.ip-desc{font-family:'Exo 2',sans-serif;font-size:.85rem;font-weight:300;color:rgba(232,234,246,.35);margin-bottom:1.4rem;line-height:1.5;}
.ip-meta{display:flex;flex-direction:column;gap:.65rem;margin-bottom:1.6rem;}
.ip-meta-row{display:flex;align-items:center;gap:.7rem;}
.ip-meta-line{width:16px;height:1px;}
.ip-meta-text{font-family:'Space Mono',monospace;font-size:.55rem;letter-spacing:.8px;color:rgba(232,234,246,.3);}
.ip-enter{font-family:'Space Mono',monospace;font-size:.6rem;letter-spacing:4px;text-transform:uppercase;padding:.75rem 2rem;pointer-events:auto;background:transparent;border:1px solid rgba(255,255,255,.1);cursor:pointer;transition:all .4s;color:rgba(232,234,246,.5);}
.ip-enter:hover{border-color:rgba(255,255,255,.25);color:rgba(232,234,246,.85);box-shadow:0 0 30px rgba(255,255,255,.04);letter-spacing:5px;}
.ip-enter.dimmed{opacity:.1;cursor:default;pointer-events:none;}
.ip-nav{display:flex;align-items:center;gap:1rem;margin-top:1.4rem;font-family:'Space Mono',monospace;font-size:.4rem;letter-spacing:2px;color:rgba(232,234,246,.1);text-transform:uppercase;}
.ip-nav-bar{flex:1;height:1px;background:rgba(255,255,255,.04);}
.ip-nav-fill{height:100%;background:rgba(255,255,255,.12);transition:width .4s ease;}
.cl-header{position:absolute;top:0;left:0;right:0;padding:1.5rem 2rem;display:flex;justify-content:space-between;align-items:flex-start;z-index:20;opacity:0;animation:fadeInDown .6s ease .3s forwards;pointer-events:none;}
.cl-brand{display:flex;align-items:center;gap:.8rem;}
.cl-logo{font-family:'Orbitron',monospace;font-size:1rem;font-weight:700;letter-spacing:6px;color:rgba(232,234,246,.4);}
.cl-divider{width:1px;height:24px;background:rgba(255,255,255,.06);}
.cl-sub{font-family:'Space Mono',monospace;font-size:.4rem;letter-spacing:3px;color:rgba(232,234,246,.12);text-transform:uppercase;}
.cl-user{display:flex;align-items:center;gap:.6rem;}
.cl-avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;font-family:'Orbitron',monospace;font-size:.5rem;font-weight:600;color:rgba(232,234,246,.4);}
.cl-name{font-family:'Space Mono',monospace;font-size:.45rem;letter-spacing:2px;color:rgba(232,234,246,.2);}
.nav-arrow{position:fixed;top:50%;z-index:3510;cursor:pointer;width:48px;height:48px;display:none;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.03);background:rgba(6,13,31,.3);transition:all .4s;font-family:'Exo 2',sans-serif;font-size:1.2rem;font-weight:200;color:rgba(232,234,246,.15);border-radius:50%;}
.nav-arrow:hover{border-color:rgba(255,255,255,.12);color:rgba(232,234,246,.5);}
.nav-arrow.left{left:1.5rem;transform:translateY(-50%);}
.nav-arrow.right{right:1.5rem;transform:translateY(-50%);}
.nav-arrow.show{display:flex;}
.cl-bottom{position:absolute;bottom:1.8rem;left:2rem;right:2rem;display:flex;justify-content:space-between;align-items:center;z-index:20;opacity:0;animation:fadeInUp .5s ease 1s forwards;}
.cl-bottom-left{font-family:'Space Mono',monospace;font-size:.38rem;letter-spacing:2px;color:rgba(232,234,246,.08);text-transform:uppercase;}
.cl-bottom-right{display:flex;gap:2rem;}
.cb-stat{text-align:right;}
.cb-val{font-family:'Orbitron',monospace;font-size:.65rem;font-weight:600;color:rgba(232,234,246,.2);}
.cb-lbl{font-family:'Space Mono',monospace;font-size:.32rem;letter-spacing:2px;color:rgba(232,234,246,.08);margin-top:.1rem;}
.portal-warp-overlay{position:fixed;inset:0;z-index:5000;display:none;background:radial-gradient(circle at 38% 48%,rgba(255,255,255,.85) 0%,var(--void) 55%);animation:warpFlash .7s ease forwards;}
.portal-warp-overlay.active{display:block;}
@keyframes fadeInDown{from{opacity:0;transform:translateY(-15px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
/* Sidebar lobby button */
.nav-lobby-btn{display:flex;align-items:center;gap:.75rem;padding:.65rem 1.5rem;cursor:pointer;transition:all .2s ease;font-size:.82rem;font-weight:400;color:rgba(0,229,255,.45);letter-spacing:.3px;border-left:2px solid transparent;border-top:1px solid rgba(0,229,255,.08);margin-top:.3rem;}
.nav-lobby-btn:hover{background:rgba(0,229,255,.06);color:rgba(0,229,255,.85);border-left-color:rgba(0,229,255,.3);}
.nav-lobby-btn .ni{font-size:.95rem;width:18px;text-align:center;flex-shrink:0;}
@media(max-width:768px){.info-panel{right:4%;width:220px;}.ip-name{font-size:1.3rem;}}
/* ═══ CURRICULUM — SPACE STATION LIBRARY ═══ */
.curr-tab{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);color:rgba(232,234,246,0.5);font-family:'Orbitron',monospace;font-size:0.5rem;font-weight:600;letter-spacing:1.5px;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;transition:all 0.3s}
.curr-tab:hover{border-color:rgba(0,229,255,0.3);color:rgba(232,234,246,0.8)}
.curr-tab.active{background:rgba(0,229,255,0.1);border-color:#00e5ff;color:#00e5ff;box-shadow:0 0 12px rgba(0,229,255,0.15)}
.curr-view{animation:fadeIn 0.3s ease}
/* BOOKSHELF */
.curr-shelf-label{font-family:'Orbitron',monospace;font-size:0.5rem;font-weight:600;letter-spacing:2px;color:#00e5ff;margin-bottom:0.8rem}
.curr-bookshelf{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:0.6rem}
.curr-book{position:relative;height:160px;border-radius:4px;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;justify-content:flex-end;padding:0.6rem;overflow:hidden;border:1px solid rgba(255,255,255,0.06)}
.curr-book::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,transparent 30%,rgba(0,0,0,0.7));z-index:1;border-radius:4px}
.curr-book:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 8px 25px rgba(0,0,0,0.4);border-color:rgba(0,229,255,0.3)}
.curr-book:hover .curr-book-glow{opacity:1}
.curr-book-glow{position:absolute;top:-2px;left:10%;right:10%;height:3px;border-radius:2px;opacity:0;transition:opacity 0.3s;z-index:3}
.curr-book-icon{font-size:1.4rem;position:relative;z-index:2;margin-bottom:0.3rem}
.curr-book-title{font-family:'Orbitron',monospace;font-size:0.42rem;font-weight:700;letter-spacing:1px;color:#e8eaf6;position:relative;z-index:2;line-height:1.4}
.curr-book-count{font-family:'Space Mono',monospace;font-size:0.35rem;color:rgba(232,234,246,0.3);position:relative;z-index:2;margin-top:0.2rem}
.curr-book-progress-bar{position:absolute;bottom:0;left:0;height:2px;z-index:3;transition:width 0.5s}
/* FLASHCARD */
.curr-card-area{animation:fadeIn 0.4s ease}
.curr-card-header{display:flex;align-items:center;justify-content:space-between;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.8rem}
.curr-card-book-title{font-family:'Orbitron',monospace;font-size:0.6rem;font-weight:700;letter-spacing:2px;color:#00e5ff}
.curr-card-counter{font-family:'Space Mono',monospace;font-size:0.45rem;color:rgba(232,234,246,0.4)}
.curr-close-btn{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);color:rgba(232,234,246,0.5);font-family:'Space Mono',monospace;font-size:0.4rem;padding:0.3rem 0.6rem;border-radius:4px;cursor:pointer;transition:all 0.2s}
.curr-close-btn:hover{border-color:#ff5f57;color:#ff5f57}
.curr-holo-card{perspective:1000px;width:100%;max-width:500px;height:280px;margin:0 auto;cursor:pointer;-webkit-tap-highlight-color:transparent}
.curr-holo-inner{position:relative;width:100%;height:100%;transition:transform 0.6s cubic-bezier(0.4,0,0.2,1);transform-style:preserve-3d}
.curr-holo-inner.flipped{transform:rotateY(180deg)}
.curr-holo-front,.curr-holo-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem;text-align:center}
.curr-holo-front{background:linear-gradient(135deg,rgba(0,229,255,0.08),rgba(124,77,255,0.08));border:1px solid rgba(0,229,255,0.2);box-shadow:0 0 30px rgba(0,229,255,0.08),inset 0 0 30px rgba(0,229,255,0.03)}
.curr-holo-back{background:linear-gradient(135deg,rgba(0,230,118,0.08),rgba(0,229,255,0.08));border:1px solid rgba(0,230,118,0.2);box-shadow:0 0 30px rgba(0,230,118,0.08),inset 0 0 30px rgba(0,230,118,0.03);transform:rotateY(180deg)}
.curr-card-q-label,.curr-card-a-label{font-family:'Orbitron',monospace;font-size:0.4rem;font-weight:600;letter-spacing:3px;margin-bottom:0.8rem}
.curr-card-q-label{color:#00e5ff}
.curr-card-a-label{color:#00e676}
.curr-card-q{font-family:'Space Grotesk',sans-serif;font-size:0.8rem;color:#e8eaf6;line-height:1.6;max-width:400px}
.curr-card-a{font-family:'Space Grotesk',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.9);line-height:1.6;max-width:400px}
.curr-card-tap{font-family:'Space Mono',monospace;font-size:0.35rem;color:rgba(232,234,246,0.25);margin-top:1rem;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:0.25}50%{opacity:0.6}}
.curr-card-nav{display:flex;gap:0.5rem;justify-content:center;margin-top:0.8rem}
.curr-nav-btn{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);color:rgba(232,234,246,0.5);font-family:'Space Mono',monospace;font-size:0.4rem;padding:0.4rem 1rem;border-radius:6px;cursor:pointer;transition:all 0.2s}
.curr-nav-btn:hover{border-color:rgba(0,229,255,0.3);color:#00e5ff}
.curr-know-btn{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.3);color:#00e676;font-family:'Orbitron',monospace;font-size:0.4rem;font-weight:600;padding:0.4rem 1.2rem;border-radius:6px;cursor:pointer;transition:all 0.2s}
.curr-know-btn:hover{background:rgba(0,230,118,0.2);box-shadow:0 0 12px rgba(0,230,118,0.2)}
.curr-swipe-hint{text-align:center;font-family:'Space Mono',monospace;font-size:0.35rem;color:rgba(232,234,246,0.15);margin-top:0.4rem}
/* TERMINAL */
.curr-terminal-frame{background:#0a0c14;border:1px solid rgba(0,229,255,0.15);border-radius:10px;overflow:hidden;box-shadow:0 0 40px rgba(0,229,255,0.06)}
.curr-term-header{display:flex;align-items:center;gap:0.6rem;padding:0.5rem 0.8rem;background:rgba(255,255,255,0.03);border-bottom:1px solid rgba(255,255,255,0.06)}
.curr-term-dots{display:flex;gap:5px}
.curr-term-dots span{width:10px;height:10px;border-radius:50%;display:block}
.curr-term-title{font-family:'Space Mono',monospace;font-size:0.4rem;color:rgba(232,234,246,0.3);letter-spacing:1px}
.curr-term-body{padding:1rem;min-height:200px}
.curr-term-line{font-family:'Space Mono',monospace;font-size:0.42rem;color:rgba(232,234,246,0.7);margin-bottom:0.3rem;line-height:1.6}
.curr-term-prompt{color:#00e676}
.curr-term-cmd{color:#00e5ff}
.curr-term-sys{color:rgba(232,234,246,0.3)}
.curr-quiz-select{display:flex;flex-direction:column;gap:0.4rem}
.curr-quiz-option{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);padding:0.6rem 0.8rem;border-radius:6px;cursor:pointer;transition:all 0.2s;display:flex;justify-content:space-between;align-items:center}
.curr-quiz-option:hover{border-color:rgba(0,229,255,0.3);background:rgba(0,229,255,0.04)}
.curr-quiz-option-name{font-family:'Orbitron',monospace;font-size:0.45rem;font-weight:600;color:#e8eaf6;letter-spacing:1px}
.curr-quiz-option-count{font-family:'Space Mono',monospace;font-size:0.35rem;color:rgba(232,234,246,0.3)}
.curr-quiz-active{padding:1rem}
.curr-quiz-q-num{font-family:'Space Mono',monospace;font-size:0.4rem;color:#00e5ff;margin-bottom:0.5rem}
.curr-quiz-question{font-family:'Space Grotesk',sans-serif;font-size:0.7rem;color:#e8eaf6;line-height:1.6;margin-bottom:1rem}
.curr-quiz-options{display:flex;flex-direction:column;gap:0.4rem}
.curr-quiz-opt-btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);padding:0.6rem 0.8rem;border-radius:6px;cursor:pointer;font-family:'Space Grotesk',sans-serif;font-size:0.5rem;color:rgba(232,234,246,0.7);text-align:left;transition:all 0.2s}
.curr-quiz-opt-btn:hover{border-color:rgba(0,229,255,0.3);color:#e8eaf6}
.curr-quiz-opt-btn.correct{border-color:#00e676;background:rgba(0,230,118,0.1);color:#00e676}
.curr-quiz-opt-btn.wrong{border-color:#ff5f57;background:rgba(255,95,87,0.1);color:#ff5f57}
.curr-quiz-opt-btn.disabled{pointer-events:none;opacity:0.5}
.curr-quiz-feedback{font-family:'Space Mono',monospace;font-size:0.42rem;padding:0.6rem;border-radius:6px;margin-top:0.6rem;line-height:1.5}
.curr-quiz-feedback.correct-fb{background:rgba(0,230,118,0.06);border:1px solid rgba(0,230,118,0.15);color:#00e676}
.curr-quiz-feedback.wrong-fb{background:rgba(255,95,87,0.06);border:1px solid rgba(255,95,87,0.15);color:#ff5f57}
.curr-quiz-next{background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.3);color:#00e5ff;font-family:'Orbitron',monospace;font-size:0.4rem;font-weight:600;padding:0.5rem 1.2rem;border-radius:6px;cursor:pointer;margin-top:0.6rem;transition:all 0.2s}
.curr-quiz-next:hover{background:rgba(0,229,255,0.2)}
.curr-quiz-results{text-align:center;padding:2rem 1rem}
.curr-quiz-score-label{font-family:'Orbitron',monospace;font-size:0.45rem;letter-spacing:3px;color:rgba(232,234,246,0.4);margin-bottom:0.3rem}
.curr-quiz-score{font-family:'Orbitron',monospace;font-size:2.5rem;font-weight:800;color:#00e5ff;text-shadow:0 0 20px rgba(0,229,255,0.3)}
.curr-quiz-grade{font-family:'Space Mono',monospace;font-size:0.5rem;color:rgba(232,234,246,0.5);margin:0.5rem 0 1.2rem}
.curr-quiz-retry,.curr-quiz-back{font-family:'Orbitron',monospace;font-size:0.4rem;font-weight:600;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;margin:0.3rem;transition:all 0.2s}
.curr-quiz-retry{background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.3);color:#00e5ff}
.curr-quiz-back{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);color:rgba(232,234,246,0.5)}
/* PROGRESS */
.curr-progress-header{display:flex;align-items:center;gap:1.5rem}
.curr-progress-ring-wrap{position:relative;width:120px;height:120px;flex-shrink:0}
.curr-progress-pct{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Orbitron',monospace;font-size:1.2rem;font-weight:800;color:#00e5ff}
.curr-badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:0.5rem}
.curr-badge{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:0.8rem 0.5rem;text-align:center;transition:all 0.3s}
.curr-badge.earned{border-color:rgba(255,210,100,0.3);background:rgba(255,210,100,0.04)}
.curr-badge.locked{opacity:0.3}
.curr-badge-icon{font-size:1.4rem;margin-bottom:0.3rem}
.curr-badge-name{font-family:'Orbitron',monospace;font-size:0.35rem;font-weight:600;letter-spacing:1px;color:#e8eaf6}
.curr-badge-req{font-family:'Space Mono',monospace;font-size:0.3rem;color:rgba(232,234,246,0.3);margin-top:0.2rem}
.curr-book-progress{display:flex;flex-direction:column;gap:0.4rem}
.curr-bp-row{display:flex;align-items:center;gap:0.6rem}
.curr-bp-name{font-family:'Space Mono',monospace;font-size:0.4rem;color:rgba(232,234,246,0.6);width:140px;flex-shrink:0}
.curr-bp-bar{flex:1;height:6px;background:rgba(255,255,255,0.04);border-radius:3px;overflow:hidden}
.curr-bp-fill{height:100%;border-radius:3px;transition:width 0.5s}
.curr-bp-pct{font-family:'Space Mono',monospace;font-size:0.35rem;color:rgba(232,234,246,0.3);width:35px;text-align:right}
/* CURRICULUM SPLASH — DID YOU KNOW */
.curr-splash{text-align:center;padding:2rem 1rem;animation:fadeIn 0.6s ease}
.curr-splash-inner{max-width:520px;margin:0 auto}
.curr-splash-beacon{width:60px;height:60px;margin:0 auto 1.2rem;border-radius:50%;background:radial-gradient(circle,rgba(0,229,255,0.3),transparent 70%);border:1px solid rgba(0,229,255,0.2);animation:beaconPulse 2.5s ease-in-out infinite;display:flex;align-items:center;justify-content:center}
.curr-splash-beacon::after{content:'📡';font-size:1.4rem}
@keyframes beaconPulse{0%,100%{box-shadow:0 0 20px rgba(0,229,255,0.1),0 0 40px rgba(0,229,255,0.05)}50%{box-shadow:0 0 30px rgba(0,229,255,0.25),0 0 60px rgba(0,229,255,0.1)}}
.curr-splash-label{font-family:'Orbitron',monospace;font-size:0.45rem;font-weight:700;letter-spacing:4px;color:#00e5ff;margin-bottom:1.2rem;animation:fadeIn 0.8s ease 0.3s both}
.curr-splash-fact{font-family:'Space Grotesk',sans-serif;font-size:0.85rem;color:#e8eaf6;line-height:1.7;margin-bottom:0.8rem;animation:fadeIn 0.8s ease 0.6s both}
.curr-splash-source{font-family:'Space Mono',monospace;font-size:0.38rem;color:rgba(232,234,246,0.25);margin-bottom:1.5rem;animation:fadeIn 0.8s ease 0.8s both}
.curr-splash-enter{background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.25);color:#00e5ff;font-family:'Orbitron',monospace;font-size:0.45rem;font-weight:600;letter-spacing:2px;padding:0.7rem 1.8rem;border-radius:8px;cursor:pointer;transition:all 0.3s;animation:fadeIn 0.6s ease 1s both}
.curr-splash-enter:hover{background:rgba(0,229,255,0.15);box-shadow:0 0 20px rgba(0,229,255,0.15);transform:translateY(-1px)}
.curr-main-content{transition:opacity 0.5s ease}
@media(max-width:600px){.curr-bookshelf{grid-template-columns:repeat(auto-fill,minmax(90px,1fr))}.curr-holo-card{height:240px}.curr-book{height:130px}.curr-splash-fact{font-size:0.7rem}}
/* ═══ CONTENT STUDIO — BROADCAST CONTROL ROOM ═══ */
@keyframes csPulseRec{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes csScanline{0%{top:-2px}100%{top:100%}}
.cs-monitor{background:rgba(0,0,0,0.4);border:1px solid rgba(255,171,64,0.12);border-radius:6px;overflow:hidden;position:relative}
.cs-monitor::before{content:'';position:absolute;top:-2px;left:0;right:0;height:2px;background:rgba(255,171,64,0.08);animation:csScanline 4s linear infinite;pointer-events:none;z-index:1}
.cs-monitor.main{border-color:rgba(255,171,64,0.25);box-shadow:0 0 15px rgba(255,171,64,0.05)}
.cs-monitor-label{font-family:'Orbitron',sans-serif;font-size:0.4rem;letter-spacing:2px;color:rgba(255,171,64,0.35);padding:0.35rem 0.5rem 0;text-transform:uppercase}
.cs-monitor-screen{padding:0.4rem 0.5rem 0.5rem}
.cs-feed-row{display:flex;align-items:center;gap:0.4rem;font-family:'Space Mono',monospace;font-size:0.55rem}
.cs-feed-row span:first-child{font-family:'Orbitron',sans-serif;font-size:0.4rem;letter-spacing:1px;min-width:16px}
.cs-feed-val{color:#e8eaf6;flex:1}
.cs-feed-delta{font-size:0.45rem}
.cs-feed-delta.up{color:#00e676}
.cs-plat-pill{font-size:0.4rem;font-family:'Orbitron',sans-serif;padding:0.15rem 0.35rem;border:1px solid;border-radius:10px;letter-spacing:0.5px}
.cs-tab{background:none;border:none;border-bottom:2px solid transparent;color:rgba(232,234,246,0.35);font-family:'Orbitron',sans-serif;font-size:0.55rem;letter-spacing:1px;padding:0.5rem 0.8rem;cursor:pointer;transition:all 0.2s}
.cs-tab:hover{color:rgba(232,234,246,0.6)}
.cs-tab.active{color:#ffab40;border-bottom-color:#ffab40}
.cs-tab-badge{background:rgba(255,171,64,0.2);color:#ffab40;font-size:0.4rem;padding:0.1rem 0.3rem;border-radius:8px;margin-left:0.3rem;font-family:'Space Mono',monospace}
.cs-tab-panel{display:none}
.cs-tab-panel.active{display:block}
.cs-nav-btn{background:rgba(255,171,64,0.08);border:1px solid rgba(255,171,64,0.15);color:#ffab40;padding:0.25rem 0.5rem;border-radius:4px;cursor:pointer;font-size:0.6rem;transition:background 0.2s}
.cs-nav-btn:hover{background:rgba(255,171,64,0.15)}
.cs-sync-badge{font-size:0.45rem;font-family:'Orbitron',sans-serif;color:#ff6e40;padding:0.2rem 0.5rem;border:1px solid rgba(255,110,64,0.25);border-radius:10px;cursor:pointer;transition:all 0.2s;letter-spacing:0.5px}
.cs-sync-badge:hover{background:rgba(255,110,64,0.1)}
.cs-plat-btn{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:rgba(232,234,246,0.4);padding:0.35rem 0.7rem;border-radius:20px;cursor:pointer;font-size:0.6rem;font-family:'Space Mono',monospace;transition:all 0.2s}
.cs-plat-btn.active{background:rgba(225,48,108,0.15);border-color:rgba(225,48,108,0.4);color:#e1306c}
.cs-select{background:rgba(255,255,255,0.05);border:1px solid rgba(255,171,64,0.15);color:#e8eaf6;padding:0.4rem;border-radius:6px;font-size:0.6rem;font-family:'Space Mono',monospace}
.cs-action-btn{background:rgba(255,255,255,0.03);border:1px solid;padding:0.4rem 0.8rem;border-radius:6px;cursor:pointer;font-size:0.6rem;font-family:'Space Mono',monospace;transition:all 0.2s}
.cs-action-btn:hover{background:rgba(255,255,255,0.06)}
.cs-queue-item{display:flex;align-items:center;gap:0.8rem;padding:0.6rem;border-radius:8px;margin-bottom:0.4rem;transition:all 0.2s;cursor:default}
.cs-queue-item:hover{background:rgba(255,255,255,0.03)}
.cs-queue-time{font-size:0.5rem;color:rgba(232,234,246,0.3);font-family:'Orbitron',sans-serif;min-width:50px;letter-spacing:0.5px}
.cs-queue-status{font-size:0.45rem;font-family:'Space Mono',monospace;padding:0.15rem 0.45rem;border:1px solid;border-radius:10px}
.cs-queue-sync{font-size:0.4rem;font-family:'Orbitron',sans-serif;padding:0.12rem 0.35rem;border:1px solid rgba(255,110,64,0.2);border-radius:8px;color:#ff6e40;margin-left:auto;letter-spacing:0.5px}
.cs-template-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,171,64,0.1);border-radius:6px;padding:0.5rem;cursor:pointer;transition:all 0.2s;text-align:center}
.cs-template-card:hover{border-color:rgba(255,171,64,0.3);background:rgba(255,171,64,0.04)}
.cs-tc-tone{font-family:'Orbitron',sans-serif;font-size:0.5rem;color:#ffab40;letter-spacing:1px;margin-bottom:0.15rem}
.cs-tc-type{font-size:0.45rem;color:rgba(232,234,246,0.35);font-family:'Space Mono',monospace}
.cs-equip{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:6px;padding:0.6rem;text-align:center;transition:all 0.2s}
.cs-equip:hover{border-color:rgba(255,171,64,0.15);background:rgba(255,171,64,0.02)}
.cs-equip-icon{font-size:1rem;color:rgba(255,171,64,0.3);margin-bottom:0.3rem}
.cs-equip-name{font-family:'Orbitron',sans-serif;font-size:0.5rem;color:rgba(232,234,246,0.5);letter-spacing:1px;margin-bottom:0.15rem}
.cs-equip-stat{font-size:0.42rem;color:rgba(232,234,246,0.25);font-family:'Space Mono',monospace}
/* Calendar day types */
.cs-cal-day{text-align:center;padding:0.35rem 0.15rem;border-radius:5px;font-size:0.58rem;cursor:pointer;transition:all 0.15s;position:relative}
.cs-cal-day:hover{background:rgba(255,171,64,0.1)}
.cs-cal-day.has-event{background:rgba(255,171,64,0.08);border:1px solid rgba(255,171,64,0.18);color:#ffab40}
.cs-cal-day.has-release{background:rgba(255,110,64,0.1);border:1px solid rgba(255,110,64,0.25);color:#ff6e40}
.cs-cal-day.today{box-shadow:inset 0 0 0 1px rgba(0,230,118,0.3)}
.cs-cal-day .cs-cal-dot{width:4px;height:4px;border-radius:50%;margin:2px auto 0;display:block}
/* ═══ DEFERRED BADGE ═══ */
.cs-deferred-badge{font-size:0.42rem;font-family:'Orbitron',sans-serif;color:rgba(232,234,246,0.3);padding:0.18rem 0.5rem;border:1px solid rgba(255,255,255,0.08);border-radius:10px;letter-spacing:0.5px}
/* ═══ SITE BUILDER TEMPLATE ═══ */
.sb-template-card{background:rgba(255,255,255,0.02);border:1px solid rgba(124,77,255,0.1);border-radius:8px;padding:0.6rem;cursor:pointer;transition:all 0.2s}
.sb-template-card:hover{border-color:rgba(124,77,255,0.3);background:rgba(124,77,255,0.03)}
.sb-tmpl-preview{border-radius:6px;padding:0.5rem;height:60px;display:flex;flex-direction:column;justify-content:center;align-items:center;margin-bottom:0.5rem}
.sb-tmpl-name{font-family:'Orbitron',sans-serif;font-size:0.55rem;color:rgba(232,234,246,0.6);letter-spacing:1px;margin-bottom:0.2rem}
.sb-tmpl-desc{font-size:0.45rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.4}
/* ═══ MERCH LAB TEMPLATE ═══ */
.merch-slot{background:rgba(255,255,255,0.02);border:1px solid rgba(255,210,100,0.08);border-radius:8px;padding:0.5rem;text-align:center;cursor:pointer;transition:all 0.2s}
.merch-slot:hover{border-color:rgba(255,210,100,0.2);background:rgba(255,210,100,0.02)}
.merch-slot-preview{height:55px;border-radius:6px;display:flex;align-items:center;justify-content:center;margin-bottom:0.4rem}
.merch-slot-name{font-family:'Orbitron',sans-serif;font-size:0.5rem;color:rgba(232,234,246,0.5);letter-spacing:1px;margin-bottom:0.15rem}
.merch-slot-stat{font-size:0.42rem;color:rgba(232,234,246,0.25);font-family:'Space Mono',monospace}
/* ═══ MUSIC CREATION API TEMPLATE ═══ */
.api-tool-card{background:rgba(255,255,255,0.02);border:1px solid rgba(0,188,212,0.08);border-radius:8px;padding:0.6rem;transition:all 0.2s}
.api-tool-card:hover{border-color:rgba(0,188,212,0.2);background:rgba(0,188,212,0.02)}
.api-tool-icon{width:32px;height:32px;border-radius:8px;border:1px solid;display:flex;align-items:center;justify-content:center;margin-bottom:0.4rem}
.api-tool-name{font-family:'Orbitron',sans-serif;font-size:0.55rem;color:rgba(232,234,246,0.6);letter-spacing:1px;margin-bottom:0.2rem}
.api-tool-desc{font-size:0.48rem;color:rgba(232,234,246,0.35);font-family:'Space Mono',monospace;line-height:1.4;margin-bottom:0.3rem}
.api-tool-apis{font-size:0.4rem;color:rgba(0,188,212,0.35);font-family:'Space Mono',monospace;letter-spacing:0.5px}
/* Mobile responsive for new sections */
@media(max-width:600px){
  #csMonitorWall{grid-template-columns:1fr!important}
  .cs-equip{padding:0.4rem}.cs-equip-icon{font-size:0.8rem}
  .sb-tmpl-preview{height:45px}
  .cs-template-card{padding:0.35rem}
  #csTemplateGrid{grid-template-columns:repeat(3,1fr)!important}
  .api-tool-card{padding:0.45rem}
  .merch-slot-preview{height:40px}
}
/* ── THE FREQUENCY ── */
@keyframes freqBar1{from{height:4px}to{height:16px}}
@keyframes freqBar2{from{height:6px}to{height:20px}}
@keyframes freqBar3{from{height:3px}to{height:12px}}
.freq-rotation-card{background:rgba(156,39,176,0.06);border:1px solid rgba(156,39,176,0.1);border-radius:8px;padding:0.6rem;cursor:pointer;transition:all 0.3s;text-align:center}
.freq-rotation-card:hover{background:rgba(156,39,176,0.12);border-color:rgba(156,39,176,0.25);transform:translateY(-2px)}
.freq-rotation-card.active{border-color:rgba(206,147,216,0.4);box-shadow:0 0 12px rgba(156,39,176,0.15)}
.freq-link-pill{display:inline-block;padding:0.15rem 0.5rem;border-radius:10px;font-size:0.5rem;font-family:'Space Mono',monospace;border:1px solid rgba(156,39,176,0.2);color:rgba(206,147,216,0.7);text-decoration:none;transition:all 0.2s}
.freq-link-pill:hover{background:rgba(156,39,176,0.12);color:#ce93d8;border-color:rgba(156,39,176,0.4)}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>
<canvas id="starfield"></canvas>
<canvas id="envCanvas" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1;pointer-events:none;opacity:0;transition:opacity 0.8s ease"></canvas>

<!-- ════ LOGIN ════ -->
<div class="login-overlay active" id="loginOverlay">
  <canvas id="starfield2" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;pointer-events:none;"></canvas>
  <div style="position:relative;z-index:10;">
    <div class="login-box">
      <div class="terminal-header">
        <div class="terminal-header-left">
          <div class="terminal-dot"></div><div class="terminal-dot"></div><div class="terminal-dot"></div>
          <span class="terminal-title">NASA-OrbitHQ Terminal</span>
        </div>
        <span class="terminal-status">ONLINE</span>
      </div>
      <div class="terminal-body">
        <div class="login-logo">OrbitHQ</div>
        <div class="login-subtitle">crew access terminal v2.6</div>
        <div class="terminal-readout">
          <span>SYS:</span> STATION ONLINE | <span>ORBIT:</span> NOMINAL<br>
          <span>DOCK:</span> PORT-7 AVAILABLE | <span>CREW:</span> AWAITING AUTH
        </div>
        <div class="login-field"><label>Operator ID</label><input type="text" placeholder="enter callsign..." id="loginEmail" autocomplete="off" spellcheck="false"></div>
        <div class="login-field"><label>Access Key</label><input type="password" placeholder="••••••••" id="loginPassword" autocomplete="off" onkeydown="if(event.key==='Enter')initDocking()"></div>
        <button class="login-btn" id="loginBtn" onclick="initDocking()">[ Initiate Docking ]</button>
        <div id="loginError" style="text-align:center;font-family:'Space Mono',monospace;font-size:0.6rem;letter-spacing:1px;color:#ff4444;margin-top:0.6rem;opacity:0;transition:opacity 0.3s ease;"></div>
        <div class="login-divider"><span>————</span></div>
        <div class="login-signup">No credentials? <a href="#" onclick="event.preventDefault();document.getElementById('loginError').textContent='SYS: REQUEST ACCESS AT ORBITARTS.APP';document.getElementById('loginError').style.opacity='1';document.getElementById('loginError').style.color='#88aaff';">Request Access</a></div>
      </div>
      <div class="terminal-footer">
        <span>OrbitHQ Flight Ops</span>
        <span id="terminalClock">00:00:00 UTC</span>
        <span>Orbit The Arts LLC</span>
      </div>
    </div>
  </div>
</div>

<!-- ════ DOCKING ════ -->
<div class="dock-transition" id="dockTransition">
  <canvas id="starfield3" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;pointer-events:none;"></canvas>
  <div class="dock-text">Docking to Station</div>
  <div class="dock-bar-container"><div class="dock-bar"></div></div>
</div>

<!-- ════ PORTAL CAROUSEL LOBBY ════ -->
<div class="carousel-lobby" id="carouselLobby">
  <canvas id="lobbyCanvas"></canvas>
  <div class="cl-vignette"></div>
  <div class="cl-header">
    <div class="cl-brand"><div class="cl-logo">OrbitHQ</div><div class="cl-divider"></div><div class="cl-sub">Select Destination</div></div>
    <div class="cl-user"><div class="cl-name">10eo</div><div class="cl-avatar">10</div></div>
  </div>
  <div class="info-panel" id="infoPanel">
    <div class="ip-badge" id="ipBadge">Online</div>
    <div class="ip-name" id="ipName">Dashboard</div>
    <div class="ip-desc" id="ipDesc">Mission control.</div>
    <div class="ip-meta" id="ipMeta"></div>
    <button class="ip-enter" id="ipEnter" onclick="portalEnterRoom()">Enter</button>
    <div class="ip-nav"><span id="ipCounter">1 / 14</span><div class="ip-nav-bar"><div class="ip-nav-fill" id="ipNavFill" style="width:7%"></div></div><span>Use ← → to navigate</span></div>
  </div>
  <div class="nav-arrow left" id="navArrowL" onclick="portalNavigate(-1)">‹</div>
  <div class="nav-arrow right" id="navArrowR" onclick="portalNavigate(1)">›</div>
  <div class="cl-bottom">
    <div class="cl-bottom-left">Orbit The Arts LLC · OrbitHQ Platform</div>
    <div class="cl-bottom-right">
      <div class="cb-stat"><div class="cb-val">142.8K</div><div class="cb-lbl">Streams</div></div>
      <div class="cb-stat"><div class="cb-val">$1,247</div><div class="cb-lbl">Revenue</div></div>
      <div class="cb-stat"><div class="cb-val">8</div><div class="cb-lbl">Rooms</div></div>
    </div>
  </div>
</div>
<div class="portal-warp-overlay" id="portalWarpOverlay"></div>

<!-- ════ APP ════ -->
<div class="app hidden" id="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo-wrap">
      <div class="sidebar-logo">OrbitHQ</div>
      <div class="sidebar-logo-sub">Command Center</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Mission Control</div>
      <div class="nav-item" data-room="dashboard" onclick="switchRoom('dashboard',this)"><span class="ni">◆</span> Dashboard</div>
      <div class="nav-item" data-room="vault" onclick="switchRoom('vault',this)"><span class="ni">🏆</span> The Vault <span class="badge" style="background:rgba(255,210,100,0.1);border-color:rgba(255,210,100,0.25);color:#ffd264">New</span></div>
      <div class="nav-item" data-room="studio" onclick="switchRoom('studio',this)"><span class="ni">🎛️</span> The Studio <span class="badge" style="background:rgba(0,229,255,0.08);border-color:rgba(0,229,255,0.2);color:#00e5ff">New</span></div>
      <div class="nav-item" data-room="pricing" onclick="switchRoom('pricing',this)"><span class="ni">◈</span> Plans &amp; Pricing <span class="badge" style="background:rgba(0,230,118,0.08);border-color:rgba(0,230,118,0.2);color:#00e676">New</span></div>
      <div class="nav-item" data-room="roster" onclick="if(!rosterMode)toggleRosterMode();else switchRoom('roster',this)"><span class="ni">👥</span> Roster View <span class="badge" style="background:rgba(255,64,129,0.1);border-color:rgba(255,64,129,0.25);color:#ff4081">Mgmt</span></div>
      <div class="nav-section-label">Your Identity</div>
      <div class="nav-item" data-room="identity" onclick="switchRoom('identity',this)"><span class="ni">🪪</span> Identity Lab</div>
      <div class="nav-section-label">Grow</div>
      <div class="nav-item" data-room="stats" onclick="switchRoom('stats',this)"><span class="ni">📡</span> Stats Explorer</div>
      <div class="nav-item" data-room="royalty" onclick="switchRoom('royalty',this)"><span class="ni">💰</span> Royalty Command <span class="badge" style="background:rgba(255,64,129,0.1);border-color:rgba(255,64,129,0.25);color:#ff4081">New</span></div>
      <div class="nav-item" data-room="content" onclick="switchRoom('content',this)"><span class="ni">📅</span> Content Studio</div>
      <div class="nav-item" data-room="frequency" onclick="switchRoom('frequency',this)"><span class="ni">🎧</span> The Frequency <span class="badge" style="background:rgba(156,39,176,0.1);border-color:rgba(156,39,176,0.25);color:#ce93d8">Live</span></div>
      <div class="nav-section-label">Create</div>

      <div class="nav-item" data-room="launch" onclick="switchRoom('launch',this)"><span class="ni">▲</span> Launch Pad</div>

      <div class="nav-section-label">Build</div>

      <div class="nav-section-label">Learn</div>
      <div class="nav-item" data-room="curriculum" onclick="switchRoom('curriculum',this)"><span class="ni">🎓</span> The Curriculum</div>
      <div class="nav-section-label">System</div>
      <div class="nav-item" data-room="settings" onclick="switchRoom('settings',this)"><span class="ni">⚙️</span> Settings</div>
      <div class="nav-lobby-btn" onclick="backToLobby()"><span class="ni">⬡</span> Station Lobby</div>
    </nav>
    <div class="sidebar-footer">
      <div class="user-card">
        <div class="user-avatar">A</div>
        <div><div class="user-name">Artist</div><div class="user-tier">Pro Tier</div></div>
      </div>
      <button class="undock-btn" onclick="logout()">[ Undock ]</button>
      <button class="undock-btn" id="demoModeBtn" onclick="toggleRosterMode()" style="margin-top:0.4rem;border-color:rgba(255,64,129,0.25);color:rgba(255,64,129,0.5)">[ Roster Mode ]</button>
    </div>
  </aside>

  <!-- MAIN COLUMN -->
  <div class="main-column">

    <!-- ROSTER BAR (Manager / Label Mode) -->
    <div class="roster-bar" id="rosterBar" style="display:none">
      <div class="roster-bar-label">Roster</div>
      <div class="roster-chips" id="rosterChips">
        <!-- chips injected by JS -->
      </div>
      <div class="roster-bar-actions">
        <div class="roster-mode-badge">LABEL VIEW</div>
        <button class="roster-add-btn" onclick="rosterAddArtist()">+ Artist</button>
      </div>
    </div>

    <!-- LOCATION BAR -->
    <div class="location-bar" id="locationBar">
      <span class="loc-segment">OrbitHQ</span>
      <span class="loc-sep">/</span>
      <span class="loc-segment active" id="locCurrent">Dashboard</span>
      <div class="loc-status">
        <div class="loc-dot green"></div>
        <span id="locStatusText">All Systems Operational</span>
      </div>
    </div>

    <!-- CONTENT + WARP FLASH -->
    <div class="content-area">
      <div class="warp-flash" id="warpFlash"></div>

      <!-- ── DASHBOARD ── -->
      <div class="room" id="room-dashboard">

        <div class="boot-section room-header">
          <div>
            <div class="room-label">Mission Control</div>
            <div class="room-title">Command Center</div>
            <div class="room-subtitle">Your mission briefing for today</div>
          </div>
          <div class="room-status"><div class="status-dot green"></div> All Systems Operational</div>
        </div>

        <div class="boot-section stats-row">
          <div class="stat-card">
            <div class="stat-label">Monthly Streams</div>
            <div class="stat-value">142.8K</div>
            <div class="stat-change up">↑ 12.4% this month</div>
            <div class="plat-row"><span class="plat-pill pp-spotify">Spotify</span><span class="plat-pill pp-apple">Apple</span><span class="plat-pill pp-yt">YouTube</span></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Social Reach</div>
            <div class="stat-value">89.2K</div>
            <div class="stat-change up">↑ 8.7% this month</div>
            <div class="plat-row"><span class="plat-pill pp-ig">IG</span><span class="plat-pill pp-tt">TikTok</span></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Revenue (MTD)</div>
            <div class="stat-value">$1,247</div>
            <div class="stat-change up">↑ 23.1% vs last month</div>
            <div class="plat-row"><span class="plat-pill" style="background:rgba(0,230,118,0.1);color:var(--accent-green);border:1px solid rgba(0,230,118,0.2)">Streaming</span><span class="plat-pill" style="background:rgba(124,77,255,0.1);color:var(--accent-purple);border:1px solid rgba(124,77,255,0.2)">Merch</span></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Profile Complete</div>
            <div class="stat-value">34%</div>
            <div class="stat-change neutral">→ Build Identity Lab</div>
            <div class="plat-row"><span class="plat-pill pp-cyan" onclick="switchRoom('identity',document.querySelector('[data-room=identity]'))">Set up now →</span></div>
          </div>
        </div>

        <div class="boot-section dash-grid-main">
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Stream Performance</div><div class="panel-badge">8 Weeks</div></div>
            <div class="mini-chart" id="streamChart"></div>
            <div class="chart-labels">
              <span class="chart-label">Jan 5</span><span class="chart-label">Jan 12</span><span class="chart-label">Jan 19</span><span class="chart-label">Jan 26</span>
              <span class="chart-label">Feb 2</span><span class="chart-label">Feb 9</span><span class="chart-label">Feb 16</span><span class="chart-label">Feb 22</span>
            </div>
          </div>
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Activity Feed</div><div class="panel-badge live">Live</div></div>
            <div class="activity-feed">
              <div class="activity-item"><div class="activity-dot c"></div><div class="activity-icon">📡</div><div><div class="activity-text"><strong>Stats Explorer</strong> ready — link Spotify to unlock</div><div class="activity-time">Just now</div></div></div>
              <div class="activity-item"><div class="activity-dot g"></div><div class="activity-icon">✅</div><div><div class="activity-text"><strong>OrbitHQ</strong> is live — station online</div><div class="activity-time">Today</div></div></div>
              <div class="activity-item"><div class="activity-dot p"></div><div class="activity-icon">🪪</div><div><div class="activity-text"><strong>Identity Lab</strong> waiting — build your profile</div><div class="activity-time">Today</div></div></div>
              <div class="activity-item"><div class="activity-dot m"></div><div class="activity-icon">▲</div><div><div class="activity-text"><strong>Launch Pad</strong> — distribution pipeline in build</div><div class="activity-time">This week</div></div></div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Quick Launch</div></div>
            <div class="quick-grid">
              <div class="quick-btn" onclick="switchRoom('identity',document.querySelector('[data-room=identity]'))"><span>🪪</span><span>Build Profile</span></div>
              <div class="quick-btn"><span>📤</span><span>Upload Track</span></div>
              <div class="quick-btn"><span>📅</span><span>Plan Content</span></div>
              <div class="quick-btn"><span>📝</span><span>Register Release</span></div>
              <div class="quick-btn"><span>🎓</span><span>Start Learning</span></div>
              <div class="quick-btn" onclick="switchRoom('royalty',document.querySelector('[data-room=royalty]'))"><span>💰</span><span>Royalty Cmd</span></div>
            </div>
          </div>
        </div>

        <div class="boot-section dash-grid-bottom">
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Mission Goals</div><div class="panel-badge">Q1 2026</div></div>
            <div class="goals-list">
              <div class="goal-item"><div class="goal-top"><span class="goal-name">Complete Identity Lab</span><span class="goal-pct">0%</span></div><div class="goal-bar-bg"><div class="goal-bar-fill" style="width:0%"></div></div></div>
              <div class="goal-item"><div class="goal-top"><span class="goal-name">Reach 200K Monthly Streams</span><span class="goal-pct">71%</span></div><div class="goal-bar-bg"><div class="goal-bar-fill p" style="width:71%"></div></div></div>
              <div class="goal-item"><div class="goal-top"><span class="goal-name">First Release via Launch Pad</span><span class="goal-pct">0%</span></div><div class="goal-bar-bg"><div class="goal-bar-fill g" style="width:0%"></div></div></div>
              <div class="goal-item"><div class="goal-top"><span class="goal-name">Complete Music Business 101</span><span class="goal-pct">0%</span></div><div class="goal-bar-bg"><div class="goal-bar-fill" style="width:0%"></div></div></div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Industry Intel</div><div class="panel-badge live">Live</div></div>
            <div class="intel-list">
              <div class="intel-item"><div class="intel-time">2 hours ago</div><div class="intel-text">Spotify announces updated royalty model changes effective Q2 2026</div><span class="intel-tag d">Distribution</span></div>
              <div class="intel-item"><div class="intel-time">5 hours ago</div><div class="intel-text">TikTok launches direct distribution for independent artists</div><span class="intel-tag p">Platform</span></div>
              <div class="intel-item"><div class="intel-time">Yesterday</div><div class="intel-text">New sync licensing marketplace opens for independent artists</div><span class="intel-tag o">Opportunity</span></div>
            </div>
          </div>
        </div>

      </div><!-- /dashboard -->

      <!-- ── IDENTITY LAB ── -->
      <div class="room" id="room-identity">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Your Identity</div>
            <div class="room-title">Identity Lab</div>
            <div class="room-subtitle">Link your platforms, build your profile, own your digital presence</div>
          </div>
          <div class="room-status"><div class="status-dot yellow"></div> Profile 34% Complete</div>
        </div>
        <div class="boot-section identity-grid">
          <div class="identity-card full">
            <div class="card-title">DSP Links</div>
            <div class="card-sub">Your music platforms — paste your artist/profile URL to connect</div>
            <div class="platform-grid" id="idlab-dsp-grid">
              <div class="ptile" data-key="spotify" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">🎵</div><div class="ptile-name">Spotify</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="open.spotify.com/artist/..." data-key="spotify" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="apple_music" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">🍎</div><div class="ptile-name">Apple Music</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="music.apple.com/artist/..." data-key="apple_music" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="youtube" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">▶️</div><div class="ptile-name">YouTube</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="youtube.com/@yourchannel" data-key="youtube" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="soundcloud" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">☁️</div><div class="ptile-name">SoundCloud</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="soundcloud.com/yourname" data-key="soundcloud" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="tidal" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">🌊</div><div class="ptile-name">Tidal</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="tidal.com/artist/..." data-key="tidal" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="audiomack" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">🎧</div><div class="ptile-name">Audiomack</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="audiomack.com/yourname" data-key="audiomack" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="bandcamp" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">⛺</div><div class="ptile-name">Bandcamp</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="yourname.bandcamp.com" data-key="bandcamp" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
            </div>
          </div>
          <div class="identity-card full" style="margin-top:0.8rem">
            <div class="card-title">Social Links</div>
            <div class="card-sub">Your social profiles — paste your profile URL to connect</div>
            <div class="platform-grid" id="idlab-social-grid">
              <div class="ptile" data-key="instagram" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">📸</div><div class="ptile-name">Instagram</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="instagram.com/yourhandle" data-key="instagram" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="tiktok" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">🎵</div><div class="ptile-name">TikTok</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="tiktok.com/@yourhandle" data-key="tiktok" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="twitter" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">𝕏</div><div class="ptile-name">X / Twitter</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="x.com/yourhandle" data-key="twitter" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
              <div class="ptile" data-key="facebook" onclick="idlabTogglePlatform(this)"><div class="conn-badge"></div><div class="ptile-icon">👤</div><div class="ptile-name">Facebook</div><div class="ptile-status">+ Connect</div><div class="ptile-input-wrap"><input class="ptile-url" type="url" placeholder="facebook.com/yourpage" data-key="facebook" onkeydown="if(event.key==='Enter')idlabCommitPlatform(this)"/><button class="ptile-save-btn" onclick="event.stopPropagation();idlabCommitPlatform(this.previousElementSibling)">✓</button></div></div>
            </div>
          </div>
        </div>
        <div class="boot-section identity-grid" style="margin-top:1.5rem">
          <div class="identity-card">
            <div class="card-title">Artist Bio</div>
            <div class="card-sub">Used across your profile, EPK, and site builder</div>
            <div class="form-row"><div class="form-label">Artist / Stage Name <span>Required</span></div><input class="form-input" id="idlab-name" type="text" placeholder="Your artist name..."/></div>
            <div class="form-row"><div class="form-label">Artist Type</div><input class="form-input" id="idlab-type" type="text" placeholder="DJ, Producer, Singer, Songwriter..."/></div>
            <div class="form-row"><div class="form-label">Location</div><input class="form-input" id="idlab-location" type="text" placeholder="City, State or Country..."/></div>
            <div class="form-row"><div class="form-label">Website</div><input class="form-input" id="idlab-website" type="text" placeholder="https://yoursite.com"/></div>
            <div class="form-row"><div class="form-label">Bio <span id="idlab-bio-count">0 / 800</span></div><textarea class="form-input" id="idlab-bio" rows="4" placeholder="Your artist story for press, EPK, and your site..." oninput="document.getElementById('idlab-bio-count').textContent=this.value.length+' / 800'"></textarea></div>
            <div class="form-row">
              <div class="form-label">Genres</div>
              <div class="genre-row">
                <span class="genre-tag active">Hip-Hop</span><span class="genre-tag">R&B</span><span class="genre-tag">Pop</span><span class="genre-tag">Electronic</span><span class="genre-tag">Soul</span><span class="genre-tag">Trap</span><span class="genre-tag">Afrobeats</span>
                <button class="genre-add">+ Add genre</button>
              </div>
            </div>
            <div class="action-row"><button class="btn-primary" id="idlab-save-btn" onclick="idlabSaveProfile()">Save Profile</button></div>
          </div>
          <div class="identity-card">
            <div class="card-title">Profile Preview</div>
            <div class="card-sub">How your profile appears to others</div>
            <div class="profile-preview">
              <div class="preview-avatar" id="idlab-preview-avatar">A</div>
              <div class="preview-name" id="idlab-preview-name">Artist Name</div>
              <div class="preview-handle" id="idlab-preview-handle">@yourhandle</div>
              <div class="preview-bio" id="idlab-preview-bio">Your bio will appear here once you fill in the form. Keep it punchy.</div>
              <div class="preview-genres" id="idlab-preview-genres"><span class="preview-genre">Hip-Hop</span><span class="preview-genre">R&B</span></div>
              <div class="preview-links" id="idlab-preview-links"><span style="color:rgba(232,234,246,0.15);font-size:0.5rem">No platforms connected</span></div>
              <div class="preview-label">orbitarts.app/your-name</div>
            </div>
          </div>
        </div>
        <div class="boot-section identity-grid" style="margin-top:1.5rem">
          <div class="identity-card full">
            <div class="card-title">Link Aggregator</div>
            <div class="card-sub">Your personal link page at orbitarts.app/your-name — one link for everything</div>
            <div class="links-list">
              <div class="link-row"><span class="link-icon">🎵</span><span class="link-label">Spotify</span><span class="link-url">open.spotify.com/artist/...</span><div class="link-actions"><button class="lab">Edit</button><button class="lab">↑</button><button class="lab">↓</button></div></div>
              <div class="link-row"><span class="link-icon">📸</span><span class="link-label">Instagram</span><span class="link-url">instagram.com/yourhandle</span><div class="link-actions"><button class="lab">Edit</button><button class="lab">↑</button><button class="lab">↓</button></div></div>
              <div class="link-row" style="opacity:0.4"><span class="link-icon">▶️</span><span class="link-label">YouTube</span><span class="link-url">Not connected</span><div class="link-actions"><button class="lab">+ Add</button></div></div>
            </div>
            <button class="add-link-btn">+ Add Custom Link</button>
            <div class="action-row"><button class="btn-primary">Publish Link Page</button><button class="btn-secondary">Copy Link</button></div>
          </div>
        </div>
        <!-- ═══ SITE BUILDER — ARTIST WEBSITE GENERATOR ═══ -->
        <div class="boot-section identity-grid" style="margin-top:1.5rem">
          <div class="identity-card full" style="border-color:rgba(124,77,255,0.15)">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="card-title" style="color:#7c4dff">Site Builder</div>
              <div style="display:flex;gap:0.5rem;align-items:center">
                <div style="display:flex;align-items:center;gap:0.3rem;padding:0.2rem 0.5rem;border:1px solid rgba(124,77,255,0.2);border-radius:10px">
                  <div style="width:5px;height:5px;border-radius:50%;background:rgba(124,77,255,0.5)"></div>
                  <span style="font-size:0.42rem;font-family:'Space Mono',monospace;color:rgba(124,77,255,0.6);letter-spacing:1px">NOT PUBLISHED</span>
                </div>
              </div>
            </div>
            <div class="card-sub">Generate a custom artist website from your OrbitHQ profile — hosted at orbitarts.app/yourname</div>
            <!-- Template Picker -->
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.6rem;margin-top:0.8rem">
              <div class="sb-template-card" onclick="this.style.borderColor='rgba(124,77,255,0.5)';this.style.boxShadow='0 0 12px rgba(124,77,255,0.1)'" style="position:relative">
                <div style="position:absolute;top:0.3rem;right:0.3rem;font-size:0.35rem;font-family:'Orbitron',sans-serif;color:rgba(124,77,255,0.5);letter-spacing:1px;padding:0.1rem 0.3rem;border:1px solid rgba(124,77,255,0.2);border-radius:4px">POPULAR</div>
                <div class="sb-tmpl-preview" style="background:linear-gradient(135deg,rgba(124,77,255,0.15),rgba(0,176,255,0.1))">
                  <div style="width:100%;height:3px;background:rgba(124,77,255,0.4);border-radius:2px;margin-bottom:4px"></div>
                  <div style="width:60%;height:2px;background:rgba(255,255,255,0.1);border-radius:2px;margin-bottom:6px"></div>
                  <div style="width:80%;height:14px;background:rgba(255,255,255,0.05);border-radius:3px;margin-bottom:4px"></div>
                  <div style="display:flex;gap:3px"><div style="flex:1;height:8px;background:rgba(124,77,255,0.1);border-radius:2px"></div><div style="flex:1;height:8px;background:rgba(124,77,255,0.1);border-radius:2px"></div></div>
                </div>
                <div class="sb-tmpl-name">Minimal</div>
                <div class="sb-tmpl-desc">Clean, text-forward. Bio + links + latest release</div>
              </div>
              <div class="sb-template-card">
                <div class="sb-tmpl-preview" style="background:linear-gradient(135deg,rgba(255,110,64,0.15),rgba(255,171,64,0.1))">
                  <div style="width:100%;height:18px;background:rgba(255,110,64,0.12);border-radius:3px;margin-bottom:4px"></div>
                  <div style="width:70%;height:2px;background:rgba(255,255,255,0.1);border-radius:2px;margin-bottom:3px"></div>
                  <div style="width:50%;height:2px;background:rgba(255,255,255,0.06);border-radius:2px;margin-bottom:5px"></div>
                  <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:2px"><div style="height:10px;background:rgba(255,110,64,0.1);border-radius:2px"></div><div style="height:10px;background:rgba(255,110,64,0.1);border-radius:2px"></div><div style="height:10px;background:rgba(255,110,64,0.1);border-radius:2px"></div></div>
                </div>
                <div class="sb-tmpl-name">Showcase</div>
                <div class="sb-tmpl-desc">Hero image, discography grid, video embeds</div>
              </div>
              <div class="sb-template-card">
                <div class="sb-tmpl-preview" style="background:linear-gradient(135deg,rgba(0,230,118,0.1),rgba(0,176,255,0.08))">
                  <div style="display:flex;gap:3px;margin-bottom:4px"><div style="flex:1;height:20px;background:rgba(0,230,118,0.08);border-radius:3px"></div><div style="width:30%;height:20px;background:rgba(0,176,255,0.08);border-radius:3px"></div></div>
                  <div style="width:100%;height:2px;background:rgba(255,255,255,0.06);border-radius:2px;margin-bottom:3px"></div>
                  <div style="display:flex;gap:2px"><div style="flex:1;height:6px;background:rgba(0,230,118,0.06);border-radius:2px"></div><div style="flex:1;height:6px;background:rgba(0,230,118,0.06);border-radius:2px"></div><div style="flex:1;height:6px;background:rgba(0,230,118,0.06);border-radius:2px"></div><div style="flex:1;height:6px;background:rgba(0,230,118,0.06);border-radius:2px"></div></div>
                </div>
                <div class="sb-tmpl-name">EPK Pro</div>
                <div class="sb-tmpl-desc">Electronic press kit: bio, stats, press photos, contact</div>
              </div>
            </div>
            <!-- Auto-populate data sources -->
            <div style="margin-top:0.8rem;display:grid;grid-template-columns:repeat(4,1fr);gap:0.4rem">
              <div style="background:rgba(124,77,255,0.03);border:1px solid rgba(124,77,255,0.08);border-radius:6px;padding:0.4rem;text-align:center">
                <div style="font-size:0.5rem;margin-bottom:0.15rem">🎭</div>
                <div style="font-family:'Orbitron',monospace;font-size:0.38rem;color:rgba(124,77,255,0.5);letter-spacing:0.5px">IDENTITY LAB</div>
                <div style="font-size:0.35rem;color:rgba(232,234,246,0.25);font-family:'Space Mono',monospace;margin-top:0.1rem">Bio · Links · Genre</div>
              </div>
              <div style="background:rgba(0,229,255,0.03);border:1px solid rgba(0,229,255,0.08);border-radius:6px;padding:0.4rem;text-align:center">
                <div style="font-size:0.5rem;margin-bottom:0.15rem">🗄️</div>
                <div style="font-family:'Orbitron',monospace;font-size:0.38rem;color:rgba(0,229,255,0.5);letter-spacing:0.5px">THE VAULT</div>
                <div style="font-size:0.35rem;color:rgba(232,234,246,0.25);font-family:'Space Mono',monospace;margin-top:0.1rem">Discography · Art</div>
              </div>
              <div style="background:rgba(41,121,255,0.03);border:1px solid rgba(41,121,255,0.08);border-radius:6px;padding:0.4rem;text-align:center">
                <div style="font-size:0.5rem;margin-bottom:0.15rem">📊</div>
                <div style="font-family:'Orbitron',monospace;font-size:0.38rem;color:rgba(41,121,255,0.5);letter-spacing:0.5px">STATS EXPLORER</div>
                <div style="font-size:0.35rem;color:rgba(232,234,246,0.25);font-family:'Space Mono',monospace;margin-top:0.1rem">Streaming numbers</div>
              </div>
              <div style="background:rgba(255,210,100,0.03);border:1px solid rgba(255,210,100,0.08);border-radius:6px;padding:0.4rem;text-align:center">
                <div style="font-size:0.5rem;margin-bottom:0.15rem">🛍️</div>
                <div style="font-family:'Orbitron',monospace;font-size:0.38rem;color:rgba(255,210,100,0.5);letter-spacing:0.5px">MERCH LAB</div>
                <div style="font-size:0.35rem;color:rgba(232,234,246,0.25);font-family:'Space Mono',monospace;margin-top:0.1rem">Product embeds</div>
              </div>
            </div>
            <!-- Publish controls -->
            <div style="margin-top:0.7rem;display:flex;gap:0.5rem;align-items:center">
              <button onclick="alert('Select a template above, then customize and publish')" style="flex:1;padding:0.55rem;background:rgba(124,77,255,0.12);border:1px solid rgba(124,77,255,0.3);border-radius:6px;color:#b388ff;font-family:'Orbitron',monospace;font-size:0.55rem;letter-spacing:2px;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='rgba(124,77,255,0.2)'" onmouseout="this.style.background='rgba(124,77,255,0.12)'">SELECT TEMPLATE & CUSTOMIZE</button>
              <button onclick="alert('Preview — select template first')" style="padding:0.55rem 1rem;background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:rgba(232,234,246,0.4);font-family:'Space Mono',monospace;font-size:0.5rem;letter-spacing:1px;cursor:pointer;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(255,255,255,0.2)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">Preview ↗</button>
            </div>
            <!-- How It Works -->
            <div style="margin-top:0.6rem;padding:0.5rem;background:rgba(124,77,255,0.02);border:1px solid rgba(124,77,255,0.06);border-radius:6px">
              <div style="display:flex;gap:0.6rem;justify-content:space-between">
                <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">①</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Pick a template</div></div>
                <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">②</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Auto-fills from your rooms</div></div>
                <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">③</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Customize colors & layout</div></div>
                <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">④</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Publish at orbitarts.app/you</div></div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /identity -->

      <!-- ── STATS EXPLORER ── -->
      <div class="room" id="room-stats">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Analytics</div>
            <div class="room-title">Stats Explorer</div>
            <div class="room-subtitle">Deep analytics across all platforms in one view</div>
          </div>
          <div class="room-status"><div class="status-dot yellow"></div> 1 of 11 platforms connected</div>
        </div>
        <div class="boot-section stats-connect-banner">
          <div class="banner-text"><strong>Connect more platforms</strong> to unlock full analytics — currently showing Spotify only</div>
          <button class="btn-primary" onclick="switchRoom('identity',document.querySelector('[data-room=identity]'))">+ Connect Platforms</button>
        </div>
        <div class="boot-section stats-grid-top">
          <div class="stat-big">
            <div class="stat-big-label">Total Streams (All Time)</div>
            <div class="stat-big-num" style="background:linear-gradient(135deg,var(--accent-cyan),var(--accent-blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent">2.4M</div>
            <div class="stat-big-change up">↑ 142.8K this month</div>
          </div>
          <div class="stat-big">
            <div class="stat-big-label">Monthly Listeners</div>
            <div class="stat-big-num" style="background:linear-gradient(135deg,var(--accent-purple),var(--accent-magenta));-webkit-background-clip:text;-webkit-text-fill-color:transparent">38.4K</div>
            <div class="stat-big-change up">↑ 4.2K vs last month</div>
          </div>
          <div class="stat-big">
            <div class="stat-big-label">Followers (All Platforms)</div>
            <div class="stat-big-num" style="background:linear-gradient(135deg,var(--accent-magenta),var(--accent-cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent">89.2K</div>
            <div class="stat-big-change up">↑ 1.8K this week</div>
          </div>
        </div>
        <div class="boot-section stats-grid-mid">
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Streams by Platform</div><div class="panel-badge">This Month</div></div>
            <div class="platform-breakdown">
              <div class="pb-row"><span class="pb-icon">🎵</span><span class="pb-name">Spotify</span><div class="pb-bar-bg"><div class="pb-bar-fill" style="width:68%;background:linear-gradient(90deg,#1db954,#1ed760)"></div></div><span class="pb-val">97.1K</span></div>
              <div class="pb-row"><span class="pb-icon">▶️</span><span class="pb-name">YouTube</span><div class="pb-bar-bg"><div class="pb-bar-fill" style="width:22%;background:linear-gradient(90deg,#ff0000,#ff4444)"></div></div><span class="pb-val">31.4K</span></div>
              <div class="pb-row"><span class="pb-icon">🍎</span><span class="pb-name">Apple Music</span><div class="pb-bar-bg"><div class="pb-bar-fill" style="width:10%;background:linear-gradient(90deg,#fc3838,#ff6b6b)"></div></div><span class="pb-val">14.3K</span></div>
              <div class="pb-row" style="opacity:0.35"><span class="pb-icon">☁️</span><span class="pb-name">SoundCloud</span><div class="pb-bar-bg"><div class="pb-bar-fill" style="width:0%;background:#ff5500"></div></div><span class="pb-val">— </span></div>
              <div class="pb-row" style="opacity:0.35"><span class="pb-icon">🌊</span><span class="pb-name">Tidal</span><div class="pb-bar-bg"><div class="pb-bar-fill" style="width:0%;background:#00bcd4"></div></div><span class="pb-val">—</span></div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-head"><div class="panel-title">Top Tracks</div><div class="panel-badge">Spotify</div></div>
            <div class="top-songs">
              <div class="song-row"><span class="song-num">1</span><div class="song-art">🎵</div><div class="song-info"><div class="song-title">Untitled Track 01</div><div class="song-streams">48.2K streams</div></div><span class="song-trend up">↑</span></div>
              <div class="song-row"><span class="song-num">2</span><div class="song-art">🎶</div><div class="song-info"><div class="song-title">Untitled Track 02</div><div class="song-streams">31.7K streams</div></div><span class="song-trend up">↑</span></div>
              <div class="song-row"><span class="song-num">3</span><div class="song-art">🎵</div><div class="song-info"><div class="song-title">Untitled Track 03</div><div class="song-streams">17.1K streams</div></div><span class="song-trend up">↑</span></div>
              <div class="song-row"><span class="song-num">4</span><div class="song-art">🎶</div><div class="song-info"><div class="song-title">Untitled Track 04</div><div class="song-streams">12.4K streams</div></div><span class="song-trend up">↑</span></div>
            </div>
          </div>
        </div>
      </div><!-- /stats -->

      <!-- ── ROYALTY COMMAND ── -->
      <div class="room" id="room-royalty">

        <div class="boot-section room-header">
          <div>
            <div class="room-label">Revenue Intelligence</div>
            <div class="room-title">Royalty Command</div>
            <div class="room-subtitle">Every stream earns money in multiple ways — here's what you're collecting vs. leaving on the table</div>
          </div>
          <div class="room-status"><div class="status-dot yellow" id="rc-status-dot"></div> <span id="rc-status-text">3 of 11 revenue streams active</span></div>
        </div>

        <!-- ARTIST CONTEXT BANNER (Roster Mode) -->
        <div class="boot-section artist-context-banner" id="artistContextBanner" style="display:none">
          <div class="acb-avatar" id="acbAvatar">?</div>
          <div class="acb-info">
            <div class="acb-name" id="acbName">—</div>
            <div class="acb-meta" id="acbMeta">—</div>
          </div>
          <div class="acb-stats" id="acbStats">
            <!-- injected by JS -->
          </div>
          <div class="acb-label-badge" id="acbLabelBadge">—</div>
        </div>

        <!-- HERO REVENUE BANNER -->
        <div class="boot-section rc-hero">
          <div class="rc-hero-label">Estimated Annual Revenue Unlocked</div>
          <div class="rc-hero-amount" id="rc-claimed-total">$0</div>
          <div class="rc-hero-sub">Based on your stream counts. You're currently leaving <strong id="rc-unclaimed-text">$0/yr</strong> uncollected — register to claim it.</div>
          <div class="rc-progress-row">
            <div class="rc-ring-wrap">
              <svg class="rc-ring-svg" width="72" height="72" viewBox="0 0 72 72">
                <circle class="rc-ring-bg" cx="36" cy="36" r="32"/>
                <circle class="rc-ring-fill" id="rc-ring-fill" cx="36" cy="36" r="32" stroke="url(#ringGrad)"/>
                <defs>
                  <linearGradient id="ringGrad" x1="0" y1="0" x2="1" y2="0">
                    <stop offset="0%" stop-color="#00e5ff"/>
                    <stop offset="100%" stop-color="#7c4dff"/>
                  </linearGradient>
                </defs>
              </svg>
              <div class="rc-ring-center"><div class="rc-ring-pct" id="rc-ring-pct">0%</div><div class="rc-ring-label">CLAIMED</div></div>
            </div>
            <div class="rc-progress-info">
              <div class="rc-progress-text"><strong id="rc-completed-count">0</strong> of <strong id="rc-total-count">11</strong> registrations complete</div>
              <div class="rc-progress-bar-bg"><div class="rc-progress-bar-fill" id="rc-progress-bar" style="width:0%"></div></div>
              <div class="rc-progress-counts" id="rc-progress-label">Complete all registrations to maximize your royalty collection</div>
            </div>
          </div>
        </div>

        <!-- STREAM INPUT PANEL -->
        <div class="boot-section rc-input-banner">
          <div class="rc-input-label">Your Stream Counts</div>
          <div class="rc-stream-inputs">
            <div class="rc-input-group">
              <div class="rc-input-sublabel">Spotify / mo</div>
              <input class="rc-stream-input" id="rc-spotify-streams" type="text" value="142,800" oninput="rcRecalculate()">
            </div>
            <div class="rc-input-group">
              <div class="rc-input-sublabel">YouTube views / mo</div>
              <input class="rc-stream-input" id="rc-yt-views" type="text" value="31,400" oninput="rcRecalculate()">
            </div>
            <div class="rc-input-group">
              <div class="rc-input-sublabel">Apple Music / mo</div>
              <input class="rc-stream-input" id="rc-apple-streams" type="text" value="14,300" oninput="rcRecalculate()">
            </div>
            <button class="rc-calc-btn" onclick="rcRecalculate()">Recalculate ↻</button>
          </div>
        </div>

        <!-- REGISTRATION GRID -->
        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">Recording Rights (Your Master)</div>
            <div class="rc-section-note">Paid to you as the recording artist</div>
          </div>
          <div class="rc-reg-grid" id="rc-grid-master"></div>
        </div>

        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">Publishing Rights (Your Songs)</div>
            <div class="rc-section-note">Paid to you as songwriter / composer</div>
          </div>
          <div class="rc-reg-grid" id="rc-grid-publishing"></div>
        </div>

        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">Sync &amp; Additional</div>
            <div class="rc-section-note">Licensing, neighboring rights, supplemental income</div>
          </div>
          <div class="rc-reg-grid" id="rc-grid-sync"></div>
        </div>

        <!-- SPLIT SHEET TRACKER -->
        <div class="boot-section">
          <div class="rc-section-header" style="margin-top:0.5rem">
            <div class="rc-section-title">Split Sheet Tracker</div>
            <div class="rc-section-note">Unregistered splits = uncollected royalties</div>
          </div>
          <div class="rc-split-grid" id="rc-split-grid"></div>
          <button class="add-link-btn" style="margin-top:0.5rem">+ Add Track / Upload Split Sheet</button>
        </div>

        <!-- SUMMARY ROW -->
        <div class="boot-section rc-summary">
          <div class="rc-summary-card highlight">
            <div class="rc-summary-num" id="rc-sum-claimed" style="color:var(--accent-green)">$0</div>
            <div class="rc-summary-label">Annual Claimed</div>
          </div>
          <div class="rc-summary-card">
            <div class="rc-summary-num" id="rc-sum-unclaimed" style="color:#ff4081">$0</div>
            <div class="rc-summary-label">Annual Unclaimed</div>
          </div>
          <div class="rc-summary-card">
            <div class="rc-summary-num" id="rc-sum-total" style="color:var(--accent-cyan)">$0</div>
            <div class="rc-summary-label">Total Potential</div>
          </div>
        </div>

      </div><!-- /royalty -->

      <!-- ── COMING SOON ── -->
      <!-- ── ROSTER OVERVIEW ── -->
      <div class="room" id="room-roster">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Label / Management</div>
            <div class="room-title">Roster Command</div>
            <div class="room-subtitle">Your full artist roster — royalty health, registration status, and revenue at a glance</div>
          </div>
          <div class="room-status"><div class="status-dot" id="roster-status-dot" style="background:#ff4081;box-shadow:0 0 6px #ff4081"></div> <span id="roster-status-text">4 Artists · Roster View Active</span></div>
        </div>

        <!-- Roster Summary Stats -->
        <div class="boot-section roster-summary-row" id="rosterSummaryRow">
          <!-- injected by JS -->
        </div>

        <!-- Roster Cards Grid -->
        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">All Artists</div>
            <div class="rc-section-note">Click an artist to view their full command center</div>
          </div>
          <div class="roster-overview-grid" id="rosterOverviewGrid">
            <!-- injected by JS -->
          </div>
        </div>

        <!-- Roster Royalty Comparison Table -->
        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">Royalty Gap Analysis</div>
            <div class="rc-section-note">Uncollected revenue across roster — sorted by opportunity</div>
          </div>
          <div id="rosterGapTable" style="display:flex;flex-direction:column;gap:0.5rem;">
            <!-- injected by JS -->
          </div>
        </div>
      </div>

      <!-- ── THE VAULT — CATALOG / PLAQUE WALL ── -->
      <div class="room" id="room-vault">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Your Legacy</div>
            <div class="room-title">The Vault</div>
            <div class="room-subtitle">Every release — streaming history, splits, royalty status, and certification</div>
          </div>
          <div class="room-status"><div class="status-dot" style="background:#ffd264;box-shadow:0 0 6px #ffd264"></div> <span id="vault-status-text">32 releases · 4 artists</span></div>
        </div>

        <!-- Filter bar -->
        <div class="boot-section vault-filter-bar">
          <button class="vault-filter-btn active" onclick="vaultFilter('all',this)">All</button>
          <button class="vault-filter-btn" onclick="vaultFilter('albums',this)">Albums</button>
          <button class="vault-filter-btn" onclick="vaultFilter('singles',this)">Singles</button>
          <button class="vault-filter-btn" onclick="vaultFilter('eps',this)">EPs</button>
          <div class="vault-filter-sep">|</div>
          <button class="vault-filter-btn" onclick="vaultFilter('gold',this)">🥇 Gold+</button>
          <button class="vault-filter-btn" onclick="vaultFilter('platinum',this)">🪙 Platinum+</button>
          <button class="vault-label-toggle" id="vaultLabelToggle" onclick="vaultToggleLabel()">Label View: OFF</button>
        </div>

        <!-- Plaque Hall — Main Artist -->
        <div class="boot-section" id="vaultHallMain">
          <!-- injected by JS -->
        </div>

        <!-- Label Catalog View (all artists) -->
        <div id="vaultLabelSection" style="display:none">
          <!-- injected per artist by JS -->
        </div>

        <!-- Release Detail Panel -->
        <div class="vault-detail-panel" id="vaultDetailPanel">
          <div class="vdp-header">
            <div class="vdp-close" onclick="vaultCloseDetail()">← CLOSE RELEASE</div>
            <div class="vdp-cover-row">
              <div class="vdp-cover" id="vdpCover"></div>
              <div>
                <div class="vdp-title" id="vdpTitle">—</div>
                <div class="vdp-artist" id="vdpArtist">—</div>
                <div class="vdp-cert-row" id="vdpCerts"></div>
              </div>
            </div>
          </div>
          <div class="vdp-body">
            <div class="vdp-section">
              <div class="vdp-section-label">Streaming Performance</div>
              <div class="vdp-stats-grid" id="vdpStats"></div>
            </div>
            <div class="vdp-section">
              <div class="vdp-section-label">Royalty Registration</div>
              <div id="vdpRegs"></div>
            </div>
            <div class="vdp-section">
              <div class="vdp-section-label">Split Sheet</div>
              <div id="vdpSplits"></div>
            </div>
          </div>
        </div>

        <!-- ═══ MERCH LAB — PRINTIFY-POWERED STOREFRONT ═══ -->
        <div class="boot-section" style="margin-top:0.5rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem">
            <div class="rc-section-title" style="color:#ffd264">MERCH LAB</div>
            <div style="display:flex;gap:0.5rem;align-items:center">
              <div style="display:flex;align-items:center;gap:0.3rem;padding:0.2rem 0.5rem;border:1px solid rgba(255,210,100,0.2);border-radius:10px;cursor:pointer;transition:all 0.2s" onclick="alert('Printify API connection — coming with TechnoNation store launch')" onmouseover="this.style.borderColor='rgba(255,210,100,0.4)';this.style.background='rgba(255,210,100,0.05)'" onmouseout="this.style.borderColor='rgba(255,210,100,0.2)';this.style.background='transparent'">
                <div style="width:5px;height:5px;border-radius:50%;background:rgba(255,210,100,0.5)"></div>
                <span style="font-size:0.42rem;font-family:'Space Mono',monospace;color:rgba(255,210,100,0.6);letter-spacing:1px">CONNECT PRINTIFY</span>
              </div>
              <div style="font-size:0.38rem;font-family:'Space Mono',monospace;color:rgba(232,234,246,0.2);letter-spacing:1px">0 PRODUCTS SYNCED</div>
            </div>
          </div>
          <!-- Product Categories -->
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem">
            <div class="merch-slot" onclick="alert('T-Shirt catalog — syncs from Printify')">
              <div class="merch-slot-preview" style="background:linear-gradient(135deg,rgba(255,210,100,0.08),rgba(255,171,64,0.04))">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><path d="M7 8L3 12V14L7 12V22H21V12L25 14V12L21 8H18C18 9.65 16.2 11 14 11S10 9.65 10 8H7Z" stroke="rgba(255,210,100,0.35)" stroke-width="1" fill="rgba(255,210,100,0.06)"/></svg>
              </div>
              <div class="merch-slot-name">T-Shirts</div>
              <div class="merch-slot-stat">Auto-sync designs</div>
            </div>
            <div class="merch-slot" onclick="alert('Hoodie catalog — syncs from Printify')">
              <div class="merch-slot-preview" style="background:linear-gradient(135deg,rgba(124,77,255,0.08),rgba(206,147,216,0.04))">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><path d="M8 7L4 11V15L8 13V23H20V13L24 15V11L20 7H18C18 8.65 16.2 10 14 10S10 8.65 10 7H8Z" stroke="rgba(124,77,255,0.35)" stroke-width="1" fill="rgba(124,77,255,0.06)"/><path d="M11 7C11 5 12 4 14 4S17 5 17 7" stroke="rgba(124,77,255,0.2)" stroke-width="0.8" fill="none"/></svg>
              </div>
              <div class="merch-slot-name">Hoodies</div>
              <div class="merch-slot-stat">Auto-sync designs</div>
            </div>
            <div class="merch-slot" onclick="alert('Accessories catalog — syncs from Printify')">
              <div class="merch-slot-preview" style="background:linear-gradient(135deg,rgba(0,230,118,0.06),rgba(0,176,255,0.04))">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><circle cx="14" cy="12" r="6" stroke="rgba(0,230,118,0.3)" stroke-width="1" fill="rgba(0,230,118,0.04)"/><path d="M8 18C8 14 20 14 20 18" stroke="rgba(0,230,118,0.2)" stroke-width="0.8" fill="none"/></svg>
              </div>
              <div class="merch-slot-name">Accessories</div>
              <div class="merch-slot-stat">Hats · Pins · Stickers</div>
            </div>
            <div class="merch-slot" onclick="alert('Add custom product type')">
              <div class="merch-slot-preview" style="background:linear-gradient(135deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01))">
                <div style="color:rgba(255,255,255,0.2);font-size:1.4rem;font-weight:200">+</div>
              </div>
              <div class="merch-slot-name">Custom</div>
              <div class="merch-slot-stat">Add product type</div>
            </div>
          </div>
          <!-- Merch Pipeline -->
          <div style="margin-top:0.6rem;display:grid;grid-template-columns:repeat(3,1fr);gap:0.4rem">
            <div style="background:rgba(255,210,100,0.03);border:1px solid rgba(255,210,100,0.08);border-radius:6px;padding:0.5rem;text-align:center">
              <div style="font-family:'Orbitron',monospace;font-size:0.5rem;color:rgba(255,210,100,0.4);letter-spacing:1px;margin-bottom:0.2rem">REVENUE</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.7rem;color:rgba(255,210,100,0.6)">$0.00</div>
              <div style="font-size:0.38rem;color:rgba(232,234,246,0.2);font-family:'Space Mono',monospace;margin-top:0.15rem">→ Royalty Command</div>
            </div>
            <div style="background:rgba(255,110,64,0.03);border:1px solid rgba(255,110,64,0.08);border-radius:6px;padding:0.5rem;text-align:center">
              <div style="font-family:'Orbitron',monospace;font-size:0.5rem;color:rgba(255,110,64,0.4);letter-spacing:1px;margin-bottom:0.2rem">CAMPAIGNS</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.7rem;color:rgba(255,110,64,0.6)">0 active</div>
              <div style="font-size:0.38rem;color:rgba(232,234,246,0.2);font-family:'Space Mono',monospace;margin-top:0.15rem">→ Launch Pad sync</div>
            </div>
            <div style="background:rgba(124,77,255,0.03);border:1px solid rgba(124,77,255,0.08);border-radius:6px;padding:0.5rem;text-align:center">
              <div style="font-family:'Orbitron',monospace;font-size:0.5rem;color:rgba(124,77,255,0.4);letter-spacing:1px;margin-bottom:0.2rem">ORDERS</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.7rem;color:rgba(124,77,255,0.6)">0 pending</div>
              <div style="font-size:0.38rem;color:rgba(232,234,246,0.2);font-family:'Space Mono',monospace;margin-top:0.15rem">Printify fulfills</div>
            </div>
          </div>
          <!-- How Merch Lab Works -->
          <div style="margin-top:0.6rem;padding:0.55rem;background:rgba(255,210,100,0.02);border:1px solid rgba(255,210,100,0.06);border-radius:6px">
            <div style="display:flex;align-items:center;gap:0.4rem;margin-bottom:0.3rem">
              <span style="font-size:0.42rem;font-family:'Orbitron',sans-serif;color:rgba(255,210,100,0.4);letter-spacing:1px">HOW IT WORKS</span>
            </div>
            <div style="display:flex;gap:0.6rem;justify-content:space-between">
              <div style="flex:1;text-align:center"><div style="font-size:0.8rem;margin-bottom:0.15rem">①</div><div style="font-size:0.4rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Connect Printify store via API key</div></div>
              <div style="flex:1;text-align:center"><div style="font-size:0.8rem;margin-bottom:0.15rem">②</div><div style="font-size:0.4rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Products auto-sync to catalog grid</div></div>
              <div style="flex:1;text-align:center"><div style="font-size:0.8rem;margin-bottom:0.15rem">③</div><div style="font-size:0.4rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Link drops to Launch Pad campaigns</div></div>
              <div style="flex:1;text-align:center"><div style="font-size:0.8rem;margin-bottom:0.15rem">④</div><div style="font-size:0.4rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Revenue flows to Royalty Command</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ── THE STUDIO — COLLABORATION HUB ── -->
      <div class="room" id="room-studio">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Studio Pack</div>
            <div class="room-title">The Studio</div>
            <div class="room-subtitle">File delivery, mix reviews, and collaboration — all in one session room</div>
          </div>
          <div class="room-status"><div class="status-dot yellow"></div> <span>2 sessions awaiting review</span></div>
        </div>

        <!-- Active participants -->
        <div class="boot-section studio-role-row" id="studioRoleRow">
          <!-- injected by JS -->
        </div>

        <!-- Session list -->
        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">Active Sessions</div>
            <div class="rc-section-note">Click a session to expand file delivery timeline</div>
          </div>
          <div class="session-grid" id="sessionGrid">
            <!-- injected by JS -->
          </div>
          <div class="new-session-cta" onclick="studioNewSession()" style="margin-top:0.75rem">
            <span style="font-size:1.2rem;opacity:0.5">＋</span>
            <span class="new-session-cta-text">Start New Session — invite engineer, producer, or collaborator</span>
          </div>
        </div>

        <!-- Delivery guide -->
        <div class="boot-section">
          <div class="rc-section-header">
            <div class="rc-section-title">How It Works</div>
            <div class="rc-section-note">Engineer delivery workflow</div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:0.75rem">
            <div class="roster-sum-card" style="text-align:left;padding:1rem">
              <div style="font-size:1.5rem;margin-bottom:0.5rem">①</div>
              <div style="font-family:'Orbitron',monospace;font-size:0.62rem;font-weight:600;letter-spacing:1px;margin-bottom:0.3rem">Artist Opens Session</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.42rem;letter-spacing:1px;color:rgba(232,234,246,0.35);line-height:1.7">Upload reference track, stems, and notes. Invite your engineer by email.</div>
            </div>
            <div class="roster-sum-card" style="text-align:left;padding:1rem">
              <div style="font-size:1.5rem;margin-bottom:0.5rem">②</div>
              <div style="font-family:'Orbitron',monospace;font-size:0.62rem;font-weight:600;letter-spacing:1px;margin-bottom:0.3rem">Engineer Delivers</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.42rem;letter-spacing:1px;color:rgba(232,234,246,0.35);line-height:1.7">Engineer uploads mix or master file. You get notified instantly — no file sharing chaos.</div>
            </div>
            <div class="roster-sum-card" style="text-align:left;padding:1rem">
              <div style="font-size:1.5rem;margin-bottom:0.5rem">③</div>
              <div style="font-family:'Orbitron',monospace;font-size:0.62rem;font-weight:600;letter-spacing:1px;margin-bottom:0.3rem">Artist Reviews</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.42rem;letter-spacing:1px;color:rgba(232,234,246,0.35);line-height:1.7">Listen, leave timestamped notes, request revisions — or approve to close the session.</div>
            </div>
            <div class="roster-sum-card" style="text-align:left;padding:1rem">
              <div style="font-size:1.5rem;margin-bottom:0.5rem">④</div>
              <div style="font-family:'Orbitron',monospace;font-size:0.62rem;font-weight:600;letter-spacing:1px;margin-bottom:0.3rem">Delivered to Vault</div>
              <div style="font-family:'Space Mono',monospace;font-size:0.42rem;letter-spacing:1px;color:rgba(232,234,246,0.35);line-height:1.7">Approved final files auto-archive to The Vault with full metadata and version history.</div>
            </div>
          </div>
        </div>

        <!-- ═══ CREATION TOOLS — MUSIC PRODUCTION API SUITE ═══ -->
        <div class="boot-section" style="margin-top:0.5rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem">
            <div class="rc-section-title" style="color:#00bcd4">CREATION TOOLS</div>
            <div style="display:flex;gap:0.5rem;align-items:center">
              <div style="display:flex;align-items:center;gap:0.3rem;padding:0.2rem 0.5rem;border:1px solid rgba(0,188,212,0.2);border-radius:10px">
                <div style="width:5px;height:5px;border-radius:50%;background:rgba(0,188,212,0.5)"></div>
                <span style="font-size:0.42rem;font-family:'Space Mono',monospace;color:rgba(0,188,212,0.6);letter-spacing:1px">5 TOOLS MAPPED</span>
              </div>
            </div>
          </div>
          <!-- Main tool grid -->
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem">
            <div class="api-tool-card" style="cursor:pointer;position:relative" onclick="alert('Beat Maker — Soundraw / AIVA / Boomy API integration')">
              <div style="position:absolute;top:0.3rem;right:0.3rem;display:flex;align-items:center;gap:0.2rem">
                <div style="width:4px;height:4px;border-radius:50%;background:#00e676"></div>
                <span style="font-size:0.32rem;color:rgba(0,230,118,0.5);font-family:'Space Mono',monospace;letter-spacing:0.5px">API READY</span>
              </div>
              <div class="api-tool-icon" style="background:rgba(124,77,255,0.1);border-color:rgba(124,77,255,0.2)">
                <span style="color:#7c4dff;font-size:0.8rem">♬</span>
              </div>
              <div class="api-tool-name">Beat Maker</div>
              <div class="api-tool-desc">AI-assisted beat generation. Select genre, BPM, mood — get stems</div>
              <div style="display:flex;gap:0.25rem;margin-top:0.3rem;flex-wrap:wrap">
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(124,77,255,0.08);border:1px solid rgba(124,77,255,0.15);border-radius:4px;color:rgba(124,77,255,0.6);font-family:'Space Mono',monospace">Soundraw</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(124,77,255,0.08);border:1px solid rgba(124,77,255,0.15);border-radius:4px;color:rgba(124,77,255,0.6);font-family:'Space Mono',monospace">AIVA</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(124,77,255,0.08);border:1px solid rgba(124,77,255,0.15);border-radius:4px;color:rgba(124,77,255,0.6);font-family:'Space Mono',monospace">Boomy</span>
              </div>
            </div>
            <div class="api-tool-card" style="cursor:pointer;position:relative" onclick="alert('Stem Splitter — Audioshake / Lalal.ai / Demucs integration')">
              <div style="position:absolute;top:0.3rem;right:0.3rem;display:flex;align-items:center;gap:0.2rem">
                <div style="width:4px;height:4px;border-radius:50%;background:#00e676"></div>
                <span style="font-size:0.32rem;color:rgba(0,230,118,0.5);font-family:'Space Mono',monospace;letter-spacing:0.5px">API READY</span>
              </div>
              <div class="api-tool-icon" style="background:rgba(255,110,64,0.1);border-color:rgba(255,110,64,0.2)">
                <span style="color:#ff6e40;font-size:0.8rem">◊</span>
              </div>
              <div class="api-tool-name">Stem Splitter</div>
              <div class="api-tool-desc">Upload a track, isolate vocals, drums, bass, melody into separate stems</div>
              <div style="display:flex;gap:0.25rem;margin-top:0.3rem;flex-wrap:wrap">
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(255,110,64,0.08);border:1px solid rgba(255,110,64,0.15);border-radius:4px;color:rgba(255,110,64,0.6);font-family:'Space Mono',monospace">Audioshake</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(255,110,64,0.08);border:1px solid rgba(255,110,64,0.15);border-radius:4px;color:rgba(255,110,64,0.6);font-family:'Space Mono',monospace">Lalal.ai</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(255,110,64,0.08);border:1px solid rgba(255,110,64,0.15);border-radius:4px;color:rgba(255,110,64,0.6);font-family:'Space Mono',monospace">Demucs</span>
              </div>
            </div>
            <div class="api-tool-card" style="cursor:pointer;position:relative" onclick="alert('Master Engine — LANDR / eMastered / CloudBounce integration')">
              <div style="position:absolute;top:0.3rem;right:0.3rem;display:flex;align-items:center;gap:0.2rem">
                <div style="width:4px;height:4px;border-radius:50%;background:#00e676"></div>
                <span style="font-size:0.32rem;color:rgba(0,230,118,0.5);font-family:'Space Mono',monospace;letter-spacing:0.5px">API READY</span>
              </div>
              <div class="api-tool-icon" style="background:rgba(0,230,118,0.1);border-color:rgba(0,230,118,0.2)">
                <span style="color:#00e676;font-size:0.8rem">≋</span>
              </div>
              <div class="api-tool-name">Master Engine</div>
              <div class="api-tool-desc">Automated mastering with reference track matching and loudness targeting</div>
              <div style="display:flex;gap:0.25rem;margin-top:0.3rem;flex-wrap:wrap">
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.15);border-radius:4px;color:rgba(0,230,118,0.6);font-family:'Space Mono',monospace">LANDR</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.15);border-radius:4px;color:rgba(0,230,118,0.6);font-family:'Space Mono',monospace">eMastered</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.15);border-radius:4px;color:rgba(0,230,118,0.6);font-family:'Space Mono',monospace">CloudBounce</span>
              </div>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:0.5rem;margin-top:0.5rem">
            <div class="api-tool-card" style="cursor:pointer;position:relative" onclick="alert('Sample Finder — Splice / Loopcloud / Tracklib integration')">
              <div style="position:absolute;top:0.3rem;right:0.3rem;display:flex;align-items:center;gap:0.2rem">
                <div style="width:4px;height:4px;border-radius:50%;background:#ffab40"></div>
                <span style="font-size:0.32rem;color:rgba(255,171,64,0.5);font-family:'Space Mono',monospace;letter-spacing:0.5px">RESEARCHING</span>
              </div>
              <div class="api-tool-icon" style="background:rgba(255,171,64,0.1);border-color:rgba(255,171,64,0.2)">
                <span style="color:#ffab40;font-size:0.8rem">∿</span>
              </div>
              <div class="api-tool-name">Sample Finder</div>
              <div class="api-tool-desc">Search royalty-free sample libraries by mood, key, BPM. Preview + drag to session</div>
              <div style="display:flex;gap:0.25rem;margin-top:0.3rem;flex-wrap:wrap">
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(255,171,64,0.08);border:1px solid rgba(255,171,64,0.15);border-radius:4px;color:rgba(255,171,64,0.6);font-family:'Space Mono',monospace">Splice</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(255,171,64,0.08);border:1px solid rgba(255,171,64,0.15);border-radius:4px;color:rgba(255,171,64,0.6);font-family:'Space Mono',monospace">Loopcloud</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(255,171,64,0.08);border:1px solid rgba(255,171,64,0.15);border-radius:4px;color:rgba(255,171,64,0.6);font-family:'Space Mono',monospace">Tracklib</span>
              </div>
            </div>
            <div class="api-tool-card" style="cursor:pointer;position:relative" onclick="alert('Lyrics Lab — Claude API / RhymeZone integration')">
              <div style="position:absolute;top:0.3rem;right:0.3rem;display:flex;align-items:center;gap:0.2rem">
                <div style="width:4px;height:4px;border-radius:50%;background:#00e676"></div>
                <span style="font-size:0.32rem;color:rgba(0,230,118,0.5);font-family:'Space Mono',monospace;letter-spacing:0.5px">API READY</span>
              </div>
              <div class="api-tool-icon" style="background:rgba(0,176,255,0.1);border-color:rgba(0,176,255,0.2)">
                <span style="color:#00b0ff;font-size:0.8rem">Ψ</span>
              </div>
              <div class="api-tool-name">Lyrics Lab</div>
              <div class="api-tool-desc">AI writing assistant for lyrics, hooks, ad-libs. Rhyme engine with syllable matching</div>
              <div style="display:flex;gap:0.25rem;margin-top:0.3rem;flex-wrap:wrap">
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(0,176,255,0.08);border:1px solid rgba(0,176,255,0.15);border-radius:4px;color:rgba(0,176,255,0.6);font-family:'Space Mono',monospace">Claude API</span>
                <span style="font-size:0.35rem;padding:0.1rem 0.3rem;background:rgba(0,176,255,0.08);border:1px solid rgba(0,176,255,0.15);border-radius:4px;color:rgba(0,176,255,0.6);font-family:'Space Mono',monospace">RhymeZone</span>
              </div>
            </div>
          </div>
          <!-- Session integration explainer -->
          <div style="margin-top:0.6rem;padding:0.55rem;background:rgba(0,188,212,0.02);border:1px solid rgba(0,188,212,0.06);border-radius:6px">
            <div style="display:flex;align-items:center;gap:0.4rem;margin-bottom:0.3rem">
              <span style="font-size:0.42rem;font-family:'Orbitron',sans-serif;color:rgba(0,188,212,0.4);letter-spacing:1px">SESSION INTEGRATION</span>
            </div>
            <div style="display:flex;gap:0.6rem;justify-content:space-between">
              <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">①</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Open any tool inside an active Studio session</div></div>
              <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">②</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Generate beats, split stems, master tracks inline</div></div>
              <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">③</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Output files auto-add to session file list</div></div>
              <div style="flex:1;text-align:center"><div style="font-size:0.7rem;margin-bottom:0.1rem">④</div><div style="font-size:0.38rem;color:rgba(232,234,246,0.3);font-family:'Space Mono',monospace;line-height:1.5">Send finals to The Vault with metadata</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ── PRICING ROOM ── -->
      <div class="room" id="room-pricing">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Orbit Plans</div>
            <div class="room-title">Choose Your Command</div>
            <div class="room-subtitle">Base plan + role add-ons — pay for what you actually need</div>
          </div>
          <div class="room-status"><div class="status-dot green"></div> <span>Annual billing saves up to 25%</span></div>
        </div>

        <!-- Role selector -->
        <div class="boot-section pricing-role-tabs" id="pricingRoleTabs">
          <div class="pricing-role-tab active" data-role="artist" onclick="pricingSetRole('artist',this)">
            <span class="tab-icon">🎤</span>ARTIST
          </div>
          <div class="pricing-role-tab" data-role="manager" onclick="pricingSetRole('manager',this)">
            <span class="tab-icon">📋</span>MANAGER
          </div>
          <div class="pricing-role-tab" data-role="studio" onclick="pricingSetRole('studio',this)">
            <span class="tab-icon">🎛️</span>STUDIO
          </div>
          <div class="pricing-role-tab" data-role="label" onclick="pricingSetRole('label',this)">
            <span class="tab-icon">🏢</span>LABEL
          </div>
        </div>

        <!-- Role description -->
        <div class="boot-section role-description visible" id="pricingRoleDesc">
          <div class="role-desc-title" id="pricingRoleTitle">Artist</div>
          <div class="role-desc-text" id="pricingRoleText">—</div>
        </div>

        <!-- Base tier cards -->
        <div class="boot-section">
          <div class="pricing-addons-label">Base Plan</div>
          <div class="pricing-base-grid" id="pricingBaseGrid">
            <!-- injected by JS -->
          </div>
        </div>

        <!-- Add-on packs -->
        <div class="boot-section">
          <div class="pricing-addons-label">Role Add-Ons — Stack on any base plan</div>
          <div class="pricing-addons-grid" id="pricingAddonsGrid">
            <!-- injected by JS -->
          </div>
        </div>

        <!-- Sticky summary -->
        <div class="pricing-summary" id="pricingSummary">
          <div class="pricing-summary-total">
            <div class="pricing-summary-label">Monthly Total</div>
            <div class="pricing-summary-amount" id="pricingSummaryAmount">$0</div>
            <div class="pricing-summary-breakdown" id="pricingSummaryBreakdown">Select a plan to get started</div>
          </div>
          <div class="pricing-save-badge" id="pricingSaveBadge" style="display:none">Save $0/yr with annual</div>
          <button class="pricing-cta-btn" onclick="pricingGetStarted()">Get Started →</button>
        </div>
      </div>

      <!-- ── CONTENT STUDIO — BROADCAST CONTROL ROOM ── -->
      <div class="room" id="room-content">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Media Room</div>
            <div class="room-title">Content Studio</div>
            <div class="room-subtitle">Your broadcast control room — cameras, screens, and a content pipeline on deck</div>
          </div>
          <div class="room-status"><div class="status-dot green"></div> <span id="csLiveStatus">3 posts scheduled · 1 release synced</span></div>
        </div>

        <!-- ═══ BROADCAST MONITOR WALL ═══ -->
        <div class="boot-section" style="margin-bottom:1.2rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem">
            <div class="rc-section-title" style="color:#ffab40">MONITOR WALL</div>
            <div style="display:flex;gap:0.4rem;align-items:center">
              <div style="width:6px;height:6px;border-radius:50%;background:#ff1744;box-shadow:0 0 6px #ff1744;animation:csPulseRec 1.5s infinite"></div>
              <span style="font-size:0.5rem;color:#ff1744;font-family:'Space Mono',monospace;letter-spacing:1px">REC</span>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem" id="csMonitorWall">
            <!-- Monitor 1: Platform Overview -->
            <div class="cs-monitor">
              <div class="cs-monitor-label">CH 01 — PLATFORMS</div>
              <div class="cs-monitor-screen">
                <div style="display:flex;flex-direction:column;gap:0.35rem">
                  <div class="cs-feed-row"><span style="color:#e1306c">IG</span><span class="cs-feed-val">349K</span><span class="cs-feed-delta up">+2.1K</span></div>
                  <div class="cs-feed-row"><span style="color:#ff0050">TK</span><span class="cs-feed-val">12.4K</span><span class="cs-feed-delta up">+890</span></div>
                  <div class="cs-feed-row"><span style="color:#1da1f2">X</span><span class="cs-feed-val">8.2K</span><span class="cs-feed-delta up">+145</span></div>
                  <div class="cs-feed-row"><span style="color:#ff0000">YT</span><span class="cs-feed-val">5.8K</span><span class="cs-feed-delta up">+320</span></div>
                </div>
              </div>
            </div>
            <!-- Monitor 2: Upcoming Content -->
            <div class="cs-monitor main">
              <div class="cs-monitor-label">CH 02 — NEXT UP</div>
              <div class="cs-monitor-screen" id="csNextUpMonitor">
                <div style="text-align:center;padding:0.5rem 0">
                  <div style="font-family:'Orbitron',sans-serif;font-size:0.65rem;color:#ffab40;margin-bottom:0.3rem">NEXT BROADCAST</div>
                  <div style="color:#e8eaf6;font-size:0.75rem;margin-bottom:0.2rem" id="csNextTitle">New single announcement</div>
                  <div style="color:rgba(232,234,246,0.4);font-size:0.55rem;font-family:'Space Mono',monospace" id="csNextTime">MAR 01 · 9:00 AM</div>
                  <div style="margin-top:0.4rem;display:flex;justify-content:center;gap:0.3rem" id="csNextPlats">
                    <span class="cs-plat-pill" style="border-color:rgba(225,48,108,0.4);color:#e1306c">IG</span>
                    <span class="cs-plat-pill" style="border-color:rgba(255,0,80,0.4);color:#ff0050">TK</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- Monitor 3: Release Sync -->
            <div class="cs-monitor">
              <div class="cs-monitor-label">CH 03 — LAUNCH PAD SYNC</div>
              <div class="cs-monitor-screen" id="csReleaseSyncMonitor">
                <div style="display:flex;flex-direction:column;gap:0.35rem">
                  <div style="font-size:0.5rem;color:rgba(232,234,246,0.3);font-family:'Orbitron',sans-serif;letter-spacing:1px">SYNCED RELEASE</div>
                  <div style="color:#ff6e40;font-size:0.7rem;font-family:'Orbitron',sans-serif" id="csSyncReleaseName">Night Drive</div>
                  <div style="color:rgba(232,234,246,0.4);font-size:0.55rem" id="csSyncReleaseDate">March 14, 2026</div>
                  <div style="display:flex;align-items:center;gap:0.3rem;margin-top:0.2rem">
                    <div style="flex:1;height:3px;background:rgba(255,255,255,0.08);border-radius:2px"><div style="height:100%;width:37.5%;background:linear-gradient(90deg,#ff6e40,#ffab40);border-radius:2px" id="csSyncProgress"></div></div>
                    <span style="font-size:0.45rem;color:#ffab40;font-family:'Space Mono',monospace" id="csSyncWeek">Wk 3/8</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ═══ CONTROL DECK — TABS ═══ -->
        <div class="boot-section" style="margin-bottom:0.5rem;padding-bottom:0">
          <div style="display:flex;gap:0;border-bottom:1px solid rgba(255,171,64,0.15)">
            <button class="cs-tab active" onclick="csTabSwitch('calendar',this)">Calendar</button>
            <button class="cs-tab" onclick="csTabSwitch('compose',this)">Compose</button>
            <button class="cs-tab" onclick="csTabSwitch('queue',this)">Queue <span class="cs-tab-badge" id="csQueueCount">3</span></button>
            <button class="cs-tab" onclick="csTabSwitch('templates',this)">Templates</button>
          </div>
        </div>

        <!-- TAB: Calendar -->
        <div class="boot-section cs-tab-panel active" id="csPanel-calendar">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem">
            <h3 style="font-family:'Orbitron',sans-serif;font-size:0.65rem;color:rgba(232,234,246,0.5);letter-spacing:2px" id="csMonthLabel">MARCH 2026</h3>
            <div style="display:flex;gap:0.4rem;align-items:center">
              <div class="cs-sync-badge" id="csSyncBadge" onclick="switchRoom('launch',document.querySelector('[data-room=launch]'))">▲ Launch Pad synced</div>
              <button onclick="csNavMonth(-1)" class="cs-nav-btn">◀</button>
              <button onclick="csNavMonth(1)" class="cs-nav-btn">▶</button>
            </div>
          </div>
          <div id="csCalGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px"></div>
          <div id="csCalDetail" style="display:none;margin-top:0.8rem;background:rgba(255,171,64,0.04);border:1px solid rgba(255,171,64,0.15);border-radius:8px;padding:0.8rem">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
              <span style="font-family:'Orbitron',sans-serif;font-size:0.6rem;color:#ffab40" id="csCalDetailDate">—</span>
              <button onclick="document.getElementById('csCalDetail').style.display='none'" style="background:none;border:none;color:rgba(232,234,246,0.3);cursor:pointer;font-size:0.7rem">✕</button>
            </div>
            <div id="csCalDetailContent" style="font-size:0.65rem;color:#e8eaf6;line-height:1.6"></div>
          </div>
        </div>

        <!-- TAB: Compose -->
        <div class="boot-section cs-tab-panel" id="csPanel-compose">
          <div style="display:flex;gap:0.5rem;margin-bottom:0.8rem;flex-wrap:wrap" id="csPlatforms">
            <button class="cs-plat-btn active" onclick="csTogglePlat(this)" data-plat="instagram">Instagram</button>
            <button class="cs-plat-btn" onclick="csTogglePlat(this)" data-plat="tiktok">TikTok</button>
            <button class="cs-plat-btn" onclick="csTogglePlat(this)" data-plat="twitter">X / Twitter</button>
            <button class="cs-plat-btn" onclick="csTogglePlat(this)" data-plat="youtube">YouTube</button>
            <button class="cs-plat-btn" onclick="csTogglePlat(this)" data-plat="facebook">Facebook</button>
          </div>
          <textarea id="csCaption" placeholder="Write your caption... or use the generator below" style="width:100%;min-height:80px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,171,64,0.15);border-radius:8px;color:#e8eaf6;padding:0.8rem;font-family:'Space Mono',monospace;font-size:0.7rem;resize:vertical;outline:none;box-sizing:border-box"></textarea>
          <div style="display:flex;gap:0.5rem;margin-top:0.6rem;flex-wrap:wrap">
            <div style="display:flex;gap:0.5rem">
              <select id="csTone" class="cs-select"><option value="hype">Hype</option><option value="chill">Chill</option><option value="personal">Personal</option><option value="promo">Promo</option><option value="story">Storytelling</option></select>
              <select id="csPostType" class="cs-select"><option value="release">New Release</option><option value="bts">Behind the Scenes</option><option value="milestone">Milestone</option><option value="engage">Fan Engagement</option><option value="collab">Collaboration</option></select>
            </div>
            <button onclick="csGenCaption()" class="cs-action-btn" style="border-color:rgba(255,171,64,0.3);color:#ffab40">Generate Caption</button>
          </div>
          <div id="csGenResult" style="display:none;background:rgba(255,171,64,0.05);border:1px solid rgba(255,171,64,0.15);border-radius:8px;padding:0.8rem;margin-top:0.6rem">
            <p id="csGenText" style="color:#e8eaf6;font-size:0.7rem;font-family:'Space Mono',monospace;line-height:1.5;margin-bottom:0.5rem"></p>
            <button onclick="document.getElementById('csCaption').value=document.getElementById('csGenText').textContent;document.getElementById('csGenResult').style.display='none'" class="cs-action-btn" style="border-color:rgba(255,171,64,0.4);color:#ffab40">Use This</button>
          </div>
          <div style="display:flex;gap:0.5rem;margin-top:0.8rem">
            <button onclick="csSchedule()" class="cs-action-btn" style="border-color:rgba(0,230,118,0.3);color:#00e676;flex:1">Schedule Post</button>
            <button onclick="csDraft()" class="cs-action-btn" style="border-color:rgba(255,255,255,0.15);color:rgba(232,234,246,0.5)">Save Draft</button>
          </div>
        </div>

        <!-- TAB: Queue -->
        <div class="boot-section cs-tab-panel" id="csPanel-queue">
          <div id="csQueue"></div>
        </div>

        <!-- TAB: Templates -->
        <div class="boot-section cs-tab-panel" id="csPanel-templates">
          <div style="color:rgba(232,234,246,0.5);font-size:0.6rem;font-family:'Orbitron',sans-serif;letter-spacing:1px;margin-bottom:0.8rem">CAPTION TEMPLATES — 75 across 5 tones × 5 types</div>
          <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:0.4rem" id="csTemplateGrid">
            <div class="cs-template-card" onclick="csLoadTemplate('hype','release')"><div class="cs-tc-tone">Hype</div><div class="cs-tc-type">Release</div></div>
            <div class="cs-template-card" onclick="csLoadTemplate('chill','release')"><div class="cs-tc-tone">Chill</div><div class="cs-tc-type">Release</div></div>
            <div class="cs-template-card" onclick="csLoadTemplate('personal','bts')"><div class="cs-tc-tone">Personal</div><div class="cs-tc-type">BTS</div></div>
            <div class="cs-template-card" onclick="csLoadTemplate('promo','milestone')"><div class="cs-tc-tone">Promo</div><div class="cs-tc-type">Milestone</div></div>
            <div class="cs-template-card" onclick="csLoadTemplate('story','collab')"><div class="cs-tc-tone">Story</div><div class="cs-tc-type">Collab</div></div>
          </div>
          <div id="csTemplatePreview" style="display:none;margin-top:0.8rem;background:rgba(255,171,64,0.04);border:1px solid rgba(255,171,64,0.12);border-radius:8px;padding:0.8rem">
            <div id="csTemplateList" style="display:flex;flex-direction:column;gap:0.5rem"></div>
          </div>
        </div>

        <!-- ═══ PRODUCTION EQUIPMENT RACK ═══ -->
        <div class="boot-section" style="margin-top:0.5rem">
          <div class="rc-section-title" style="color:rgba(232,234,246,0.4);margin-bottom:0.6rem">EQUIPMENT RACK</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem">
            <div class="cs-equip"><div class="cs-equip-icon">◎</div><div class="cs-equip-name">Camera</div><div class="cs-equip-stat">Photo + Video capture</div></div>
            <div class="cs-equip"><div class="cs-equip-icon">⧉</div><div class="cs-equip-name">Teleprompter</div><div class="cs-equip-stat">Script & caption preview</div></div>
            <div class="cs-equip"><div class="cs-equip-icon">◈</div><div class="cs-equip-name">Scheduler</div><div class="cs-equip-stat">Multi-platform queue</div></div>
            <div class="cs-equip"><div class="cs-equip-icon">⬡</div><div class="cs-equip-name">Analytics</div><div class="cs-equip-stat">Post performance data</div></div>
          </div>
        </div>
      </div>

      <div class="room" id="room-launch">
        <div class="room-section" style="margin-bottom:1.5rem">
          <h2 style="font-family:'Orbitron',sans-serif;font-size:1.1rem;color:#ff6e40;margin-bottom:0.3rem">▲ Launch Pad</h2>
          <p style="font-size:0.7rem;color:rgba(232,234,246,0.4);letter-spacing:1px">DISTRIBUTE · PROMOTE · TRACK · LAUNCH</p>
        </div>
        <!-- Active Release -->
        <div class="room-section" style="margin-bottom:1.5rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem">
            <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px">ACTIVE RELEASE</h3>
            <button onclick="lpNewRelease()" style="background:rgba(255,110,64,0.15);border:1px solid rgba(255,110,64,0.3);color:#ff6e40;padding:0.3rem 0.7rem;border-radius:6px;cursor:pointer;font-size:0.6rem;font-family:'Space Mono',monospace">+ New Release</button>
          </div>
          <div style="background:rgba(255,110,64,0.05);border:1px solid rgba(255,110,64,0.2);border-radius:10px;padding:1rem">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:0.8rem">
              <div><div style="color:#ff6e40;font-family:'Orbitron',sans-serif;font-size:0.85rem;margin-bottom:0.3rem">Night Drive — Single</div><div style="color:rgba(232,234,246,0.4);font-size:0.6rem;font-family:'Space Mono',monospace">Release Date: March 14, 2026 · 18 days out</div></div>
              <div style="color:#ffab40;font-size:0.6rem;font-family:'Space Mono',monospace;padding:0.25rem 0.6rem;border:1px solid rgba(255,171,64,0.3);border-radius:12px">Week 3 of 8</div>
            </div>
            <div style="background:rgba(255,255,255,0.05);border-radius:6px;height:8px;margin-bottom:0.8rem;overflow:hidden"><div style="background:linear-gradient(90deg,#ff6e40,#ffab40);height:100%;width:37.5%;border-radius:6px;transition:width 0.5s"></div></div>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem;text-align:center">
              <div><div style="color:#00e676;font-size:1rem;margin-bottom:0.2rem">✓</div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem">Mastered</div></div>
              <div><div style="color:#00e676;font-size:1rem;margin-bottom:0.2rem">✓</div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem">Distributed</div></div>
              <div><div style="color:#ffab40;font-size:1rem;margin-bottom:0.2rem">◐</div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem">Pre-save</div></div>
              <div><div style="color:rgba(232,234,246,0.2);font-size:1rem;margin-bottom:0.2rem">○</div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem">Playlists</div></div>
            </div>
          </div>
        </div>
        <!-- 8-Week Timeline -->
        <div class="room-section" style="margin-bottom:1.5rem">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px;margin-bottom:0.8rem">8-WEEK ROLLOUT TIMELINE</h3>
          <div id="lpTimeline" style="position:relative;padding-left:1.5rem">
            <div style="position:absolute;left:0.45rem;top:0;bottom:0;width:2px;background:linear-gradient(180deg,#00e676 0%,#00e676 37%,rgba(255,110,64,0.4) 37%,rgba(255,255,255,0.08) 100%)"></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:#00e676;box-shadow:0 0 8px rgba(0,230,118,0.4)"></div><div style="color:#00e676;font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 1 — FOUNDATION ✓</div><div style="color:rgba(232,234,246,0.4);font-size:0.6rem">Final master approved. Metadata submitted. Cover art locked.</div></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:#00e676;box-shadow:0 0 8px rgba(0,230,118,0.4)"></div><div style="color:#00e676;font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 2 — DISTRIBUTION ✓</div><div style="color:rgba(232,234,246,0.4);font-size:0.6rem">Uploaded to distributor. ISRC assigned. Delivery confirmed to DSPs.</div></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:#ff6e40;box-shadow:0 0 8px rgba(255,110,64,0.4);border:2px solid #ff6e40"></div><div style="color:#ff6e40;font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 3 — PRE-SAVE PUSH ← YOU ARE HERE</div><div style="color:rgba(232,234,246,0.4);font-size:0.6rem">Pre-save links live. Social campaign started. Email blast to fans.</div></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:transparent;border:2px solid rgba(255,255,255,0.15)"></div><div style="color:rgba(232,234,246,0.3);font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 4 — PLAYLIST PITCHING</div><div style="color:rgba(232,234,246,0.25);font-size:0.6rem">Submit to Spotify editorial. Pitch independent curators. Blog outreach.</div></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:transparent;border:2px solid rgba(255,255,255,0.15)"></div><div style="color:rgba(232,234,246,0.3);font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 5 — CONTENT BLITZ</div><div style="color:rgba(232,234,246,0.25);font-size:0.6rem">Daily content: teasers, lyric videos, BTS clips. TikTok sound push.</div></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:transparent;border:2px solid rgba(255,255,255,0.15)"></div><div style="color:rgba(232,234,246,0.3);font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 6 — RELEASE WEEK</div><div style="color:rgba(232,234,246,0.25);font-size:0.6rem">🚀 LAUNCH DAY. Monitor streams. Engage comments. Share milestones.</div></div>
            <div style="position:relative;padding:0.5rem 0 0.8rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:transparent;border:2px solid rgba(255,255,255,0.15)"></div><div style="color:rgba(232,234,246,0.3);font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 7 — MOMENTUM</div><div style="color:rgba(232,234,246,0.25);font-size:0.6rem">Music video drop. Remix/acoustic version. Cross-promotion with features.</div></div>
            <div style="position:relative;padding:0.5rem 0 0rem 1rem"><div style="position:absolute;left:-1.1rem;top:0.6rem;width:10px;height:10px;border-radius:50%;background:transparent;border:2px solid rgba(255,255,255,0.15)"></div><div style="color:rgba(232,234,246,0.3);font-size:0.6rem;font-family:'Orbitron',sans-serif;margin-bottom:0.2rem">WEEK 8 — ANALYSIS</div><div style="color:rgba(232,234,246,0.25);font-size:0.6rem">Performance review. Revenue tracking. Plan next release cycle.</div></div>
          </div>
        </div>
        <!-- DSP Checklist -->
        <div class="room-section" style="margin-bottom:1.5rem">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px;margin-bottom:0.8rem">DSP SUBMISSION TRACKER</h3>
          <div id="lpDSPs">
            <div onclick="lpToggleDSP(this)" style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(30,215,96,0.05);border:1px solid rgba(30,215,96,0.2);border-radius:8px;margin-bottom:0.4rem;cursor:pointer"><div style="width:18px;height:18px;border-radius:4px;background:#1ed760;display:flex;align-items:center;justify-content:center;font-size:0.6rem;color:#000">✓</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Spotify</div><div style="color:#00e676;font-size:0.5rem;font-family:'Space Mono',monospace">Delivered</div></div>
            <div onclick="lpToggleDSP(this)" style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(252,60,68,0.05);border:1px solid rgba(252,60,68,0.15);border-radius:8px;margin-bottom:0.4rem;cursor:pointer"><div style="width:18px;height:18px;border-radius:4px;background:#fc3c44;display:flex;align-items:center;justify-content:center;font-size:0.6rem;color:#fff">✓</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Apple Music</div><div style="color:#00e676;font-size:0.5rem;font-family:'Space Mono',monospace">Delivered</div></div>
            <div onclick="lpToggleDSP(this)" style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,0,0,0.03);border:1px solid rgba(255,0,0,0.12);border-radius:8px;margin-bottom:0.4rem;cursor:pointer"><div style="width:18px;height:18px;border-radius:4px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:0.6rem;color:rgba(255,255,255,0.3)">○</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">YouTube Music</div><div style="color:#ffab40;font-size:0.5rem;font-family:'Space Mono',monospace">Processing</div></div>
            <div onclick="lpToggleDSP(this)" style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px;margin-bottom:0.4rem;cursor:pointer"><div style="width:18px;height:18px;border-radius:4px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:0.6rem;color:rgba(255,255,255,0.3)">○</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Amazon Music</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem;font-family:'Space Mono',monospace">Pending</div></div>
            <div onclick="lpToggleDSP(this)" style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px;margin-bottom:0.4rem;cursor:pointer"><div style="width:18px;height:18px;border-radius:4px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:0.6rem;color:rgba(255,255,255,0.3)">○</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Tidal</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem;font-family:'Space Mono',monospace">Pending</div></div>
            <div onclick="lpToggleDSP(this)" style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="width:18px;height:18px;border-radius:4px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:0.6rem;color:rgba(255,255,255,0.3)">○</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Deezer</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem;font-family:'Space Mono',monospace">Pending</div></div>
          </div>
        </div>
        <!-- Pre-save Links -->
        <div class="room-section">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px;margin-bottom:0.8rem">PRE-SAVE LINKS</h3>
          <div style="display:flex;flex-direction:column;gap:0.5rem">
            <div style="display:flex;align-items:center;gap:0.6rem;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#1ed760;font-size:0.7rem;min-width:20px">♫</div><div style="flex:1"><div style="color:#e8eaf6;font-size:0.65rem;margin-bottom:0.15rem">Spotify Pre-save</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem;font-family:'Space Mono',monospace">distrokid.com/hyperfollow/10eo/night-drive</div></div><button onclick="lpCopyLink(this,'Copied!')" style="background:rgba(255,110,64,0.15);border:1px solid rgba(255,110,64,0.3);color:#ff6e40;padding:0.25rem 0.5rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Copy</button></div>
            <div style="display:flex;align-items:center;gap:0.6rem;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#fc3c44;font-size:0.7rem;min-width:20px">♫</div><div style="flex:1"><div style="color:#e8eaf6;font-size:0.65rem;margin-bottom:0.15rem">Apple Music Pre-add</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem;font-family:'Space Mono',monospace">music.apple.com/pre-add/night-drive</div></div><button onclick="lpCopyLink(this,'Copied!')" style="background:rgba(255,110,64,0.15);border:1px solid rgba(255,110,64,0.3);color:#ff6e40;padding:0.25rem 0.5rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Copy</button></div>
            <div style="display:flex;align-items:center;gap:0.6rem;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#ffab40;font-size:0.7rem;min-width:20px">🔗</div><div style="flex:1"><div style="color:#e8eaf6;font-size:0.65rem;margin-bottom:0.15rem">Smart Link (All Platforms)</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem;font-family:'Space Mono',monospace">linktr.ee/10eo/night-drive</div></div><button onclick="lpCopyLink(this,'Copied!')" style="background:rgba(255,110,64,0.15);border:1px solid rgba(255,110,64,0.3);color:#ff6e40;padding:0.25rem 0.5rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Copy</button></div>
          </div>
        </div>
      </div>


      <!-- ── THE CURRICULUM — SPACE STATION LIBRARY ── -->
      <div class="room" id="room-curriculum">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">The Curriculum</div>
            <div class="room-title">Everything You Need to Know About the Music Business</div>
            <div class="room-subtitle">Interactive space station library — pull a book, flip the cards, master the game</div>
          </div>
          <div class="room-status"><div class="status-dot green"></div> <span id="currProgressLabel">0 / 100 cards mastered</span></div>
        </div>

        <!-- ═══ DID YOU KNOW — ENTRY SPLASH ═══ -->
        <div class="curr-splash" id="currSplash">
          <div class="curr-splash-inner">
            <div class="curr-splash-beacon"></div>
            <div class="curr-splash-label">TRANSMISSION INCOMING</div>
            <div class="curr-splash-fact" id="currSplashFact">—</div>
            <div class="curr-splash-source" id="currSplashSource">—</div>
            <button class="curr-splash-enter" onclick="currDismissSplash()">Enter the Library →</button>
          </div>
        </div>

        <!-- LIBRARY MODE TABS -->
        <div class="boot-section curr-main-content" id="currMainContent" style="display:none;opacity:0">
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
          <button class="curr-tab active" onclick="currSwitchView('library',this)">📚 Library</button>
          <button class="curr-tab" onclick="currSwitchView('terminal',this)">🖥️ Terminal</button>
          <button class="curr-tab" onclick="currSwitchView('progress',this)">🏆 Progress</button>
          </div>
        </div>

        <!-- ═══ LIBRARY VIEW — NEON BOOKSHELF ═══ -->
        <div class="curr-view" id="currLibrary" style="display:none">
          <div class="boot-section">
            <div class="curr-shelf-label">TAP A BOOK TO OPEN THE DECK</div>
            <div class="curr-bookshelf" id="currBookshelf">
              <!-- Books injected by JS -->
            </div>
          </div>

          <!-- FLASHCARD AREA (hidden until book selected) -->
          <div class="boot-section curr-card-area" id="currCardArea" style="display:none">
            <div class="curr-card-header">
              <div class="curr-card-book-title" id="currCardBookTitle">—</div>
              <div class="curr-card-counter" id="currCardCounter">1 / 10</div>
              <button class="curr-close-btn" onclick="currCloseBook()">✕ Close Book</button>
            </div>
            <!-- HOLOGRAPHIC FLASHCARD -->
            <div class="curr-holo-card" id="currHoloCard" onclick="currFlipCard()">
              <div class="curr-holo-inner" id="currHoloInner">
                <div class="curr-holo-front" id="currHoloFront">
                  <div class="curr-card-q-label">QUESTION</div>
                  <div class="curr-card-q" id="currCardQ">—</div>
                  <div class="curr-card-tap">tap to reveal</div>
                </div>
                <div class="curr-holo-back" id="currHoloBack">
                  <div class="curr-card-a-label">ANSWER</div>
                  <div class="curr-card-a" id="currCardA">—</div>
                </div>
              </div>
            </div>
            <!-- CARD NAV -->
            <div class="curr-card-nav">
              <button class="curr-nav-btn" onclick="currPrevCard()">← Prev</button>
              <button class="curr-know-btn" onclick="currMarkKnown()">✓ Got It</button>
              <button class="curr-nav-btn" onclick="currNextCard()">Next →</button>
            </div>
            <!-- SWIPE HINT -->
            <div class="curr-swipe-hint">← swipe or use arrows →</div>
          </div>
        </div>

        <!-- ═══ TERMINAL VIEW — QUIZ COMPUTER ═══ -->
        <div class="curr-view" id="currTerminal" style="display:none">
          <div class="boot-section">
            <div class="curr-terminal-frame" id="currTermFrame">
              <div class="curr-term-header">
                <span class="curr-term-dots"><span style="background:#ff5f57"></span><span style="background:#febc2e"></span><span style="background:#28c840"></span></span>
                <span class="curr-term-title">OrbitHQ TERMINAL v2.0</span>
              </div>
              <div class="curr-term-body" id="currTermBody">
                <div class="curr-term-line"><span class="curr-term-prompt">arthq@station:~$</span> <span class="curr-term-cmd">boot curriculum_engine</span></div>
                <div class="curr-term-line curr-term-sys">████████████████ SYSTEM READY</div>
                <div class="curr-term-line curr-term-sys">Select a quiz module to begin testing your knowledge.</div>
                <div class="curr-term-line">&nbsp;</div>
                <div class="curr-quiz-select" id="currQuizSelect">
                  <!-- injected by JS -->
                </div>
              </div>
              <!-- QUIZ MODE (hidden until selected) -->
              <div class="curr-quiz-active" id="currQuizActive" style="display:none">
                <div class="curr-quiz-q-num" id="currQuizQNum">Q1 / 10</div>
                <div class="curr-quiz-question" id="currQuizQuestion">—</div>
                <div class="curr-quiz-options" id="currQuizOptions">
                  <!-- injected -->
                </div>
                <div class="curr-quiz-feedback" id="currQuizFeedback" style="display:none"></div>
                <button class="curr-quiz-next" id="currQuizNext" style="display:none" onclick="currQuizNextQ()">Next Question →</button>
              </div>
              <!-- QUIZ RESULTS -->
              <div class="curr-quiz-results" id="currQuizResults" style="display:none">
                <div class="curr-quiz-score-label">SCORE</div>
                <div class="curr-quiz-score" id="currQuizScore">0%</div>
                <div class="curr-quiz-grade" id="currQuizGrade">—</div>
                <button class="curr-quiz-retry" onclick="currQuizRetry()">Try Again</button>
                <button class="curr-quiz-back" onclick="currQuizBackToMenu()">← Back to Terminal</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ═══ PROGRESS VIEW — BADGES & TRACKER ═══ -->
        <div class="curr-view" id="currProgress" style="display:none">
          <div class="boot-section">
            <div class="curr-progress-header">
              <div class="curr-progress-ring-wrap">
                <svg class="curr-progress-ring" viewBox="0 0 120 120">
                  <circle cx="60" cy="60" r="52" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="8"/>
                  <circle id="currProgressArc" cx="60" cy="60" r="52" fill="none" stroke="#00e5ff" stroke-width="8" stroke-linecap="round" stroke-dasharray="326.73" stroke-dashoffset="326.73" transform="rotate(-90 60 60)"/>
                </svg>
                <div class="curr-progress-pct" id="currProgressPct">0%</div>
              </div>
              <div>
                <div style="font-family:'Orbitron',monospace;font-size:0.8rem;font-weight:700;letter-spacing:2px;color:#e8eaf6">MASTERY LEVEL</div>
                <div style="font-family:'Space Mono',monospace;font-size:0.5rem;color:rgba(232,234,246,0.4);margin-top:0.3rem" id="currMasteryLabel">Beginner — Keep studying!</div>
              </div>
            </div>
          </div>
          <div class="boot-section">
            <div style="font-family:'Orbitron',monospace;font-size:0.55rem;font-weight:600;letter-spacing:2px;color:#00e5ff;margin-bottom:0.8rem">BADGES EARNED</div>
            <div class="curr-badges-grid" id="currBadgesGrid">
              <!-- injected -->
            </div>
          </div>
          <div class="boot-section">
            <div style="font-family:'Orbitron',monospace;font-size:0.55rem;font-weight:600;letter-spacing:2px;color:#00e5ff;margin-bottom:0.8rem">BOOK PROGRESS</div>
            <div class="curr-book-progress" id="currBookProgress">
              <!-- injected -->
            </div>
          </div>
        </div>

      </div><!-- /room-curriculum -->
      <div class="room" id="room-settings">
        <div class="room-section" style="margin-bottom:1.5rem">
          <h2 style="font-family:'Orbitron',sans-serif;font-size:1.1rem;color:#90a4ae;margin-bottom:0.3rem">⚙️ Settings</h2>
          <p style="font-size:0.7rem;color:rgba(232,234,246,0.4);letter-spacing:1px">ACCOUNT · CONNECTIONS · PREFERENCES · BILLING</p>
        </div>
        <!-- Account Info -->
        <div class="room-section" style="margin-bottom:1.5rem">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px;margin-bottom:0.8rem">ACCOUNT</h3>
          <div style="display:flex;flex-direction:column;gap:0.6rem">
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.7rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem;font-family:'Orbitron',sans-serif;letter-spacing:1px;margin-bottom:0.3rem">DISPLAY NAME</div><div style="color:#e8eaf6;font-size:0.75rem">10eo</div></div><button onclick="stEdit(this)" style="background:rgba(144,164,174,0.1);border:1px solid rgba(144,164,174,0.2);color:#90a4ae;padding:0.25rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Edit</button></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.7rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem;font-family:'Orbitron',sans-serif;letter-spacing:1px;margin-bottom:0.3rem">EMAIL</div><div style="color:#e8eaf6;font-size:0.75rem"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c3b7a6ada6acaeb6b0aaa083a4aea2aaafeda0acae">[email&#160;protected]</a></div></div><button onclick="stEdit(this)" style="background:rgba(144,164,174,0.1);border:1px solid rgba(144,164,174,0.2);color:#90a4ae;padding:0.25rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Edit</button></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.7rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem;font-family:'Orbitron',sans-serif;letter-spacing:1px;margin-bottom:0.3rem">PLAN</div><div style="color:#ce93d8;font-size:0.75rem">Orbit Pro · $14.99/mo</div></div><button onclick="switchRoom('pricing',null)" style="background:rgba(206,147,216,0.1);border:1px solid rgba(206,147,216,0.2);color:#ce93d8;padding:0.25rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Manage</button></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.7rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div><div style="color:rgba(232,234,246,0.4);font-size:0.5rem;font-family:'Orbitron',sans-serif;letter-spacing:1px;margin-bottom:0.3rem">PASSWORD</div><div style="color:#e8eaf6;font-size:0.75rem">••••••••••••</div></div><button onclick="stEdit(this)" style="background:rgba(144,164,174,0.1);border:1px solid rgba(144,164,174,0.2);color:#90a4ae;padding:0.25rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace">Change</button></div>
          </div>
        </div>
        <!-- Connected Platforms -->
        <div class="room-section" style="margin-bottom:1.5rem">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px;margin-bottom:0.8rem">CONNECTED PLATFORMS</h3>
          <div style="display:flex;flex-direction:column;gap:0.4rem">
            <div style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(30,215,96,0.05);border:1px solid rgba(30,215,96,0.15);border-radius:8px"><div style="color:#1ed760;font-size:0.8rem;min-width:24px;text-align:center">♫</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Spotify for Artists</div><div style="color:#00e676;font-size:0.5rem;font-family:'Space Mono',monospace;padding:0.2rem 0.5rem;border:1px solid rgba(0,230,118,0.2);border-radius:12px">Connected</div></div>
            <div style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(252,60,68,0.04);border:1px solid rgba(252,60,68,0.12);border-radius:8px"><div style="color:#fc3c44;font-size:0.8rem;min-width:24px;text-align:center">♫</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Apple Music for Artists</div><div style="color:#00e676;font-size:0.5rem;font-family:'Space Mono',monospace;padding:0.2rem 0.5rem;border:1px solid rgba(0,230,118,0.2);border-radius:12px">Connected</div></div>
            <div style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(225,48,108,0.04);border:1px solid rgba(225,48,108,0.12);border-radius:8px"><div style="color:#e1306c;font-size:0.8rem;min-width:24px;text-align:center">◎</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">Instagram</div><div style="color:#00e676;font-size:0.5rem;font-family:'Space Mono',monospace;padding:0.2rem 0.5rem;border:1px solid rgba(0,230,118,0.2);border-radius:12px">Connected</div></div>
            <div style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:rgba(232,234,246,0.4);font-size:0.8rem;min-width:24px;text-align:center">▶</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">YouTube</div><div style="color:#ffab40;font-size:0.5rem;font-family:'Space Mono',monospace;padding:0.2rem 0.5rem;border:1px solid rgba(255,171,64,0.2);border-radius:12px;cursor:pointer" onclick="alert('Connect YouTube — OAuth flow coming in v7')">Connect</div></div>
            <div style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:rgba(232,234,246,0.4);font-size:0.8rem;min-width:24px;text-align:center">♪</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">TikTok</div><div style="color:#ffab40;font-size:0.5rem;font-family:'Space Mono',monospace;padding:0.2rem 0.5rem;border:1px solid rgba(255,171,64,0.2);border-radius:12px;cursor:pointer" onclick="alert('Connect TikTok — OAuth flow coming in v7')">Connect</div></div>
            <div style="display:flex;align-items:center;gap:0.8rem;padding:0.6rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:rgba(232,234,246,0.4);font-size:0.8rem;min-width:24px;text-align:center">$</div><div style="flex:1;color:#e8eaf6;font-size:0.68rem">DistroKid</div><div style="color:#ffab40;font-size:0.5rem;font-family:'Space Mono',monospace;padding:0.2rem 0.5rem;border:1px solid rgba(255,171,64,0.2);border-radius:12px;cursor:pointer" onclick="alert('Connect DistroKid — API integration coming in v7')">Connect</div></div>
          </div>
        </div>
        <!-- Notifications -->
        <div class="room-section" style="margin-bottom:1.5rem">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(232,234,246,0.5);letter-spacing:2px;margin-bottom:0.8rem">NOTIFICATIONS</h3>
          <div style="display:flex;flex-direction:column;gap:0.5rem">
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#e8eaf6;font-size:0.68rem">Revenue milestones</div><div onclick="stToggle(this)" style="width:36px;height:20px;border-radius:10px;background:#00e676;cursor:pointer;position:relative;transition:background 0.3s"><div style="width:16px;height:16px;border-radius:50%;background:#fff;position:absolute;top:2px;right:2px;transition:all 0.3s"></div></div></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#e8eaf6;font-size:0.68rem">Stream count alerts</div><div onclick="stToggle(this)" style="width:36px;height:20px;border-radius:10px;background:#00e676;cursor:pointer;position:relative;transition:background 0.3s"><div style="width:16px;height:16px;border-radius:50%;background:#fff;position:absolute;top:2px;right:2px;transition:all 0.3s"></div></div></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#e8eaf6;font-size:0.68rem">New playlist additions</div><div onclick="stToggle(this)" style="width:36px;height:20px;border-radius:10px;background:#00e676;cursor:pointer;position:relative;transition:background 0.3s"><div style="width:16px;height:16px;border-radius:50%;background:#fff;position:absolute;top:2px;right:2px;transition:all 0.3s"></div></div></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#e8eaf6;font-size:0.68rem">Weekly performance digest</div><div onclick="stToggle(this)" style="width:36px;height:20px;border-radius:10px;background:rgba(255,255,255,0.15);cursor:pointer;position:relative;transition:background 0.3s"><div style="width:16px;height:16px;border-radius:50%;background:rgba(255,255,255,0.5);position:absolute;top:2px;left:2px;transition:all 0.3s"></div></div></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:0.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px"><div style="color:#e8eaf6;font-size:0.68rem">Email marketing updates</div><div onclick="stToggle(this)" style="width:36px;height:20px;border-radius:10px;background:rgba(255,255,255,0.15);cursor:pointer;position:relative;transition:background 0.3s"><div style="width:16px;height:16px;border-radius:50%;background:rgba(255,255,255,0.5);position:absolute;top:2px;left:2px;transition:all 0.3s"></div></div></div>
          </div>
        </div>
        <!-- Danger Zone -->
        <div class="room-section">
          <h3 style="font-family:'Orbitron',sans-serif;font-size:0.7rem;color:rgba(255,82,82,0.6);letter-spacing:2px;margin-bottom:0.8rem">DANGER ZONE</h3>
          <div style="padding:0.8rem;border:1px solid rgba(255,82,82,0.2);border-radius:8px;background:rgba(255,82,82,0.03)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem"><div style="color:rgba(232,234,246,0.5);font-size:0.65rem">Export all data</div><button style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:rgba(232,234,246,0.5);padding:0.25rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace" onclick="alert('Data export — generates CSV/JSON bundle of all your OrbitHQ data')">Export</button></div>
            <div style="display:flex;justify-content:space-between;align-items:center"><div style="color:rgba(255,82,82,0.6);font-size:0.65rem">Delete account</div><button style="background:rgba(255,82,82,0.1);border:1px solid rgba(255,82,82,0.2);color:#ff5252;padding:0.25rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.55rem;font-family:'Space Mono',monospace" onclick="alert('This action is permanent. Type DELETE to confirm.')">Delete</button></div>
          </div>
        </div>
      </div>

      <!-- ═══════════ ROOM 13: THE FREQUENCY ═══════════ -->
      <div class="room" id="room-frequency">
        <div class="boot-section room-header">
          <div>
            <div class="room-label">Room 13</div>
            <div class="room-title">The Frequency</div>
            <div class="room-subtitle">Live DJ showcase — every featured artist transforms the room</div>
          </div>
          <div class="room-status"><div class="status-dot green"></div> <span id="freqLiveStatus">Loading...</span></div>
        </div>

        <!-- ═══ LIVE ENVIRONMENT CANVAS ═══ -->
        <div class="boot-section" style="position:relative;margin-bottom:1rem">
          <canvas id="freqEnvCanvas" style="width:100%;height:220px;border-radius:10px;border:1px solid rgba(156,39,176,0.15);display:block"></canvas>
          <div style="position:absolute;bottom:12px;left:16px;display:flex;align-items:center;gap:8px">
            <div style="width:8px;height:8px;border-radius:50%;background:#ce93d8;box-shadow:0 0 8px rgba(156,39,176,0.6);animation:csPulseRec 1.5s infinite"></div>
            <span style="font-size:0.5rem;color:#ce93d8;font-family:'Orbitron',sans-serif;letter-spacing:2px" id="freqEnvLabel">ENVIRONMENT LOADING</span>
          </div>
        </div>

        <!-- ═══ FEATURED DJ CARD ═══ -->
        <div class="boot-section" id="freqDJCard" style="margin-bottom:1rem;background:linear-gradient(135deg,rgba(156,39,176,0.06),rgba(233,30,99,0.04));border:1px solid rgba(156,39,176,0.12);border-radius:12px;padding:1.2rem">
          <div style="display:flex;align-items:flex-start;gap:1rem">
            <!-- DJ Avatar -->
            <div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,rgba(156,39,176,0.25),rgba(233,30,99,0.2));border:2px solid rgba(206,147,216,0.3);display:flex;align-items:center;justify-content:center;flex-shrink:0">
              <span style="font-size:1.8rem" id="freqDJAvatar">🎧</span>
            </div>
            <div style="flex:1;min-width:0">
              <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.3rem">
                <span style="font-family:'Orbitron',sans-serif;font-size:0.9rem;color:#e8eaf6;font-weight:700" id="freqDJName">—</span>
                <span class="badge" style="background:rgba(156,39,176,0.15);border-color:rgba(156,39,176,0.3);color:#ce93d8;font-size:0.4rem" id="freqDJBadge"></span>
              </div>
              <p style="color:rgba(232,234,246,0.55);font-size:0.65rem;line-height:1.5;margin-bottom:0.5rem" id="freqDJBio">Loading featured DJ...</p>
              <div style="display:flex;gap:0.4rem;flex-wrap:wrap" id="freqDJLinks"></div>
            </div>
          </div>
        </div>

        <!-- ═══ MIX PLAYER ═══ -->
        <div class="boot-section" id="freqMixSection" style="margin-bottom:1rem">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.6rem">
            <div class="rc-section-title" style="color:#ce93d8">NOW PLAYING</div>
            <div style="display:flex;gap:0.3rem;align-items:center">
              <div style="width:4px;height:12px;background:#ce93d8;border-radius:2px;animation:freqBar1 0.8s infinite alternate"></div>
              <div style="width:4px;height:18px;background:#e040fb;border-radius:2px;animation:freqBar2 0.6s infinite alternate"></div>
              <div style="width:4px;height:10px;background:#ce93d8;border-radius:2px;animation:freqBar3 0.9s infinite alternate"></div>
              <div style="width:4px;height:15px;background:#e040fb;border-radius:2px;animation:freqBar1 0.7s infinite alternate"></div>
              <div style="width:4px;height:8px;background:#ce93d8;border-radius:2px;animation:freqBar2 1s infinite alternate"></div>
            </div>
          </div>
          <div id="freqMixEmbed" style="background:rgba(156,39,176,0.04);border:1px solid rgba(156,39,176,0.12);border-radius:10px;padding:1rem;min-height:120px;display:flex;align-items:center;justify-content:center">
            <div style="text-align:center">
              <div style="font-size:1.5rem;margin-bottom:0.3rem;opacity:0.4">🎵</div>
              <div style="color:rgba(232,234,246,0.25);font-size:0.6rem;font-family:'Orbitron',sans-serif" id="freqMixTitle">Mix embed loading...</div>
            </div>
          </div>
        </div>

        <!-- ═══ DJ ROTATION ═══ -->
        <div class="boot-section">
          <div class="rc-section-title" style="color:rgba(232,234,246,0.4);margin-bottom:0.6rem">FEATURED ROTATION</div>
          <div id="freqRotation" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:0.5rem">
            <div style="text-align:center;padding:1rem;color:rgba(232,234,246,0.2);font-size:0.55rem;font-family:'Orbitron',sans-serif">Loading rotation...</div>
          </div>
        </div>
      </div><!-- /room-frequency -->

    </div><!-- /content-area -->
  </div><!-- /main-column -->
</div><!-- /app -->

<!-- ════ MOBILE NAV ════ -->
<nav class="mobile-nav" id="mobileNav">
  <div class="mobile-nav-inner">
    <div class="mobile-nav-item" id="mnav-dashboard" onclick="switchRoom('dashboard',document.querySelector('[data-room=dashboard]'));setMobileNav('dashboard')">
      <span class="mni">◆</span><span class="mnl">Home</span>
    </div>
    <div class="mobile-nav-item" id="mnav-identity" onclick="switchRoom('identity',document.querySelector('[data-room=identity]'));setMobileNav('identity')">
      <span class="mni">🪪</span><span class="mnl">Identity</span>
    </div>
    <div class="mobile-nav-item" id="mnav-stats" onclick="switchRoom('stats',document.querySelector('[data-room=stats]'));setMobileNav('stats')">
      <span class="mni">📡</span><span class="mnl">Stats</span>
    </div>
    <div class="mobile-nav-item" id="mnav-more" onclick="toggleMoreMenu()">
      <span class="mni">⋯</span><span class="mnl">More</span>
    </div>
  </div>
</nav>
<div class="mobile-more-menu" id="mobileMoreMenu">
  <div class="mobile-more-grid">
    <div class="mobile-more-item" onclick="switchRoom('royalty',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">💰</div><div class="mmi-label">Royalty Cmd</div></div>
    <div class="mobile-more-item" onclick="switchRoom('vault',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">🏆</div><div class="mmi-label">The Vault</div></div>
    <div class="mobile-more-item" onclick="switchRoom('studio',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">🎛️</div><div class="mmi-label">The Studio</div></div>
    <div class="mobile-more-item" onclick="switchRoom('pricing',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">◈</div><div class="mmi-label">Plans</div></div>
    <div class="mobile-more-item" onclick="if(!rosterMode)toggleRosterMode();else switchRoom('roster',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">👥</div><div class="mmi-label">Roster</div></div>
    <div class="mobile-more-item" onclick="switchRoom('content',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">📅</div><div class="mmi-label">Content Studio</div></div>
    <div class="mobile-more-item" onclick="switchRoom('frequency',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">🎧</div><div class="mmi-label">Frequency</div></div>
    <div class="mobile-more-item" onclick="switchRoom('launch',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">▲</div><div class="mmi-label">Launch Pad</div></div>


    <div class="mobile-more-item" onclick="switchRoom('curriculum',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">🎓</div><div class="mmi-label">Curriculum</div></div>
    <div class="mobile-more-item" onclick="switchRoom('settings',null);setMobileNav('more');toggleMoreMenu()"><div class="mmi-icon">⚙️</div><div class="mmi-label">Settings</div></div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ════════════════════════════════════════════════
//  PORTAL CAROUSEL ENGINE (Geometric Portals v2)
// ════════════════════════════════════════════════
const portalRooms = [
  {id:'dashboard',name:'Dashboard',desc:'Mission control. Revenue, streams, goals — everything at a glance.',badge:'online',color:'#00e5ff',shape:'hex',active:true,meta:['Real-time revenue tracking','Stream velocity & trajectory','Goal progress across all rooms']},
  {id:'royalty',name:'Royalty Cmd',desc:'Eleven revenue streams. Every dollar tracked from source to account.',badge:'online',color:'#00e676',shape:'diamond',active:true,meta:['$1,247 revenue this month','11 collection organizations','Split sheet tracker per release']},
  {id:'stats',name:'Stats',desc:'Global streaming analytics. Every listener, every platform, every region.',badge:'online',color:'#42a5f5',shape:'circle',active:true,meta:['142.8K monthly streams','Platform-by-platform breakdown','Geographic listener distribution']},
  {id:'identity',name:'Identity Lab',desc:'Your artist profile built from zero. Every platform, every link, one hub.',badge:'34% complete',color:'#7c4dff',shape:'pent',active:true,meta:['12 platforms to connect','Bio, genre tags, branding','Link aggregator with publish flow']},
  {id:'vault',name:'The Vault',desc:'Your catalog as a trophy wall. Every release certified and tracked.',badge:'32 releases',color:'#ffd264',shape:'star5',active:true,meta:['Gold & platinum certifications','Full catalog with stream counts','Per-release revenue breakdown']},
  {id:'studio',name:'The Studio',desc:'File delivery. Mix reviews. Session management. The record keeps spinning.',badge:'2 sessions',color:'#d7ccc8',shape:'oct',active:true,meta:['Engineer → Artist pipeline','Mix, stems, master tracking','Approve, revise, archive']},
  {id:'pricing',name:'Plans',desc:'Three tiers. Four role packs. Pricing that scales with your career.',badge:'orbit pro',color:'#ce93d8',shape:'tri',active:true,meta:['Free / Pro / Elite tiers','Role-based add-on packs','Annual savings available']},
  {id:'roster',name:'Roster',desc:'Multi-artist management. Aggregate analytics. Individual deep-dives.',badge:'4 artists',color:'#80cbc4',shape:'cross',active:true,meta:['4 artists under management','Aggregate & individual stats','Per-artist context switching']},
  {id:'launch',name:'Launch Pad',desc:'Release distribution pipeline. DSP checklist, pre-save links, 8-week rollout timeline.',badge:'online',color:'#ff6e40',shape:'hex',active:true,meta:['8-week release timeline','DSP submission checklist','Pre-save link generator']},
  {id:'content',name:'Content Studio',desc:'Plan, create, and schedule content across every platform.',badge:'online',color:'#ffab40',shape:'diamond',active:true,meta:['Visual content calendar','Caption generator','Multi-platform scheduling']},
  {id:'frequency',name:'The Frequency',desc:'Live DJ showcase. Every featured artist transforms the room entirely.',badge:'live',color:'#ce93d8',shape:'oct',active:true,meta:['Featured DJ rotation','Procedural environments','Embedded live mixes']},
  {id:'curriculum',name:'Curriculum',desc:'Everything you need to know about the music industry. Interactive library.',badge:'active',color:'#ea80fc',shape:'pent',active:true,meta:['70 flashcards across 7 books','Quiz terminal with scoring','Progress tracking & badges']},
  {id:'settings',name:'Settings',desc:'Account management, connected platforms, and billing.',badge:'online',color:'#90a4ae',shape:'tri',active:true,meta:['Connected platform manager','Notification preferences','Billing & subscription']},
];

let pCurIdx=0,pTargetIdx=0,pSlideOffset=0,pIsSliding=false,pTime=0,lobbyActive=false,lobbyBgStars=[],lobbyShootingStars=[];
function hexRgb(h){const n=parseInt(h.replace('#',''),16);return[(n>>16)&255,(n>>8)&255,n&255];}

// ── Shape path generators ──
function drawPoly(ctx,cx,cy,R,sides,rot){
  ctx.beginPath();
  for(let i=0;i<=sides;i++){const a=rot+(Math.PI*2/sides)*i-Math.PI/2;i===0?ctx.moveTo(cx+Math.cos(a)*R,cy+Math.sin(a)*R):ctx.lineTo(cx+Math.cos(a)*R,cy+Math.sin(a)*R);}
  ctx.closePath();
}
function drawStar(ctx,cx,cy,R,points,rot,innerRatio){
  const ir=R*(innerRatio||.45);ctx.beginPath();
  for(let i=0;i<=points*2;i++){const a=rot+(Math.PI/points)*i-Math.PI/2;const r=i%2===0?R:ir;i===0?ctx.moveTo(cx+Math.cos(a)*r,cy+Math.sin(a)*r):ctx.lineTo(cx+Math.cos(a)*r,cy+Math.sin(a)*r);}
  ctx.closePath();
}
function drawDiamond(ctx,cx,cy,R,rot){
  const w=R*.7,h=R;const c=Math.cos(rot),s=Math.sin(rot);
  const pts=[{x:0,y:-h},{x:w,y:0},{x:0,y:h},{x:-w,y:0}];
  ctx.beginPath();pts.forEach((p,i)=>{const rx=p.x*c-p.y*s+cx,ry=p.x*s+p.y*c+cy;i===0?ctx.moveTo(rx,ry):ctx.lineTo(rx,ry);});ctx.closePath();
}
function drawCross(ctx,cx,cy,R,rot){
  const w=R*.3,l=R;
  const pts=[{x:-w,y:-l},{x:w,y:-l},{x:w,y:-w},{x:l,y:-w},{x:l,y:w},{x:w,y:w},{x:w,y:l},{x:-w,y:l},{x:-w,y:w},{x:-l,y:w},{x:-l,y:-w},{x:-w,y:-w}];
  const c=Math.cos(rot),s=Math.sin(rot);ctx.beginPath();pts.forEach((p,i)=>{const rx=p.x*c-p.y*s+cx,ry=p.x*s+p.y*c+cy;i===0?ctx.moveTo(rx,ry):ctx.lineTo(rx,ry);});ctx.closePath();
}
function traceShape(ctx,shape,cx,cy,R,rot){
  switch(shape){case'hex':drawPoly(ctx,cx,cy,R,6,rot);break;case'tri':drawPoly(ctx,cx,cy,R,3,rot);break;case'pent':drawPoly(ctx,cx,cy,R,5,rot);break;case'oct':drawPoly(ctx,cx,cy,R,8,rot);break;case'diamond':drawDiamond(ctx,cx,cy,R,rot);break;case'star5':drawStar(ctx,cx,cy,R,5,rot,.42);break;case'cross':drawCross(ctx,cx,cy,R*.85,rot);break;case'circle':ctx.beginPath();ctx.arc(cx,cy,R,0,6.28);break;}
}
function shapeVerts(shape){return{hex:6,tri:3,pent:5,oct:8,diamond:4,star5:10,cross:12,circle:8}[shape]||6;}

// ── Draw portal ──
function drawPortal(ctx,room,cx,cy,R,alpha,t){
  if(alpha<.008||R<4)return;ctx.save();const rgb=hexRgb(room.color);const isCenter=alpha>.9;const bobY=Math.sin(t*.0018)*R*.03;cy+=bobY;
  const glow=ctx.createRadialGradient(cx,cy,R*.3,cx,cy,R*2.2);glow.addColorStop(0,`rgba(${rgb.join(',')},${.12*alpha})`);glow.addColorStop(.5,`rgba(${rgb.join(',')},${.03*alpha})`);glow.addColorStop(1,'transparent');ctx.beginPath();ctx.arc(cx,cy,R*2.2,0,6.28);ctx.fillStyle=glow;ctx.fill();
  ctx.save();ctx.globalAlpha=alpha*.12;traceShape(ctx,room.shape,cx,cy,R*1.28,t*.0003);ctx.strokeStyle=room.color;ctx.lineWidth=.4;ctx.stroke();ctx.restore();
  ctx.save();ctx.globalAlpha=alpha*.2;traceShape(ctx,room.shape,cx,cy,R*1.12,-t*.0007);ctx.strokeStyle=room.color;ctx.lineWidth=.7;ctx.stroke();ctx.restore();
  ctx.save();ctx.globalAlpha=alpha*(room.active?.65:.1);traceShape(ctx,room.shape,cx,cy,R,t*.001);ctx.strokeStyle=room.color;ctx.lineWidth=isCenter?2.5:1;if(isCenter){ctx.shadowColor=room.color;ctx.shadowBlur=20;}ctx.stroke();ctx.restore();
  ctx.save();ctx.globalAlpha=alpha*(room.active?.35:.05);traceShape(ctx,room.shape,cx,cy,R*.68,-t*.0018);ctx.strokeStyle=room.color;ctx.lineWidth=.6;ctx.stroke();ctx.restore();
  ctx.save();ctx.globalAlpha=alpha*(room.active?.2:.03);traceShape(ctx,room.shape,cx,cy,R*.4,t*.003);ctx.strokeStyle=room.color;ctx.lineWidth=.4;ctx.stroke();ctx.restore();
  if(room.active&&alpha>.15){ctx.save();ctx.globalAlpha=alpha*.18;traceShape(ctx,room.shape,cx,cy,R*.62,t*.001);const fill=ctx.createRadialGradient(cx,cy,0,cx,cy,R*.65);fill.addColorStop(0,`rgba(${rgb.join(',')},${isCenter?.12:.03})`);fill.addColorStop(.6,`rgba(${rgb.join(',')},${isCenter?.04:.01})`);fill.addColorStop(1,'transparent');ctx.fillStyle=fill;ctx.fill();ctx.restore();}
  if(room.active&&R>12){const nv=shapeVerts(room.shape);const mainRot=t*.001;for(let i=0;i<nv;i++){let vx,vy;if(room.shape==='circle'){const a=mainRot+(6.28/nv)*i;vx=cx+Math.cos(a)*R;vy=cy+Math.sin(a)*R;}else if(room.shape==='diamond'){const pts=[{x:0,y:-R},{x:R*.7,y:0},{x:0,y:R},{x:-R*.7,y:0}];const c2=Math.cos(mainRot),s2=Math.sin(mainRot);const p=pts[i%4];vx=p.x*c2-p.y*s2+cx;vy=p.x*s2+p.y*c2+cy;}else if(room.shape==='cross'){const a=mainRot+(6.28/nv)*i;vx=cx+Math.cos(a)*R*.85;vy=cy+Math.sin(a)*R*.85;}else if(room.shape==='star5'){const a=mainRot+(Math.PI/5)*i-Math.PI/2;const r=i%2===0?R:R*.42;vx=cx+Math.cos(a)*r;vy=cy+Math.sin(a)*r;}else{const sides=nv;const a=mainRot+(6.28/sides)*i-Math.PI/2;vx=cx+Math.cos(a)*R;vy=cy+Math.sin(a)*R;}const pulse=.3+.7*Math.abs(Math.sin(t*.003+i*.8));ctx.beginPath();ctx.arc(vx,vy,isCenter?2.5:1.2,0,6.28);ctx.fillStyle=`rgba(${rgb.join(',')},${alpha*pulse*.45})`;ctx.fill();if(isCenter){const vg=ctx.createRadialGradient(vx,vy,0,vx,vy,7);vg.addColorStop(0,`rgba(${rgb.join(',')},${alpha*pulse*.12})`);vg.addColorStop(1,'transparent');ctx.beginPath();ctx.arc(vx,vy,7,0,6.28);ctx.fillStyle=vg;ctx.fill();}}}
  if(isCenter&&room.active){const scanY=cy+Math.sin(t*.004)*R*.7;ctx.save();ctx.globalAlpha=.07;const sg=ctx.createLinearGradient(cx-R*.3,scanY,cx+R*.3,scanY);sg.addColorStop(0,'transparent');sg.addColorStop(.5,`rgba(${rgb.join(',')},${.06})`);sg.addColorStop(1,'transparent');ctx.fillRect(cx-R,scanY-3,R*2,6);ctx.fillStyle=sg;ctx.fill();ctx.beginPath();ctx.moveTo(cx-R,scanY);ctx.lineTo(cx+R,scanY);ctx.strokeStyle=room.color;ctx.lineWidth=.8;ctx.stroke();ctx.restore();}
  if(room.active&&alpha>.18){const count=isCenter?10:3;for(let i=0;i<count;i++){const pa=t*(.0015+i*.0004)+i*(1.2);const pd=R*(1.05+Math.sin(t*.001+i)*.12);const ppx=cx+Math.cos(pa)*pd;const ppy=cy+Math.sin(pa)*pd*.6;ctx.beginPath();ctx.arc(ppx,ppy,isCenter?1.2:.5,0,6.28);ctx.fillStyle=`rgba(${rgb.join(',')},${alpha*.25})`;ctx.fill();}}
  if(alpha>.03&&R>8){const fontSize=Math.max(7,Math.min(18,R*.13));const labelY=cy-R*1.35+Math.sin(t*.0014+portalRooms.indexOf(room)*1.5)*(R*.02);ctx.save();ctx.font=`${fontSize}px Orbitron, sans-serif`;ctx.textAlign='center';ctx.textBaseline='bottom';ctx.shadowColor=`rgba(${rgb.join(',')},${alpha*.4})`;ctx.shadowBlur=fontSize*1.5;ctx.fillStyle=`rgba(${rgb.join(',')},${alpha*(room.active?.45:.08)})`;ctx.fillText(room.name.toUpperCase(),cx,labelY);if(alpha>.8){ctx.shadowBlur=0;ctx.fillStyle=`rgba(220,225,240,${alpha*.18})`;ctx.fillText(room.name.toUpperCase(),cx,labelY);}ctx.restore();}
  ctx.restore();
}

// ── Intro animation state ──
let introActive=false,introStart=0,introScatter=[];
const INTRO_DURATION=6400;
function easeOutCubic(t){return 1-Math.pow(1-t,3);}
function easeOutQuint(t){return 1-Math.pow(1-t,5);}
function easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;}
function easeOutQuart(t){return 1-Math.pow(1-t,4);}

// ── Lobby render loop ──
function drawLobby(){
  if(!lobbyActive)return;
  const c=document.getElementById('lobbyCanvas'),ctx=c.getContext('2d');pTime++;
  ctx.fillStyle='#020408';ctx.fillRect(0,0,c.width,c.height);

  // Background stars
  lobbyBgStars.forEach(s=>{s.p+=s.sp;const px=s.x+(introActive?0:pSlideOffset*s.depth*40);const o=s.o*(.5+.5*Math.sin(s.p));ctx.beginPath();ctx.arc(px,s.y,s.sz,0,6.28);ctx.fillStyle=`rgba(200,210,240,${o})`;ctx.fill();});

  // Shooting stars (suppress during intro)
  if(!introActive){
    if(Math.random()<.006&&lobbyShootingStars.length<3){const fl=Math.random()>.5;lobbyShootingStars.push({x:fl?-20:c.width+20,y:Math.random()*c.height*.6,vx:(fl?1:-1)*(3+Math.random()*4),vy:.5+Math.random()*1.5,life:1,decay:.006+Math.random()*.008,sz:.6+Math.random()*.8});}
    lobbyShootingStars=lobbyShootingStars.filter(s=>{s.x+=s.vx;s.y+=s.vy;s.life-=s.decay;if(s.life<=0)return false;const grad=ctx.createLinearGradient(s.x-s.vx*12,s.y-s.vy*12,s.x,s.y);grad.addColorStop(0,'transparent');grad.addColorStop(1,`rgba(200,220,255,${s.life*.6})`);ctx.beginPath();ctx.moveTo(s.x-s.vx*12,s.y-s.vy*12);ctx.lineTo(s.x,s.y);ctx.strokeStyle=grad;ctx.lineWidth=s.sz;ctx.stroke();return s.x>-50&&s.x<c.width+50;});
  }

  const W=c.width,H=c.height;
  const carouselCX=W*.36,carouselCY=H*.48;
  const mainR=Math.min(W,H)*.17;

  // ── INTRO: MERRY-GO-ROUND → FLING → CONVERGE ──
  if(introActive){
    const elapsed=performance.now()-introStart;
    const p=Math.min(elapsed/INTRO_DURATION,1);

    // Phase 1: SPIN (0→0.40) — merry-go-round, portals orbit in a ring, accelerating
    // Phase 2: FLING (0.40→0.55) — centrifugal release, portals fly outward from ring
    // Phase 3: HANG (0.55→0.65) — brief float at scattered positions
    // Phase 4: CONVERGE (0.65→1.0) — Dashboard anchors center, others follow into carousel

    const spinEnd=.48,flingEnd=.60,hangEnd=.70;
    const total=portalRooms.length;
    const orbitR=W*.32;

    // Spin progress: accelerates through phase 1
    let spinAngle=0;
    if(p<=spinEnd){
      // Accelerating spin — starts slow, builds to fast
      const sp=p/spinEnd;
      spinAngle=easeInOutCubic(sp)*2.8*Math.PI*2; // ~2.8 revolutions
    } else {
      spinAngle=2.8*Math.PI*2; // locked at final spin angle
    }

    // Fling progress (0→1 during fling phase)
    const flingP=p>spinEnd?easeOutCubic(Math.min((p-spinEnd)/(flingEnd-spinEnd),1)):0;

    // Converge progress (0→1 during converge phase)
    const convergeP=p>hangEnd?easeOutQuart(Math.min((p-hangEnd)/(1-hangEnd),1)):0;

    // Orbit radius expands during fling
    const expandR=orbitR+(W*.25)*flingP;

    // Center glow during spin phase
    if(p<spinEnd+.05){
      const glowA=Math.min(1,p/spinEnd*.5)*Math.max(0,1-flingP*3)*.12;
      const fg=ctx.createRadialGradient(W*.5,H*.5,0,W*.5,H*.5,orbitR*1.5);
      fg.addColorStop(0,'rgba(180,200,255,'+glowA+')');
      fg.addColorStop(.6,'rgba(100,140,220,'+glowA*.3+')');
      fg.addColorStop(1,'transparent');
      ctx.beginPath();ctx.arc(W*.5,H*.5,orbitR*1.5,0,6.28);ctx.fillStyle=fg;ctx.fill();
    }

    for(let i=0;i<total;i++){
      const room=portalRooms[i];
      const sc=introScatter[i];

      // Each portal's angle in the ring
      const baseAngle=(i/total)*Math.PI*2;
      const ringAngle=baseAngle+spinAngle;

      // Ring position (during spin + fling expansion)
      const currentR=p<=spinEnd?orbitR:expandR;
      // During fling, each portal drifts along its tangent too
      const tangentDrift=flingP*sc.tangentForce*Math.min(W,H)*.2;
      const ringX=W*.5+Math.cos(ringAngle)*currentR+Math.cos(ringAngle+1.57)*tangentDrift;
      const ringY=H*.5+Math.sin(ringAngle)*currentR*.65+Math.sin(ringAngle+1.57)*tangentDrift*.65;

      // Carousel final position
      const relIdx=i-pCurIdx;
      const carX=carouselCX+relIdx*(W*.4);
      const carY=carouselCY;

      // Dashboard converges slightly earlier
      const isDash=(i===0);
      const cDelay=isDash?0:(.02+sc.convergeDelay*.06);
      const myConverge=Math.max(0,Math.min(1,(convergeP-cDelay)/(1-cDelay)));
      const easedC=easeOutCubic(myConverge);

      // Position: ring/scattered → carousel
      let bx,by;
      if(p<=hangEnd){
        bx=ringX; by=ringY;
      } else if(isDash){
        // Dashboard falls from top-center of sky
        const dropStartX=W*.5;
        const dropStartY=-mainR*1.5;
        // Smooth drop with slight deceleration at landing
        const dropEase=easeOutQuart(myConverge);
        bx=dropStartX+(carX-dropStartX)*dropEase;
        by=dropStartY+(carY-dropStartY)*dropEase;
      } else {
        bx=ringX+(carX-ringX)*easedC;
        by=ringY+(carY-ringY)*easedC;
      }

      // Scale: uniform small during spin, grows during converge
      const dist=Math.abs(relIdx);
      let finalScale,finalAlpha;
      if(dist<.05){finalScale=1;finalAlpha=1;}
      else if(dist<1.15){finalScale=1-dist*.58;finalAlpha=1-dist*.65;}
      else{finalScale=.12;finalAlpha=.05;}

      const spinScale=.32;
      let scale,alpha;
      if(isDash&&p>flingEnd*.7){
        // Dashboard: fade out during fling, reappear during sky drop
        const fadeOut=p<=hangEnd?Math.max(0,1-easeOutCubic((p-flingEnd*.7)/(hangEnd-flingEnd*.7))):0;
        const fadeIn=p>hangEnd?easeOutCubic(myConverge):0;
        const dashAlpha=p<=hangEnd?(.6*fadeOut):(fadeIn);
        const dashScale=p<=hangEnd?(spinScale*fadeOut):(spinScale+(finalScale-spinScale)*easeOutQuart(myConverge));
        scale=dashScale;
        alpha=dashAlpha;
      } else {
        scale=spinScale+(finalScale-spinScale)*easedC;
        // Alpha: materialize during spin, differentiate during converge
        const matAlpha=Math.min(1,easeOutCubic(Math.min(p*3.5,1)))*.6;
        alpha=matAlpha+(finalAlpha-matAlpha)*easedC;
      }
      const r=mainR*Math.max(.08,scale);

      // Motion trail during spin phase
      if(p<flingEnd&&p>.02){
        const trailA=Math.min(.06,alpha*.12)*(1-flingP);
        const prevAngle=ringAngle-.18;
        const prevX=W*.5+Math.cos(prevAngle)*currentR;
        const prevY=H*.5+Math.sin(prevAngle)*currentR*.65;
        const rgb=hexRgb(room.color);
        const tg=ctx.createLinearGradient(prevX,prevY,bx,by);
        tg.addColorStop(0,'transparent');
        tg.addColorStop(1,'rgba('+rgb.join(',')+','+trailA+')');
        ctx.beginPath();ctx.moveTo(prevX,prevY);ctx.lineTo(bx,by);
        ctx.strokeStyle=tg;ctx.lineWidth=r*.15;ctx.stroke();
      }

      if(bx>-r*3&&bx<W+r*3&&by>-r*3&&by<H+r*3)
        drawPortal(ctx,room,bx,by,r,alpha,pTime);
    }

    // Intro complete → reveal UI
    if(p>=1){
      introActive=false;
      document.getElementById('navArrowL').classList.add('show');
      document.getElementById('navArrowR').classList.add('show');
      portalUpdateInfo(true);
    }
    requestAnimationFrame(drawLobby);
    return;
  }

  // ── NORMAL CAROUSEL RENDER (post-intro) ──
  if(pIsSliding){let diff=pTargetIdx-pCurIdx;if(diff>portalRooms.length/2)diff-=portalRooms.length;if(diff<-portalRooms.length/2)diff+=portalRooms.length;const dir=diff>0?-1:1;pSlideOffset+=(dir-pSlideOffset)*.065;if(Math.abs(pSlideOffset-dir)<.015){pCurIdx=pTargetIdx;pSlideOffset=0;pIsSliding=false;portalUpdateInfo();}}
  for(let pos=-2;pos<=2;pos++){const vp=pos+pSlideOffset;const idx=((pCurIdx+pos)%portalRooms.length+portalRooms.length)%portalRooms.length;const room=portalRooms[idx];const spacing=W*.4;const px=carouselCX+vp*spacing;const dist=Math.abs(vp);let scale,alpha;if(dist<.05){scale=1;alpha=1;}else if(dist<1.15){scale=1-dist*.58;alpha=1-dist*.65;}else{scale=.12;alpha=.05;}const r=mainR*Math.max(.08,scale);const py=carouselCY+(1-scale)*H*.03;if(px>-r*3&&px<W+r*3) drawPortal(ctx,room,px,py,r,alpha,pTime);}
  requestAnimationFrame(drawLobby);
}

// ── Carousel controls ──
function showCarousel(){
  document.getElementById('carouselLobby').classList.add('active');
  document.getElementById('navArrowL').classList.remove('show');
  document.getElementById('navArrowR').classList.remove('show');
  document.getElementById('infoPanel').classList.remove('visible');
  lobbyActive=true;pTime=0;lobbyShootingStars=[];
  const c=document.getElementById('lobbyCanvas');c.width=innerWidth;c.height=innerHeight;
  lobbyBgStars=[];
  for(let i=0;i<Math.floor(c.width*c.height/2200);i++)
    lobbyBgStars.push({x:Math.random()*c.width,y:Math.random()*c.height,sz:Math.random()*1.2+.15,o:Math.random()*.35+.03,p:Math.random()*6.28,sp:Math.random()*.003+.0008,depth:Math.random()*.8+.2});
  // Generate scatter properties — tangent force for fling, converge delay for stagger
  introScatter=portalRooms.map((room,i)=>({
    tangentForce:.5+Math.random()*.8, // how far they drift tangentially during fling
    convergeDelay:Math.random(), // staggered return (Dashboard overridden to 0)
  }));
  introScatter[0].tangentForce=.2; // Dashboard stays closer
  introScatter[0].convergeDelay=0;
  introActive=true;introStart=performance.now();
  drawLobby();
}

function portalUpdateInfo(instant){
  const room=portalRooms[pCurIdx];const panel=document.getElementById('infoPanel');
  if(!instant)panel.classList.remove('visible');
  setTimeout(()=>{
    const badge=document.getElementById('ipBadge');badge.textContent=room.badge.toUpperCase();
    const rgb=hexRgb(room.color);badge.style.borderColor=`rgba(${rgb.join(',')},${room.active?.15:.05})`;badge.style.color=room.active?room.color:'#2a2a3a';
    document.getElementById('ipName').textContent=room.name;document.getElementById('ipDesc').textContent=room.desc;
    const metaEl=document.getElementById('ipMeta');metaEl.innerHTML='';
    room.meta.forEach(m=>{const row=document.createElement('div');row.className='ip-meta-row';row.innerHTML=`<div class="ip-meta-line" style="background:rgba(${rgb.join(',')},${room.active?.2:.05})"></div><span class="ip-meta-text">${m}</span>`;metaEl.appendChild(row);});
    const btn=document.getElementById('ipEnter');
    if(room.active){btn.classList.remove('dimmed');btn.textContent='Enter';btn.style.borderColor=`rgba(${rgb.join(',')},0.12)`;btn.style.color=room.color;}
    else{btn.classList.add('dimmed');btn.textContent='Coming Soon';btn.style.color='#2a2a3a';}
    document.getElementById('ipCounter').textContent=`${pCurIdx+1} / ${portalRooms.length}`;
    document.getElementById('ipNavFill').style.width=`${((pCurIdx+1)/portalRooms.length)*100}%`;
    panel.classList.add('visible');
  },instant?0:180);
}
function portalNavigate(dir){if(pIsSliding)return;pTargetIdx=((pCurIdx+dir)%portalRooms.length+portalRooms.length)%portalRooms.length;pIsSliding=true;pSlideOffset=0;document.getElementById('infoPanel').classList.remove('visible');}

// ── Enter room from portal → warp into app ──
function portalEnterRoom(){
  const room=portalRooms[pCurIdx];if(!room.active)return;
  document.getElementById('portalWarpOverlay').classList.add('active');
  setTimeout(()=>{
    document.getElementById('portalWarpOverlay').classList.remove('active');
    lobbyActive=false;
    document.getElementById('carouselLobby').classList.remove('active');
    document.getElementById('navArrowL').classList.remove('show');
    document.getElementById('navArrowR').classList.remove('show');
    // Show app shell
    const app=document.getElementById('app');
    app.classList.remove('hidden');app.classList.add('active');
    // Build chart if first time
    buildStreamChart();
    // Navigate to the selected room
    const navEl=document.querySelector(`.nav-item[data-room="${room.id}"]`);
    if(room.id==='roster' && typeof toggleRosterMode==='function' && !rosterMode){
      toggleRosterMode();
    } else {
      switchRoom(room.id, navEl);
    }
  },650);
}

// ── Return to lobby from inside app ──
function backToLobby(){
  const app=document.getElementById('app');
  app.classList.remove('active');app.classList.add('hidden');
  // Reset room states for clean re-entry
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  showCarousel();
}

// ── Keyboard + touch for carousel ──
document.addEventListener('keydown',e=>{if(!lobbyActive)return;if(e.key==='ArrowLeft')portalNavigate(-1);if(e.key==='ArrowRight')portalNavigate(1);if(e.key==='Enter')portalEnterRoom();});
let lobbyTouchSX=0;
document.addEventListener('touchstart',e=>{lobbyTouchSX=e.touches[0].clientX;});
document.addEventListener('touchend',e=>{if(!lobbyActive)return;const dx=e.changedTouches[0].clientX-lobbyTouchSX;if(Math.abs(dx)>50)portalNavigate(dx<0?1:-1);});
window.addEventListener('resize',()=>{if(!lobbyActive)return;const c=document.getElementById('lobbyCanvas');c.width=innerWidth;c.height=innerHeight;lobbyBgStars=[];for(let i=0;i<Math.floor(c.width*c.height/2200);i++)lobbyBgStars.push({x:Math.random()*c.width,y:Math.random()*c.height,sz:Math.random()*1.2+.15,o:Math.random()*.35+.03,p:Math.random()*6.28,sp:Math.random()*.003+.0008,depth:Math.random()*.8+.2});});

// ════════════════════════════════════════════════
//  ORIGINAL V5 ENGINE BELOW
// ════════════════════════════════════════════════

// ════ STARFIELD ════
function initStarfield(id) {
  const canvas = document.getElementById(id);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let stars = [];
  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  function createStars() {
    stars = [];
    const n = Math.floor((canvas.width * canvas.height) / 3000);
    for (let i = 0; i < n; i++) stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:Math.random()*1.5+0.3, opacity:Math.random()*0.8+0.1, pulse:Math.random()*Math.PI*2, speed:Math.random()*0.005+0.002 });
  }
  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    stars.forEach(s => { s.pulse+=s.speed; const f=Math.sin(s.pulse)*0.3+0.7; ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fillStyle=`rgba(200,210,240,${s.opacity*f})`; ctx.fill(); });
    requestAnimationFrame(draw);
  }
  resize(); createStars(); draw();
  window.addEventListener('resize', () => { resize(); createStars(); });
}
initStarfield('starfield');

// ════ SOLAR SYSTEM ════
let loginCanvasActive=false, loginAnimFrame=null, isDocking=false;
let supernovaActive=false, supernovaProgress=0, supernovaCx=0, supernovaCy=0;

function initLoginStarfield(id) {
  const canvas=document.getElementById(id); if(!canvas) return;
  const ctx=canvas.getContext('2d'); let stars=[],time=0;
  isDocking=false; supernovaActive=false; supernovaProgress=0;
  const planets=[
    {name:'Mercury',dist:0.12,size:4,speed:0.008,color:'#a0a0a0',glow:'rgba(160,160,160,0.15)',angle:Math.random()*Math.PI*2},
    {name:'Venus',dist:0.17,size:6,speed:0.006,color:'#e8c87a',glow:'rgba(232,200,122,0.12)',angle:Math.random()*Math.PI*2},
    {name:'Earth',dist:0.23,size:7,speed:0.0045,color:'#4a9eff',glow:'rgba(74,158,255,0.15)',angle:Math.random()*Math.PI*2},
    {name:'Mars',dist:0.29,size:5,speed:0.0035,color:'#d4724e',glow:'rgba(212,114,78,0.12)',angle:Math.random()*Math.PI*2},
    {name:'Jupiter',dist:0.37,size:14,speed:0.002,color:'#c4a882',glow:'rgba(196,168,130,0.1)',angle:Math.random()*Math.PI*2},
    {name:'Saturn',dist:0.45,size:11,speed:0.0015,color:'#e8d5a3',glow:'rgba(232,213,163,0.1)',angle:Math.random()*Math.PI*2,ring:true}
  ];
  function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
  function createStars(){stars=[];const n=Math.floor((canvas.width*canvas.height)/2500);for(let i=0;i<n;i++)stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:Math.random()*1.3+0.2,opacity:Math.random()*0.6+0.05,pulse:Math.random()*Math.PI*2,speed:Math.random()*0.005+0.002});}
  function shade(c,p){const n=parseInt(c.replace('#',''),16);return`rgb(${Math.min(255,Math.max(0,(n>>16)+p))},${Math.min(255,Math.max(0,((n>>8)&0xFF)+p))},${Math.min(255,Math.max(0,(n&0xFF)+p))})`;}
  function draw(){
    if(!loginCanvasActive)return; time++;
    ctx.fillStyle='#05060a';ctx.fillRect(0,0,canvas.width,canvas.height);
    stars.forEach(s=>{s.pulse+=s.speed;ctx.beginPath();ctx.arc(s.x,s.y,s.size,0,Math.PI*2);ctx.fillStyle=`rgba(220,225,240,${s.opacity*(0.5+0.5*Math.sin(s.pulse))})`;ctx.fill();});
    const cx=canvas.width*0.5,cy=canvas.height*0.5,sc=Math.min(canvas.width,canvas.height);
    planets.forEach(p=>{ctx.beginPath();ctx.arc(cx,cy,p.dist*sc,0,Math.PI*2);ctx.strokeStyle='rgba(255,255,255,0.03)';ctx.lineWidth=0.5;ctx.stroke();});
    const sR=sc*0.03,sG=ctx.createRadialGradient(cx,cy,0,cx,cy,sR*3);
    sG.addColorStop(0,'rgba(255,220,100,0.9)');sG.addColorStop(0.15,'rgba(255,180,50,0.7)');sG.addColorStop(0.4,'rgba(255,140,20,0.15)');sG.addColorStop(1,'transparent');
    ctx.beginPath();ctx.arc(cx,cy,sR*3,0,Math.PI*2);ctx.fillStyle=sG;ctx.fill();
    const cG=ctx.createRadialGradient(cx,cy,0,cx,cy,sR);cG.addColorStop(0,'#fffbe6');cG.addColorStop(0.5,'#ffd54f');cG.addColorStop(1,'#ff9800');
    ctx.beginPath();ctx.arc(cx,cy,sR,0,Math.PI*2);ctx.fillStyle=cG;ctx.fill();
    planets.forEach(p=>{
      p.angle+=isDocking?p.speed*12:p.speed;
      const r=p.dist*sc,px=cx+Math.cos(p.angle)*r,py=cy+Math.sin(p.angle)*r*0.4;
      const gG=ctx.createRadialGradient(px,py,0,px,py,p.size*3);gG.addColorStop(0,p.glow);gG.addColorStop(1,'transparent');
      ctx.beginPath();ctx.arc(px,py,p.size*3,0,Math.PI*2);ctx.fillStyle=gG;ctx.fill();
      if(p.ring){ctx.beginPath();ctx.ellipse(px,py,p.size*2.2,p.size*0.5,-0.3,0,Math.PI*2);ctx.strokeStyle='rgba(232,213,163,0.25)';ctx.lineWidth=1.5;ctx.stroke();}
      const pG=ctx.createRadialGradient(px-p.size*0.3,py-p.size*0.3,0,px,py,p.size);pG.addColorStop(0,p.color);pG.addColorStop(1,shade(p.color,-40));
      ctx.beginPath();ctx.arc(px,py,p.size,0,Math.PI*2);ctx.fillStyle=pG;ctx.fill();
      if(p.name==='Earth'){const ma=time*0.02,mx=px+Math.cos(ma)*(p.size+8),my=py+Math.sin(ma)*(p.size+6)*0.5;ctx.beginPath();ctx.arc(mx,my,1.5,0,Math.PI*2);ctx.fillStyle='rgba(200,200,210,0.7)';ctx.fill();}
    });
    if(supernovaActive){
      supernovaProgress+=0.008;if(supernovaProgress>1)supernovaProgress=1;
      const p=supernovaProgress,mR=Math.max(canvas.width,canvas.height)*1.2;
      if(p<0.4){const eP=p/0.4,r=eP*mR*0.4,i=1-eP*0.3;const rG=ctx.createRadialGradient(supernovaCx,supernovaCy,r*0.3,supernovaCx,supernovaCy,r);rG.addColorStop(0,`rgba(255,255,255,${i*0.9})`);rG.addColorStop(0.4,`rgba(200,220,255,${i*0.5})`);rG.addColorStop(0.7,`rgba(150,180,255,${i*0.15})`);rG.addColorStop(1,'transparent');ctx.beginPath();ctx.arc(supernovaCx,supernovaCy,r,0,Math.PI*2);ctx.fillStyle=rG;ctx.fill();ctx.beginPath();ctx.arc(supernovaCx,supernovaCy,15*(1-eP*0.5),0,Math.PI*2);ctx.fillStyle=`rgba(255,255,255,${i})`;ctx.fill();}
      else if(p<0.65){ctx.fillStyle=`rgba(255,255,255,${(1-(p-0.4)/0.25)*0.7})`;ctx.fillRect(0,0,canvas.width,canvas.height);}
      else{ctx.fillStyle=`rgba(0,0,0,${(p-0.65)/0.35})`;ctx.fillRect(0,0,canvas.width,canvas.height);}
    }
    loginAnimFrame=requestAnimationFrame(draw);
  }
  resize();createStars();loginCanvasActive=true;draw();
  window.addEventListener('resize',()=>{resize();createStars();});
}

// ════ CLOCK ════
function updateTerminalClock(){const el=document.getElementById('terminalClock');if(el){const n=new Date();el.textContent=n.toUTCString().split(' ')[4]+' UTC';}requestAnimationFrame(updateTerminalClock);}
updateTerminalClock();

// ════ DEV BYPASS ════

// ════ SUPABASE AUTH ════
const SUPABASE_URL='https://xsiajjevilfriankuimt.supabase.co';
const SUPABASE_ANON='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzaWFqamV2aWxmcmlhbmt1aW10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NzgxNzAsImV4cCI6MjA4NzU1NDE3MH0.OMDUz1L8bHAUOqz77YmHSUcdo_vK6Wpr14lrQa88W9E';
const _sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON);
let _currentUser=null;

async function initDocking(){
  const uid=document.getElementById('loginEmail').value.trim().toLowerCase();
  const key=document.getElementById('loginPassword').value;
  const err=document.getElementById('loginError');
  err.style.color='#ff4444';
  if(!uid||!key){err.textContent='SYS: ALL FIELDS REQUIRED';err.style.opacity='1';return;}
  const email=uid.replace(/[^a-z0-9_.-]/g,'')+'@orbithq.app';
  const btn=document.getElementById('loginBtn');
  btn.disabled=true;
  btn.textContent='[ Authenticating... ]';
  try{
    const result=await _sb.auth.signInWithPassword({email,password:key});
    if(result.error) throw result.error;
    _currentUser=result.data.user;
    _loadUserMilestones(); // Pre-load milestones at login
    err.style.opacity='0';
    _runDockingAnimation(btn);
  } catch(e){
    btn.textContent='[ Initiate Docking ]';btn.disabled=false;
    let msg='SYS: ACCESS DENIED';
    if(e.message){
      if(e.message.includes('Invalid login'))msg='SYS: ACCESS DENIED — INVALID CREDENTIALS';
      else if(e.message.includes('rate limit'))msg='SYS: TOO MANY ATTEMPTS — STAND BY';
      else msg='SYS: '+e.message.toUpperCase().slice(0,60);
    }
    err.textContent=msg;err.style.opacity='1';
    const box=document.querySelector('.login-box');
    box.style.animation='none';box.offsetHeight;box.style.animation='shake 0.4s ease';
    setTimeout(()=>{box.style.animation='';},500);
  }
}

function _runDockingAnimation(btn){
  btn.classList.add('docking');btn.textContent='[ Launching... ]';
  const box=document.querySelector('.login-box');
  const rect=box.getBoundingClientRect();
  supernovaCx=rect.left+rect.width/2;supernovaCy=rect.top+rect.height/2;
  box.style.transition='opacity 0.5s ease';box.style.opacity='0';
  setTimeout(()=>{supernovaActive=true;supernovaProgress=0;isDocking=true;},500);
  setTimeout(()=>{
    loginCanvasActive=false;supernovaActive=false;
    if(loginAnimFrame)cancelAnimationFrame(loginAnimFrame);
    document.getElementById('loginOverlay').classList.remove('active');
    document.getElementById('dockTransition').classList.add('active');
    initStarfield('starfield3');
    box.style.transition='none';box.style.opacity='';
    btn.classList.remove('docking');btn.textContent='[ Initiate Docking ]';btn.disabled=false;
    isDocking=false;
    document.getElementById('loginEmail').value='';document.getElementById('loginPassword').value='';
    setTimeout(()=>{
      document.getElementById('dockTransition').classList.remove('active');
      showCarousel();
      _checkHashRoute();
    },3500);
  },3200);
}

async function logout(){
  await _sb.auth.signOut();
  _currentUser=null;_idlabLoaded=false;_milestonesLoaded=false;_userMilestones.clear();
  window.location.hash='';
  const app=document.getElementById('app');app.classList.remove('active');app.classList.add('hidden');
  lobbyActive=false;document.getElementById('carouselLobby').classList.remove('active');
  document.getElementById('navArrowL').classList.remove('show');
  document.getElementById('navArrowR').classList.remove('show');
  document.getElementById('loginOverlay').classList.add('active');
  loginCanvasActive=false;
  setTimeout(()=>initLoginStarfield('starfield2'),100);
}

// ════ SESSION PERSISTENCE — auto-login if session exists ════
async function checkExistingSession(){
  const{data:{session}}=await _sb.auth.getSession();
  if(session&&session.user){
    _currentUser=session.user;
    _loadUserMilestones(); // Pre-load milestones at session resume
    document.getElementById('loginOverlay').classList.remove('active');
    loginCanvasActive=false;
    if(loginAnimFrame)cancelAnimationFrame(loginAnimFrame);
    showCarousel();
    setTimeout(_checkHashRoute,500);
  }
}
checkExistingSession();

function _checkHashRoute(){
  const hash=window.location.hash.replace('#','');
  if(hash&&document.getElementById('room-'+hash)){
    const nav=document.querySelector('[data-room="'+hash+'"]');
    switchRoom(hash,nav);
  }
}

// ════ ROOM NAVIGATION + SLIDE+FADE + WARP FLASH ════
const roomMeta = {
  dashboard: { label:'Dashboard', status:'All Systems Operational', statusType:'green' },
  identity:  { label:'Identity Lab', status:'Profile 34% Complete', statusType:'yellow' },
  stats:     { label:'Stats Explorer', status:'1 of 11 platforms connected', statusType:'yellow' },
  royalty:   { label:'Royalty Command', status:'3 of 11 revenue streams active', statusType:'yellow' },
  roster:    { label:'Roster Command', status:'4 Artists · Label View Active', statusType:'green' },
  vault:    { label:'The Vault', status:'32 Releases · Catalog Active', statusType:'yellow' },
  studio:   { label:'The Studio', status:'2 Sessions Awaiting Review', statusType:'yellow' },
  pricing:  { label:'Plans & Pricing', status:'Hybrid Tiers Available', statusType:'green' },
  content:   { label:'Content Studio', status:'Active', statusType:'green' },
  frequency: { label:'The Frequency', status:'Loading...', statusType:'green' },
  launch:    { label:'Launch Pad', status:'Active', statusType:'green' },
  curriculum:{ label:'The Curriculum', status:'Active', statusType:'green' },
  settings:  { label:'Settings', status:'Active', statusType:'green' }
};
const bootedRooms = new Set();
let isTransitioning = false;

function switchRoom(roomId, navEl) {
  if (isTransitioning) return;
  const current = document.querySelector('.room.active');
  if (current && current.id === 'room-' + roomId) return;
  isTransitioning = true;
  window.location.hash = roomId;
  // Sidebar active state
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  if (navEl) navEl.classList.add('active');
  // Location bar
  const meta = roomMeta[roomId] || { label:roomId, status:'', statusType:'green' };
  document.getElementById('locCurrent').textContent = meta.label;
  document.getElementById('locStatusText').textContent = meta.status;
  const locDot = document.querySelector('.loc-dot');
  locDot.className = 'loc-dot ' + meta.statusType;
  // Exit current
  if (current) { current.classList.add('exiting'); setTimeout(()=>current.classList.remove('exiting'),300); current.classList.remove('active'); }
  // Warp flash
  const flash = document.getElementById('warpFlash');
  flash.classList.remove('fire');
  void flash.offsetWidth; // reflow
  flash.classList.add('fire');
  // Enter new
  setTimeout(()=>{
    const next = document.getElementById('room-' + roomId);
    if (next) {
      next.style.transform = 'translateX(30px)';
      next.style.opacity = '0';
      next.classList.add('active');
      void next.offsetWidth;
      next.style.transform = '';
      next.style.opacity = '';
      if (!bootedRooms.has(roomId)) {
        bootRoom(roomId);
        bootedRooms.add(roomId);
        if (roomId === 'royalty') setTimeout(rcInit, 200);
        if (roomId === 'roster') setTimeout(rosterRenderOverview, 200);
        if (roomId === 'vault') setTimeout(vaultInit, 200);
        if (roomId === 'studio') setTimeout(studioInit, 200);
        if (roomId === 'pricing') setTimeout(pricingInit, 200);
        if (roomId === 'identity') setTimeout(idlabLoadProfile, 200);
        if (roomId === 'frequency') setTimeout(frequencyInit, 200);
      }
      // Every-visit refreshes (not just first boot)
      if (roomId === 'content') setTimeout(csBootDB, 300);
    }
    isTransitioning = false;
  }, 120);
}

// ════ BOOT SEQUENCE — staggered section fade-up ════
function bootRoom(roomId) {
  const room = document.getElementById('room-' + roomId);
  if (!room) return;
  const sections = room.querySelectorAll('.boot-section');
  sections.forEach((s, i) => {
    setTimeout(() => s.classList.add('booted'), i * 120);
  });
  bootedRooms.add(roomId);
}

// ════ MOBILE NAV ════
function setMobileNav(id) {
  document.querySelectorAll('.mobile-nav-item').forEach(i=>i.classList.remove('active'));
  const el = document.getElementById('mnav-'+id);
  if (el) el.classList.add('active');
}
function toggleMoreMenu() {
  document.getElementById('mobileMoreMenu').classList.toggle('open');
}
document.addEventListener('click', e => {
  const menu = document.getElementById('mobileMoreMenu');
  if (menu.classList.contains('open') && !menu.contains(e.target) && !document.getElementById('mnav-more').contains(e.target)) {
    menu.classList.remove('open');
  }
});

// ════ CHART ════
function buildStreamChart(){
  const c=document.getElementById('streamChart'); if(!c)return;
  const data=[62,71,68,85,92,88,108,143]; const max=Math.max(...data);
  c.innerHTML='';
  data.forEach((v,i)=>{const b=document.createElement('div');b.className='chart-bar'+(i===data.length-1?' highlight':'');b.style.height=(v/max*100)+'%';b.title=v+'K streams';c.appendChild(b);});
}

// ════ ROYALTY COMMAND ENGINE ════

// Registration definitions
// status: 'registered' | 'pending' | 'locked'
// revenueKey: used to pull from rcRevenue object after calculation
const rcRegistrations = {
  master: [
    {
      id: 'distributor',
      icon: '🔊',
      name: 'Music Distributor',
      desc: 'DistroKid / TuneCore / CD Baby — collects your master streaming royalties',
      status: 'registered',
      revenueKey: 'masterStreaming',
      link: 'https://distrokid.com'
    },
    {
      id: 'spotifyArtists',
      icon: '🎵',
      name: 'Spotify for Artists',
      desc: 'Claim your profile, unlock analytics + editorial pitching',
      status: 'registered',
      revenueKey: 'spotifyBoost',
      link: 'https://artists.spotify.com'
    },
    {
      id: 'soundexchange',
      icon: '📻',
      name: 'SoundExchange',
      desc: 'Collects digital performance royalties from Pandora, SiriusXM, iHeartRadio',
      status: 'locked',
      revenueKey: 'soundexchange',
      link: 'https://www.soundexchange.com/artist-copyright-owner/register/'
    },
    {
      id: 'appleArtists',
      icon: '🍎',
      name: 'Apple Music for Artists',
      desc: 'Claim your Apple profile + Apple Music analytics',
      status: 'locked',
      revenueKey: 'appleMaster',
      link: 'https://artists.apple.com'
    },
    {
      id: 'contentid',
      icon: '▶️',
      name: 'YouTube Content ID',
      desc: 'Claim ad revenue from all YouTube videos using your music',
      status: 'pending',
      revenueKey: 'contentId',
      link: 'https://support.google.com/youtube/answer/2797370'
    }
  ],
  publishing: [
    {
      id: 'pro',
      icon: '🎼',
      name: 'PRO Registration (BMI or ASCAP)',
      desc: 'Performs. rights org — collects public performance royalties from streaming + radio + TV',
      status: 'locked',
      revenueKey: 'proPerformance',
      link: 'https://www.bmi.com/join'
    },
    {
      id: 'mlc',
      icon: '🏛️',
      name: 'The MLC (Mechanical Licensing Collective)',
      desc: 'US mechanical royalties from interactive streaming — Spotify/Apple must pay this',
      status: 'locked',
      revenueKey: 'mechanical',
      link: 'https://www.themlc.com/register'
    },
    {
      id: 'songtrust',
      icon: '🌍',
      name: 'Songtrust — International Publishing Admin',
      desc: 'Collects your PRO royalties from 245+ countries and territories',
      status: 'locked',
      revenueKey: 'internationalPub',
      link: 'https://www.songtrust.com'
    },
    {
      id: 'worksReg',
      icon: '📝',
      name: 'Register Works with PRO',
      desc: 'Each song must be individually registered — ASCAP/BMI can\'t pay unregistered works',
      status: 'locked',
      revenueKey: 'worksBonus',
      link: null
    }
  ],
  sync: [
    {
      id: 'neighboring',
      icon: '🌐',
      name: 'Neighboring Rights (PPL / SoundExchange Intl)',
      desc: 'International radio/TV performance royalties paid to recording artist',
      status: 'locked',
      revenueKey: 'neighboring',
      link: 'https://ppluk.com/music-creators/performers/join-ppl/'
    },
    {
      id: 'syncLib',
      icon: '🎬',
      name: 'Sync Library Placement',
      desc: 'Artlist, Musicbed, Epidemic Sound — non-exclusive sync licensing',
      status: 'locked',
      revenueKey: 'sync',
      link: 'https://artists.artlist.io'
    },
    {
      id: 'bandcamp',
      icon: '🏕️',
      name: 'Bandcamp Direct Sales',
      desc: 'Direct-to-fan store — highest margin of any music platform (85% to artist)',
      status: 'locked',
      revenueKey: 'bandcamp',
      link: 'https://bandcamp.com'
    }
  ]
};

// Split sheet data
const rcSplits = [
  {
    title: 'Untitled Track 01',
    streams: '48,200',
    collaborators: [
      { name: 'You', initials: 'Y', role: 'Songwriter / Producer', pct: 60, color: '#00e5ff' },
      { name: 'Co-writer', initials: 'C', role: 'Songwriter', pct: 40, color: '#7c4dff' }
    ],
    proFiled: false
  },
  {
    title: 'Untitled Track 02',
    streams: '31,700',
    collaborators: [
      { name: 'You', initials: 'Y', role: 'Songwriter / Producer', pct: 100, color: '#00e5ff' }
    ],
    proFiled: true
  },
  {
    title: 'Untitled Track 03',
    streams: '17,100',
    collaborators: [
      { name: 'You', initials: 'Y', role: 'Songwriter', pct: 50, color: '#00e5ff' },
      { name: 'Producer X', initials: 'P', role: 'Producer (Master)', pct: 30, color: '#ff4081' },
      { name: 'Feature', initials: 'F', role: 'Featured Artist', pct: 20, color: '#ffeb3b' }
    ],
    proFiled: false
  }
];

// Revenue calculation engine
let rcRevenue = {};

function rcParseNum(inputId) {
  const raw = document.getElementById(inputId)?.value || '0';
  return parseInt(raw.replace(/[^0-9]/g, '')) || 0;
}

function rcCalcRevenue() {
  const spotifyMo  = rcParseNum('rc-spotify-streams');
  const ytMo       = rcParseNum('rc-yt-views');
  const appleMo    = rcParseNum('rc-apple-streams');
  const spotifyYr  = spotifyMo * 12;
  const ytYr       = ytMo * 12;
  const appleYr    = appleMo * 12;
  const totalStreamYr = spotifyYr + appleYr;

  // Master / recording
  const masterStreamingSpotify = spotifyYr * 0.004;
  const masterStreamingApple   = appleYr * 0.008;
  rcRevenue.masterStreaming    = Math.round(masterStreamingSpotify + masterStreamingApple);
  rcRevenue.spotifyBoost       = Math.round(spotifyYr * 0.0003); // analytics/promo uplift est
  rcRevenue.appleMaster        = Math.round(appleYr * 0.0015);   // incremental from claiming profile
  rcRevenue.soundexchange      = Math.round(totalStreamYr * 0.18 * 0.004); // ~18% of streams end up on non-interactive; SXE rate
  rcRevenue.contentId          = Math.round(ytYr * 0.00069);

  // Publishing
  rcRevenue.proPerformance     = Math.round(totalStreamYr * 0.15 * 0.004); // PRO = ~15% of master on streaming
  rcRevenue.mechanical         = Math.round(totalStreamYr * 0.00091);      // MLC mechanical rate
  rcRevenue.internationalPub   = Math.round(rcRevenue.proPerformance * 0.55); // Songtrust intl ~55% of PRO
  rcRevenue.worksBonus         = Math.round((rcRevenue.proPerformance + rcRevenue.mechanical) * 0.08);

  // Sync / other
  rcRevenue.neighboring        = Math.round(rcRevenue.masterStreaming * 0.08);
  rcRevenue.sync               = 500; // flat conservative sync library estimate
  rcRevenue.bandcamp           = Math.round((rcRevenue.masterStreaming) * 0.06);
}

function rcGetRevenue(key) {
  return rcRevenue[key] || 0;
}

function rcFmt(n) {
  if (n >= 1000) return '$' + (n/1000).toFixed(1) + 'K';
  return '$' + Math.round(n);
}

function rcRenderGrid(containerId, regs) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = '';
  regs.forEach(reg => {
    const amt = rcGetRevenue(reg.revenueKey);
    const isReg = reg.status === 'registered';
    const isPend = reg.status === 'pending';
    const isLocked = reg.status === 'locked';
    const amtClass = isReg ? 'claimed' : isPend ? 'unlockable' : 'locked-amt';
    const prefix = isReg ? '' : isPend ? '+ ' : '🔒 ';
    let btnHtml = '';
    if (isReg) {
      btnHtml = `<button class="rc-reg-btn btn-registered">✓ Registered</button>`;
    } else if (isPend) {
      btnHtml = `<button class="rc-reg-btn btn-pending">⏳ Pending</button>`;
    } else {
      const href = reg.link ? `onclick="window.open('${reg.link}','_blank')"` : '';
      btnHtml = `<button class="rc-reg-btn btn-register" data-id="${reg.id}" ${href}>Register →</button>`;
    }
    const statusBadge = isReg
      ? `<div class="rc-reg-status-badge green">● ACTIVE — collecting now</div>`
      : isPend
      ? `<div class="rc-reg-status-badge yellow">◐ Submitted — awaiting approval</div>`
      : `<div class="rc-reg-status-badge dim">○ Not registered — revenue not being collected</div>`;

    el.innerHTML += `
      <div class="rc-reg-row status-${reg.status}" id="rcrow-${reg.id}">
        <div class="rc-reg-icon">${reg.icon}</div>
        <div class="rc-reg-info">
          <div class="rc-reg-name">${reg.name}</div>
          <div class="rc-reg-desc">${reg.desc}</div>
          ${statusBadge}
        </div>
        <div class="rc-reg-revenue">
          <div class="rc-reg-amount ${amtClass}" id="rcamt-${reg.id}">${prefix}${rcFmt(amt)}</div>
          <div class="rc-reg-period">per year</div>
        </div>
        <div class="rc-reg-action">${btnHtml}</div>
      </div>`;
  });

  // Register button interaction
  el.querySelectorAll('.rc-reg-btn.btn-register').forEach(btn => {
    btn.addEventListener('click', function(e) {
      if (!this.onclick) {
        // no external link — simulate toggle
        const id = this.dataset.id;
        const row = document.getElementById('rcrow-' + id);
        if (row) {
          row.classList.remove('status-locked');
          row.classList.add('status-pending', 'just-unlocked');
          setTimeout(()=>row.classList.remove('just-unlocked'), 800);
          this.className = 'rc-reg-btn btn-pending';
          this.textContent = '⏳ Pending';
          row.querySelector('.rc-reg-status-badge').className = 'rc-reg-status-badge yellow';
          row.querySelector('.rc-reg-status-badge').textContent = '◐ Submitted — awaiting approval';
          const amtEl = document.getElementById('rcamt-' + id);
          if (amtEl) { amtEl.className = 'rc-reg-amount unlockable'; }
          // Update reg status in data
          [...rcRegistrations.master, ...rcRegistrations.publishing, ...rcRegistrations.sync]
            .forEach(r => { if (r.id === id) r.status = 'pending'; });
          rcUpdateTotals();
        }
      }
    });
  });
}

function rcRenderSplits() {
  const el = document.getElementById('rc-split-grid');
  if (!el) return;
  el.innerHTML = '';
  rcSplits.forEach((track, idx) => {
    const warnHtml = track.proFiled
      ? `<span class="rc-split-warn ok">✓ PRO Filed</span>`
      : `<span class="rc-split-warn warn">⚠ PRO Unfiled</span>`;
    const collabRows = track.collaborators.map(c => `
      <div class="rc-split-collab-row">
        <div class="rc-split-collab-avatar" style="background:linear-gradient(135deg,${c.color},${c.color}88)">${c.initials}</div>
        <div style="flex:1">
          <div class="rc-split-collab-name">${c.name}</div>
          <div class="rc-split-collab-role">${c.role}</div>
        </div>
        <div class="rc-split-collab-pct">${c.pct}%</div>
      </div>`).join('');
    const pctSegs = track.collaborators.map(c =>
      `<div class="rc-split-pct-seg" style="width:${c.pct}%;background:${c.color}"></div>`
    ).join('');
    const filedTag = track.proFiled
      ? `<span class="rc-split-tag filed">✓ PRO Registered</span>`
      : `<span class="rc-split-tag notfiled">⚠ Register with PRO</span>`;

    el.innerHTML += `
      <div class="rc-split-card" id="split-card-${idx}">
        <div class="rc-split-card-head" onclick="rcToggleSplit(${idx})">
          <div class="rc-split-track-name">${track.title}</div>
          <div class="rc-split-streams">${track.streams} streams</div>
          ${warnHtml}
          <div class="rc-split-chevron">▾</div>
        </div>
        <div class="rc-split-body">
          <div class="rc-split-collaborators">${collabRows}</div>
          <div class="rc-split-pct-bar">${pctSegs}</div>
          <div class="rc-split-actions-row">
            ${filedTag}
            <button class="lab">Edit Splits</button>
            <button class="lab">Download PDF</button>
          </div>
        </div>
      </div>`;
  });
}

function rcToggleSplit(idx) {
  const card = document.getElementById('split-card-' + idx);
  if (card) card.classList.toggle('open');
}

function rcUpdateTotals() {
  const allRegs = [...rcRegistrations.master, ...rcRegistrations.publishing, ...rcRegistrations.sync];
  let claimed = 0, unclaimed = 0, total = 0, completedCount = 0;
  allRegs.forEach(reg => {
    const amt = rcGetRevenue(reg.revenueKey);
    total += amt;
    if (reg.status === 'registered') { claimed += amt; completedCount++; }
    else if (reg.status === 'pending') { unclaimed += amt; completedCount++; }
    else { unclaimed += amt; }
  });

  // Hero numbers
  document.getElementById('rc-claimed-total').textContent = rcFmt(claimed);
  document.getElementById('rc-unclaimed-text').textContent = rcFmt(unclaimed) + '/yr';

  // Ring + bar
  const pct = total > 0 ? Math.round((claimed / total) * 100) : 0;
  const dashOffset = 201 - (201 * pct / 100);
  document.getElementById('rc-ring-fill').style.strokeDashoffset = dashOffset;
  document.getElementById('rc-ring-pct').textContent = pct + '%';
  document.getElementById('rc-progress-bar').style.width = (completedCount / allRegs.length * 100) + '%';
  document.getElementById('rc-completed-count').textContent = completedCount;
  document.getElementById('rc-total-count').textContent = allRegs.length;

  // Progress label
  const remaining = allRegs.length - completedCount;
  document.getElementById('rc-progress-label').textContent =
    remaining > 0
      ? `${remaining} registration${remaining > 1 ? 's' : ''} remaining — ${rcFmt(unclaimed)}/yr uncollected`
      : '✓ All registrations complete — maximum royalty collection active';

  // Location bar status
  roomMeta.royalty.status = `${completedCount} of ${allRegs.length} revenue streams active`;

  // Summary footer
  document.getElementById('rc-sum-claimed').textContent = rcFmt(claimed);
  document.getElementById('rc-sum-unclaimed').textContent = rcFmt(unclaimed);
  document.getElementById('rc-sum-total').textContent = rcFmt(total);
}

function rcRecalculate() {
  rcCalcRevenue();
  // Re-render amounts in existing rows without full re-render (preserve state)
  const allRegs = [...rcRegistrations.master, ...rcRegistrations.publishing, ...rcRegistrations.sync];
  allRegs.forEach(reg => {
    const amtEl = document.getElementById('rcamt-' + reg.id);
    if (amtEl) {
      const amt = rcGetRevenue(reg.revenueKey);
      const isReg = reg.status === 'registered';
      const isPend = reg.status === 'pending';
      const prefix = isReg ? '' : isPend ? '+ ' : '🔒 ';
      amtEl.textContent = prefix + rcFmt(amt);
    }
  });
  rcUpdateTotals();
}

function rcInit() {
  rcCalcRevenue();
  rcRenderGrid('rc-grid-master', rcRegistrations.master);
  rcRenderGrid('rc-grid-publishing', rcRegistrations.publishing);
  rcRenderGrid('rc-grid-sync', rcRegistrations.sync);
  rcRenderSplits();
  rcUpdateTotals();
}

// ════════════════════════════════════════════════════════
//  ROSTER VIEW SYSTEM
// ════════════════════════════════════════════════════════

const ROSTER_ARTISTS = [
  {
    id: 'cordae',
    name: 'Cordae',
    initials: 'CO',
    color: '#7c4dff',
    gradient: 'linear-gradient(135deg,#7c4dff,#5c35cc)',
    tier: 'signed',
    tierLabel: 'SIGNED',
    label: 'Atlantic Records',
    spotifyMonthly: 4200000,
    instagramFollowers: 2000000,
    ytViewsMonthly: 820000,
    appleMonthly: 380000,
    topTracks: ['RNP (ft. Anderson .Paak)', 'Gifted (ft. Roddy Ricch)', 'The Homies', 'Sade', 'Kung Fu'],
    narrative: 'Rising signed artist — real royalty gaps likely. Most relatable to OrbitHQ target user.',
    // registration status: how many of 11 are complete
    regsComplete: 4,
    regsTotal: 11,
    splits: [
      { title: 'RNP (ft. Anderson .Paak)', streams: '12.4M', collaborators: [
        { name: 'Cordae', initials: 'CO', role: 'Songwriter', pct: 50, color: '#7c4dff' },
        { name: 'Anderson .Paak', initials: 'AP', role: 'Songwriter / Feature', pct: 50, color: '#00e5ff' }
      ], proFiled: true },
      { title: 'Gifted (ft. Roddy Ricch)', streams: '9.1M', collaborators: [
        { name: 'Cordae', initials: 'CO', role: 'Songwriter', pct: 60, color: '#7c4dff' },
        { name: 'Roddy Ricch', initials: 'RR', role: 'Songwriter / Feature', pct: 40, color: '#ff4081' }
      ], proFiled: false },
      { title: 'The Homies', streams: '5.8M', collaborators: [
        { name: 'Cordae', initials: 'CO', role: 'Songwriter / Producer', pct: 100, color: '#7c4dff' }
      ], proFiled: true }
    ],
    registrations: {
      master: [
        { id: 'co_spotify', icon: '🎵', name: 'Spotify for Artists', desc: 'Claim your profile, unlock analytics + editorial pitching', status: 'registered', revenueKey: 'spotifyBoost', link: 'https://artists.spotify.com' },
        { id: 'co_sxe', icon: '📻', name: 'SoundExchange', desc: 'Digital performance royalties from Pandora, SiriusXM, iHeartRadio', status: 'locked', revenueKey: 'soundexchange', link: 'https://www.soundexchange.com/artist-copyright-owner/register/' },
        { id: 'co_apple', icon: '🍎', name: 'Apple Music for Artists', desc: 'Claim your Apple profile + Apple Music analytics', status: 'registered', revenueKey: 'appleMaster', link: 'https://artists.apple.com' },
        { id: 'co_cid', icon: '▶️', name: 'YouTube Content ID', desc: 'Claim ad revenue from all YouTube videos using your music', status: 'locked', revenueKey: 'contentId', link: 'https://support.google.com/youtube/answer/2797370' }
      ],
      publishing: [
        { id: 'co_pro', icon: '🎼', name: 'PRO Registration (BMI)', desc: 'Performance royalties from streaming + radio + TV', status: 'registered', revenueKey: 'proPerformance', link: 'https://www.bmi.com/join' },
        { id: 'co_mlc', icon: '🏛️', name: 'The MLC', desc: 'US mechanical royalties from interactive streaming', status: 'locked', revenueKey: 'mechanical', link: 'https://www.themlc.com/register' },
        { id: 'co_st', icon: '🌍', name: 'Songtrust — International Publishing', desc: 'Collects PRO royalties from 245+ countries', status: 'locked', revenueKey: 'internationalPub', link: 'https://www.songtrust.com' },
        { id: 'co_works', icon: '📝', name: 'Register Works with PRO', desc: 'Each song must be individually registered', status: 'registered', revenueKey: 'worksBonus', link: null }
      ],
      sync: [
        { id: 'co_nbr', icon: '🌐', name: 'Neighboring Rights (PPL / SXE Intl)', desc: 'International radio/TV performance royalties', status: 'locked', revenueKey: 'neighboring', link: 'https://ppluk.com/music-creators/performers/join-ppl/' },
        { id: 'co_sync', icon: '🎬', name: 'Sync Library Placement', desc: 'Artlist, Musicbed — non-exclusive sync licensing', status: 'locked', revenueKey: 'sync', link: 'https://artists.artlist.io' },
        { id: 'co_bc', icon: '🏕️', name: 'Bandcamp Direct Sales', desc: 'Direct-to-fan store — 85% to artist', status: 'locked', revenueKey: 'bandcamp', link: 'https://bandcamp.com' }
      ]
    }
  },
  {
    id: 'russ',
    name: 'Russ',
    initials: 'RU',
    color: '#00e676',
    gradient: 'linear-gradient(135deg,#00e676,#00c853)',
    tier: 'independent',
    tierLabel: 'INDEPENDENT',
    label: 'Self-Released (TuneCore)',
    spotifyMonthly: 10800000,
    instagramFollowers: 5000000,
    ytViewsMonthly: 2100000,
    appleMonthly: 960000,
    topTracks: ['Losin Control', 'What They Want', '3:15 (Breathe)', 'Best on Earth (ft. BIA)', 'Missin You Crazy'],
    narrative: 'Owns 100% of masters + publishing. Self-released 11 albums. All registrations green — the independence blueprint.',
    regsComplete: 11,
    regsTotal: 11,
    splits: [
      { title: 'Losin Control', streams: '28.3M', collaborators: [
        { name: 'Russ', initials: 'RU', role: 'Songwriter / Producer', pct: 100, color: '#00e676' }
      ], proFiled: true },
      { title: 'What They Want', streams: '22.1M', collaborators: [
        { name: 'Russ', initials: 'RU', role: 'Songwriter / Producer', pct: 100, color: '#00e676' }
      ], proFiled: true },
      { title: 'Best on Earth (ft. BIA)', streams: '15.7M', collaborators: [
        { name: 'Russ', initials: 'RU', role: 'Songwriter / Producer', pct: 70, color: '#00e676' },
        { name: 'BIA', initials: 'BI', role: 'Songwriter / Feature', pct: 30, color: '#ffeb3b' }
      ], proFiled: true }
    ],
    registrations: {
      master: [
        { id: 'ru_spotify', icon: '🎵', name: 'Spotify for Artists', desc: 'Profile claimed, analytics + editorial active', status: 'registered', revenueKey: 'spotifyBoost', link: 'https://artists.spotify.com' },
        { id: 'ru_sxe', icon: '📻', name: 'SoundExchange', desc: 'Digital performance royalties — fully active', status: 'registered', revenueKey: 'soundexchange', link: null },
        { id: 'ru_apple', icon: '🍎', name: 'Apple Music for Artists', desc: 'Profile claimed + analytics active', status: 'registered', revenueKey: 'appleMaster', link: null },
        { id: 'ru_cid', icon: '▶️', name: 'YouTube Content ID', desc: 'All videos monetized via Content ID', status: 'registered', revenueKey: 'contentId', link: null }
      ],
      publishing: [
        { id: 'ru_pro', icon: '🎼', name: 'PRO Registration (ASCAP)', desc: 'Performance royalties — all works registered', status: 'registered', revenueKey: 'proPerformance', link: null },
        { id: 'ru_mlc', icon: '🏛️', name: 'The MLC', desc: 'US mechanical royalties — fully registered', status: 'registered', revenueKey: 'mechanical', link: null },
        { id: 'ru_st', icon: '🌍', name: 'Songtrust — International Publishing', desc: 'Active in 245+ countries', status: 'registered', revenueKey: 'internationalPub', link: null },
        { id: 'ru_works', icon: '📝', name: 'Register Works with PRO', desc: 'All catalog works individually registered', status: 'registered', revenueKey: 'worksBonus', link: null }
      ],
      sync: [
        { id: 'ru_nbr', icon: '🌐', name: 'Neighboring Rights (PPL)', desc: 'International performance royalties active', status: 'registered', revenueKey: 'neighboring', link: null },
        { id: 'ru_sync', icon: '🎬', name: 'Sync Library Placement', desc: 'Licensed with Artlist, Musicbed + custom deals', status: 'registered', revenueKey: 'sync', link: null },
        { id: 'ru_bc', icon: '🏕️', name: 'Bandcamp Direct Sales', desc: 'Active direct-to-fan store', status: 'registered', revenueKey: 'bandcamp', link: null }
      ]
    }
  },
  {
    id: 'jid',
    name: 'JID',
    initials: 'JD',
    color: '#00e5ff',
    gradient: 'linear-gradient(135deg,#00e5ff,#2979ff)',
    tier: 'indie',
    tierLabel: 'INDIE MAJOR',
    label: 'Dreamville / Interscope',
    spotifyMonthly: 18200000,
    instagramFollowers: 2000000,
    ytViewsMonthly: 3600000,
    appleMonthly: 1620000,
    topTracks: ['Surround Sound (ft. 21 Savage)', 'Dance Now', 'Stars (ft. Yasiin Bey)', "Can't Make U Change", 'Kody Blu 31'],
    narrative: 'Label holds master income, artist collects publishing. Split sheet examples show label ownership structure.',
    regsComplete: 7,
    regsTotal: 11,
    splits: [
      { title: 'Surround Sound (ft. 21 Savage & Baby Tate)', streams: '31.2M', collaborators: [
        { name: 'JID', initials: 'JD', role: 'Songwriter', pct: 40, color: '#00e5ff' },
        { name: '21 Savage', initials: '21', role: 'Songwriter / Feature', pct: 35, color: '#ff4081' },
        { name: 'Baby Tate', initials: 'BT', role: 'Songwriter / Feature', pct: 25, color: '#ffeb3b' }
      ], proFiled: true },
      { title: 'Dance Now', streams: '18.8M', collaborators: [
        { name: 'JID', initials: 'JD', role: 'Songwriter', pct: 60, color: '#00e5ff' },
        { name: 'Co-writer', initials: 'CW', role: 'Songwriter', pct: 40, color: '#7c4dff' }
      ], proFiled: false },
      { title: 'Stars (ft. Yasiin Bey)', streams: '11.4M', collaborators: [
        { name: 'JID', initials: 'JD', role: 'Songwriter', pct: 55, color: '#00e5ff' },
        { name: 'Yasiin Bey', initials: 'YB', role: 'Songwriter / Feature', pct: 45, color: '#00e676' }
      ], proFiled: true }
    ],
    registrations: {
      master: [
        { id: 'jd_spotify', icon: '🎵', name: 'Spotify for Artists', desc: 'Profile claimed — Dreamville / Interscope manages master', status: 'registered', revenueKey: 'spotifyBoost', link: 'https://artists.spotify.com' },
        { id: 'jd_sxe', icon: '📻', name: 'SoundExchange', desc: 'Label handles — artist share being collected', status: 'registered', revenueKey: 'soundexchange', link: null },
        { id: 'jd_apple', icon: '🍎', name: 'Apple Music for Artists', desc: 'Profile claimed via Dreamville', status: 'registered', revenueKey: 'appleMaster', link: null },
        { id: 'jd_cid', icon: '▶️', name: 'YouTube Content ID', desc: 'Label Content ID active — artist share unclaimed', status: 'pending', revenueKey: 'contentId', link: 'https://support.google.com/youtube/answer/2797370' }
      ],
      publishing: [
        { id: 'jd_pro', icon: '🎼', name: 'PRO Registration (ASCAP)', desc: 'Performance royalties — works registered', status: 'registered', revenueKey: 'proPerformance', link: null },
        { id: 'jd_mlc', icon: '🏛️', name: 'The MLC', desc: 'US mechanicals — registered through label pub admin', status: 'registered', revenueKey: 'mechanical', link: null },
        { id: 'jd_st', icon: '🌍', name: 'Songtrust — International Publishing', desc: 'Some international territories uncollected', status: 'locked', revenueKey: 'internationalPub', link: 'https://www.songtrust.com' },
        { id: 'jd_works', icon: '📝', name: 'Register Works with PRO', desc: 'Most catalog registered — 3 newer tracks pending', status: 'registered', revenueKey: 'worksBonus', link: null }
      ],
      sync: [
        { id: 'jd_nbr', icon: '🌐', name: 'Neighboring Rights (PPL)', desc: 'International performance royalties — label handles EU, other territories missed', status: 'locked', revenueKey: 'neighboring', link: 'https://ppluk.com/music-creators/performers/join-ppl/' },
        { id: 'jd_sync', icon: '🎬', name: 'Sync Library Placement', desc: 'Dreamville handles major sync — independent library not set up', status: 'locked', revenueKey: 'sync', link: 'https://artists.artlist.io' },
        { id: 'jd_bc', icon: '🏕️', name: 'Bandcamp Direct Sales', desc: 'No direct-to-fan store — leaving margin on the table', status: 'locked', revenueKey: 'bandcamp', link: 'https://bandcamp.com' }
      ]
    }
  },
  {
    id: 'sza',
    name: 'SZA',
    initials: 'SZ',
    color: '#ff4081',
    gradient: 'linear-gradient(135deg,#ff4081,#e91e63)',
    tier: 'superstar',
    tierLabel: 'SUPERSTAR',
    label: 'TDE / RCA Records',
    spotifyMonthly: 71200000,
    instagramFollowers: 23000000,
    ytViewsMonthly: 14200000,
    appleMonthly: 6350000,
    topTracks: ['Kill Bill', 'Snooze', 'Good Days', 'All The Stars (ft. Kendrick)', 'Kiss Me More (ft. Doja Cat)'],
    narrative: '7x Grammy winner. Superstar ceiling view. TDE/RCA master deal — but publishing royalties enormous across SOS catalog.',
    regsComplete: 9,
    regsTotal: 11,
    splits: [
      { title: 'Kill Bill', streams: '1.5B', collaborators: [
        { name: 'SZA', initials: 'SZ', role: 'Songwriter', pct: 45, color: '#ff4081' },
        { name: 'Jacob Kasher', initials: 'JK', role: 'Songwriter', pct: 30, color: '#7c4dff' },
        { name: 'Rob Bisel', initials: 'RB', role: 'Producer', pct: 25, color: '#00e5ff' }
      ], proFiled: true },
      { title: 'Snooze', streams: '1.2B', collaborators: [
        { name: 'SZA', initials: 'SZ', role: 'Songwriter', pct: 40, color: '#ff4081' },
        { name: 'producer(s)', initials: 'PR', role: 'Production', pct: 35, color: '#ffeb3b' },
        { name: 'Co-writers', initials: 'CW', role: 'Songwriter', pct: 25, color: '#00e676' }
      ], proFiled: true },
      { title: 'Good Days', streams: '1.0B', collaborators: [
        { name: 'SZA', initials: 'SZ', role: 'Songwriter / Producer', pct: 55, color: '#ff4081' },
        { name: 'Co-writers', initials: 'CW', role: 'Songwriter', pct: 45, color: '#7c4dff' }
      ], proFiled: true }
    ],
    registrations: {
      master: [
        { id: 'sz_spotify', icon: '🎵', name: 'Spotify for Artists', desc: 'Profile claimed — TDE/RCA manages master revenue', status: 'registered', revenueKey: 'spotifyBoost', link: null },
        { id: 'sz_sxe', icon: '📻', name: 'SoundExchange', desc: 'Digital performance — label handles + artist split active', status: 'registered', revenueKey: 'soundexchange', link: null },
        { id: 'sz_apple', icon: '🍎', name: 'Apple Music for Artists', desc: 'Profile claimed — full analytics active', status: 'registered', revenueKey: 'appleMaster', link: null },
        { id: 'sz_cid', icon: '▶️', name: 'YouTube Content ID', desc: 'Label Content ID fully active across all catalog', status: 'registered', revenueKey: 'contentId', link: null }
      ],
      publishing: [
        { id: 'sz_pro', icon: '🎼', name: 'PRO Registration (ASCAP)', desc: 'All songwriting credits registered — major collection', status: 'registered', revenueKey: 'proPerformance', link: null },
        { id: 'sz_mlc', icon: '🏛️', name: 'The MLC', desc: 'US mechanicals — registered, major revenue stream', status: 'registered', revenueKey: 'mechanical', link: null },
        { id: 'sz_st', icon: '🌍', name: 'Songtrust — International Publishing', desc: 'Global collection active in 245+ territories', status: 'registered', revenueKey: 'internationalPub', link: null },
        { id: 'sz_works', icon: '📝', name: 'Register Works with PRO', desc: 'Full SOS catalog registered — newer tracks need update', status: 'pending', revenueKey: 'worksBonus', link: null }
      ],
      sync: [
        { id: 'sz_nbr', icon: '🌐', name: 'Neighboring Rights (PPL)', desc: 'EU + international rights — partial collection only', status: 'locked', revenueKey: 'neighboring', link: 'https://ppluk.com/music-creators/performers/join-ppl/' },
        { id: 'sz_sync', icon: '🎬', name: 'Sync Library Placement', desc: 'Major sync deals via TDE — independent library missing', status: 'locked', revenueKey: 'sync', link: 'https://artists.artlist.io' },
        { id: 'sz_bc', icon: '🏕️', name: 'Bandcamp Direct Sales', desc: 'No direct-to-fan store — huge margin gap at this scale', status: 'registered', revenueKey: 'bandcamp', link: null }
      ]
    }
  }
];


// ═══════════════════════════════════════════════
// THE VAULT — CATALOG / PLAQUE WALL
// ═══════════════════════════════════════════════

const VAULT_CATALOG = {
  cordae: [
    { id:'c1', title:'From a Birds Eye View', type:'album', year:2022, emoji:'🌅', bg:'linear-gradient(135deg,#1a0a3a,#2d1060)', streams:'420M', appleStreams:'85M', ytViews:'62M', certs:['Gold','Gold (US)'], label:'Atlantic Records', tracks:14,
      splits:[{song:'Bad Idea (feat. Lil Durk)',splits:['Cordae 40%','Lil Durk 30%','Prod. 30%']},{song:'Two Tens (feat. Anderson .Paak)',splits:['Cordae 45%','Anderson .Paak 35%','Prod. 20%']}],
      regs:{master:'Complete',publishing:'Complete',sync:'Partial',soundExchange:'Pending'}},
    { id:'c2', title:'The Lost Boy', type:'album', year:2019, emoji:'🛸', bg:'linear-gradient(135deg,#0a1a3a,#1a3060)', streams:'880M', appleStreams:'190M', ytViews:'210M', certs:['Platinum','Grammy Nom.'], label:'Atlantic Records', tracks:12,
      splits:[{song:'RNP (feat. Anderson .Paak)',splits:['Cordae 40%','Anderson .Paak 35%','Prod. 25%']},{song:'Gifted (feat. Roddy Ricch)',splits:['Cordae 45%','Roddy Ricch 30%','Prod. 25%']}],
      regs:{master:'Complete',publishing:'Partial',sync:'Missing',soundExchange:'Missing'}},
    { id:'c3', title:'Gifted', type:'single', year:2019, emoji:'🎁', bg:'linear-gradient(135deg,#1a0a2a,#3a1560)', streams:'310M', appleStreams:'65M', ytViews:'88M', certs:['Gold'], label:'Atlantic Records', tracks:1,
      splits:[{song:'Gifted',splits:['Cordae 45%','Roddy Ricch 30%','Prod. 25%']}],
      regs:{master:'Complete',publishing:'Partial',sync:'Missing',soundExchange:'Missing'}},
    { id:'c4', title:'RNP', type:'single', year:2019, emoji:'📡', bg:'linear-gradient(135deg,#0a1530,#1e3a7a)', streams:'240M', appleStreams:'48M', ytViews:'71M', certs:['Gold'], label:'Atlantic Records', tracks:1,
      splits:[{song:'RNP',splits:['Cordae 40%','Anderson .Paak 35%','Prod. 25%']}],
      regs:{master:'Complete',publishing:'Missing',sync:'Missing',soundExchange:'Pending'}},
    { id:'c5', title:'The Homies', type:'single', year:2021, emoji:'🌐', bg:'linear-gradient(135deg,#1a0a40,#4a20a0)', streams:'95M', appleStreams:'22M', ytViews:'18M', certs:[], label:'Atlantic Records', tracks:1,
      splits:[{song:'The Homies',splits:['Cordae 50%','Prod. 30%','Writer 20%']}],
      regs:{master:'Partial',publishing:'Missing',sync:'Missing',soundExchange:'Missing'}},
  ],
  russ: [
    { id:'r1', title:'Chomp 2', type:'album', year:2022, emoji:'🐊', bg:'linear-gradient(135deg,#0a2a1a,#1a5a30)', streams:'680M', appleStreams:'140M', ytViews:'95M', certs:['Gold'], label:'DIEMON / TuneCore', tracks:18,
      splits:[{song:'Pull the Trigger',splits:['Russ 100% (self-produced)']},{song:'What They Want',splits:['Russ 100% (self-produced)']}],
      regs:{master:'Complete',publishing:'Complete',sync:'Complete',soundExchange:'Complete'}},
    { id:'r2', title:'Shake the Snow Globe', type:'album', year:2020, emoji:'🌨️', bg:'linear-gradient(135deg,#0a1a2a,#1a3d5a)', streams:'1.1B', appleStreams:'220M', ytViews:'185M', certs:['Gold','Platinum (DE)'], label:'DIEMON / TuneCore', tracks:20,
      splits:[{song:'Losing Control',splits:['Russ 100% (self-produced)']},{song:'3:15 (Breathe)',splits:['Russ 95%','Co-writer 5%']}],
      regs:{master:'Complete',publishing:'Complete',sync:'Complete',soundExchange:'Complete'}},
    { id:'r3', title:'Losin Control', type:'single', year:2017, emoji:'🎯', bg:'linear-gradient(135deg,#1a2a0a,#3a6015)', streams:'890M', appleStreams:'180M', ytViews:'320M', certs:['4× Platinum'], label:'DIEMON / TuneCore', tracks:1,
      splits:[{song:'Losin Control',splits:['Russ 100% (self-produced)']}],
      regs:{master:'Complete',publishing:'Complete',sync:'Complete',soundExchange:'Complete'}},
    { id:'r4', title:'What They Want', type:'single', year:2016, emoji:'💡', bg:'linear-gradient(135deg,#0a2a15,#1a5530)', streams:'650M', appleStreams:'130M', ytViews:'240M', certs:['2× Platinum'], label:'DIEMON / TuneCore', tracks:1,
      splits:[{song:'What They Want',splits:['Russ 100% (self-produced)']}],
      regs:{master:'Complete',publishing:'Complete',sync:'Complete',soundExchange:'Complete'}},
  ],
  jid: [
    { id:'j1', title:'The Forever Story', type:'album', year:2022, emoji:'📖', bg:'linear-gradient(135deg,#0a1a2a,#1030a0)', streams:'1.4B', appleStreams:'280M', ytViews:'210M', certs:['Gold'], label:'Dreamville / Interscope', tracks:20,
      splits:[{song:'Surround Sound',splits:['JID 35%','21 Savage 25%','Baby Tate 20%','Prod. 20%']},{song:'Dance Now',splits:['JID 40%','Busta Rhymes 25%','Prod. 35%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Partial',soundExchange:'Pending'}},
    { id:'j2', title:'DiCaprio 2', type:'album', year:2018, emoji:'🎬', bg:'linear-gradient(135deg,#1a0a0a,#7a1010)', streams:'920M', appleStreams:'195M', ytViews:'150M', certs:['Gold'], label:'Dreamville / Interscope', tracks:16,
      splits:[{song:'Off Deez (feat. J. Cole)',splits:['JID 30%','J. Cole 30%','Prod. 40%']},{song:"Workin' Out",splits:['JID 50%','Prod. 35%','Co-writer 15%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Missing',soundExchange:'Pending'}},
    { id:'j3', title:'Surround Sound', type:'single', year:2022, emoji:'🔊', bg:'linear-gradient(135deg,#0a0a2a,#1515a0)', streams:'480M', appleStreams:'96M', ytViews:'72M', certs:['Gold'], label:'Dreamville / Interscope', tracks:1,
      splits:[{song:'Surround Sound',splits:['JID 35%','21 Savage 25%','Baby Tate 20%','Prod. 20%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Partial',soundExchange:'Missing'}},
  ],
  sza: [
    { id:'s1', title:'SOS', type:'album', year:2022, emoji:'🆘', bg:'linear-gradient(135deg,#2a0a1a,#a02060)', streams:'8.2B', appleStreams:'1.6B', ytViews:'1.1B', certs:['Diamond','7× Platinum'], label:'TDE / RCA Records', tracks:23,
      splits:[{song:'Kill Bill',splits:['SZA 45%','Ctrl Boy 30%','Prog. 25%']},{song:'Snooze',splits:['SZA 50%','Prod. 30%','Co-writer 20%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Complete',soundExchange:'Partial'}},
    { id:'s2', title:'Ctrl', type:'album', year:2017, emoji:'⚡', bg:'linear-gradient(135deg,#1a0a30,#5a20a0)', streams:'5.4B', appleStreams:'1.1B', ytViews:'820M', certs:['4× Platinum'], label:'TDE / RCA Records', tracks:14,
      splits:[{song:'The Weekend',splits:['SZA 50%','Prod. 30%','Co-writer 20%']},{song:'Drew Barrymore',splits:['SZA 45%','Prod. 35%','Co-writer 20%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Complete',soundExchange:'Complete'}},
    { id:'s3', title:'Kill Bill', type:'single', year:2022, emoji:'🗡️', bg:'linear-gradient(135deg,#2a0808,#a01818)', streams:'1.5B', appleStreams:'300M', ytViews:'210M', certs:['4× Platinum','Diamond (streams)'], label:'TDE / RCA Records', tracks:1,
      splits:[{song:'Kill Bill',splits:['SZA 45%','Ctrl Boy 30%','Prog. 25%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Complete',soundExchange:'Complete'}},
    { id:'s4', title:'Good Days', type:'single', year:2020, emoji:'☀️', bg:'linear-gradient(135deg,#1a2a0a,#506020)', streams:'1.0B', appleStreams:'200M', ytViews:'155M', certs:['2× Platinum'], label:'TDE / RCA Records', tracks:1,
      splits:[{song:'Good Days',splits:['SZA 55%','Prod. 30%','Co-writer 15%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Partial',soundExchange:'Partial'}},
    { id:'s5', title:'Snooze', type:'single', year:2022, emoji:'😴', bg:'linear-gradient(135deg,#0a1a2a,#103060)', streams:'1.2B', appleStreams:'240M', ytViews:'180M', certs:['2× Platinum'], label:'TDE / RCA Records', tracks:1,
      splits:[{song:'Snooze',splits:['SZA 50%','Prod. 30%','Co-writer 20%']}],
      regs:{master:'Label Controlled',publishing:'Complete',sync:'Complete',soundExchange:'Partial'}},
  ]
};

let vaultActiveFilter = 'all';
let vaultLabelMode = false;
let vaultCurrentRelease = null;

function vaultInit() {
  const artist = ROSTER_ARTISTS.find(a => a.id === activeArtistId);
  const catalog = VAULT_CATALOG[activeArtistId] || [];
  const hall = document.getElementById('vaultHallMain');
  if (!hall) return;
  hall.innerHTML = `
    <div class="plaque-hall">
      <div class="plaque-hall-label">— ${artist.name.toUpperCase()} — ${catalog.length} Releases</div>
      <div class="plaque-grid" id="plaqueGridMain">
        ${vaultBuildPlaques(catalog, activeArtistId)}
      </div>
    </div>
  `;
}

function vaultBuildPlaques(catalog, artistId) {
  const artist = ROSTER_ARTISTS.find(a => a.id === artistId);
  return catalog
    .filter(r => {
      if (vaultActiveFilter === 'all') return true;
      if (vaultActiveFilter === 'albums') return r.type === 'album';
      if (vaultActiveFilter === 'singles') return r.type === 'single';
      if (vaultActiveFilter === 'eps') return r.type === 'ep';
      if (vaultActiveFilter === 'gold') return r.certs.some(c => c.toLowerCase().includes('gold') || c.toLowerCase().includes('platinum') || c.toLowerCase().includes('diamond'));
      if (vaultActiveFilter === 'platinum') return r.certs.some(c => c.toLowerCase().includes('platinum') || c.toLowerCase().includes('diamond'));
      return true;
    })
    .map(r => {
      const topCert = r.certs[0] || null;
      const certLevel = topCert ? (topCert.toLowerCase().includes('diamond') ? 'diamond' : topCert.toLowerCase().includes('platinum') ? 'platinum' : 'gold') : null;
      const typeColor = r.type === 'album' ? '#7c4dff' : r.type === 'single' ? '#00e5ff' : '#ff4081';
      return `
        <div class="plaque" onclick="vaultOpenRelease('${r.id}','${artistId}')">
          <div class="plaque-frame">
            <div class="plaque-type-bar" style="background:${typeColor}44;"><div style="height:100%;width:60%;background:${typeColor};opacity:0.6;border-radius:2px"></div></div>
            <div class="plaque-cover" style="--cover-bg:${r.bg}">
              <div style="background:${r.bg};position:absolute;inset:0;border-radius:2px"></div>
              <span style="position:relative;z-index:1;font-size:2rem">${r.emoji}</span>
              <div class="plaque-cover-overlay"></div>
              <div class="plaque-streams-badge">${r.streams}</div>
            </div>
            <div class="plaque-title">${r.title}</div>
            <div class="plaque-meta">
              <span>${r.year}</span>
              <span>${r.type.toUpperCase()}</span>
            </div>
            ${certLevel ? `
            <div class="plaque-certification">
              <span class="cert-icon">${certLevel === 'diamond' ? '💎' : certLevel === 'platinum' ? '🪙' : '🥇'}</span>
              <span class="cert-text ${certLevel}">${topCert.toUpperCase()}</span>
            </div>` : '<div style="height:18px"></div>'}
          </div>
          <div class="plaque-shadow"></div>
        </div>
      `;
    }).join('');
}

function vaultFilter(type, btn) {
  vaultActiveFilter = type;
  document.querySelectorAll('.vault-filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  vaultInit();
  if (vaultLabelMode) vaultRenderLabel();
}

function vaultToggleLabel() {
  vaultLabelMode = !vaultLabelMode;
  const tog = document.getElementById('vaultLabelToggle');
  const labelSec = document.getElementById('vaultLabelSection');
  const mainHall = document.getElementById('vaultHallMain');
  if (vaultLabelMode) {
    tog.classList.add('active');
    tog.textContent = 'Label View: ON';
    mainHall.style.display = 'none';
    labelSec.style.display = 'block';
    vaultRenderLabel();
  } else {
    tog.classList.remove('active');
    tog.textContent = 'Label View: OFF';
    mainHall.style.display = 'block';
    labelSec.style.display = 'none';
  }
}

function vaultRenderLabel() {
  const sec = document.getElementById('vaultLabelSection');
  sec.innerHTML = ROSTER_ARTISTS.map(artist => {
    const catalog = VAULT_CATALOG[artist.id] || [];
    return `
      <div class="boot-section plaque-hall" style="margin-bottom:1.5rem">
        <div class="plaque-hall-label" style="color:${artist.color}88">
          — ${artist.name.toUpperCase()} — ${catalog.length} Releases
          <span style="color:rgba(232,234,246,0.15);margin-left:1rem">${artist.tierLabel}</span>
        </div>
        <div class="plaque-grid">${vaultBuildPlaques(catalog, artist.id)}</div>
      </div>
    `;
  }).join('');
}

function vaultOpenRelease(releaseId, artistId) {
  const catalog = VAULT_CATALOG[artistId] || [];
  const release = catalog.find(r => r.id === releaseId);
  const artist = ROSTER_ARTISTS.find(a => a.id === artistId);
  if (!release || !artist) return;

  vaultCurrentRelease = release;
  const panel = document.getElementById('vaultDetailPanel');

  // Cover
  const cover = document.getElementById('vdpCover');
  cover.style.background = release.bg;
  cover.innerHTML = `<span style="font-size:2.5rem">${release.emoji}</span>`;

  document.getElementById('vdpTitle').textContent = release.title;
  document.getElementById('vdpArtist').textContent = `${artist.name.toUpperCase()} · ${release.year} · ${release.type.toUpperCase()} · ${release.label}`;

  // Certs
  const certsEl = document.getElementById('vdpCerts');
  certsEl.innerHTML = release.certs.map(c => {
    const lvl = c.toLowerCase().includes('diamond') ? 'diamond' : c.toLowerCase().includes('platinum') ? 'platinum' : '';
    return `<span class="vdp-cert-pill ${lvl}">${c.toUpperCase()}</span>`;
  }).join('') || '<span class="vdp-cert-pill" style="opacity:0.4">NO CERT YET</span>';

  // Stats
  document.getElementById('vdpStats').innerHTML = `
    <div class="vdp-stat"><div class="vdp-stat-val">${release.streams}</div><div class="vdp-stat-label">Spotify Streams</div></div>
    <div class="vdp-stat"><div class="vdp-stat-val">${release.appleStreams}</div><div class="vdp-stat-label">Apple Streams</div></div>
    <div class="vdp-stat"><div class="vdp-stat-val">${release.ytViews}</div><div class="vdp-stat-label">YT Views</div></div>
  `;

  // Registrations
  const regColors = { 'Complete':'#00e676','Partial':'#ffeb3b','Missing':'#ff4444','Pending':'#ff9800','Label Controlled':'#00e5ff' };
  document.getElementById('vdpRegs').innerHTML = Object.entries(release.regs).map(([k,v]) => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:0.45rem 0;border-bottom:1px solid rgba(255,255,255,0.04)">
      <span style="font-family:'Space Mono',monospace;font-size:0.48rem;letter-spacing:1px;color:rgba(232,234,246,0.5)">${k}</span>
      <span style="font-family:'Space Mono',monospace;font-size:0.45rem;letter-spacing:2px;color:${regColors[v] || '#888'}">${v.toUpperCase()}</span>
    </div>
  `).join('');

  // Splits
  document.getElementById('vdpSplits').innerHTML = release.splits.map(s => `
    <div style="margin-bottom:0.8rem">
      <div style="font-family:'Space Mono',monospace;font-size:0.48rem;letter-spacing:1px;color:rgba(232,234,246,0.5);margin-bottom:0.35rem">${s.song}</div>
      ${s.splits.map(sp => `
        <div style="display:flex;justify-content:space-between;align-items:center;padding:0.3rem 0.6rem;background:rgba(255,255,255,0.02);border-radius:2px;margin-bottom:2px">
          <span style="font-family:'Space Mono',monospace;font-size:0.42rem;letter-spacing:1px;color:rgba(232,234,246,0.4)">${sp}</span>
        </div>
      `).join('')}
    </div>
  `).join('');

  panel.classList.add('open');
}

function vaultCloseDetail() {
  document.getElementById('vaultDetailPanel').classList.remove('open');
}

// ═══════════════════════════════════════════════
// THE STUDIO — COLLABORATION HUB
// ═══════════════════════════════════════════════

const STUDIO_SESSIONS = [
  {
    id: 'ss1',
    name: 'GIFTED — Final Mix',
    type: 'Mixing',
    status: 'needs-review',
    statusLabel: 'NEEDS REVIEW',
    created: 'Feb 18, 2026',
    updated: '2 hours ago',
    participants: [
      { initials:'CO', color:'#7c4dff', role:'Artist' },
      { initials:'MX', color:'#00e5ff', role:'Mix Engineer' }
    ],
    files: [
      { name:'Gifted_Reference_v1.wav', size:'48 MB', tag:'ref', icon:'🎵', uploader:'CO', date:'Feb 18' },
      { name:'Gifted_Stems_Session.zip', size:'1.2 GB', tag:'stems', icon:'📦', uploader:'CO', date:'Feb 18' },
      { name:'Gifted_Mix_v3_FINAL.wav', size:'52 MB', tag:'mix', icon:'🎚️', uploader:'MX', date:'Feb 19' },
    ],
    timeline: [
      { step:'Session Created', status:'done', detail:'Artist uploaded reference + stems' },
      { step:'Engineer Received Files', status:'done', detail:'Marcus confirmed receipt Feb 18' },
      { step:'Mix Delivered (v3)', status:'active', detail:'Awaiting your review — uploaded 2 hours ago' },
      { step:'Artist Approval', status:'pending', detail:'Approve or request revisions' },
      { step:'Archived to Vault', status:'pending', detail:'Auto-saves approved final to catalog' },
    ]
  },
  {
    id: 'ss2',
    name: 'THE HOMIES — Mastering',
    type: 'Mastering',
    status: 'needs-review',
    statusLabel: 'NEEDS REVIEW',
    created: 'Feb 20, 2026',
    updated: '4 hours ago',
    participants: [
      { initials:'CO', color:'#7c4dff', role:'Artist' },
      { initials:'DM', color:'#ff4081', role:'Mastering Engineer' }
    ],
    files: [
      { name:'TheHomies_MixedFinal.wav', size:'55 MB', tag:'mix', icon:'🎵', uploader:'CO', date:'Feb 20' },
      { name:'TheHomies_Master_v1.wav', size:'58 MB', tag:'master', icon:'💿', uploader:'DM', date:'Feb 20' },
    ],
    timeline: [
      { step:'Session Created', status:'done', detail:'Mixed file sent to mastering' },
      { step:'Engineer Received Files', status:'done', detail:'Demi confirmed receipt Feb 20' },
      { step:'Master Delivered (v1)', status:'active', detail:'First master — awaiting review' },
      { step:'Artist Approval', status:'pending', detail:'Approve or request revisions' },
      { step:'Archived to Vault', status:'pending', detail:'Ready to attach to release in Vault' },
    ]
  },
  {
    id: 'ss3',
    name: 'BIRDS EYE — New Single Collab',
    type: 'Collaboration',
    status: 'in-progress',
    statusLabel: 'IN PROGRESS',
    created: 'Feb 21, 2026',
    updated: 'Yesterday',
    participants: [
      { initials:'CO', color:'#7c4dff', role:'Artist' },
      { initials:'RS', color:'#00e676', role:'Featured Artist' },
      { initials:'PR', color:'#ffd264', role:'Producer' }
    ],
    files: [
      { name:'BirdsEye_BeatV2.mp3', size:'8 MB', tag:'ref', icon:'🎹', uploader:'PR', date:'Feb 21' },
    ],
    timeline: [
      { step:'Session Created', status:'done', detail:'Producer uploaded initial beat' },
      { step:'Artists Recording', status:'active', detail:'Cordae + Russ recording their verses' },
      { step:'Mix & Master', status:'pending', detail:'Engineer assigned — not started' },
      { step:'Approval', status:'pending', detail:'All collaborators must approve' },
      { step:'Archived to Vault', status:'pending', detail:'Will appear in both artist catalogs' },
    ]
  },
  {
    id: 'ss4',
    name: 'RNP — Sync Licensing Master',
    type: 'Sync Prep',
    status: 'delivered',
    statusLabel: 'DELIVERED',
    created: 'Jan 30, 2026',
    updated: 'Feb 2, 2026',
    participants: [
      { initials:'CO', color:'#7c4dff', role:'Artist' },
      { initials:'SL', color:'#7c4dff', role:'Sync Supervisor' }
    ],
    files: [
      { name:'RNP_SyncMaster_Instrumental.wav', size:'62 MB', tag:'master', icon:'🎬', uploader:'SL', date:'Feb 1' },
      { name:'RNP_SyncMaster_Vocal.wav', size:'65 MB', tag:'master', icon:'🎬', uploader:'SL', date:'Feb 1' },
    ],
    timeline: [
      { step:'Session Created', status:'done', detail:'Sync licensing brief received' },
      { step:'Engineer Received Files', status:'done', detail:'Confirmed Jan 31' },
      { step:'Sync Masters Delivered', status:'done', detail:'Both vocal and instrumental masters' },
      { step:'Artist Approval', status:'done', detail:'Approved Feb 2 by Cordae' },
      { step:'Archived to Vault', status:'done', detail:'Attached to RNP release · Feb 2' },
    ]
  }
];

function studioInit() {
  studioRenderRoles();
  studioRenderSessions();
}

function studioRenderRoles() {
  const artist = ROSTER_ARTISTS.find(a => a.id === activeArtistId);
  document.getElementById('studioRoleRow').innerHTML = `
    <div class="studio-role-card">
      <div class="studio-role-title">Lead Artist</div>
      <div class="studio-role-name" style="color:${artist.color}">${artist.name}</div>
      <div class="studio-role-spec">${artist.tierLabel} · Session Owner</div>
    </div>
    <div class="studio-role-card">
      <div class="studio-role-title">Mix Engineer</div>
      <div class="studio-role-name" style="color:#00e5ff">Marcus Webb</div>
      <div class="studio-role-spec">Freelance · 3 Sessions Active</div>
    </div>
    <div class="studio-role-card">
      <div class="studio-role-title">Mastering</div>
      <div class="studio-role-name" style="color:#ff4081">Demi Lorez</div>
      <div class="studio-role-spec">Studio Pack Member · 1 Pending</div>
    </div>
    <div class="studio-role-card" style="background:rgba(0,229,255,0.02);border-style:dashed;border-color:rgba(0,229,255,0.15);cursor:pointer" onclick="studioInvite()">
      <div class="studio-role-title">Add Collaborator</div>
      <div class="studio-role-name" style="color:rgba(232,234,246,0.25);font-size:0.6rem">+ Invite by email</div>
      <div class="studio-role-spec">Producer, engineer, artist</div>
    </div>
  `;
}

function studioRenderSessions() {
  const grid = document.getElementById('sessionGrid');
  if (!grid) return;
  grid.innerHTML = STUDIO_SESSIONS.map(s => {
    const stepsDone = s.timeline.filter(t => t.status === 'done').length;
    const totalSteps = s.timeline.length;
    const pct = Math.round((stepsDone / totalSteps) * 100);
    return `
      <div class="session-card" id="sc-${s.id}" onclick="studioToggleSession('${s.id}')">
        <div class="session-header">
          <div class="session-status-dot ${s.status}"></div>
          <div class="session-info">
            <div class="session-name">${s.name}</div>
            <div class="session-meta">${s.type.toUpperCase()} · Updated ${s.updated} · ${pct}% Complete</div>
          </div>
          <div class="session-participants">
            ${s.participants.map(p => `<div class="session-participant-avatar" style="background:${p.color}22;border-color:rgba(6,13,31,0.9);color:${p.color}">${p.initials}</div>`).join('')}
          </div>
          <div class="session-status-pill ${s.status}">${s.statusLabel}</div>
        </div>
        <div class="session-body">
          <div class="delivery-timeline">
            ${s.timeline.map(t => `
              <div class="delivery-step">
                <div class="delivery-step-dot ${t.status}">${t.status === 'done' ? '✓' : t.status === 'active' ? '●' : '○'}</div>
                <div class="delivery-step-content">
                  <div class="delivery-step-title ${t.status}">${t.step}</div>
                  <div class="delivery-step-detail ${t.status === 'active' ? 'active' : ''}">${t.detail}</div>
                </div>
              </div>
            `).join('')}
          </div>
          <div style="font-family:'Space Mono',monospace;font-size:0.45rem;letter-spacing:3px;color:rgba(255,255,255,0.15);margin:0.75rem 0 0.4rem">FILES IN SESSION</div>
          <div class="session-files">
            ${s.files.map(f => `
              <div class="session-file">
                <div class="session-file-icon">${f.icon}</div>
                <div class="session-file-info">
                  <div class="session-file-name">${f.name}</div>
                  <div class="session-file-meta">Uploaded by ${f.uploader} · ${f.date} · ${f.size}</div>
                </div>
                <span class="session-file-tag ${f.tag}">${f.tag.toUpperCase()}</span>
                <button class="session-file-download" onclick="event.stopPropagation();studioDownload('${f.name}')">↓ GET</button>
              </div>
            `).join('')}
          </div>
          <div class="session-actions">
            ${s.status === 'needs-review' ? `
              <button class="session-btn approve" onclick="event.stopPropagation();studioApprove('${s.id}')">✓ Approve & Archive</button>
              <button class="session-btn primary" onclick="event.stopPropagation();studioRevision('${s.id}')">Request Revision</button>
            ` : s.status === 'in-progress' ? `
              <button class="session-btn primary" onclick="event.stopPropagation();studioUpload('${s.id}')">Upload Files</button>
              <button class="session-btn secondary" onclick="event.stopPropagation();studioMessage('${s.id}')">Message Team</button>
            ` : `
              <button class="session-btn secondary" onclick="event.stopPropagation();studioViewInVault('${s.id}')">View in Vault →</button>
            `}
          </div>
        </div>
      </div>
    `;
  }).join('');
}

function studioToggleSession(id) {
  const card = document.getElementById('sc-' + id);
  if (!card) return;
  const isOpen = card.classList.contains('open');
  document.querySelectorAll('.session-card.open').forEach(c => c.classList.remove('open'));
  if (!isOpen) card.classList.add('open');
}

function studioApprove(id) {
  const s = STUDIO_SESSIONS.find(x => x.id === id);
  if (!s) return;
  s.status = 'delivered'; s.statusLabel = 'DELIVERED';
  s.timeline.forEach(t => t.status = 'done');
  studioRenderSessions();
  const card = document.getElementById('sc-' + id);
  if (card) card.classList.add('open');
  // flash notification
  const notif = document.createElement('div');
  notif.style.cssText = 'position:fixed;bottom:2rem;right:1.5rem;background:rgba(0,230,118,0.15);border:1px solid rgba(0,230,118,0.35);color:#00e676;font-family:Space Mono,monospace;font-size:0.55rem;letter-spacing:2px;padding:0.8rem 1.2rem;border-radius:4px;z-index:9999;animation:fadeIn 0.3s ease';
  notif.textContent = '✓ SESSION APPROVED — Archived to Vault';
  document.body.appendChild(notif);
  setTimeout(() => notif.remove(), 3000);
}

function studioRevision(id) {
  alert('Revision request: In a full build, this opens a timestamped feedback composer sent directly to the engineer.');
}
function studioUpload(id) {
  alert('File upload: In a full build, this opens a secure upload dialog — files are chunked, versioned, and notified to all session members.');
}
function studioMessage(id) {
  alert('Session messaging: In a full build, this opens an inline thread tied to the session timeline.');
}
function studioDownload(filename) {
  alert(`Downloading: ${filename}\n\nIn a full build, this triggers a secure signed URL download from cloud storage.`);
}
function studioViewInVault(id) {
  switchRoom('vault', document.querySelector('[data-room="vault"]'));
}
function studioNewSession() {
  alert('New Session: In a full build, you name the session, set the type (mixing/mastering/collab), and invite collaborators by email. They receive a link to a shared session room.');
}
function studioInvite() {
  alert('Invite Collaborator: Enter their email and role. They get access only to sessions you explicitly share with them.');
}

// ═══════════════════════════════════════════════
// PRICING ROOM
// ═══════════════════════════════════════════════

const PRICING_ROLES = {
  artist: {
    title: 'Artist',
    text: 'For solo artists who want to own their career — royalty tracking, catalog management, stats, and identity protection all in one command center.',
    icon: '🎤'
  },
  manager: {
    title: 'Manager / A&R',
    text: 'Manage multiple artists from one dashboard. See roster health, gap analysis, and revenue opportunities across your entire client list.',
    icon: '📋'
  },
  studio: {
    title: 'Studio Owner / Engineer',
    text: 'Run sessions, deliver files, and manage client projects. Your clients get a clean portal — you get full workflow visibility.',
    icon: '🎛️'
  },
  label: {
    title: 'Label / Publishing Admin',
    text: 'Full catalog control, deal tracking, multi-artist royalty oversight, and A&R tools designed for teams running multiple revenue streams.',
    icon: '🏢'
  }
};

const PRICING_TIERS = [
  {
    id: 'free', name: 'Orbit Free', price: 0, color: 'rgba(232,234,246,0.5)',
    features: [
      { text:'Dashboard + Identity Lab', included:true },
      { text:'Basic Stats Explorer', included:true },
      { text:'1 Split Sheet', included:true },
      { text:'Royalty Command', included:false },
      { text:'The Vault (catalog)', included:false },
      { text:'The Studio', included:false },
    ]
  },
  {
    id: 'pro', name: 'Orbit Pro', price: 19, color: '#00e5ff', featured: true,
    features: [
      { text:'Everything in Free', included:true },
      { text:'Full Royalty Command', included:true },
      { text:'The Vault — full catalog', included:true },
      { text:'Unlimited split sheets', included:true },
      { text:'All 11 reg trackers', included:true },
      { text:'The Studio (1 active session)', included:false },
    ]
  },
  {
    id: 'elite', name: 'Orbit Elite', price: 39, color: '#7c4dff',
    features: [
      { text:'Everything in Pro', included:true },
      { text:'The Studio — 10 sessions', included:true },
      { text:'Advanced analytics', included:true },
      { text:'Priority support', included:true },
      { text:'Early access features', included:true },
      { text:'API access (coming soon)', included:true },
    ]
  }
];

const PRICING_ADDONS = [
  {
    id: 'manager', name: 'Manager Pack', color: '#ff4081',
    desc: 'Roster View, multi-artist dashboards, client reporting, gap analysis across all artists.',
    price: 15, period:'/mo · per seat'
  },
  {
    id: 'studio', name: 'Studio Pack', color: '#00e5ff',
    desc: 'Unlimited studio sessions, client portal, delivery workflow, version tracking, auto-archive to Vault.',
    price: 20, period:'/mo · per studio'
  },
  {
    id: 'label', name: 'Label Pack', color: '#ffd264',
    desc: 'Full label catalog command, deal tracking, A&R tools, multi-user team seats, royalty oversight at scale.',
    price: 49, period:'/mo · per label'
  }
];

let pricingSelectedTier = null;
let pricingSelectedAddons = new Set();
let pricingCurrentRole = 'artist';

function pricingInit() {
  pricingSetRole('artist', document.querySelector('[data-role="artist"]'));
}

function pricingSetRole(role, tabEl) {
  pricingCurrentRole = role;
  document.querySelectorAll('.pricing-role-tab').forEach(t => t.classList.remove('active'));
  if (tabEl) tabEl.classList.add('active');

  const rd = PRICING_ROLES[role];
  document.getElementById('pricingRoleTitle').textContent = rd.icon + ' ' + rd.title;
  document.getElementById('pricingRoleText').textContent = rd.text;
  document.getElementById('pricingRoleDesc').classList.add('visible');

  // Auto-suggest relevant addon
  pricingSelectedAddons.clear();
  if (role === 'manager') pricingSelectedAddons.add('manager');
  if (role === 'studio') pricingSelectedAddons.add('studio');
  if (role === 'label') { pricingSelectedAddons.add('label'); pricingSelectedAddons.add('manager'); }

  pricingRenderBase();
  pricingRenderAddons();
  pricingUpdateSummary();
}

function pricingRenderBase() {
  const grid = document.getElementById('pricingBaseGrid');
  if (!grid) return;
  grid.innerHTML = PRICING_TIERS.map(t => `
    <div class="pricing-tier-card ${t.featured ? 'featured':''} ${pricingSelectedTier === t.id ? 'selected':''}"
         style="--tier-color:${t.color}"
         onclick="pricingSelectTier('${t.id}')">
      <div class="pricing-tier-name">${t.name}</div>
      <div class="pricing-tier-price" style="color:${t.color}">${t.price === 0 ? 'Free' : '$' + t.price}</div>
      <div class="pricing-tier-period">${t.price === 0 ? 'forever' : 'per month · billed annually'}</div>
      <div class="pricing-tier-features">
        ${t.features.map(f => `<div class="pricing-tier-feature ${f.included ? 'included' : 'excluded'}">${f.text}</div>`).join('')}
      </div>
      <button class="pricing-select-btn">${pricingSelectedTier === t.id ? '✓ SELECTED' : 'SELECT PLAN'}</button>
    </div>
  `).join('');
}

function pricingRenderAddons() {
  const grid = document.getElementById('pricingAddonsGrid');
  if (!grid) return;
  grid.innerHTML = PRICING_ADDONS.map(a => `
    <div class="addon-card ${pricingSelectedAddons.has(a.id) ? 'selected':''}"
         style="--addon-color:${a.color}"
         onclick="pricingToggleAddon('${a.id}')">
      <div class="addon-check">${pricingSelectedAddons.has(a.id) ? '✓' : ''}</div>
      <div class="addon-info">
        <div class="addon-name" style="color:${pricingSelectedAddons.has(a.id) ? a.color : 'rgba(232,234,246,0.7)'}">${a.name}</div>
        <div class="addon-desc">${a.desc}</div>
        <div class="addon-price" style="color:${a.color}">+$${a.price}<span class="addon-period"> ${a.period}</span></div>
      </div>
    </div>
  `).join('');
}

function pricingSelectTier(id) {
  pricingSelectedTier = id;
  pricingRenderBase();
  pricingUpdateSummary();
}

function pricingToggleAddon(id) {
  if (pricingSelectedAddons.has(id)) pricingSelectedAddons.delete(id);
  else pricingSelectedAddons.add(id);
  pricingRenderAddons();
  pricingUpdateSummary();
}

function pricingUpdateSummary() {
  const tier = PRICING_TIERS.find(t => t.id === pricingSelectedTier);
  const addonTotal = [...pricingSelectedAddons].reduce((sum, id) => {
    const a = PRICING_ADDONS.find(x => x.id === id);
    return sum + (a ? a.price : 0);
  }, 0);
  const base = tier ? tier.price : 0;
  const total = base + addonTotal;

  document.getElementById('pricingSummaryAmount').textContent = total === 0 ? '$0 / mo' : `$${total} / mo`;

  let breakdown = [];
  if (tier) breakdown.push(`${tier.name}: $${tier.price}`);
  [...pricingSelectedAddons].forEach(id => {
    const a = PRICING_ADDONS.find(x => x.id === id);
    if (a) breakdown.push(`${a.name}: +$${a.price}`);
  });
  document.getElementById('pricingSummaryBreakdown').textContent = breakdown.length ? breakdown.join(' · ') : 'Select a plan to get started';

  const saveBadge = document.getElementById('pricingSaveBadge');
  if (total > 0) {
    const annualSave = Math.round(total * 12 * 0.25);
    saveBadge.textContent = `Save $${annualSave}/yr with annual billing`;
    saveBadge.style.display = 'block';
  } else {
    saveBadge.style.display = 'none';
  }
}

function pricingGetStarted() {
  if (!pricingSelectedTier) {
    alert('Select a base plan first — Free, Pro, or Elite.');
    return;
  }
  const tier = PRICING_TIERS.find(t => t.id === pricingSelectedTier);
  const addons = [...pricingSelectedAddons].map(id => PRICING_ADDONS.find(a => a.id === id)?.name).filter(Boolean);
  alert(`Starting your Orbit Plan:\n\nBase: ${tier.name}\n${addons.length ? 'Add-ons: ' + addons.join(', ') : ''}\n\nIn a full build, this launches checkout via Stripe.`);
}

// ═══════════════════════════════════════════════
// Roster state
let rosterMode = false;
let activeArtistId = 'cordae'; // default

function toggleRosterMode() {
  rosterMode = !rosterMode;
  const bar = document.getElementById('rosterBar');
  const btn = document.getElementById('demoModeBtn');
  if (rosterMode) {
    bar.style.display = 'flex';
    btn.style.borderColor = 'rgba(255,64,129,0.5)';
    btn.style.color = '#ff4081';
    btn.textContent = '[ Solo Mode ]';
    rosterRenderChips();
    rosterLoadArtist(activeArtistId);
    // auto-navigate to roster overview
    switchRoom('roster', document.querySelector('[data-room="roster"]'));
  } else {
    bar.style.display = 'none';
    btn.style.borderColor = 'rgba(255,64,129,0.25)';
    btn.style.color = 'rgba(255,64,129,0.5)';
    btn.textContent = '[ Roster Mode ]';
    document.getElementById('artistContextBanner').style.display = 'none';
    // restore default data
    rosterLoadArtist('cordae');
    switchRoom('dashboard', document.querySelector('[data-room="dashboard"]'));
  }
}

function rosterRenderChips() {
  const container = document.getElementById('rosterChips');
  container.innerHTML = '';
  ROSTER_ARTISTS.forEach(a => {
    const active = a.id === activeArtistId ? 'active' : '';
    container.innerHTML += `
      <div class="roster-chip ${active}" id="chip-${a.id}" onclick="rosterSelectArtist('${a.id}')">
        <div class="rc-avatar" style="background:${a.gradient}">${a.initials}</div>
        <span class="rc-chip-name">${a.name}</span>
        <span class="rc-chip-tier ${a.tier}">${a.tierLabel}</span>
      </div>`;
  });
}

function rosterSelectArtist(id) {
  activeArtistId = id;
  rosterRenderChips();
  rosterLoadArtist(id);
  // If not on a room that makes sense, go to royalty command
  const currentRoom = document.querySelector('.room.active');
  if (currentRoom && currentRoom.id === 'room-roster') {
    // stay on roster, just re-highlight
  } else {
    switchRoom('royalty', document.querySelector('[data-room="royalty"]'));
  }
}

function rosterFmtNum(n) {
  if (n >= 1000000) return (n/1000000).toFixed(1) + 'M';
  if (n >= 1000) return (n/1000).toFixed(0) + 'K';
  return n;
}

function rosterLoadArtist(id) {
  const a = ROSTER_ARTISTS.find(x => x.id === id);
  if (!a) return;

  // 1. Update stream inputs with artist's real data
  const spotifyPerMonth = Math.round(a.spotifyMonthly / 1000);
  const ytPerMonth = Math.round(a.ytViewsMonthly / 1000);
  const applePerMonth = Math.round(a.appleMonthly / 1000);

  // Use actual values per month scaled for "per-song" estimate (divide by catalog ~10 tracks)
  const spotifyInput = document.getElementById('rc-spotify-streams');
  const ytInput = document.getElementById('rc-yt-views');
  const appleInput = document.getElementById('rc-apple-streams');
  if (spotifyInput) spotifyInput.value = Math.round(a.spotifyMonthly / 10).toLocaleString();
  if (ytInput) ytInput.value = Math.round(a.ytViewsMonthly / 8).toLocaleString();
  if (appleInput) appleInput.value = Math.round(a.appleMonthly / 10).toLocaleString();

  // 2. Swap registration data
  rcRegistrations.master = a.registrations.master;
  rcRegistrations.publishing = a.registrations.publishing;
  rcRegistrations.sync = a.registrations.sync;

  // 3. Swap split data
  rcSplits.length = 0;
  a.splits.forEach(s => rcSplits.push(s));

  // 4. Update artist context banner
  const banner = document.getElementById('artistContextBanner');
  if (banner) {
    if (rosterMode) {
      banner.style.display = 'flex';
      banner.style.setProperty('--artist-color', a.color);
      banner.style.borderColor = a.color + '30';
      banner.style.background = a.color + '08';
    }
    document.getElementById('acbAvatar').textContent = a.initials;
    document.getElementById('acbAvatar').style.background = a.gradient;
    document.getElementById('acbAvatar').style.color = '#fff';
    document.getElementById('acbName').textContent = a.name;
    document.getElementById('acbName').style.color = a.color;
    document.getElementById('acbMeta').textContent = `${a.label} · ${a.tier.toUpperCase()}`;
    document.getElementById('acbStats').innerHTML = `
      <div class="acb-stat">
        <div class="acb-stat-val" style="color:${a.color}">${rosterFmtNum(a.spotifyMonthly)}</div>
        <div class="acb-stat-label">Monthly Listeners</div>
      </div>
      <div class="acb-stat">
        <div class="acb-stat-val" style="color:${a.color}">${rosterFmtNum(a.instagramFollowers)}</div>
        <div class="acb-stat-label">Instagram Followers</div>
      </div>
      <div class="acb-stat">
        <div class="acb-stat-val" style="color:${a.color}">${a.regsComplete}/${a.regsTotal}</div>
        <div class="acb-stat-label">Registrations Done</div>
      </div>`;
    const badge = document.getElementById('acbLabelBadge');
    badge.textContent = a.tierLabel;
    badge.style.background = a.color + '20';
    badge.style.color = a.color;
    badge.style.borderColor = a.color + '40';
  }

  // 5. Re-init royalty command with new data
  rcInit();
}

function rosterAddArtist() {
  alert('Add artist to roster — this will connect to your OrbitHQ account system. Feature in v5.');
}

function rosterRenderOverview() {
  // Summary stats
  const sumRow = document.getElementById('rosterSummaryRow');
  if (sumRow) {
    const totalMonthly = ROSTER_ARTISTS.reduce((a,x) => a + x.spotifyMonthly, 0);
    const totalIG = ROSTER_ARTISTS.reduce((a,x) => a + x.instagramFollowers, 0);
    const avgComplete = ROSTER_ARTISTS.reduce((a,x) => a + (x.regsComplete/x.regsTotal), 0) / ROSTER_ARTISTS.length;
    const gapArtists = ROSTER_ARTISTS.filter(x => (x.regsComplete/x.regsTotal) < 1).length;
    sumRow.innerHTML = `
      <div class="roster-sum-card">
        <div class="roster-sum-val" style="color:#00e5ff">${rosterFmtNum(totalMonthly)}</div>
        <div class="roster-sum-label">Total Monthly Listeners</div>
      </div>
      <div class="roster-sum-card">
        <div class="roster-sum-val" style="color:#ff4081">${rosterFmtNum(totalIG)}</div>
        <div class="roster-sum-label">Combined Followers</div>
      </div>
      <div class="roster-sum-card">
        <div class="roster-sum-val" style="color:#00e676">${Math.round(avgComplete*100)}%</div>
        <div class="roster-sum-label">Avg Registration Health</div>
      </div>
      <div class="roster-sum-card">
        <div class="roster-sum-val" style="color:#ffeb3b">${gapArtists}</div>
        <div class="roster-sum-label">Artists with Royalty Gaps</div>
      </div>`;
  }

  // Artist cards
  const grid = document.getElementById('rosterOverviewGrid');
  if (grid) {
    grid.innerHTML = '';
    ROSTER_ARTISTS.forEach(a => {
      const pct = Math.round((a.regsComplete / a.regsTotal) * 100);
      const isActive = a.id === activeArtistId ? 'active-artist' : '';
      grid.innerHTML += `
        <div class="roster-card ${isActive}" style="--artist-stripe:${a.gradient}" onclick="rosterSelectArtist('${a.id}')">
          <div class="rc-head">
            <div class="rc-head-avatar" style="background:${a.gradient};color:#fff">${a.initials}</div>
            <div class="rc-head-info">
              <div class="rc-head-name" style="color:${a.color}">${a.name}</div>
              <div class="rc-head-label">${a.label}</div>
            </div>
            <span class="rc-chip-tier ${a.tier}" style="margin-left:auto">${a.tierLabel}</span>
          </div>
          <div class="rc-stats-row">
            <div class="rc-mini-stat">
              <div class="rc-mini-stat-val" style="color:${a.color}">${rosterFmtNum(a.spotifyMonthly)}</div>
              <div class="rc-mini-stat-label">Monthly Listeners</div>
            </div>
            <div class="rc-mini-stat">
              <div class="rc-mini-stat-val" style="color:${a.color}">${rosterFmtNum(a.instagramFollowers)}</div>
              <div class="rc-mini-stat-label">Instagram</div>
            </div>
          </div>
          <div class="rc-reg-bar">
            <div class="rc-reg-bar-fill" style="width:${pct}%;background:${a.color}"></div>
          </div>
          <div class="rc-card-footer">
            <div class="rc-card-status">${a.regsComplete}/${a.regsTotal} registrations · ${pct}%</div>
            <button class="rc-card-btn" onclick="event.stopPropagation();rosterSelectArtist('${a.id}')">View →</button>
          </div>
        </div>`;
    });
  }

  // Gap analysis table
  const gapTable = document.getElementById('rosterGapTable');
  if (gapTable) {
    // calculate estimated uncollected for each artist (simplified)
    const gaps = ROSTER_ARTISTS.map(a => {
      const monthlyStreams = a.spotifyMonthly / 10; // per track estimate
      const lockedCount = a.regsTotal - a.regsComplete;
      // rough estimate: each missed registration = some % of annual stream revenue
      const annualRevBase = monthlyStreams * 12 * 0.004;
      const uncollected = Math.round(annualRevBase * (lockedCount / a.regsTotal) * 3.2);
      return { a, uncollected, lockedCount };
    }).sort((x,y) => y.uncollected - x.uncollected);

    gapTable.innerHTML = '';
    gaps.forEach(({ a, uncollected, lockedCount }) => {
      const pct = Math.round((a.regsComplete / a.regsTotal) * 100);
      gapTable.innerHTML += `
        <div class="rc-reg-row" style="cursor:pointer;border-color:${a.color}18" onclick="rosterSelectArtist('${a.id}')">
          <div class="rc-reg-icon" style="font-size:1rem">
            <div class="rc-head-avatar" style="background:${a.gradient};color:#fff;width:32px;height:32px;font-size:0.7rem;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Orbitron',monospace;font-weight:700">${a.initials}</div>
          </div>
          <div class="rc-reg-info">
            <div class="rc-reg-name" style="color:${a.color}">${a.name}</div>
            <div class="rc-reg-desc">${lockedCount} registrations missing — ${pct}% complete</div>
            <div class="rc-reg-status-badge ${lockedCount === 0 ? 'green' : 'dim'}">
              ${lockedCount === 0 ? '● All registrations complete' : `○ ${lockedCount} revenue streams not being collected`}
            </div>
          </div>
          <div class="rc-reg-revenue">
            <div class="rc-reg-amount ${lockedCount === 0 ? 'claimed' : 'unlockable'}">
              ${lockedCount === 0 ? '' : '+ '}${uncollected >= 1000 ? '$'+(uncollected/1000).toFixed(1)+'K' : '$'+uncollected}
            </div>
            <div class="rc-reg-period">${lockedCount === 0 ? 'fully collected' : 'estimated uncollected/yr'}</div>
          </div>
          <div class="rc-reg-action">
            <button class="rc-reg-btn btn-register" onclick="event.stopPropagation();rosterSelectArtist('${a.id}')">View Gaps →</button>
          </div>
        </div>`;
    });
  }
}

// Hook: render roster overview when navigating to it — called from rosterSelectArtist and nav
function rosterOnEnter() {
  rosterRenderOverview();
}

// ════ GENRE TAGS ════
document.addEventListener('click',e=>{if(e.target.classList.contains('genre-tag'))e.target.classList.toggle('active');});

// ── IDENTITY LAB — SUPABASE PROFILE CRUD ──
let _idlabLoaded = false;

async function idlabLoadProfile() {
  if (!_currentUser || _idlabLoaded) return;
  // Load milestones alongside profile (parallel fetch)
  _loadUserMilestones();
  try {
    const { data, error } = await _sb
      .from('profiles')
      .select('*')
      .eq('id', _currentUser.id)
      .single();
    if (error) throw error;
    if (!data) return;
    // Populate form fields
    const el = id => document.getElementById(id);
    if (data.display_name) el('idlab-name').value = data.display_name;
    if (data.artist_type) el('idlab-type').value = data.artist_type;
    if (data.location) el('idlab-location').value = data.location;
    if (data.website_url) el('idlab-website').value = data.website_url;
    if (data.bio) { el('idlab-bio').value = data.bio; el('idlab-bio-count').textContent = data.bio.length + ' / 800'; }
    // Populate genres
    if (data.genre) {
      const genres = data.genre.split(',').map(g => g.trim().toLowerCase());
      document.querySelectorAll('.genre-tag').forEach(tag => {
        tag.classList.toggle('active', genres.includes(tag.textContent.trim().toLowerCase()));
      });
    }
    // Populate platform links from JSONB
    _idlabPopulateLinks('idlab-dsp-grid', data.dsp_links);
    _idlabPopulateLinks('idlab-social-grid', data.social_links);
    _idlabUpdatePlatformPreview();
    // Update preview
    idlabUpdatePreview(data);
    _idlabLoaded = true;
  } catch (e) { console.error('Identity Lab load error:', e); }
}

async function idlabSaveProfile() {
  if (!_currentUser) return;
  const btn = document.getElementById('idlab-save-btn');
  btn.disabled = true; btn.textContent = '[ Saving... ]';
  // Collect genres
  const genres = [];
  document.querySelectorAll('.genre-tag.active').forEach(t => genres.push(t.textContent.trim()));
  // Build update object
  const updates = {
    id: _currentUser.id,
    display_name: document.getElementById('idlab-name').value.trim(),
    artist_type: document.getElementById('idlab-type').value.trim(),
    location: document.getElementById('idlab-location').value.trim(),
    website_url: document.getElementById('idlab-website').value.trim(),
    bio: document.getElementById('idlab-bio').value.trim(),
    genre: genres.join(', '),
    social_links: _idlabCollectLinks('idlab-social-grid'),
    dsp_links: _idlabCollectLinks('idlab-dsp-grid')
  };
  try {
    const { error } = await _sb
      .from('profiles')
      .update(updates)
      .eq('id', _currentUser.id);
    if (error) throw error;
    // Success feedback
    btn.textContent = '[ Saved ✓ ]';
    orbitalConfirm('PROFILE SYNCED', 'sync');
    setTimeout(() => { btn.textContent = 'Save Profile'; btn.disabled = false; }, 2000);
    // Update preview live
    idlabUpdatePreview(updates);
  } catch (e) {
    console.error('Save error:', e);
    btn.textContent = 'Save Profile'; btn.disabled = false;
    orbitalConfirm('SYNC FAILED', 'alert');
  }
}

function idlabUpdatePreview(data) {
  const el = id => document.getElementById(id);
  if (data.display_name) {
    el('idlab-preview-name').textContent = data.display_name;
    el('idlab-preview-avatar').textContent = data.display_name.charAt(0).toUpperCase();
    el('idlab-preview-handle').textContent = '@' + (data.display_name.toLowerCase().replace(/\s+/g,''));
  }
  if (data.bio) el('idlab-preview-bio').textContent = data.bio.length > 160 ? data.bio.slice(0, 157) + '...' : data.bio;
  if (data.genre) {
    const genres = data.genre.split(',').map(g => g.trim()).filter(Boolean);
    el('idlab-preview-genres').innerHTML = genres.map(g => '<span class="preview-genre">' + g + '</span>').join('');
  }
}

// ── PLATFORM TILE INTERACTION (Identity Lab) ──
function idlabTogglePlatform(tile) {
  // If clicking the input area, don't toggle
  if (event && event.target.classList.contains('ptile-url')) return;
  if (event && event.target.classList.contains('ptile-save-btn')) return;
  const wasExpanded = tile.classList.contains('expanded');
  // Collapse all tiles in same grid
  tile.closest('.platform-grid').querySelectorAll('.ptile.expanded').forEach(t => t.classList.remove('expanded'));
  if (!wasExpanded) {
    tile.classList.add('expanded');
    const input = tile.querySelector('.ptile-url');
    if (input) setTimeout(() => input.focus(), 100);
  }
}

function idlabCommitPlatform(input) {
  const tile = input.closest('.ptile');
  const url = input.value.trim();
  const platform = input.dataset.key;
  if (url) {
    tile.classList.add('connected');
    tile.classList.remove('expanded');
    tile.querySelector('.ptile-status').textContent = 'Connected';
    // Tier 1: Orbital Confirm fires every time (routine, satisfying)
    orbitalConfirm(tile.querySelector('.ptile-name').textContent.toUpperCase() + ' LINKED', 'sync');
    // Tier 2: Poetic Residue — FIRST platform connection only (milestone gate)
    const handle = _extractHandle(url, platform);
    _checkMilestone('dsp_connected', { handle, platform });
  } else {
    tile.classList.remove('connected');
    tile.classList.remove('expanded');
    tile.querySelector('.ptile-status').textContent = '+ Connect';
  }
  _idlabUpdatePlatformPreview();
}

function _extractHandle(url, platform) {
  try {
    // Strip protocol, trailing slashes
    let path = url.replace(/^https?:\/\//, '').replace(/\/+$/, '');
    // Remove domain
    const slashIdx = path.indexOf('/');
    if (slashIdx > -1) path = path.substring(slashIdx + 1);
    // Remove query params
    path = path.split('?')[0].split('#')[0];
    // Get last meaningful segment
    const segments = path.split('/').filter(Boolean);
    const last = segments[segments.length - 1] || '';
    if (last && last.length > 1) return '@' + last.replace(/^@/, '');
  } catch(e) {}
  return '@' + platform;
}

function _idlabCollectLinks(gridId) {
  const links = {};
  document.querySelectorAll('#' + gridId + ' .ptile-url').forEach(input => {
    const val = input.value.trim();
    if (val) links[input.dataset.key] = val;
  });
  return links;
}

function _idlabPopulateLinks(gridId, data) {
  if (!data || typeof data !== 'object') return;
  document.querySelectorAll('#' + gridId + ' .ptile').forEach(tile => {
    const key = tile.dataset.key;
    const input = tile.querySelector('.ptile-url');
    if (key && data[key] && input) {
      input.value = data[key];
      tile.classList.add('connected');
      tile.querySelector('.ptile-status').textContent = 'Connected';
    }
  });
}

function _idlabUpdatePlatformPreview() {
  const previewLinks = document.getElementById('idlab-preview-links');
  if (!previewLinks) return;
  const icons = [];
  document.querySelectorAll('#idlab-dsp-grid .ptile.connected, #idlab-social-grid .ptile.connected').forEach(tile => {
    icons.push('<span class="preview-link-icon">' + tile.querySelector('.ptile-icon').textContent + '</span>');
  });
  previewLinks.innerHTML = icons.length ? icons.join('') : '<span style="color:rgba(232,234,246,0.15);font-size:0.5rem">No platforms connected</span>';
}

// ── ORBITAL CONFIRMATION ENGINE ──
// Usage: orbitalConfirm('TEXT', 'sync'|'locked'|'alert'|'transmit')
const _orbStyles = {
  sync:     { color:'0,230,118', label:'sync' },
  locked:   { color:'0,229,255', label:'locked' },
  alert:    { color:'255,68,68', label:'alert' },
  transmit: { color:'255,210,64', label:'transmit' }
};
let _orbBusy = false;

function orbitalConfirm(text, type='sync', residue=null) {
  if (_orbBusy) return;
  _orbBusy = true;
  const s = _orbStyles[type] || _orbStyles.sync;
  const c = s.color;
  const overlay = document.getElementById('orbConfirm');
  const txt = document.getElementById('orbText');
  const glow = document.getElementById('orbGlow');
  const hline = document.getElementById('orbHline');
  const scan = txt.querySelector('.orb-confirm-scanline');

  // Reset
  txt.textContent = text;
  txt.appendChild(scan);
  txt.style.cssText = 'opacity:0;transform:scaleY(0.02) scaleX(1);color:rgba('+c+',0.95);text-shadow:none;filter:blur(0);letter-spacing:8px;font-size:1.1rem;transition:none';
  glow.style.cssText = 'transform:translate(-50%,-50%) scale(0);opacity:0;background:rgba('+c+',0.15);transition:none';
  hline.style.cssText = 'width:0;opacity:0;background:rgba('+c+',0.9);box-shadow:0 0 20px rgba('+c+',0.8),0 0 60px rgba('+c+',0.4);transition:none';
  scan.style.cssText = 'opacity:0;color:rgba('+c+',1)';
  overlay.classList.add('active');

  // Phase 1: POWER ON — horizontal line draws, then text expands from it
  requestAnimationFrame(() => {
    hline.style.transition = 'width 0.35s cubic-bezier(0.16,1,0.3,1), opacity 0.15s ease';
    hline.style.width = '280px';
    hline.style.opacity = '1';
    glow.style.transition = 'transform 0.5s cubic-bezier(0.16,1,0.3,1), opacity 0.4s ease';
    glow.style.transform = 'translate(-50%,-50%) scale(1)';
    glow.style.opacity = '1';
  });

  // Phase 2: MATERIALIZE — text expands vertically from the line
  setTimeout(() => {
    hline.style.transition = 'opacity 0.4s ease';
    hline.style.opacity = '0';
    txt.style.transition = 'opacity 0.4s ease, transform 0.5s cubic-bezier(0.16,1,0.3,1), text-shadow 0.5s ease';
    txt.style.opacity = '1';
    txt.style.transform = 'scaleY(1) scaleX(1)';
    txt.style.textShadow = '0 0 15px rgba('+c+',0.6), 0 0 40px rgba('+c+',0.25)';
    scan.style.transition = 'opacity 0.3s ease';
    scan.style.opacity = '1';
  }, 350);

  // Phase 3: HOLD — gentle glow pulse
  setTimeout(() => {
    txt.style.transition = 'text-shadow 0.8s ease';
    txt.style.textShadow = '0 0 8px rgba('+c+',0.4), 0 0 25px rgba('+c+',0.15)';
    setTimeout(() => {
      txt.style.textShadow = '0 0 15px rgba('+c+',0.6), 0 0 40px rgba('+c+',0.25)';
    }, 400);
  }, 850);

  // Phase 4: CRT SHUTDOWN — compress to line, flash, vanish
  setTimeout(() => {
    scan.style.transition = 'opacity 0.2s ease';
    scan.style.opacity = '0';
    // Compress text to thin line
    txt.style.transition = 'transform 0.45s cubic-bezier(0.5,0,0.75,0), text-shadow 0.3s ease, filter 0.3s ease, letter-spacing 0.45s ease';
    txt.style.transform = 'scaleY(0.015) scaleX(1.1)';
    txt.style.textShadow = '0 0 25px rgba('+c+',1), 0 0 60px rgba('+c+',0.7), 0 0 120px rgba('+c+',0.3)';
    txt.style.letterSpacing = '12px';
    // Glow intensifies during compress
    glow.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    glow.style.transform = 'translate(-50%,-50%) scale(1.5)';
    glow.style.opacity = '0.8';
  }, 1800);

  // Phase 5: FLASH + line reappears bright
  setTimeout(() => {
    hline.style.transition = 'width 0.15s ease, opacity 0.1s ease';
    hline.style.width = '320px';
    hline.style.opacity = '1';
    hline.style.height = '3px';
    hline.style.boxShadow = '0 0 30px rgba('+c+',1), 0 0 80px rgba('+c+',0.6), 0 0 150px rgba('+c+',0.3)';
    txt.style.opacity = '0';
  }, 2250);

  // Phase 6: Line contracts to point and vanishes
  setTimeout(() => {
    hline.style.transition = 'width 0.35s cubic-bezier(0.5,0,0.75,0), opacity 0.3s ease 0.15s, box-shadow 0.3s ease';
    hline.style.width = '0';
    hline.style.boxShadow = '0 0 60px rgba('+c+',1), 0 0 120px rgba('+c+',0.5)';
    glow.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
    glow.style.opacity = '0';
    glow.style.transform = 'translate(-50%,-50%) scale(0.3)';
  }, 2400);

  // Cleanup
  setTimeout(() => {
    overlay.classList.remove('active');
    hline.style.height = '2px';
    _orbBusy = false;
    // Phase 7: IDENTITY RESIDUE — if residue data provided
    if (residue && residue.handle) {
      setTimeout(() => orbitalResidue(residue.handle, residue.platform), 100);
    }
  }, 2900);
}

// ── IDENTITY RESIDUE ENGINE ──
// Usage: orbitalResidue('@handle', 'spotify')
// Fires after orbital confirm fades — personalized identity moment

const _residueMap = {
  spotify:     { effect:'electricArc',   color:[30,215,96] },
  tidal:       { effect:'electricArc',   color:[0,229,255] },
  audiomack:   { effect:'electricArc',   color:[255,130,20] },
  instagram:   { effect:'neonBurnIn',    color:[225,48,108] },
  tiktok:      { effect:'neonBurnIn',    color:[0,242,234] },
  apple_music: { effect:'holoProjection',color:[252,60,68] },
  facebook:    { effect:'holoProjection',color:[66,103,178] },
  soundcloud:  { effect:'smokeBrand',    color:[255,85,0] },
  bandcamp:    { effect:'smokeBrand',    color:[29,185,184] },
  youtube:     { effect:'laserEtch',     color:[255,0,0] },
  twitter:     { effect:'laserEtch',     color:[230,236,240] },
  _default:    { effect:'electricArc',   color:[0,230,118] }
};

// ── MILESTONE ENGINE — Poetic Residue fires on firsts only ──
// "Every effect is a metaphor" — residue = surprise, not routine
const _userMilestones = new Set(); // loaded from user_ascent at session start
let _milestonesLoaded = false;

// Milestone → Poetic Metaphor → Effect mapping
// Each milestone fires ONCE per user lifetime. The effect IS the meaning.
const _milestoneResidueMap = {
  // First platform connection (Identity Lab) — "Coordinates locking onto a star chart"
  dsp_connected:     { effect:'laserEtch',      color:[0,230,180],  getText: (ctx) => ctx.handle || '@artist' },
  // First RSP broadcast — "Signal propagation, radio waves from antenna"
  first_rsp:         { effect:'electricArc',     color:[255,210,64], getText: (ctx) => ctx.handle || 'SIGNAL LIVE' },
  // First Vault upload — "Submersion, bioluminescent deep sea"
  vault_upload:      { effect:'smokeBrand',      color:[0,180,255],  getText: (ctx) => ctx.title || 'SECURED' },
  // First CRM pitch sent — "Message in a bottle, paper airplane"
  first_crm_contact: { effect:'neonBurnIn',      color:[180,120,255],getText: (ctx) => ctx.name || 'TRANSMITTED' },
  // Identity Lab complete — "Star chart fully mapped"
  identity_complete: { effect:'holoProjection',  color:[0,230,118],  getText: (ctx) => ctx.handle || 'IDENTITY LOCKED' },
  // First Curriculum module — "Apparition, ghostly silhouette forming"
  curriculum_module: { effect:'neonBurnIn',      color:[255,180,60], getText: (ctx) => 'KNOWLEDGE GAINED' }
};

async function _loadUserMilestones() {
  if (!_currentUser || _milestonesLoaded) return;
  try {
    const { data, error } = await _sb
      .from('user_ascent')
      .select('milestone_key')
      .eq('user_id', _currentUser.id);
    if (error) throw error;
    _userMilestones.clear();
    if (data) data.forEach(row => _userMilestones.add(row.milestone_key));
    _milestonesLoaded = true;
    console.log('[Milestone] Loaded:', [..._userMilestones]);
  } catch (e) { console.error('[Milestone] Load error:', e); }
}

// Gate + fire + record. Returns true if milestone was NEW.
async function _checkMilestone(milestoneKey, context = {}) {
  if (_userMilestones.has(milestoneKey)) return false; // already earned
  const mCfg = _milestoneResidueMap[milestoneKey];
  if (!mCfg) return false; // unknown milestone

  // Mark locally FIRST (prevents double-fire during async)
  _userMilestones.add(milestoneKey);

  // Fire the poetic residue AFTER Orbital Confirm finishes (~3100ms delay)
  // Orbital Confirm takes ~2900ms + 100ms buffer
  const displayText = mCfg.getText(context);
  setTimeout(() => _firePoetic(displayText, mCfg.effect, mCfg.color), 3100);

  // Write to Supabase (fire-and-forget, local cache is source of truth for session)
  if (_currentUser) {
    try {
      await _sb.from('user_ascent').insert({
        user_id: _currentUser.id,
        milestone_key: milestoneKey
      });
      console.log('[Milestone] Recorded:', milestoneKey);
    } catch (e) { console.error('[Milestone] Write error:', e); }
  }
  return true;
}

// Direct residue fire with custom effect+color (bypasses platform map)
function _firePoetic(text, effectName, rgb) {
  const wrap = document.getElementById('orbResidue');
  const canvas = document.getElementById('orbResCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  wrap.classList.add('active');
  if (_resAnimId) cancelAnimationFrame(_resAnimId);
  const effects = { electricArc: _resElectricArc, neonBurnIn: _resNeonBurnIn, smokeBrand: _resSmokeBrand, laserEtch: _resLaserEtch, holoProjection: _resHoloProjection };
  const fn = effects[effectName] || effects.electricArc;
  fn(ctx, canvas, canvas.width / 2, canvas.height / 2, rgb, text, wrap);
}

let _resAnimId = null;

function orbitalResidue(handle, platform) {
  const cfg = _residueMap[platform] || _residueMap._default;
  const wrap = document.getElementById('orbResidue');
  const canvas = document.getElementById('orbResCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  wrap.classList.add('active');

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const r = cfg.color;

  if (_resAnimId) cancelAnimationFrame(_resAnimId);

  const effects = { electricArc: _resElectricArc, neonBurnIn: _resNeonBurnIn, smokeBrand: _resSmokeBrand, laserEtch: _resLaserEtch, holoProjection: _resHoloProjection };
  const fn = effects[cfg.effect] || effects.electricArc;
  fn(ctx, canvas, cx, cy, r, handle, wrap);
}

// ── EFFECT 1: ELECTRIC ARC ──
function _resElectricArc(ctx, canvas, cx, cy, rgb, handle, wrap) {
  const particles = [];
  const startTime = performance.now();
  const duration = 3000;
  const fontSize = Math.min(36, canvas.width * 0.04);
  ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
  const textW = ctx.measureText(handle).width;
  const chars = handle.split('');
  // Pre-calc char positions
  let xOff = cx - textW / 2;
  const charPos = chars.map(ch => { const w = ctx.measureText(ch).width; const x = xOff; xOff += w; return { ch, x, w }; });

  function frame(now) {
    const t = (now - startTime) / duration;
    if (t > 1) { ctx.clearRect(0, 0, canvas.width, canvas.height); wrap.classList.remove('active'); return; }
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Text appears letter by letter in first 30%
    const revealPct = Math.min(1, t / 0.3);
    const revealCount = Math.floor(revealPct * chars.length);
    // After 70%, chars burn out left to right
    const burnPct = t > 0.7 ? (t - 0.7) / 0.3 : 0;
    const burnCount = Math.floor(burnPct * chars.length);

    for (let i = 0; i < charPos.length; i++) {
      const cp = charPos[i];
      if (i >= revealCount) continue;
      let alpha = 1;
      if (i < burnCount) {
        const burnT = (burnCount - i) / chars.length;
        alpha = Math.max(0, 1 - burnT * 3);
        // Spark particles on burn-out
        if (alpha < 0.5 && Math.random() < 0.3) {
          particles.push({ x: cp.x + cp.w / 2, y: cy, vx: (Math.random() - 0.5) * 4, vy: (Math.random() - 0.5) * 4 - 2, life: 1 });
        }
      }
      // Glow
      ctx.save();
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha * 0.8})`;
      ctx.shadowBlur = 15;
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha})`;
      ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
      ctx.fillText(cp.ch, cp.x, cy + fontSize * 0.35);
      ctx.restore();
    }

    // Lightning arcs between adjacent revealed chars
    if (revealCount > 1 && t < 0.75) {
      ctx.strokeStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${0.4 + Math.random() * 0.3})`;
      ctx.lineWidth = 1;
      for (let i = 0; i < revealCount - 1; i++) {
        if (Math.random() > 0.4) continue;
        const a = charPos[i], b = charPos[i + 1];
        ctx.beginPath();
        ctx.moveTo(a.x + a.w, cy);
        const midX = (a.x + a.w + b.x) / 2 + (Math.random() - 0.5) * 10;
        const midY = cy + (Math.random() - 0.5) * 20;
        ctx.quadraticCurveTo(midX, midY, b.x, cy);
        ctx.stroke();
      }
    }

    // Render particles
    for (let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.vy += 0.08; p.life -= 0.03;
      if (p.life <= 0) { particles.splice(i, 1); continue; }
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${p.life})`;
      ctx.fillRect(p.x - 1, p.y - 1, 2, 2);
    }
    _resAnimId = requestAnimationFrame(frame);
  }
  _resAnimId = requestAnimationFrame(frame);
}

// ── EFFECT 2: NEON BURN-IN ──
function _resNeonBurnIn(ctx, canvas, cx, cy, rgb, handle, wrap) {
  const startTime = performance.now();
  const duration = 3200;
  const fontSize = Math.min(36, canvas.width * 0.04);
  // Secondary color for gradient effect (shift hue)
  const rgb2 = [Math.min(255, rgb[0] + 80), Math.max(0, rgb[1] - 40), Math.min(255, rgb[2] + 60)];

  function frame(now) {
    const t = (now - startTime) / duration;
    if (t > 1) { ctx.clearRect(0, 0, canvas.width, canvas.height); wrap.classList.remove('active'); return; }
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Phase: flicker on (0-0.2), stable glow (0.2-0.6), crack + gas escape (0.6-1.0)
    let alpha, flickerOff = false;
    if (t < 0.2) {
      // Neon tube flickering on
      alpha = Math.random() > 0.3 ? (t / 0.2) : 0;
      flickerOff = alpha === 0;
    } else if (t < 0.6) {
      // Stable with occasional micro-flicker
      alpha = Math.random() > 0.03 ? 1 : 0.3;
    } else {
      // Fading — glass cracking, gas escaping
      alpha = Math.max(0, 1 - ((t - 0.6) / 0.4) * 1.2);
      if (Math.random() > 0.7) alpha *= 0.5; // death flickers
    }

    if (!flickerOff) {
      ctx.save();
      // Outer glow (tube glass)
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha * 0.5})`;
      ctx.shadowBlur = 30;
      ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
      ctx.textAlign = 'center';
      // Gradient fill
      const grad = ctx.createLinearGradient(cx - 100, cy, cx + 100, cy);
      grad.addColorStop(0, `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha})`);
      grad.addColorStop(0.5, `rgba(${rgb2[0]},${rgb2[1]},${rgb2[2]},${alpha})`);
      grad.addColorStop(1, `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha})`);
      ctx.fillStyle = grad;
      ctx.fillText(handle, cx, cy + fontSize * 0.35);
      // Inner bright core
      ctx.shadowBlur = 5;
      ctx.globalAlpha = alpha * 0.4;
      ctx.fillStyle = `rgba(255,255,255,${alpha * 0.6})`;
      ctx.fillText(handle, cx, cy + fontSize * 0.35);
      ctx.globalAlpha = 1;
      ctx.restore();
    }

    // Gas mist particles rising (after 0.6)
    if (t > 0.6) {
      const mist = Math.floor((t - 0.6) * 80);
      for (let i = 0; i < mist; i++) {
        const mx = cx + (Math.random() - 0.5) * 200;
        const my = cy - (t - 0.6) * 200 * Math.random() - Math.random() * 40;
        const ma = Math.max(0, 0.15 - (t - 0.6) * 0.3) * Math.random();
        ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${ma})`;
        ctx.beginPath();
        ctx.arc(mx, my, 2 + Math.random() * 4, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    _resAnimId = requestAnimationFrame(frame);
  }
  _resAnimId = requestAnimationFrame(frame);
}

// ── EFFECT 3: SMOKE BRAND ──
function _resSmokeBrand(ctx, canvas, cx, cy, rgb, handle, wrap) {
  const startTime = performance.now();
  const duration = 3500;
  const fontSize = Math.min(36, canvas.width * 0.04);
  const smokeParticles = [];

  function frame(now) {
    const t = (now - startTime) / duration;
    if (t > 1) { ctx.clearRect(0, 0, canvas.width, canvas.height); wrap.classList.remove('active'); return; }
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Phase: slam down (0-0.08), white-hot (0.08-0.2), cool through colors (0.2-0.7), ember fade (0.7-1)
    ctx.save();
    ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
    ctx.textAlign = 'center';

    let textAlpha = 1, textColor;
    if (t < 0.08) {
      // Slam — scale bounce
      const slamT = t / 0.08;
      const scale = 1 + (1 - slamT) * 0.3;
      ctx.translate(cx, cy + fontSize * 0.35);
      ctx.scale(scale, scale);
      ctx.translate(-cx, -(cy + fontSize * 0.35));
      textColor = '255,255,255';
      // Burst of smoke on impact
      for (let i = 0; i < 8; i++) {
        smokeParticles.push({ x: cx + (Math.random() - 0.5) * 150, y: cy, vx: (Math.random() - 0.5) * 2, vy: -Math.random() * 3 - 1, size: 3 + Math.random() * 6, life: 1 });
      }
    } else if (t < 0.2) {
      textColor = '255,255,255';
    } else if (t < 0.4) {
      // Cool: white → orange
      const ct = (t - 0.2) / 0.2;
      textColor = `${255},${Math.floor(255 - ct * 90)},${Math.floor(255 - ct * 200)}`;
    } else if (t < 0.6) {
      // Cool: orange → red
      const ct = (t - 0.4) / 0.2;
      textColor = `${255},${Math.floor(165 - ct * 100)},${Math.floor(55 - ct * 55)}`;
    } else {
      // Ember fade
      const ct = (t - 0.6) / 0.4;
      textColor = `${Math.floor(200 - ct * 150)},${Math.floor(65 - ct * 65)},0`;
      textAlpha = Math.max(0, 1 - ct * 1.5);
    }

    // Continuous smoke wisps
    if (t > 0.08 && t < 0.85 && Math.random() < 0.4) {
      smokeParticles.push({ x: cx + (Math.random() - 0.5) * 120, y: cy - 5, vx: (Math.random() - 0.5) * 0.5, vy: -Math.random() * 1.5 - 0.5, size: 2 + Math.random() * 4, life: 1 });
    }

    // Draw text
    ctx.shadowColor = `rgba(${textColor},${textAlpha * 0.7})`;
    ctx.shadowBlur = t < 0.2 ? 25 : 10;
    ctx.fillStyle = `rgba(${textColor},${textAlpha})`;
    ctx.fillText(handle, cx, cy + fontSize * 0.35);
    ctx.restore();

    // Render smoke
    for (let i = smokeParticles.length - 1; i >= 0; i--) {
      const p = smokeParticles[i];
      p.x += p.vx; p.y += p.vy; p.vy -= 0.01; p.life -= 0.012; p.size += 0.05;
      if (p.life <= 0) { smokeParticles.splice(i, 1); continue; }
      ctx.fillStyle = `rgba(180,180,180,${p.life * 0.12})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
    }
    _resAnimId = requestAnimationFrame(frame);
  }
  _resAnimId = requestAnimationFrame(frame);
}

// ── EFFECT 4: LASER ETCH ──
function _resLaserEtch(ctx, canvas, cx, cy, rgb, handle, wrap) {
  const startTime = performance.now();
  const duration = 3200;
  const fontSize = Math.min(36, canvas.width * 0.04);
  ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
  const textW = ctx.measureText(handle).width;
  const startX = cx - textW / 2;

  function frame(now) {
    const t = (now - startTime) / duration;
    if (t > 1) { ctx.clearRect(0, 0, canvas.width, canvas.height); wrap.classList.remove('active'); return; }
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
    ctx.textAlign = 'left';

    // Phase 1 (0-0.35): laser writes left to right
    // Phase 2 (0.35-0.65): verification scan (cyan pulse left-to-right)
    // Phase 3 (0.65-0.85): hold
    // Phase 4 (0.85-1.0): flash and fade

    if (t < 0.35) {
      // Writing phase — clip text to reveal
      const revealX = startX + (t / 0.35) * textW;
      ctx.beginPath();
      ctx.rect(startX - 5, cy - fontSize, revealX - startX + 5, fontSize * 2);
      ctx.clip();
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.6)`;
      ctx.shadowBlur = 12;
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.9)`;
      ctx.fillText(handle, startX, cy + fontSize * 0.35);
      ctx.restore();
      // Laser head
      ctx.save();
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},1)`;
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},1)`;
      ctx.shadowBlur = 20;
      ctx.fillRect(revealX - 1, cy - fontSize * 0.5, 2, fontSize);
      // Scatter sparks at etch point
      for (let i = 0; i < 3; i++) {
        const sx = revealX + (Math.random() - 0.5) * 6;
        const sy = cy + (Math.random() - 0.5) * fontSize;
        ctx.fillRect(sx, sy, 1.5, 1.5);
      }
      ctx.restore();
    } else if (t < 0.65) {
      // Full text visible + verification scan
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.5)`;
      ctx.shadowBlur = 10;
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.85)`;
      ctx.textAlign = 'left';
      ctx.fillText(handle, startX, cy + fontSize * 0.35);
      // Cyan verification pulse
      const scanX = startX + ((t - 0.35) / 0.3) * textW;
      ctx.fillStyle = `rgba(0,229,255,0.12)`;
      ctx.fillRect(scanX - 15, cy - fontSize * 0.6, 30, fontSize * 1.4);
      ctx.restore();
    } else if (t < 0.85) {
      // Hold — gentle glow
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.4)`;
      ctx.shadowBlur = 8;
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.8)`;
      ctx.textAlign = 'left';
      ctx.fillText(handle, startX, cy + fontSize * 0.35);
      ctx.restore();
    } else {
      // Flash and fade
      const fadeT = (t - 0.85) / 0.15;
      const flash = fadeT < 0.2 ? 0.3 : 0;
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${(1 - fadeT) * 0.5})`;
      ctx.shadowBlur = 15 + flash * 30;
      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${Math.max(0, 1 - fadeT * 1.5)})`;
      ctx.textAlign = 'left';
      ctx.fillText(handle, startX, cy + fontSize * 0.35);
      if (flash > 0) { ctx.fillStyle = `rgba(255,255,255,${flash})`; ctx.fillRect(0, 0, canvas.width, canvas.height); }
      ctx.restore();
    }
    _resAnimId = requestAnimationFrame(frame);
  }
  _resAnimId = requestAnimationFrame(frame);
}

// ── EFFECT 5: HOLO PROJECTION ──
function _resHoloProjection(ctx, canvas, cx, cy, rgb, handle, wrap) {
  const startTime = performance.now();
  const duration = 3400;
  const fontSize = Math.min(36, canvas.width * 0.04);

  function frame(now) {
    const t = (now - startTime) / duration;
    if (t > 1) { ctx.clearRect(0, 0, canvas.width, canvas.height); wrap.classList.remove('active'); return; }
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.font = `800 ${fontSize}px 'Orbitron', monospace`;
    ctx.textAlign = 'center';

    // Phase: wobbly appear (0-0.25), stabilize (0.25-0.4), hold with float (0.4-0.75), shrink to point (0.75-1)
    let alpha, yOffset = 0, rgbSplit = 0, scanLineAlpha = 0;

    if (t < 0.25) {
      // Wobbly hologram appearing
      alpha = t / 0.25;
      rgbSplit = (1 - t / 0.25) * 4;
      scanLineAlpha = 0.15;
      yOffset = Math.sin(now * 0.02) * 3;
    } else if (t < 0.4) {
      // Stabilizing
      const st = (t - 0.25) / 0.15;
      alpha = 1;
      rgbSplit = (1 - st) * 2;
      scanLineAlpha = (1 - st) * 0.1;
      yOffset = Math.sin(now * 0.015) * (1 - st) * 2;
    } else if (t < 0.75) {
      // Stable hold with gentle bob
      alpha = 1;
      rgbSplit = 0;
      scanLineAlpha = 0;
      yOffset = Math.sin(now * 0.003) * 2;
    } else {
      // Shrink to point of light
      const st = (t - 0.75) / 0.25;
      alpha = 1 - st;
      rgbSplit = st * 3;
      scanLineAlpha = st * 0.2;
    }

    const drawY = cy + fontSize * 0.35 + yOffset;

    // RGB split channels
    if (rgbSplit > 0.5) {
      ctx.globalAlpha = alpha * 0.3;
      ctx.fillStyle = `rgba(255,0,0,${alpha * 0.5})`;
      ctx.fillText(handle, cx - rgbSplit, drawY);
      ctx.fillStyle = `rgba(0,0,255,${alpha * 0.5})`;
      ctx.fillText(handle, cx + rgbSplit, drawY);
      ctx.globalAlpha = 1;
    }

    // Main text
    ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha * 0.5})`;
    ctx.shadowBlur = 15;
    ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha * 0.85})`;
    ctx.fillText(handle, cx, drawY);
    // White core
    ctx.globalAlpha = alpha * 0.3;
    ctx.fillStyle = `rgba(255,255,255,${alpha * 0.4})`;
    ctx.fillText(handle, cx, drawY);
    ctx.globalAlpha = 1;

    // Horizontal scan lines
    if (scanLineAlpha > 0) {
      for (let y = cy - fontSize; y < cy + fontSize; y += 3) {
        ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${scanLineAlpha * Math.random()})`;
        ctx.fillRect(cx - 120, y, 240, 1);
      }
    }

    // Point of light on shrink
    if (t > 0.85) {
      const pt = (t - 0.85) / 0.15;
      const pointAlpha = (1 - pt) * 0.8;
      ctx.fillStyle = `rgba(255,255,255,${pointAlpha})`;
      ctx.shadowColor = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${pointAlpha})`;
      ctx.shadowBlur = 20;
      ctx.beginPath();
      ctx.arc(cx, cy, 3 * (1 - pt), 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.restore();
    _resAnimId = requestAnimationFrame(frame);
  }
  _resAnimId = requestAnimationFrame(frame);
}

// ── CURRICULUM ENGINE — SPACE STATION LIBRARY ════

// ── COOL FACTS DATABASE (Splash + Newsletter Excerpts) ──
const CURR_FACTS = [
  {fact:'The word "mechanical" in mechanical royalties comes from player piano rolls — the first technology that mechanically reproduced sheet music into a product you could sell. The term stuck, even for Spotify streams.',category:'Royalties',newsletter:true},
  {fact:'Taylor Swift\'s decision to re-record her first six albums wasn\'t just artistic — it was a masterclass in copyright strategy. By creating new master recordings, she captured both the master AND composition royalties on the new versions.',category:'Copyright',newsletter:true},
  {fact:'There are over 100 royalty collection societies worldwide. If you\'re only registered with one PRO in one country, you\'re almost certainly leaving international money on the table.',category:'Publishing',newsletter:true},
  {fact:'Spotify pays roughly $0.003–0.005 per stream — but that\'s only the RECORDING side. The composition side (mechanical + performance royalties) is collected separately by different organizations entirely.',category:'Streaming',newsletter:true},
  {fact:'In the US, a song is copyrighted the instant you record it or write it down. Registration with the Copyright Office isn\'t required to own the copyright — but it IS required to sue for infringement.',category:'Copyright',newsletter:true},
  {fact:'ASCAP and BMI paid out a combined $2.34 billion in performance royalties in 2019 alone — and that\'s just ONE type of royalty, in just North America.',category:'Revenue',newsletter:true},
  {fact:'A single song can generate up to 6 different types of royalties: recording, digital performance, mechanical, performance, sync, and print. Most independent artists only collect 1 or 2 of these.',category:'Royalties',newsletter:true},
  {fact:'The "200% pie" in publishing means royalties split into writer\'s share (100%) and publisher\'s share (100%). If you self-publish, you collect both halves — the full 200%.',category:'Publishing',newsletter:true},
  {fact:'More than 100,000 songs are uploaded to streaming platforms every single day. Without a marketing strategy, your release has a near-zero chance of being discovered organically.',category:'Marketing',newsletter:true},
  {fact:'A "360 deal" means the label takes a cut of ALL your revenue — not just recordings, but touring, merch, publishing, endorsements, and sometimes even your social media income.',category:'Deals',newsletter:true},
  {fact:'SoundExchange has paid out over $10 billion to artists and labels since its founding. If you\'re not registered, that money is sitting unclaimed.',category:'Revenue',newsletter:true},
  {fact:'The standard music manager commission is 15-20% of GROSS income — meaning before expenses. A manager earning 20% on a $100K year takes $20K whether you profit or not.',category:'Business',newsletter:true},
  {fact:'Pre-save campaigns don\'t just boost day-one streams — they signal Spotify\'s algorithm that your release has anticipation, increasing your chances of algorithmic playlist placement.',category:'Marketing',newsletter:true},
  {fact:'Leonard Cohen wrote "Hallelujah" in 1984. When Jeff Buckley recorded his cover in 1994, Buckley owned HIS recording\'s master rights — but the composition royalties still flowed back to Cohen.',category:'Copyright',newsletter:true},
  {fact:'Your email list is more valuable than your follower count. Social platforms can change algorithms overnight, but nobody can take your email subscribers away from you.',category:'Marketing',newsletter:true},
  {fact:'In a work-for-hire agreement, the person who PAYS for the work owns the copyright — not the person who created it. Session musicians and ghost-writers often sign these without realizing what they\'re giving up.',category:'Legal',newsletter:true},
  {fact:'The Mechanical Licensing Collective (MLC) was created by the Music Modernization Act in 2018 specifically to collect digital mechanical royalties. Before it existed, billions in mechanical royalties went uncollected.',category:'Royalties',newsletter:true},
  {fact:'Spotify\'s Discover Weekly algorithm weighs save rate, completion rate, and repeat listens more heavily than raw stream count. A song with 1,000 streams and high saves can outperform one with 100,000 streams and high skips.',category:'Data',newsletter:true},
  {fact:'Music catalogs are typically valued at 8-30x their annual net royalty income. A catalog earning $50K/year could be worth $400K-$1.5M to an investor.',category:'Business',newsletter:true},
  {fact:'Copyright protection lasts for the life of the last surviving author plus 70 years. Your music can generate income for your family for nearly a century after you\'re gone.',category:'Copyright',newsletter:true},
  {fact:'By 2026, independence isn\'t a stepping stone — it\'s a destination. More artists are choosing to stay independent because they retain ownership, release faster, and keep more earnings.',category:'Industry',newsletter:true},
  {fact:'A split sheet is a written agreement between co-writers documenting ownership percentages. Without one, a single dispute can freeze ALL royalties from a song indefinitely.',category:'Publishing',newsletter:true},
  {fact:'Sync licensing — getting your music in TV, film, and ads — requires clearing BOTH the master recording AND the composition. Two separate licenses, often from two separate owners.',category:'Sync',newsletter:true},
  {fact:'The average independent artist needs roughly 250,000 Spotify streams per month to earn the equivalent of a US minimum wage from streaming alone. That\'s why multiple revenue pillars matter.',category:'Revenue',newsletter:true},
  {fact:'Neighboring rights royalties exist in most countries outside the US. If your music is played on European radio, you\'re owed money — but only if you\'re registered with the right collection societies.',category:'International',newsletter:true},
  {fact:'An audit clause in your contract gives you the right to inspect a label\'s or publisher\'s books. Industry audits frequently find underpayments of 10-40%. Always negotiate for this clause.',category:'Legal',newsletter:true},
  {fact:'The term "A&R" stands for Artists and Repertoire — the people at labels responsible for discovering talent and overseeing the artistic development of recording artists.',category:'Industry',newsletter:true},
  {fact:'A sunset clause in a management contract reduces the manager\'s commission over time after the deal ends. Without one, your former manager could earn 20% on deals they set up — forever.',category:'Deals',newsletter:true},
  {fact:'Your ISRC code follows a recording forever — across every platform, every country, every format. If you change distributors, the same ISRC must stay with the same recording to preserve your stream counts.',category:'Distribution',newsletter:true},
  {fact:'In 2026, the most successful independent artists don\'t chase algorithms or gatekeepers. They build sustainable micro-economies — multiple revenue pillars owned and operated on their own terms.',category:'Strategy',newsletter:true}
];

// SPLASH LOGIC
let currSplashShown = false;

function currShowSplash(){
  const splash = document.getElementById('currSplash');
  const main = document.getElementById('currMainContent');
  const fact = CURR_FACTS[Math.floor(Math.random()*CURR_FACTS.length)];
  document.getElementById('currSplashFact').textContent = fact.fact;
  document.getElementById('currSplashSource').textContent = '— OrbitHQ Curriculum · ' + fact.category;
  splash.style.display = 'block';
  main.style.display = 'none';
  // Also hide library/terminal/progress views
  document.querySelectorAll('.curr-view').forEach(v=>v.style.display='none');
}

function currDismissSplash(){
  const splash = document.getElementById('currSplash');
  const main = document.getElementById('currMainContent');
  splash.style.display = 'none';
  main.style.display = 'block';
  main.style.opacity = '0';
  setTimeout(()=>{ main.style.opacity='1'; },50);
  // Show library view by default
  document.getElementById('currLibrary').style.display = 'block';
  currSplashShown = true;
}
const CURR_BOOKS = [
  { id:'foundations', title:'Industry Foundations', icon:'🌐', color:'#00e5ff',
    cards:[
      {q:'What are the two types of copyright in a recorded song?',a:'Master recording copyright (the actual sound recording) and composition copyright (the underlying music/lyrics, also called publishing rights).'},
      {q:'What is a PRO?',a:'A Performance Rights Organization (like ASCAP, BMI, or SESAC) that tracks public performances of music and collects/distributes performance royalties to songwriters and publishers.'},
      {q:'When is a song automatically copyrighted?',a:'The moment it is "fixed in a tangible medium of expression" — meaning when you record it or write it down. Registration with the Copyright Office provides additional legal protection.'},
      {q:'What does "owning your masters" mean?',a:'It means you own the master recording copyright — the actual sound recordings. This controls who can distribute, license, and profit from the recordings.'},
      {q:'What is the difference between a label and a distributor?',a:'A label signs artists, finances recordings, and handles marketing/promotion. A distributor gets your music onto streaming platforms and stores. You can use a distributor without a label.'},
      {q:'What is an ISRC code?',a:'International Standard Recording Code — a unique 12-character identifier assigned to each individual recording. It tracks your song across all platforms for royalty collection.'},
      {q:'What is a UPC code?',a:'Universal Product Code — identifies a release (single, EP, album) as a product. Your distributor typically assigns this. One UPC per release, ISRCs for each track.'},
      {q:'What is metadata in the music industry?',a:'The information embedded in your music files — song title, artist name, ISRC, genre, credits, songwriter info, etc. Bad metadata = lost royalties.'},
      {q:'Why should an independent artist form an LLC?',a:'An LLC separates personal and business liability, provides tax advantages, looks more professional to industry partners, and is required for some publishing and licensing deals.'},
      {q:'What is the "fixation rule" in copyright?',a:'Copyright protection begins the instant an original work is fixed in a tangible medium — a recording, written notation, or digital file. You don\'t need to register to own the copyright.'}
    ]},
  { id:'royalties', title:'Royalties & Revenue', icon:'💰', color:'#00e676',
    cards:[
      {q:'How many types of royalties can a single song generate?',a:'Up to 6: recording royalties, digital performance royalties, mechanical royalties, performance royalties, sync royalties, and print royalties.'},
      {q:'What are mechanical royalties?',a:'Payments generated when a composition is reproduced — streams, downloads, physical copies. In the US, The MLC collects digital mechanical royalties. The statutory rate is set by the Copyright Royalty Board.'},
      {q:'What are performance royalties?',a:'Payments when a song is publicly performed — radio play, live venues, streaming, TV broadcast. Collected by PROs (ASCAP, BMI, SESAC) and split 50/50 between songwriter and publisher.'},
      {q:'What is SoundExchange?',a:'A nonprofit that collects digital performance royalties for sound recordings played on non-interactive platforms (Pandora, SiriusXM, internet radio). Artists AND labels get paid.'},
      {q:'What is The MLC?',a:'The Mechanical Licensing Collective — a nonprofit that collects and distributes digital mechanical royalties from streaming services in the US. Created by the Music Modernization Act of 2018.'},
      {q:'What is a sync license?',a:'A synchronization license grants permission to use a composition in visual media (TV, film, ads, video games). It requires clearing BOTH the master and the composition.'},
      {q:'What is the "200% pie" in publishing?',a:'Publishing royalties split into writer\'s share (100%) and publisher\'s share (100%) = 200% total. The writer always gets their 100% writer\'s share. The publisher\'s share depends on your deal.'},
      {q:'What is a publishing administrator?',a:'A company (like Songtrust, TuneCore Publishing, or CD Baby Pro) that registers your songs, collects royalties worldwide, and takes a small commission — WITHOUT taking ownership of your copyright.'},
      {q:'What is recoupment?',a:'When a label or publisher gives you an advance, they recoup (earn back) that money from your royalties before you see any additional payments. You don\'t get paid again until the advance is recouped.'},
      {q:'What neighboring rights royalties?',a:'Royalties paid to performers and master owners when recordings are broadcast publicly (radio, TV, public venues). Available in most countries outside the US through organizations like PPL and SCPP.'}
    ]},
  { id:'publishing', title:'Publishing Deep Dive', icon:'📜', color:'#7c4dff',
    cards:[
      {q:'What is the difference between a songwriter and a composer?',a:'A songwriter writes lyrics and melody. A composer writes instrumental music. Both own composition copyright. In practice, the terms are often used interchangeably.'},
      {q:'What is a split sheet?',a:'A written agreement between co-writers that documents each person\'s ownership percentage of a song BEFORE release. Without one, disputes can freeze royalties indefinitely.'},
      {q:'What are the 4 types of publishing deals?',a:'1) Full publishing (label owns 100%), 2) Co-publishing (artist keeps 50%), 3) Administration deal (admin collects for a fee, you keep ownership), 4) Self-publishing (you do everything yourself).'},
      {q:'What is the Harry Fox Agency?',a:'HFA issues mechanical licenses and collects mechanical royalties for physical and digital reproductions of compositions in the US. They handle the licensing when someone covers your song.'},
      {q:'What is a compulsory mechanical license?',a:'Once a songwriter releases a recording of their song, anyone can record their own version by obtaining a compulsory license and paying the statutory rate. They don\'t need the songwriter\'s permission.'},
      {q:'What is a catalog in the music business?',a:'The complete collection of songs/recordings owned by an artist, songwriter, publisher, or label. Catalogs are assets that can be bought, sold, and invested in.'},
      {q:'What does "life of copyright" mean in a publishing deal?',a:'The publisher controls your songs for the full duration of copyright — your lifetime plus 70 years after death. This is the most restrictive deal term.'},
      {q:'Why register with BOTH a PRO and The MLC?',a:'Your PRO (ASCAP/BMI) collects performance royalties. The MLC collects mechanical royalties. They cover different royalty types from the same streams. Missing one = leaving money on the table.'},
      {q:'What is sub-publishing?',a:'When your publisher partners with local publishers in other countries to collect your international royalties. Without sub-publishing, foreign royalties often go uncollected.'},
      {q:'What is a reversion clause?',a:'A contract provision that returns copyright ownership to the songwriter after a set period or if certain conditions aren\'t met. Always negotiate for one.'}
    ]},
  { id:'marketing', title:'Marketing & Growth', icon:'📡', color:'#ff6b6b',
    cards:[
      {q:'What is an EPK?',a:'Electronic Press Kit — a digital portfolio containing your bio, photos, music, videos, press quotes, social stats, and contact info. Used for booking, press pitches, and industry meetings.'},
      {q:'What is the "content funnel" for artists?',a:'Discovery → Engagement → Conversion. New listeners find you (discovery), connect with your content (engagement), then take action — follow, save, buy, attend shows (conversion).'},
      {q:'Why is an email list more valuable than followers?',a:'You own your email list. Social platforms can change algorithms, ban accounts, or shut down. Email/SMS gives you direct, reliable access to fans without a middleman.'},
      {q:'What is the 8-week release timeline?',a:'Industry standard prep window: Week 8-6: assets ready. Week 5-4: pre-save campaigns, press outreach. Week 3-2: content ramp-up, playlist pitching. Week 1: launch push. Post-release: sustain.'},
      {q:'What is playlist pitching?',a:'Submitting your unreleased music to Spotify editorial playlists (via Spotify for Artists), independent curators, and algorithmic playlist triggers at least 7 days before release.'},
      {q:'What triggers Spotify\'s Discover Weekly algorithm?',a:'Save rate, completion rate (listeners finishing the song), repeat listens, playlist adds by users, and engagement velocity in the first 24-48 hours of release.'},
      {q:'What is the difference between earned, owned, and paid media?',a:'Earned = press, reviews, shares (free). Owned = your website, email list, social profiles (you control). Paid = ads, sponsored posts, playlist placements (you pay for reach).'},
      {q:'What is a "superfan" strategy?',a:'Focusing on your most dedicated fans (top 1-5%) who buy merch, attend shows, share your music, and support you financially — rather than chasing mass casual listeners.'},
      {q:'What is a pre-save campaign?',a:'Getting fans to "save" your song on Spotify/Apple Music before release day. Pre-saves boost day-one streams, signal the algorithm, and can help trigger editorial playlist consideration.'},
      {q:'What does D2C mean for artists?',a:'Direct-to-Consumer — selling merch, music, tickets, and memberships directly to fans (through your own website/store) instead of through third-party platforms that take a cut.'}
    ]},
  { id:'deals', title:'Deals & Contracts', icon:'⚖️', color:'#ffd264',
    cards:[
      {q:'What is a 360 deal?',a:'A record deal where the label takes a percentage of ALL revenue streams — not just recordings, but also touring, merch, publishing, endorsements. Common with major labels since the 2000s.'},
      {q:'What is an advance?',a:'Upfront money from a label or publisher against future royalties. It\'s NOT free money — it\'s a loan that gets recouped from your earnings before you see additional royalty payments.'},
      {q:'What are "options" in a record deal?',a:'Clauses that give the label the right (but not obligation) to extend the deal for additional albums. The label exercises options if you\'re profitable; you can\'t opt out.'},
      {q:'What is a key person clause?',a:'A provision that lets you exit or renegotiate a deal if a specific person (usually the A&R who signed you) leaves the company. Protects you from being stuck with people who don\'t champion you.'},
      {q:'What is a sunset clause in management?',a:'A provision that reduces the manager\'s commission percentage over time after the contract ends. Example: 20% year 1 post-contract, 10% year 2, 0% year 3.'},
      {q:'What is the standard manager commission?',a:'15-20% of gross income. Managers typically earn commission on all income generated during the management period, and often on deals they set up even after the contract ends.'},
      {q:'What is a distribution deal vs. a record deal?',a:'Distribution deal: distributor gets your music on platforms for a fee or revenue split. You keep ownership. Record deal: label typically owns/controls the masters in exchange for investment.'},
      {q:'What is rights reversion?',a:'When ownership of masters or publishing rights returns to the artist after a contract term expires. Always negotiate for it. Without it, the label may own your music forever.'},
      {q:'When should an artist get a music attorney?',a:'Before signing ANY deal — management, label, publishing, sync. An entertainment attorney reviews contracts, negotiates terms, and protects your interests. Budget $500-2000 for contract review.'},
      {q:'What is a work-for-hire agreement?',a:'A contract where the person who commissions the work (not the creator) owns the copyright. Common for producers, session musicians, and ghost-writers. If you sign one, you own nothing.'}
    ]},
  { id:'data', title:'Data & Analytics', icon:'📊', color:'#42a5f5',
    cards:[
      {q:'What is Spotify for Artists?',a:'Spotify\'s free dashboard for verified artists. Shows real-time streams, listener demographics, geographic data, playlist placements, and allows editorial playlist pitching for upcoming releases.'},
      {q:'What is "save rate" and why does it matter?',a:'The percentage of listeners who save your song to their library. High save rate signals Spotify\'s algorithm that the song has staying power, triggering algorithmic playlist recommendations.'},
      {q:'What is a royalty statement?',a:'A periodic report from your label, distributor, or publisher showing what your music earned, from which sources, minus any recoupable expenses. Read them carefully — errors are common.'},
      {q:'What metrics indicate real fan growth vs. a viral spike?',a:'Monthly listener retention rate, save-to-listen ratio, repeat listener percentage, follower growth (not just monthly listeners), and merch/email conversion rates indicate sustainable growth.'},
      {q:'What is a 1099 form for musicians?',a:'A tax form received from each entity that paid you $600+ in a year. As a self-employed musician, you\'ll get 1099s from distributors, labels, venues, etc. You must report all this income.'},
      {q:'What is the average per-stream payout on Spotify?',a:'Approximately $0.003-0.005 per stream (as of 2025-26), but it varies by country, listener type (free vs premium), and total platform payouts. This covers the recording side only.'},
      {q:'What is "skip rate" and how does it affect your music?',a:'The percentage of listeners who skip your song before it finishes. High skip rate tells algorithms the song isn\'t connecting, reducing its chances of being recommended to new listeners.'},
      {q:'Why is geographic streaming data important?',a:'It shows where your fans actually are — informing tour routing, targeted ads, playlist pitching by region, and international strategy. Don\'t tour cities where you have zero listeners.'},
      {q:'What are quarterly estimated tax payments?',a:'Self-employed musicians must pay estimated taxes 4x per year (April, June, September, January) instead of waiting until April. Failure to pay triggers penalties from the IRS.'},
      {q:'What is a catalog audit?',a:'A systematic review of all your registered songs, royalty accounts, and collection society memberships to find uncollected royalties, registration errors, or missing income streams.'}
    ]},
  { id:'advanced', title:'Advanced Strategy', icon:'🚀', color:'#e040fb',
    cards:[
      {q:'What is the "micro-economy" model for artists in 2026?',a:'Building a self-sustaining business ecosystem: D2C merch, memberships, email/SMS monetization, sync income, live revenue, and streaming — multiple pillars so you\'re never dependent on one source.'},
      {q:'What is neighboring rights income?',a:'Royalties paid to performers (not just songwriters) when sound recordings are broadcast on radio, TV, or in public spaces. Collected through organizations like PPL (UK), GVL (Germany), etc.'},
      {q:'What does "fan transparency" mean as a 2026 trend?',a:'Artists openly sharing their earnings, business decisions, and career economics with fans. Builds trust, differentiates from major-label opacity, and turns fans into invested stakeholders.'},
      {q:'What is a P&D deal?',a:'Pressing and Distribution deal — the label or partner handles manufacturing and distribution, but the artist retains ownership and more control. Common stepping stone between full indie and label deal.'},
      {q:'How do you price a sync license?',a:'Based on: usage type (TV, film, ad, game), prominence (featured vs background), duration, territory, media (broadcast, streaming, theatrical), and artist stature. Fees range from $500 to $500,000+.'},
      {q:'What is catalog valuation?',a:'The process of determining what a music catalog is worth for sale or investment. Typically valued at 8-30x annual net royalty income, depending on catalog age, trend, and diversity.'},
      {q:'What is the difference between interactive and non-interactive streaming?',a:'Interactive = user chooses what to play (Spotify, Apple Music). Non-interactive = programmed playlists/radio (Pandora, SiriusXM). They generate different royalty types and rates.'},
      {q:'What is an audit clause in a contract?',a:'The right to hire an accountant to inspect the label\'s or publisher\'s books and verify your royalty statements are accurate. If errors exceed a threshold (often 5-10%), they pay for the audit.'},
      {q:'What is "algorithmic security"?',a:'Building a consistent enough release cadence and engagement pattern that streaming algorithms reliably surface your music to new listeners — reducing reliance on editorial playlists.'},
      {q:'Why is owning data the key competitive advantage in 2026?',a:'Artists who own their listener data, email lists, streaming analytics, and customer info can make informed decisions independently — without needing a label\'s resources or permission to act on insights.'}
    ]}
];

// STATE
let currState = { currentBook:null, currentCard:0, flipped:false, known:new Set(), quizBook:null, quizIdx:0, quizCorrect:0, quizAnswered:false };

// Persist known cards
function currSaveState(){ try{localStorage.setItem('arthq_curr',JSON.stringify([...currState.known]))}catch(e){} }
function currLoadState(){ try{const d=localStorage.getItem('arthq_curr');if(d)currState.known=new Set(JSON.parse(d))}catch(e){} }

// VIEW SWITCHER
function currSwitchView(view, btn){
  document.querySelectorAll('.curr-tab').forEach(t=>t.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.querySelectorAll('.curr-view').forEach(v=>v.style.display='none');
  document.getElementById({library:'currLibrary',terminal:'currTerminal',progress:'currProgress'}[view]).style.display='block';
  if(view==='progress')currRenderProgress();
}

// BOOKSHELF
function currRenderBookshelf(){
  const shelf = document.getElementById('currBookshelf');
  shelf.innerHTML = CURR_BOOKS.map(b=>{
    const known = b.cards.filter((_,i)=>currState.known.has(b.id+'-'+i)).length;
    const pct = Math.round(known/b.cards.length*100);
    return `<div class="curr-book" style="background:linear-gradient(160deg,${b.color}15,${b.color}05)" onclick="currOpenBook('${b.id}')">
      <div class="curr-book-glow" style="background:${b.color}"></div>
      <div class="curr-book-icon">${b.icon}</div>
      <div class="curr-book-title">${b.title}</div>
      <div class="curr-book-count">${b.cards.length} cards · ${pct}%</div>
      <div class="curr-book-progress-bar" style="width:${pct}%;background:${b.color}"></div>
    </div>`;
  }).join('');
}

// OPEN BOOK → FLASHCARDS
function currOpenBook(id){
  const book = CURR_BOOKS.find(b=>b.id===id);
  if(!book) return;
  currState.currentBook = book;
  currState.currentCard = 0;
  currState.flipped = false;
  document.getElementById('currCardArea').style.display = 'block';
  document.getElementById('currCardBookTitle').textContent = book.title.toUpperCase();
  currRenderCard();
  document.getElementById('currCardArea').scrollIntoView({behavior:'smooth',block:'start'});
}

function currCloseBook(){
  currState.currentBook = null;
  document.getElementById('currCardArea').style.display = 'none';
}

function currRenderCard(){
  const b = currState.currentBook;
  if(!b) return;
  const c = b.cards[currState.currentCard];
  const inner = document.getElementById('currHoloInner');
  inner.classList.remove('flipped');
  currState.flipped = false;
  document.getElementById('currCardQ').textContent = c.q;
  document.getElementById('currCardA').textContent = c.a;
  document.getElementById('currCardCounter').textContent = `${currState.currentCard+1} / ${b.cards.length}`;
  const key = b.id+'-'+currState.currentCard;
  const knowBtn = document.querySelector('.curr-know-btn');
  if(currState.known.has(key)){knowBtn.textContent='✓ Mastered';knowBtn.style.opacity='0.4'}
  else{knowBtn.textContent='✓ Got It';knowBtn.style.opacity='1'}
}

function currFlipCard(){
  const inner = document.getElementById('currHoloInner');
  inner.classList.toggle('flipped');
  currState.flipped = !currState.flipped;
}

function currNextCard(){
  if(!currState.currentBook) return;
  currState.currentCard = (currState.currentCard+1) % currState.currentBook.cards.length;
  currRenderCard();
}

function currPrevCard(){
  if(!currState.currentBook) return;
  currState.currentCard = (currState.currentCard-1+currState.currentBook.cards.length) % currState.currentBook.cards.length;
  currRenderCard();
}

function currMarkKnown(){
  if(!currState.currentBook) return;
  const key = currState.currentBook.id+'-'+currState.currentCard;
  currState.known.add(key);
  currSaveState();
  currUpdateGlobalProgress();
  currRenderBookshelf();
  currNextCard();
}

function currUpdateGlobalProgress(){
  const total = CURR_BOOKS.reduce((s,b)=>s+b.cards.length,0);
  const known = currState.known.size;
  document.getElementById('currProgressLabel').textContent = `${known} / ${total} cards mastered`;
}

// TERMINAL — QUIZ MODE
function currRenderQuizMenu(){
  const el = document.getElementById('currQuizSelect');
  el.innerHTML = CURR_BOOKS.map(b=>
    `<div class="curr-quiz-option" onclick="currStartQuiz('${b.id}')">
      <span class="curr-quiz-option-name">${b.icon} ${b.title}</span>
      <span class="curr-quiz-option-count">${b.cards.length} questions</span>
    </div>`
  ).join('') + `<div class="curr-quiz-option" onclick="currStartQuiz('random')">
    <span class="curr-quiz-option-name">🎲 Random Mix</span>
    <span class="curr-quiz-option-count">10 questions</span>
  </div>`;
}

function currStartQuiz(id){
  let cards;
  if(id==='random'){
    const all = CURR_BOOKS.flatMap(b=>b.cards.map(c=>({...c,bookId:b.id})));
    cards = all.sort(()=>Math.random()-0.5).slice(0,10);
  } else {
    const book = CURR_BOOKS.find(b=>b.id===id);
    cards = [...book.cards].sort(()=>Math.random()-0.5).slice(0,10);
  }
  currState.quizCards = cards;
  currState.quizIdx = 0;
  currState.quizCorrect = 0;
  currState.quizAnswered = false;
  document.getElementById('currTermBody').style.display='none';
  document.getElementById('currQuizResults').style.display='none';
  document.getElementById('currQuizActive').style.display='block';
  currRenderQuizQ();
}

function currRenderQuizQ(){
  const c = currState.quizCards[currState.quizIdx];
  document.getElementById('currQuizQNum').textContent = `Q${currState.quizIdx+1} / ${currState.quizCards.length}`;
  document.getElementById('currQuizQuestion').textContent = c.q;
  // Generate options: correct + 3 wrong from other cards
  const allCards = CURR_BOOKS.flatMap(b=>b.cards);
  const wrongPool = allCards.filter(x=>x.a!==c.a).sort(()=>Math.random()-0.5).slice(0,3);
  const opts = [{text:c.a,correct:true},...wrongPool.map(w=>({text:w.a,correct:false}))].sort(()=>Math.random()-0.5);
  // Truncate answers for display
  const truncate = (t) => t.length > 120 ? t.substring(0,117)+'...' : t;
  document.getElementById('currQuizOptions').innerHTML = opts.map((o,i)=>
    `<button class="curr-quiz-opt-btn" onclick="currQuizAnswer(${i},${o.correct})">${truncate(o.text)}</button>`
  ).join('');
  document.getElementById('currQuizFeedback').style.display='none';
  document.getElementById('currQuizNext').style.display='none';
  currState.quizAnswered = false;
}

function currQuizAnswer(idx, correct){
  if(currState.quizAnswered) return;
  currState.quizAnswered = true;
  const btns = document.querySelectorAll('.curr-quiz-opt-btn');
  btns.forEach((b,i)=>{
    if(i===idx) b.classList.add(correct?'correct':'wrong');
    b.classList.add('disabled');
  });
  // Show correct answer
  btns.forEach(b=>{ if(CURR_BOOKS.flatMap(bk=>bk.cards).find(c=>b.textContent.startsWith(c.a.substring(0,20)))) {} });
  if(correct) currState.quizCorrect++;
  const fb = document.getElementById('currQuizFeedback');
  fb.style.display='block';
  fb.className = 'curr-quiz-feedback ' + (correct?'correct-fb':'wrong-fb');
  fb.textContent = correct ? '✓ Correct!' : '✗ Not quite. Review this topic in the Library.';
  document.getElementById('currQuizNext').style.display='inline-block';
}

function currQuizNextQ(){
  currState.quizIdx++;
  if(currState.quizIdx >= currState.quizCards.length){
    currShowQuizResults();
  } else {
    currRenderQuizQ();
  }
}

function currShowQuizResults(){
  document.getElementById('currQuizActive').style.display='none';
  document.getElementById('currQuizResults').style.display='block';
  const pct = Math.round(currState.quizCorrect/currState.quizCards.length*100);
  document.getElementById('currQuizScore').textContent = pct+'%';
  let grade = pct>=90?'🏆 Industry Expert':pct>=70?'📡 Rising Professional':pct>=50?'📚 Getting There':'🔰 Keep Studying';
  document.getElementById('currQuizGrade').textContent = grade;
}

function currQuizRetry(){ currStartQuiz(currState.quizBook||'random'); }
function currQuizBackToMenu(){
  document.getElementById('currQuizActive').style.display='none';
  document.getElementById('currQuizResults').style.display='none';
  document.getElementById('currTermBody').style.display='block';
}

// PROGRESS VIEW
function currRenderProgress(){
  const total = CURR_BOOKS.reduce((s,b)=>s+b.cards.length,0);
  const known = currState.known.size;
  const pct = total?Math.round(known/total*100):0;
  document.getElementById('currProgressPct').textContent = pct+'%';
  const arc = document.getElementById('currProgressArc');
  const circ = 2*Math.PI*52;
  arc.style.strokeDashoffset = circ - (circ*pct/100);
  let label = pct>=90?'Expert — You know the business!':pct>=70?'Advanced — Strong foundation':pct>=40?'Intermediate — Progressing well':'Beginner — Keep studying!';
  document.getElementById('currMasteryLabel').textContent = label;
  // Badges
  const badges = [
    {icon:'🌐',name:'Foundation',req:'Complete Industry Foundations',earned:CURR_BOOKS[0].cards.every((_,i)=>currState.known.has('foundations-'+i))},
    {icon:'💰',name:'Revenue Pro',req:'Complete Royalties & Revenue',earned:CURR_BOOKS[1].cards.every((_,i)=>currState.known.has('royalties-'+i))},
    {icon:'📜',name:'Publisher',req:'Complete Publishing Deep Dive',earned:CURR_BOOKS[2].cards.every((_,i)=>currState.known.has('publishing-'+i))},
    {icon:'📡',name:'Marketer',req:'Complete Marketing & Growth',earned:CURR_BOOKS[3].cards.every((_,i)=>currState.known.has('marketing-'+i))},
    {icon:'⚖️',name:'Deal Maker',req:'Complete Deals & Contracts',earned:CURR_BOOKS[4].cards.every((_,i)=>currState.known.has('deals-'+i))},
    {icon:'📊',name:'Data Driven',req:'Complete Data & Analytics',earned:CURR_BOOKS[5].cards.every((_,i)=>currState.known.has('data-'+i))},
    {icon:'🚀',name:'Strategist',req:'Complete Advanced Strategy',earned:CURR_BOOKS[6].cards.every((_,i)=>currState.known.has('advanced-'+i))},
    {icon:'👑',name:'Master',req:'Complete ALL books',earned:pct===100}
  ];
  document.getElementById('currBadgesGrid').innerHTML = badges.map(b=>
    `<div class="curr-badge ${b.earned?'earned':'locked'}">
      <div class="curr-badge-icon">${b.icon}</div>
      <div class="curr-badge-name">${b.name}</div>
      <div class="curr-badge-req">${b.earned?'EARNED':b.req}</div>
    </div>`
  ).join('');
  // Book progress bars
  document.getElementById('currBookProgress').innerHTML = CURR_BOOKS.map(b=>{
    const bKnown = b.cards.filter((_,i)=>currState.known.has(b.id+'-'+i)).length;
    const bPct = Math.round(bKnown/b.cards.length*100);
    return `<div class="curr-bp-row">
      <div class="curr-bp-name">${b.icon} ${b.title}</div>
      <div class="curr-bp-bar"><div class="curr-bp-fill" style="width:${bPct}%;background:${b.color}"></div></div>
      <div class="curr-bp-pct">${bPct}%</div>
    </div>`;
  }).join('');
}

// KEYBOARD NAV for flashcards
document.addEventListener('keydown',e=>{
  if(!currState.currentBook) return;
  if(e.key==='ArrowRight'||e.key==='d') currNextCard();
  if(e.key==='ArrowLeft'||e.key==='a') currPrevCard();
  if(e.key===' '||e.key==='Enter'){e.preventDefault();currFlipCard();}
});

// SWIPE SUPPORT
let currTouchStartX=0;
document.addEventListener('touchstart',e=>{
  if(!currState.currentBook)return;
  currTouchStartX=e.touches[0].clientX;
},{passive:true});
document.addEventListener('touchend',e=>{
  if(!currState.currentBook)return;
  const diff=e.changedTouches[0].clientX-currTouchStartX;
  if(Math.abs(diff)>50){diff>0?currPrevCard():currNextCard();}
},{passive:true});

// BOOT CURRICULUM
function bootCurriculum(){
  currLoadState();
  currRenderBookshelf();
  currRenderQuizMenu();
  currUpdateGlobalProgress();
  // Show splash every time you enter the room
  currShowSplash();
}

// Hook into bootRoom
const _origBootRoom = typeof bootRoom==='function' ? bootRoom : null;
if(_origBootRoom){
  const _wrappedBoot = bootRoom;
  bootRoom = function(id){
    _wrappedBoot(id);
    if(id==='curriculum') bootCurriculum();
  };
} else { document.addEventListener('DOMContentLoaded',()=>setTimeout(bootCurriculum,500)); }

// ════ CONTENT STUDIO — BROADCAST CONTROL ROOM ENGINE ════

// ── Shared Release Data (Calendar ↔ Launch Pad Sync) ──
const lpReleaseData = {
  title: 'Night Drive',
  type: 'Single',
  artist: '10eo',
  releaseDate: new Date(2026, 2, 14), // March 14 2026
  currentWeek: 3,
  totalWeeks: 8,
  timeline: [
    {week:1,name:'Foundation',tasks:['Final master approved','Metadata submitted','Cover art locked'],done:true},
    {week:2,name:'Distribution',tasks:['Uploaded to distributor','ISRC assigned','Delivery confirmed'],done:true},
    {week:3,name:'Pre-save Push',tasks:['Pre-save links live','Social campaign started','Email blast to fans'],done:false,current:true},
    {week:4,name:'Playlist Pitching',tasks:['Spotify editorial submit','Independent curators','Blog outreach'],done:false},
    {week:5,name:'Content Blitz',tasks:['Daily teasers','Lyric videos','TikTok sound push'],done:false},
    {week:6,name:'Release Week',tasks:['LAUNCH DAY','Monitor streams','Share milestones'],done:false},
    {week:7,name:'Momentum',tasks:['Music video drop','Remix/acoustic','Cross-promotion'],done:false},
    {week:8,name:'Analysis',tasks:['Performance review','Revenue tracking','Plan next cycle'],done:false}
  ]
};

// ── Calendar Events (merged: user scheduled + LP auto-synced) ──
let csEvents = [];
function csInitEvents(){
  // User-scheduled content posts
  csEvents = [
    {day:1,month:2,year:2026,title:'New single announcement',plats:['Instagram','TikTok'],status:'scheduled',type:'post',color:'#e1306c'},
    {day:3,month:2,year:2026,title:'Studio session BTS clip',plats:['X / Twitter','YouTube'],status:'draft',type:'post',color:'#1da1f2'},
    {day:7,month:2,year:2026,title:'150K streams celebration',plats:['Instagram','Facebook','X'],status:'idea',type:'post',color:'#7c4dff'},
    {day:10,month:2,year:2026,title:'Pre-save push reminder',plats:['Instagram','TikTok','X'],status:'scheduled',type:'post',color:'#e1306c'},
    {day:21,month:2,year:2026,title:'Behind the scenes studio',plats:['TikTok','YouTube'],status:'draft',type:'post',color:'#ff0050'}
  ];
  // Auto-sync from Launch Pad release timeline
  const rd = lpReleaseData.releaseDate;
  lpReleaseData.timeline.forEach(wk => {
    const weekDate = new Date(rd);
    weekDate.setDate(rd.getDate() - (lpReleaseData.totalWeeks - wk.week) * 7);
    if(weekDate.getMonth() >= 0){
      csEvents.push({
        day: weekDate.getDate(), month: weekDate.getMonth(), year: weekDate.getFullYear(),
        title: `▲ Wk ${wk.week}: ${wk.name}`, plats: [], status: wk.done ? 'complete' : (wk.current ? 'active' : 'upcoming'),
        type: 'release', color: '#ff6e40', fromLaunchPad: true
      });
    }
  });
  // Release day itself
  csEvents.push({day:rd.getDate(),month:rd.getMonth(),year:rd.getFullYear(),title:'RELEASE DAY — '+lpReleaseData.title,plats:[],status:'release-day',type:'release',color:'#ff6e40',fromLaunchPad:true});
}
csInitEvents();

let csMonth=2, csYear=2026;
const csMonths=['JANUARY','FEBRUARY','MARCH','APRIL','MAY','JUNE','JULY','AUGUST','SEPTEMBER','OCTOBER','NOVEMBER','DECEMBER'];

// Tab switching
function csTabSwitch(tab, btn){
  document.querySelectorAll('.cs-tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.cs-tab').forEach(t=>t.classList.remove('active'));
  const panel = document.getElementById('csPanel-'+tab);
  if(panel) panel.classList.add('active');
  if(btn) btn.classList.add('active');
  if(tab==='queue') csRenderQueue();
}

// Calendar renderer (with LP sync)
function csRenderCal(){
  const g=document.getElementById('csCalGrid');if(!g)return;
  g.innerHTML='';
  ['SUN','MON','TUE','WED','THU','FRI','SAT'].forEach(d=>{
    const h=document.createElement('div');
    h.style.cssText='text-align:center;font-size:0.45rem;color:rgba(232,234,246,0.25);padding:0.3rem;font-family:Orbitron,sans-serif;letter-spacing:1px';
    h.textContent=d;g.appendChild(h);
  });
  const first=new Date(csYear,csMonth,1).getDay();
  const days=new Date(csYear,csMonth+1,0).getDate();
  const today=new Date();
  for(let i=0;i<first;i++){g.appendChild(document.createElement('div'));}
  for(let d=1;d<=days;d++){
    const el=document.createElement('div');
    const dayEvents=csEvents.filter(e=>e.day===d&&e.month===csMonth&&e.year===csYear);
    const hasRelease=dayEvents.some(e=>e.type==='release');
    const hasPost=dayEvents.some(e=>e.type==='post');
    const isToday=d===today.getDate()&&csMonth===today.getMonth()&&csYear===today.getFullYear();
    el.className='cs-cal-day'+(hasRelease?' has-release':hasPost?' has-event':'')+(isToday?' today':'');
    el.style.cssText='color:'+(hasRelease?'#ff6e40':hasPost?'#ffab40':'rgba(232,234,246,0.45)');
    let dots='';
    if(hasPost) dots+='<span class="cs-cal-dot" style="background:#ffab40"></span>';
    if(hasRelease) dots+='<span class="cs-cal-dot" style="background:#ff6e40"></span>';
    el.innerHTML=d+dots;
    el.onclick=()=>csShowDayDetail(d,dayEvents);
    g.appendChild(el);
  }
  document.getElementById('csMonthLabel').textContent=csMonths[csMonth]+' '+csYear;
}

function csShowDayDetail(day,events){
  const panel=document.getElementById('csCalDetail');
  const content=document.getElementById('csCalDetailContent');
  if(!events.length){
    document.getElementById('csCalDetailDate').textContent=csMonths[csMonth]+' '+day;
    content.innerHTML='<div style="color:rgba(232,234,246,0.3);font-size:0.6rem">No content scheduled — click Compose tab to create a post</div>';
    panel.style.display='block'; return;
  }
  document.getElementById('csCalDetailDate').textContent=csMonths[csMonth]+' '+day;
  content.innerHTML=events.map(e=>{
    const badge=e.fromLaunchPad?'<span style="font-size:0.4rem;color:#ff6e40;border:1px solid rgba(255,110,64,0.2);padding:0.1rem 0.3rem;border-radius:6px;margin-left:0.3rem;font-family:Orbitron,sans-serif;letter-spacing:0.5px">Launch Pad</span>':'';
    const statusColor=e.status==='scheduled'?'#00e676':e.status==='draft'?'#ffab40':e.status==='complete'?'#00e676':e.status==='active'?'#ff6e40':'rgba(232,234,246,0.3)';
    return `<div style="padding:0.4rem;background:rgba(255,255,255,0.02);border-left:2px solid ${e.color};border-radius:0 4px 4px 0;margin-bottom:0.3rem">
      <div style="display:flex;align-items:center;gap:0.3rem"><span style="color:${e.color};font-size:0.65rem">${e.title}</span>${badge}</div>
      ${e.plats.length?'<div style="color:rgba(232,234,246,0.3);font-size:0.5rem;margin-top:0.2rem">'+e.plats.join(' · ')+'</div>':''}
      <div style="color:${statusColor};font-size:0.45rem;margin-top:0.2rem;font-family:Space Mono,monospace;text-transform:uppercase">${e.status}</div>
    </div>`;
  }).join('');
  panel.style.display='block';
}

function csNavMonth(dir){csMonth+=dir;if(csMonth>11){csMonth=0;csYear++;}if(csMonth<0){csMonth=11;csYear--;}csRenderCal();}

// Queue renderer
function csRenderQueue(){
  const q=document.getElementById('csQueue');if(!q)return;
  const posts=csEvents.filter(e=>e.type==='post').sort((a,b)=>a.day-b.day);
  const syncedRelease=csEvents.filter(e=>e.fromLaunchPad&&e.month===csMonth&&e.year===csYear);
  let html=posts.map(p=>{
    const sc=p.status==='scheduled'?'color:#00e676;border-color:rgba(0,230,118,0.2)':p.status==='draft'?'color:#ffab40;border-color:rgba(255,171,64,0.2)':'color:rgba(232,234,246,0.3);border-color:rgba(255,255,255,0.1)';
    const bg=p.status==='scheduled'?'background:rgba(0,230,118,0.03)':p.status==='draft'?'background:rgba(255,171,64,0.03)':'background:rgba(255,255,255,0.01)';
    return `<div class="cs-queue-item" style="border:1px solid rgba(255,255,255,0.06);${bg}">
      <div class="cs-queue-time">${csMonths[p.month].slice(0,3)} ${String(p.day).padStart(2,'0')}</div>
      <div style="flex:1"><div style="color:#e8eaf6;font-size:0.65rem;margin-bottom:0.15rem">${p.title}</div><div style="color:rgba(232,234,246,0.3);font-size:0.5rem">${p.plats.join(' · ')}</div></div>
      <div class="cs-queue-status" style="${sc}">${p.status}</div>
    </div>`;
  }).join('');
  if(syncedRelease.length){
    html+=`<div style="margin-top:0.8rem;padding-top:0.6rem;border-top:1px solid rgba(255,110,64,0.1)">
      <div style="font-family:Orbitron,sans-serif;font-size:0.45rem;color:rgba(255,110,64,0.4);letter-spacing:1.5px;margin-bottom:0.5rem">SYNCED FROM LAUNCH PAD</div>`;
    html+=syncedRelease.map(r=>`<div class="cs-queue-item" style="border:1px solid rgba(255,110,64,0.1);background:rgba(255,110,64,0.02)">
      <div class="cs-queue-time" style="color:#ff6e40">${csMonths[r.month].slice(0,3)} ${String(r.day).padStart(2,'0')}</div>
      <div style="flex:1"><div style="color:#ff6e40;font-size:0.65rem">${r.title}</div></div>
      <div class="cs-queue-sync">▲ LP</div>
    </div>`).join('');
    html+=`</div>`;
  }
  q.innerHTML=html;
  const cnt=document.getElementById('csQueueCount');if(cnt)cnt.textContent=posts.length;
}

// Caption generator (preserved from v6)
const csCaptions={
  hype:{release:['NEW MUSIC. {title} drops {date}. Pre-save NOW, this one hits different.','THE WAIT IS OVER. {title} is here. Stream it everywhere right now.','Y\'all not ready for this one. {title} coming {date}. Buckle up.'],bts:['In the lab cooking something crazy rn','Studio session went CRAZY today. Wait til you hear what\'s coming...','3 AM session. Coffee cold. Beat still hot. This is how hits are made.'],milestone:['We just hit {number} streams. Started from zero. THANK YOU.','This community is unreal. {number} of you chose to listen. I don\'t take that lightly.','From bedroom recordings to {number} streams. The grind is real.'],engage:['What song of mine do you have on repeat right now? Drop it below','If you could hear me collab with anyone, who would it be?','Real talk: morning playlist or late night vibes?'],collab:['Something special cooking with @{artist}. Not ready to say more yet...','When two sounds collide. Me + @{artist} = something else','This collab was made in the stars. @{artist}, we got one.']},
  chill:{release:['new sounds. {title} is out there now. hope it finds you at the right moment.','been sitting with this one for a while. {title} is finally yours. link in bio.','made something honest. {title} available everywhere. let me know what you feel.'],bts:['quiet studio day. just me and the keys. sometimes that\'s enough.','found a melody today that stopped me. can\'t wait to share it with you.','the best ideas always come when you stop trying so hard.'],milestone:['{number} streams. grateful for every single one.','numbers are cool but it\'s the DMs from y\'all that really hit. thank you.','didn\'t start this for the numbers. but {number} of you listening means everything.'],engage:['what are you listening to today? need some new sounds in my rotation.','sunrise or sunset — when do you listen to music most?','share a song that changed your life. I\'ll go first...'],collab:['made something beautiful with @{artist}. patience.','when you find someone who hears music the same way you do. @{artist}','this one felt effortless. @{artist} brought something special.']},
  personal:{release:['I wrote {title} at 2 AM when I couldn\'t sleep. now it\'s yours.','{title} is the most honest thing I\'ve ever made. out now everywhere.','some songs write themselves. {title} was one of those. stream link in bio.'],bts:['wrote about something I\'ve never talked about publicly. nervous but ready.','every song starts as a feeling I can\'t put into words yet.','today I remembered why I started making music. it\'s always been about this.'],milestone:['when I started, my mom was my only listener. now {number} of you are here.','{number} streams. each one represents someone who gave me a chance.','I genuinely didn\'t think anyone would listen. {number} streams later...'],engage:['what\'s a song that makes you feel understood? I need to know.','I make music for the 2 AM thoughts. what keeps you up at night?','tell me what lyric has ever hit you the hardest. no wrong answers.'],collab:['@{artist} understood what I was trying to say before I could say it.','this collab happened because we were both going through the same thing.','real recognize real. @{artist} made this song what it is.']},
  promo:{release:['OUT NOW: {title} — Stream on all platforms. Link in bio.','NEW RELEASE: {title} is LIVE. Spotify / Apple Music / YouTube. Don\'t sleep.','{title} — available now everywhere you stream music. Link in bio.'],bts:['Content creating behind the scenes. New music coming soon. Stay locked in.','The process > the product. But the product is fire too. Coming soon.','Building something bigger than a song. Stay tuned.'],milestone:['MILESTONE: {number} streams! Thank you for being part of this journey.','We did it! {number} streams. Celebrating with a special announcement this week...','{number} streams and counting. The mission: 1M by end of year. Are you with me?'],engage:['Q&A TIME — Ask me anything about my music, studio life, or what\'s coming next.','POLL: What should I release next? A) Dark electronic B) Acoustic ballad C) High-energy banger','GIVEAWAY — Win signed merch. Follow + Like + Tag 2 friends. Winner Friday!'],collab:['COLLAB ALERT: Me x @{artist}. Coming soon.','Double trouble incoming. @{artist} + @10eo. Mark your calendars.','The collab you didn\'t know you needed. Me + @{artist} = something special.']},
  story:{release:['I started writing {title} on a Tuesday night when everything felt wrong. Three months later, it\'s the song I\'m most proud of.','There\'s a story behind {title} that I\'ve never told anyone. Maybe one day I will. For now, just listen.','Every song I\'ve ever made led to {title}. It\'s not just a track — it\'s a chapter closing and a new one beginning.'],bts:['The first version of this song was terrible. But I kept pushing. And now it\'s something I\'m proud of.','I almost deleted this song three times. The fourth time I listened back, something clicked.','Today marks one year since I built my home studio with $200 and a dream. Look at us now.'],milestone:['I remember my first stream. Literally one stream. I refreshed the page twelve times. Now we\'re at {number}.','My teacher told me music wasn\'t a real career. {number} streams later, I think about that a lot.','From playing to empty rooms to {number} streams. Every no brought me closer to this yes.'],engage:['I\'ve been thinking about why we connect with certain songs. Is it the melody? The lyrics? Or where we were when we first heard it?','Music saved my life at 16. I\'m not being dramatic. What song saved yours?','The most powerful thing about music is that it makes strangers feel like family. Prove me right.'],collab:['This collab happened: I slid into @{artist}\'s DMs at 1 AM with a voice note. They responded in 4 minutes.','I\'ve admired @{artist}\'s work for years. Getting in the studio together felt surreal.','Two different cities, two different sounds, one shared vision. @{artist} and I found something magical.']}
};

function csGenCaption(){
  const tone=document.getElementById('csTone').value;
  const type=document.getElementById('csPostType').value;
  const pool=csCaptions[tone]?.[type]||csCaptions.hype.release;
  let txt=pool[Math.floor(Math.random()*pool.length)];
  txt=txt.replace(/{title}/g,lpReleaseData.title).replace(/{date}/g,'March 14').replace(/{number}/g,'142,800').replace(/{artist}/g,'featured_artist');
  document.getElementById('csGenText').textContent=txt;
  document.getElementById('csGenResult').style.display='block';
}
function csTogglePlat(btn){btn.classList.toggle('active');const a=btn.classList.contains('active');btn.style.background=a?'rgba(225,48,108,0.15)':'rgba(255,255,255,0.05)';btn.style.borderColor=a?'rgba(225,48,108,0.4)':'rgba(255,255,255,0.1)';btn.style.color=a?'#e1306c':'rgba(232,234,246,0.4)';}
function csSchedule(){
  const cap=document.getElementById('csCaption').value;
  if(!cap){orbitalConfirm('WRITE SOMETHING FIRST','alert');return;}
  if(!_currentUser){orbitalConfirm('LOGIN REQUIRED','alert');return;}
  // Collect platforms
  const plats=[];
  document.querySelectorAll('.cs-plat-btn.active').forEach(b=>plats.push(b.dataset.plat));
  // Save to Supabase calendar
  const now=new Date();
  const scheduledAt=new Date(csYear,csMonth,now.getDate()+1,9,0); // schedule for tomorrow 9am
  _sb.from('calendar').insert({
    user_id: _currentUser.id,
    title: cap.slice(0,100),
    description: cap,
    event_type: 'post',
    platform: plats.join(','),
    scheduled_at: scheduledAt.toISOString(),
    status: 'scheduled',
    content_data: { caption: cap, platforms: plats, tone: document.getElementById('csTone').value, postType: document.getElementById('csPostType').value }
  }).then(({error})=>{
    if(error){console.error('Schedule error:',error);orbitalConfirm('SCHEDULE FAILED','alert');return;}
    orbitalConfirm('POST SCHEDULED','sync');
    document.getElementById('csCaption').value='';
    // Milestone: first RSP broadcast
    _checkMilestone('first_rsp',{handle:_currentUser.user_metadata?.callsign||'artist'});
    // Reload calendar from DB
    _csLoadFromDB();
  });
}
function csDraft(){
  const cap=document.getElementById('csCaption').value;
  if(!cap){orbitalConfirm('WRITE SOMETHING FIRST','alert');return;}
  if(!_currentUser){orbitalConfirm('LOGIN REQUIRED','alert');return;}
  const plats=[];
  document.querySelectorAll('.cs-plat-btn.active').forEach(b=>plats.push(b.dataset.plat));
  _sb.from('calendar').insert({
    user_id: _currentUser.id,
    title: cap.slice(0,100),
    description: cap,
    event_type: 'post',
    platform: plats.join(','),
    scheduled_at: new Date().toISOString(),
    status: 'draft',
    content_data: { caption: cap, platforms: plats, tone: document.getElementById('csTone').value, postType: document.getElementById('csPostType').value }
  }).then(({error})=>{
    if(error){console.error('Draft error:',error);orbitalConfirm('SAVE FAILED','alert');return;}
    orbitalConfirm('DRAFT SAVED','locked');
    document.getElementById('csCaption').value='';
    _csLoadFromDB();
  });
}

// Load user calendar events from Supabase
async function _csLoadFromDB(){
  if(!_currentUser) return;
  try{
    const {data,error}=await _sb.from('calendar').select('*').eq('user_id',_currentUser.id).order('scheduled_at',{ascending:true});
    if(error) throw error;
    // Clear user events, keep LP sync events
    csEvents=csEvents.filter(e=>e.fromLaunchPad);
    // Merge DB events
    if(data) data.forEach(ev=>{
      const d=new Date(ev.scheduled_at);
      const plats=ev.platform?ev.platform.split(','):[];
      csEvents.push({
        day:d.getDate(),month:d.getMonth(),year:d.getFullYear(),
        title:ev.title,plats,status:ev.status,type:ev.event_type,
        color:ev.status==='scheduled'?'#ffab40':ev.status==='draft'?'rgba(232,234,246,0.3)':'#00e676',
        dbId:ev.id, description:ev.description
      });
    });
    csRenderCal();
    csRenderQueue();
    // Update status
    const scheduled=csEvents.filter(e=>e.status==='scheduled'&&!e.fromLaunchPad).length;
    const synced=csEvents.filter(e=>e.fromLaunchPad).length;
    document.getElementById('csLiveStatus').textContent=scheduled+' post'+(scheduled!==1?'s':'')+' scheduled · '+synced+' release'+(synced!==1?'s':'')+' synced';
  }catch(e){console.error('Calendar load error:',e);}
}
function csLoadTemplate(tone,type){
  const pool=csCaptions[tone]?.[type]||[];
  const list=document.getElementById('csTemplateList');
  const preview=document.getElementById('csTemplatePreview');
  list.innerHTML=pool.map((t,i)=>`<div style="padding:0.5rem;background:rgba(255,255,255,0.02);border:1px solid rgba(255,171,64,0.08);border-radius:6px;cursor:pointer" onclick="document.getElementById('csCaption').value=this.textContent;csTabSwitch('compose',document.querySelectorAll('.cs-tab')[1])"><div style="color:#e8eaf6;font-size:0.6rem;font-family:'Space Mono',monospace;line-height:1.5">${t.replace(/{title}/g,lpReleaseData.title).replace(/{date}/g,'March 14').replace(/{number}/g,'142,800').replace(/{artist}/g,'featured_artist')}</div></div>`).join('');
  preview.style.display='block';
}

// Update sync monitor from LP data
function csUpdateSyncMonitor(){
  const n=document.getElementById('csSyncReleaseName');if(n)n.textContent=lpReleaseData.title;
  const d=document.getElementById('csSyncReleaseDate');if(d)d.textContent=lpReleaseData.releaseDate.toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'});
  const p=document.getElementById('csSyncProgress');if(p)p.style.width=(lpReleaseData.currentWeek/lpReleaseData.totalWeeks*100)+'%';
  const w=document.getElementById('csSyncWeek');if(w)w.textContent='Wk '+lpReleaseData.currentWeek+'/'+lpReleaseData.totalWeeks;
}

// Init on room entry
if(document.getElementById('csCalGrid')){csRenderCal();csUpdateSyncMonitor();}

// Content Studio DB load hook — called from switchRoom
function csBootDB(){ if(_currentUser) _csLoadFromDB(); }

// ════ LAUNCH PAD ENGINE (synced with Content Studio) ════
function lpNewRelease(){alert('New Release wizard — set title, type, release date, and begin 8-week countdown. Coming with backend.');}
function lpToggleDSP(el){const status=el.querySelector('div:last-child');const icon=el.querySelector('div:first-child');if(status.textContent.trim()==='Pending'){status.textContent='Processing';status.style.color='#ffab40';icon.textContent='◐';icon.style.background='rgba(255,171,64,0.2)';icon.style.color='#ffab40';}else if(status.textContent.trim()==='Processing'){status.textContent='Delivered';status.style.color='#00e676';icon.textContent='✓';icon.style.background='rgba(0,230,118,0.2)';icon.style.color='#00e676';}else if(status.textContent.trim()==='Delivered'){status.textContent='Pending';status.style.color='rgba(232,234,246,0.3)';icon.textContent='○';icon.style.background='rgba(255,255,255,0.1)';icon.style.color='rgba(255,255,255,0.3)';}}
function lpCopyLink(btn,msg){const url=btn.parentElement.querySelector('div[style*="font-family"]').textContent;navigator.clipboard?.writeText(url).then(()=>{const o=btn.textContent;btn.textContent=msg;setTimeout(()=>btn.textContent=o,1500);}).catch(()=>{const o=btn.textContent;btn.textContent=msg;setTimeout(()=>btn.textContent=o,1500);});}
// LP→CS sync: when release data changes, re-init calendar events
function lpSyncToCalendar(){csInitEvents();csRenderCal();csUpdateSyncMonitor();}

// ════ SETTINGS ENGINE ════
function stEdit(btn){alert('Edit field — inline editing coming in v7');}
function stToggle(el){const dot=el.querySelector('div');const isOn=el.style.background.includes('00e676');if(isOn){el.style.background='rgba(255,255,255,0.15)';dot.style.background='rgba(255,255,255,0.5)';dot.style.right='auto';dot.style.left='2px';}else{el.style.background='#00e676';dot.style.background='#fff';dot.style.left='auto';dot.style.right='2px';}}
function stDanger(action){if(confirm('Are you sure? This action is '+action)){alert(action+' — backend required');}}

// ════════════════════════════════════════════════════
//  ROOM ENVIRONMENT ENGINE — Procedural Landscapes
// ════════════════════════════════════════════════════

const envCanvas = document.getElementById('envCanvas');
const envCtx = envCanvas ? envCanvas.getContext('2d') : null;
let envActive = null;
let envFrame = null;
let envTime = 0;
let meteors = [];
let auroraWaves = [];
let cityLights = [];
let raindrops = [];
let envParticles = [];

function envResize() {
  if (!envCanvas) return;
  envCanvas.width = window.innerWidth;
  envCanvas.height = window.innerHeight;
}
if (envCanvas) { envResize(); window.addEventListener('resize', envResize); }

// ── METEOR SHOWER (lobby enhancement) ──
function initMeteors() {
  meteors = [];
  for (let i = 0; i < 4; i++) {
    meteors.push(createMeteor(Math.random() * 5000));
  }
}
function createMeteor(delay) {
  const W = envCanvas.width, H = envCanvas.height;
  return {
    x: Math.random() * W * 1.2, y: -20 - Math.random() * 100,
    vx: -(2 + Math.random() * 3), vy: 3 + Math.random() * 4,
    len: 40 + Math.random() * 80, life: 0, maxLife: 60 + Math.random() * 40,
    delay: delay, size: 0.5 + Math.random() * 1.2,
    hue: Math.random() > 0.7 ? 190 : (Math.random() > 0.5 ? 270 : 210)
  };
}
function drawMeteors(ctx) {
  meteors.forEach((m, i) => {
    if (m.delay > 0) { m.delay--; return; }
    m.life++;
    m.x += m.vx; m.y += m.vy;
    const alpha = m.life < 10 ? m.life / 10 : (m.life > m.maxLife - 15 ? (m.maxLife - m.life) / 15 : 1);
    if (alpha <= 0 || m.y > envCanvas.height + 50) {
      meteors[i] = createMeteor(Math.random() * 300 + 100);
      return;
    }
    const tailX = m.x - m.vx * m.len / Math.sqrt(m.vx*m.vx + m.vy*m.vy);
    const tailY = m.y - m.vy * m.len / Math.sqrt(m.vx*m.vx + m.vy*m.vy);
    const grad = ctx.createLinearGradient(m.x, m.y, tailX, tailY);
    grad.addColorStop(0, `hsla(${m.hue},80%,80%,${alpha * 0.9})`);
    grad.addColorStop(0.3, `hsla(${m.hue},60%,60%,${alpha * 0.4})`);
    grad.addColorStop(1, `hsla(${m.hue},40%,50%,0)`);
    ctx.beginPath(); ctx.moveTo(m.x, m.y); ctx.lineTo(tailX, tailY);
    ctx.strokeStyle = grad; ctx.lineWidth = m.size; ctx.lineCap = 'round'; ctx.stroke();
    // head glow
    ctx.beginPath(); ctx.arc(m.x, m.y, m.size * 2, 0, Math.PI * 2);
    ctx.fillStyle = `hsla(${m.hue},80%,90%,${alpha * 0.6})`; ctx.fill();
  });
}

// ── AURORA BOREALIS ──
function initAurora() {
  auroraWaves = [];
  for (let i = 0; i < 5; i++) {
    auroraWaves.push({
      y: 0.08 + i * 0.06,
      amplitude: 15 + Math.random() * 25,
      frequency: 0.003 + Math.random() * 0.004,
      speed: 0.008 + Math.random() * 0.012,
      phase: Math.random() * Math.PI * 2,
      hue: [160, 130, 180, 200, 280][i],
      opacity: 0.08 + Math.random() * 0.06,
      width: 0.15 + Math.random() * 0.1
    });
  }
}
function drawAurora(ctx, W, H) {
  auroraWaves.forEach(w => {
    w.phase += w.speed;
    const baseY = H * w.y;
    const bandH = H * w.width;
    for (let x = 0; x < W; x += 3) {
      const wave = Math.sin(x * w.frequency + w.phase) * w.amplitude +
                   Math.sin(x * w.frequency * 1.7 + w.phase * 0.6) * w.amplitude * 0.5;
      const shimmer = Math.sin(x * 0.02 + envTime * 0.03) * 0.3 + 0.7;
      const alpha = w.opacity * shimmer * (0.7 + 0.3 * Math.sin(x * 0.005 + envTime * 0.01));
      const grad = ctx.createLinearGradient(x, baseY + wave - bandH/2, x, baseY + wave + bandH/2);
      grad.addColorStop(0, `hsla(${w.hue},70%,60%,0)`);
      grad.addColorStop(0.3, `hsla(${w.hue},70%,55%,${alpha})`);
      grad.addColorStop(0.5, `hsla(${w.hue},80%,65%,${alpha * 1.2})`);
      grad.addColorStop(0.7, `hsla(${w.hue + 20},70%,55%,${alpha})`);
      grad.addColorStop(1, `hsla(${w.hue + 20},60%,50%,0)`);
      ctx.fillStyle = grad;
      ctx.fillRect(x, baseY + wave - bandH/2, 4, bandH);
    }
  });
}

// ── CITY SKYLINE (penthouse view) ──
function initCity() {
  cityLights = [];
  const W = envCanvas.width;
  const baseY = envCanvas.height * 0.72;
  // Buildings
  for (let i = 0; i < 60; i++) {
    const x = (i / 60) * W;
    const h = 30 + Math.random() * 120;
    const w = 8 + Math.random() * 25;
    cityLights.push({
      type: 'building', x: x, y: baseY - h, w: w, h: h,
      windows: Math.floor(Math.random() * 8) + 2,
      floors: Math.floor(h / 8),
      brightness: 0.02 + Math.random() * 0.04
    });
  }
  // Window twinkles
  for (let i = 0; i < 200; i++) {
    cityLights.push({
      type: 'window',
      x: Math.random() * W,
      y: baseY - 10 - Math.random() * 140,
      size: 1 + Math.random() * 2,
      pulse: Math.random() * Math.PI * 2,
      speed: 0.01 + Math.random() * 0.03,
      on: Math.random() > 0.3
    });
  }
  // Rain
  raindrops = [];
  for (let i = 0; i < 80; i++) {
    raindrops.push({
      x: Math.random() * W, y: Math.random() * envCanvas.height,
      speed: 4 + Math.random() * 6, len: 8 + Math.random() * 15,
      opacity: 0.03 + Math.random() * 0.06
    });
  }
}
function drawCity(ctx, W, H) {
  const baseY = H * 0.72;
  // Cityscape silhouette
  ctx.fillStyle = 'rgba(8,12,24,0.95)';
  ctx.fillRect(0, baseY, W, H - baseY);
  // Buildings
  cityLights.forEach(b => {
    if (b.type !== 'building') return;
    ctx.fillStyle = `rgba(12,18,35,${0.8 + Math.random() * 0.1})`;
    ctx.fillRect(b.x, b.y, b.w, b.h);
    // Window grid
    for (let fy = 0; fy < b.floors; fy++) {
      for (let fx = 0; fx < b.windows; fx++) {
        if (Math.random() > 0.6) continue;
        const wx = b.x + 2 + fx * (b.w / b.windows);
        const wy = b.y + 3 + fy * 8;
        const flicker = Math.sin(envTime * 0.02 + wx * 0.1 + wy * 0.05) * 0.5 + 0.5;
        ctx.fillStyle = `rgba(255,220,140,${b.brightness * flicker})`;
        ctx.fillRect(wx, wy, 2, 3);
      }
    }
  });
  // Floating window lights
  cityLights.forEach(w => {
    if (w.type !== 'window' || !w.on) return;
    w.pulse += w.speed;
    const alpha = (Math.sin(w.pulse) * 0.5 + 0.5) * 0.15;
    ctx.beginPath(); ctx.arc(w.x, w.y, w.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,200,100,${alpha})`; ctx.fill();
  });
  // Rain
  raindrops.forEach(r => {
    r.y += r.speed;
    if (r.y > H) { r.y = -r.len; r.x = Math.random() * W; }
    ctx.beginPath();
    ctx.moveTo(r.x, r.y); ctx.lineTo(r.x - 0.5, r.y - r.len);
    ctx.strokeStyle = `rgba(150,180,220,${r.opacity})`; ctx.lineWidth = 0.5; ctx.stroke();
  });
  // Glass reflection line
  const reflGrad = ctx.createLinearGradient(0, H * 0.65, 0, H * 0.72);
  reflGrad.addColorStop(0, 'transparent');
  reflGrad.addColorStop(1, 'rgba(100,140,200,0.02)');
  ctx.fillStyle = reflGrad;
  ctx.fillRect(0, H * 0.65, W, H * 0.07);
  // Glass frame lines (floor-to-ceiling windows)
  ctx.strokeStyle = 'rgba(100,160,220,0.04)';
  ctx.lineWidth = 1;
  for (let gx = 0; gx < W; gx += W / 5) {
    ctx.beginPath(); ctx.moveTo(gx, 0); ctx.lineTo(gx, H); ctx.stroke();
  }
  // Horizontal frame
  ctx.beginPath(); ctx.moveTo(0, H * 0.35); ctx.lineTo(W, H * 0.35); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(0, H * 0.7); ctx.lineTo(W, H * 0.7); ctx.stroke();
}

// ── DEEP SEA (The Vault) ──
let jellyfish = [];
let seaParticles = [];
function initDeepSea() {
  jellyfish = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 12; i++) {
    jellyfish.push({
      x: Math.random() * W, y: Math.random() * H,
      size: 8 + Math.random() * 18, drift: Math.random() * Math.PI * 2,
      driftSpeed: 0.003 + Math.random() * 0.005,
      riseSpeed: 0.15 + Math.random() * 0.3,
      hue: [190, 210, 260, 170, 300][Math.floor(Math.random() * 5)],
      pulse: Math.random() * Math.PI * 2,
      tentacles: 3 + Math.floor(Math.random() * 4)
    });
  }
  seaParticles = [];
  for (let i = 0; i < 60; i++) {
    seaParticles.push({
      x: Math.random() * W, y: Math.random() * H,
      size: 0.5 + Math.random() * 2, drift: Math.random() * Math.PI * 2,
      speed: 0.002 + Math.random() * 0.004,
      hue: [180, 200, 160, 280][Math.floor(Math.random() * 4)],
      alpha: 0.1 + Math.random() * 0.2
    });
  }
}
function drawDeepSea(ctx, W, H) {
  // Ocean gradient
  const seaGrad = ctx.createLinearGradient(0, 0, 0, H);
  seaGrad.addColorStop(0, 'rgba(0,8,20,0.7)');
  seaGrad.addColorStop(0.5, 'rgba(0,12,30,0.5)');
  seaGrad.addColorStop(1, 'rgba(0,5,15,0.8)');
  ctx.fillStyle = seaGrad; ctx.fillRect(0, 0, W, H);
  // Bioluminescent particles
  seaParticles.forEach(p => {
    p.drift += p.speed;
    p.x += Math.sin(p.drift) * 0.3;
    p.y -= 0.1 + Math.sin(p.drift * 1.3) * 0.2;
    if (p.y < -10) { p.y = H + 10; p.x = Math.random() * W; }
    const shimmer = Math.sin(envTime * 0.03 + p.drift) * 0.5 + 0.5;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fillStyle = `hsla(${p.hue},80%,70%,${p.alpha * shimmer})`;
    ctx.fill();
  });
  // Jellyfish
  jellyfish.forEach(j => {
    j.drift += j.driftSpeed;
    j.x += Math.sin(j.drift) * 0.5;
    j.y -= j.riseSpeed;
    j.pulse += 0.04;
    if (j.y < -j.size * 4) { j.y = H + j.size * 4; j.x = Math.random() * W; }
    const breathe = Math.sin(j.pulse) * 0.15 + 1;
    const alpha = 0.08 + Math.sin(j.pulse) * 0.04;
    // Bell
    const glow = ctx.createRadialGradient(j.x, j.y, 0, j.x, j.y, j.size * breathe * 2);
    glow.addColorStop(0, `hsla(${j.hue},70%,70%,${alpha * 1.5})`);
    glow.addColorStop(0.5, `hsla(${j.hue},60%,50%,${alpha})`);
    glow.addColorStop(1, `hsla(${j.hue},50%,40%,0)`);
    ctx.beginPath(); ctx.arc(j.x, j.y, j.size * breathe * 2, 0, Math.PI * 2);
    ctx.fillStyle = glow; ctx.fill();
    ctx.beginPath(); ctx.arc(j.x, j.y, j.size * breathe, Math.PI, 0);
    ctx.fillStyle = `hsla(${j.hue},60%,65%,${alpha * 2})`; ctx.fill();
    // Tentacles
    for (let t = 0; t < j.tentacles; t++) {
      const tx = j.x + (t - j.tentacles/2) * (j.size * 0.4);
      ctx.beginPath(); ctx.moveTo(tx, j.y);
      const wave = Math.sin(envTime * 0.02 + t) * 5;
      ctx.quadraticCurveTo(tx + wave, j.y + j.size * 1.5, tx + wave * 1.5, j.y + j.size * 2.5);
      ctx.strokeStyle = `hsla(${j.hue},50%,60%,${alpha * 1.5})`; ctx.lineWidth = 0.8; ctx.stroke();
    }
  });
  // Pressure vignette
  const vign = ctx.createRadialGradient(W/2, H/2, W*0.2, W/2, H/2, W*0.7);
  vign.addColorStop(0, 'transparent'); vign.addColorStop(1, 'rgba(0,5,15,0.3)');
  ctx.fillStyle = vign; ctx.fillRect(0, 0, W, H);
}

// ── CLOUD STUDIO (The Studio) ──
let clouds = [];
function initClouds() {
  clouds = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 15; i++) {
    clouds.push({
      x: Math.random() * W * 1.5 - W * 0.25,
      y: H * 0.5 + Math.random() * H * 0.5,
      w: 100 + Math.random() * 200, h: 30 + Math.random() * 50,
      speed: 0.1 + Math.random() * 0.2,
      alpha: 0.03 + Math.random() * 0.05
    });
  }
}
function drawCloudStudio(ctx, W, H) {
  // Golden hour sky
  const skyGrad = ctx.createLinearGradient(0, 0, 0, H);
  skyGrad.addColorStop(0, 'rgba(15,12,25,0.5)');
  skyGrad.addColorStop(0.3, 'rgba(40,20,10,0.3)');
  skyGrad.addColorStop(0.5, 'rgba(60,30,10,0.2)');
  skyGrad.addColorStop(0.7, 'rgba(80,40,15,0.15)');
  skyGrad.addColorStop(1, 'rgba(20,10,5,0.4)');
  ctx.fillStyle = skyGrad; ctx.fillRect(0, 0, W, H);
  // Sun glow
  const sunX = W * 0.7, sunY = H * 0.35;
  const sunGlow = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, W * 0.3);
  sunGlow.addColorStop(0, 'rgba(255,180,80,0.08)');
  sunGlow.addColorStop(0.3, 'rgba(255,140,40,0.04)');
  sunGlow.addColorStop(1, 'transparent');
  ctx.fillStyle = sunGlow; ctx.fillRect(0, 0, W, H);
  // Clouds drifting
  clouds.forEach(c => {
    c.x += c.speed;
    if (c.x > W + c.w) { c.x = -c.w; c.y = H * 0.5 + Math.random() * H * 0.5; }
    const cGrad = ctx.createRadialGradient(c.x, c.y, 0, c.x, c.y, c.w * 0.6);
    cGrad.addColorStop(0, `rgba(255,220,180,${c.alpha})`);
    cGrad.addColorStop(0.5, `rgba(200,160,120,${c.alpha * 0.6})`);
    cGrad.addColorStop(1, 'transparent');
    ctx.beginPath(); ctx.ellipse(c.x, c.y, c.w, c.h, 0, 0, Math.PI * 2);
    ctx.fillStyle = cGrad; ctx.fill();
  });
  // Warm ambient particles (dust motes in golden light)
  for (let i = 0; i < 20; i++) {
    const px = (Math.sin(envTime * 0.01 + i * 1.7) * 0.5 + 0.5) * W;
    const py = (Math.cos(envTime * 0.008 + i * 2.3) * 0.5 + 0.5) * H;
    const pa = Math.sin(envTime * 0.02 + i) * 0.03 + 0.04;
    ctx.beginPath(); ctx.arc(px, py, 1 + Math.sin(envTime * 0.01 + i) * 0.5, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,200,120,${pa})`; ctx.fill();
  }
}

// ── OBSERVATORY (Stats Explorer) ──
let constellationLines = [];
let starChartAngle = 0;
function initObservatory() {
  constellationLines = [];
  const W = envCanvas.width, H = envCanvas.height;
  // Create constellation patterns
  for (let c = 0; c < 6; c++) {
    const cx = Math.random() * W, cy = Math.random() * H * 0.6;
    const points = [];
    const n = 3 + Math.floor(Math.random() * 5);
    for (let i = 0; i < n; i++) {
      points.push({ x: cx + (Math.random() - 0.5) * 150, y: cy + (Math.random() - 0.5) * 120 });
    }
    constellationLines.push({ points: points, hue: [190, 200, 210, 170, 220, 180][c], alpha: 0.04 + Math.random() * 0.04 });
  }
}
function drawObservatory(ctx, W, H) {
  // Dark dome gradient
  const domeGrad = ctx.createRadialGradient(W/2, H*0.3, 0, W/2, H*0.3, W*0.7);
  domeGrad.addColorStop(0, 'rgba(5,10,25,0.3)');
  domeGrad.addColorStop(0.6, 'rgba(2,5,15,0.5)');
  domeGrad.addColorStop(1, 'rgba(0,2,8,0.6)');
  ctx.fillStyle = domeGrad; ctx.fillRect(0, 0, W, H);
  // Rotating star chart rings
  starChartAngle += 0.001;
  ctx.save(); ctx.translate(W/2, H * 0.4);
  for (let r = 0; r < 4; r++) {
    ctx.rotate(starChartAngle * (r % 2 === 0 ? 1 : -1));
    const radius = 80 + r * 60;
    ctx.beginPath(); ctx.arc(0, 0, radius, 0, Math.PI * 2);
    ctx.strokeStyle = `rgba(80,180,220,${0.03 - r * 0.005})`; ctx.lineWidth = 0.5; ctx.stroke();
    // Tick marks
    for (let t = 0; t < 12; t++) {
      const angle = (t / 12) * Math.PI * 2;
      ctx.beginPath();
      ctx.moveTo(Math.cos(angle) * (radius - 4), Math.sin(angle) * (radius - 4));
      ctx.lineTo(Math.cos(angle) * (radius + 4), Math.sin(angle) * (radius + 4));
      ctx.strokeStyle = `rgba(80,180,220,0.06)`; ctx.stroke();
    }
  }
  ctx.restore();
  // Constellation lines
  constellationLines.forEach(c => {
    const shimmer = Math.sin(envTime * 0.015) * 0.3 + 0.7;
    c.points.forEach((p, i) => {
      if (i > 0) {
        ctx.beginPath(); ctx.moveTo(c.points[i-1].x, c.points[i-1].y);
        ctx.lineTo(p.x, p.y);
        ctx.strokeStyle = `hsla(${c.hue},60%,60%,${c.alpha * shimmer})`; ctx.lineWidth = 0.5; ctx.stroke();
      }
      // Star node
      ctx.beginPath(); ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
      ctx.fillStyle = `hsla(${c.hue},70%,75%,${c.alpha * 2 * shimmer})`; ctx.fill();
    });
  });
  // Data aurora (cyan/blue pulses at top)
  for (let x = 0; x < W; x += 4) {
    const wave = Math.sin(x * 0.005 + envTime * 0.02) * 20 + Math.sin(x * 0.01 + envTime * 0.01) * 10;
    const baseY = H * 0.08 + wave;
    const alpha = (Math.sin(x * 0.008 + envTime * 0.015) * 0.5 + 0.5) * 0.04;
    ctx.fillStyle = `rgba(50,180,220,${alpha})`;
    ctx.fillRect(x, baseY, 5, 30);
  }
}

// ── BANK VAULT (Royalty Command) ──
let goldDust = [];
function initVault() {
  goldDust = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 50; i++) {
    goldDust.push({
      x: Math.random() * W, y: Math.random() * H,
      size: 0.5 + Math.random() * 1.5,
      speed: 0.2 + Math.random() * 0.5,
      drift: Math.random() * Math.PI * 2,
      driftSpeed: 0.005 + Math.random() * 0.01,
      alpha: 0.05 + Math.random() * 0.15
    });
  }
}
function drawBankVault(ctx, W, H) {
  // Deep underground gradient
  const vaultGrad = ctx.createLinearGradient(0, 0, 0, H);
  vaultGrad.addColorStop(0, 'rgba(15,12,5,0.6)');
  vaultGrad.addColorStop(0.5, 'rgba(20,15,5,0.4)');
  vaultGrad.addColorStop(1, 'rgba(10,8,2,0.7)');
  ctx.fillStyle = vaultGrad; ctx.fillRect(0, 0, W, H);
  // Steel wall glow seams
  ctx.strokeStyle = 'rgba(180,160,80,0.03)'; ctx.lineWidth = 1;
  for (let y = 0; y < H; y += H / 8) {
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
  }
  for (let x = 0; x < W; x += W / 6) {
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
  }
  // Seam glow points at intersections
  for (let y = 0; y < H; y += H / 8) {
    for (let x = 0; x < W; x += W / 6) {
      const pulse = Math.sin(envTime * 0.02 + x * 0.01 + y * 0.01) * 0.5 + 0.5;
      ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(200,180,80,${0.03 * pulse})`; ctx.fill();
    }
  }
  // Floating gold dust
  goldDust.forEach(g => {
    g.drift += g.driftSpeed;
    g.x += Math.sin(g.drift) * 0.3;
    g.y -= g.speed;
    if (g.y < -5) { g.y = H + 5; g.x = Math.random() * W; }
    const shimmer = Math.sin(envTime * 0.04 + g.drift) * 0.5 + 0.5;
    ctx.beginPath(); ctx.arc(g.x, g.y, g.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,215,80,${g.alpha * shimmer})`; ctx.fill();
  });
  // Gold ambient light from below
  const goldGlow = ctx.createRadialGradient(W/2, H, 0, W/2, H, H * 0.6);
  goldGlow.addColorStop(0, 'rgba(200,160,40,0.04)');
  goldGlow.addColorStop(1, 'transparent');
  ctx.fillStyle = goldGlow; ctx.fillRect(0, 0, W, H);
}

// ── NEON GALLERY (Identity Lab) ──
let neonLights = [];
let spotlights = [];
function initNeonGallery() {
  neonLights = [];
  spotlights = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 8; i++) {
    neonLights.push({
      x: Math.random() * W, y: H * 0.2 + Math.random() * H * 0.5,
      w: 2 + Math.random() * 40, h: 2,
      hue: [320, 280, 200, 160, 50, 340, 240, 190][i],
      pulse: Math.random() * Math.PI * 2, vertical: Math.random() > 0.5
    });
  }
  for (let i = 0; i < 4; i++) {
    spotlights.push({
      x: W * 0.15 + i * W * 0.23,
      hue: [300, 200, 50, 280][i],
      angle: Math.random() * Math.PI * 2,
      speed: 0.003 + Math.random() * 0.005
    });
  }
}
function drawNeonGallery(ctx, W, H) {
  // Dark gallery walls
  ctx.fillStyle = 'rgba(5,3,8,0.5)'; ctx.fillRect(0, 0, W, H);
  // Shifting spotlights
  spotlights.forEach(s => {
    s.angle += s.speed;
    s.hue = (s.hue + 0.1) % 360;
    const spotGrad = ctx.createRadialGradient(s.x, 0, 0, s.x, 0, H * 0.8);
    const alpha = 0.02 + Math.sin(s.angle) * 0.01;
    spotGrad.addColorStop(0, `hsla(${s.hue},70%,60%,${alpha})`);
    spotGrad.addColorStop(0.4, `hsla(${s.hue},50%,40%,${alpha * 0.5})`);
    spotGrad.addColorStop(1, 'transparent');
    ctx.fillStyle = spotGrad;
    ctx.beginPath(); ctx.moveTo(s.x, 0);
    ctx.lineTo(s.x - W * 0.15, H); ctx.lineTo(s.x + W * 0.15, H);
    ctx.closePath(); ctx.fill();
  });
  // Floating neon accent lines
  neonLights.forEach(n => {
    n.pulse += 0.03;
    const alpha = 0.1 + Math.sin(n.pulse) * 0.08;
    const glow = 4 + Math.sin(n.pulse) * 2;
    ctx.shadowColor = `hsla(${n.hue},100%,60%,0.3)`;
    ctx.shadowBlur = glow;
    ctx.fillStyle = `hsla(${n.hue},90%,65%,${alpha})`;
    if (n.vertical) {
      ctx.fillRect(n.x, n.y, n.h, n.w);
    } else {
      ctx.fillRect(n.x, n.y, n.w, n.h);
    }
    ctx.shadowBlur = 0;
  });
}
// ── SPACE STATION MARKETPLACE (Plans & Pricing) ──
let stationPanels = [];
let earthViewAngle = 0;
function initMarketplace() {
  stationPanels = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 5; i++) {
    stationPanels.push({
      x: W * 0.1 + i * W * 0.2, y: H * 0.15 + Math.random() * 20,
      w: W * 0.12, h: H * 0.35,
      glow: Math.random() * Math.PI * 2
    });
  }
}
function drawMarketplace(ctx, W, H) {
  // Clean station interior gradient
  const stGrad = ctx.createLinearGradient(0, 0, 0, H);
  stGrad.addColorStop(0, 'rgba(8,12,20,0.5)');
  stGrad.addColorStop(0.5, 'rgba(12,16,28,0.3)');
  stGrad.addColorStop(1, 'rgba(6,8,15,0.5)');
  ctx.fillStyle = stGrad; ctx.fillRect(0, 0, W, H);
  // Earth visible through viewport (bottom right)
  earthViewAngle += 0.002;
  const eX = W * 0.82, eY = H * 0.7, eR = W * 0.12;
  // Viewport frame
  ctx.beginPath(); ctx.arc(eX, eY, eR + 8, 0, Math.PI * 2);
  ctx.strokeStyle = 'rgba(100,120,160,0.08)'; ctx.lineWidth = 3; ctx.stroke();
  // Earth
  const earthGrad = ctx.createRadialGradient(eX - eR * 0.2, eY - eR * 0.2, 0, eX, eY, eR);
  earthGrad.addColorStop(0, 'rgba(60,130,200,0.12)');
  earthGrad.addColorStop(0.5, 'rgba(30,100,160,0.08)');
  earthGrad.addColorStop(0.8, 'rgba(20,60,100,0.06)');
  earthGrad.addColorStop(1, 'rgba(5,15,30,0.1)');
  ctx.beginPath(); ctx.arc(eX, eY, eR, 0, Math.PI * 2);
  ctx.fillStyle = earthGrad; ctx.fill();
  // Continent hints
  for (let c = 0; c < 4; c++) {
    const ca = earthViewAngle + c * 1.5;
    const cx = eX + Math.cos(ca) * eR * 0.5;
    const cy = eY + Math.sin(ca * 0.7) * eR * 0.4;
    ctx.beginPath(); ctx.arc(cx, cy, eR * 0.15, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(40,120,60,0.06)'; ctx.fill();
  }
  // Atmosphere rim
  ctx.beginPath(); ctx.arc(eX, eY, eR + 2, 0, Math.PI * 2);
  ctx.strokeStyle = 'rgba(100,180,255,0.04)'; ctx.lineWidth = 4; ctx.stroke();
  // Viewport window panels (premium lounge aesthetic)
  stationPanels.forEach(p => {
    p.glow += 0.015;
    const brightness = Math.sin(p.glow) * 0.01 + 0.02;
    ctx.strokeStyle = `rgba(140,160,200,${brightness})`;
    ctx.lineWidth = 1;
    ctx.strokeRect(p.x, p.y, p.w, p.h);
    // Subtle panel light
    const pGrad = ctx.createLinearGradient(p.x, p.y, p.x, p.y + p.h);
    pGrad.addColorStop(0, `rgba(120,140,180,${brightness * 0.5})`);
    pGrad.addColorStop(1, 'transparent');
    ctx.fillStyle = pGrad; ctx.fillRect(p.x, p.y, p.w, p.h);
  });
  // Clean ambient particles (bright, sparse)
  for (let i = 0; i < 10; i++) {
    const px = (Math.sin(envTime * 0.006 + i * 2.1) * 0.5 + 0.5) * W;
    const py = (Math.cos(envTime * 0.005 + i * 1.8) * 0.5 + 0.5) * H;
    ctx.beginPath(); ctx.arc(px, py, 0.8, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(180,200,255,${0.04 + Math.sin(envTime * 0.02 + i) * 0.02})`;
    ctx.fill();
  }
}

// ── BROADCAST TOWER (Content Studio) ──
let antennas = [];
let rainCS = [];
function initBroadcast() {
  antennas = [];
  rainCS = [];
  const W = envCanvas.width, H = envCanvas.height;
  // Antenna arrays on rooftop
  for (let i = 0; i < 6; i++) {
    antennas.push({
      x: W * 0.1 + i * W * 0.16,
      baseY: H * 0.55 + Math.random() * 20,
      height: 60 + Math.random() * 80,
      blinkPhase: Math.random() * Math.PI * 2,
      type: ['dish', 'tower', 'mast'][Math.floor(Math.random() * 3)]
    });
  }
  for (let i = 0; i < 60; i++) {
    rainCS.push({
      x: Math.random() * W, y: Math.random() * H,
      speed: 3 + Math.random() * 5, len: 8 + Math.random() * 12
    });
  }
}
function drawBroadcast(ctx, W, H) {
  // Dark sky with city glow below
  const skyGrad = ctx.createLinearGradient(0, 0, 0, H);
  skyGrad.addColorStop(0, 'rgba(5,5,15,0.6)');
  skyGrad.addColorStop(0.5, 'rgba(10,8,20,0.4)');
  skyGrad.addColorStop(0.7, 'rgba(15,10,10,0.3)');
  skyGrad.addColorStop(1, 'rgba(20,12,8,0.5)');
  ctx.fillStyle = skyGrad; ctx.fillRect(0, 0, W, H);
  // City glow below rooftop
  const cityGlow = ctx.createRadialGradient(W/2, H, 0, W/2, H, H * 0.5);
  cityGlow.addColorStop(0, 'rgba(200,120,50,0.04)');
  cityGlow.addColorStop(0.5, 'rgba(150,80,30,0.02)');
  cityGlow.addColorStop(1, 'transparent');
  ctx.fillStyle = cityGlow; ctx.fillRect(0, 0, W, H);
  // ON AIR glow (pulsing red)
  const onAirPulse = Math.sin(envTime * 0.04) * 0.5 + 0.5;
  const onAirGrad = ctx.createRadialGradient(W * 0.15, H * 0.3, 0, W * 0.15, H * 0.3, 80);
  onAirGrad.addColorStop(0, `rgba(255,30,30,${0.04 * onAirPulse})`);
  onAirGrad.addColorStop(1, 'transparent');
  ctx.fillStyle = onAirGrad; ctx.fillRect(0, 0, W, H);
  // Antenna silhouettes
  antennas.forEach(a => {
    a.blinkPhase += 0.03;
    ctx.strokeStyle = 'rgba(60,70,90,0.08)'; ctx.lineWidth = 2;
    if (a.type === 'tower') {
      ctx.beginPath(); ctx.moveTo(a.x, a.baseY); ctx.lineTo(a.x, a.baseY - a.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(a.x - 8, a.baseY - a.height * 0.3); ctx.lineTo(a.x + 8, a.baseY - a.height * 0.3); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(a.x - 5, a.baseY - a.height * 0.6); ctx.lineTo(a.x + 5, a.baseY - a.height * 0.6); ctx.stroke();
    } else if (a.type === 'dish') {
      ctx.beginPath(); ctx.moveTo(a.x, a.baseY); ctx.lineTo(a.x, a.baseY - a.height * 0.6); ctx.stroke();
      ctx.beginPath(); ctx.arc(a.x, a.baseY - a.height * 0.6, 15, Math.PI * 0.8, Math.PI * 0.2, true);
      ctx.stroke();
    } else {
      ctx.beginPath(); ctx.moveTo(a.x, a.baseY); ctx.lineTo(a.x, a.baseY - a.height); ctx.stroke();
    }
    // Blinking tip light
    const blink = Math.sin(a.blinkPhase) > 0.7 ? 0.15 : 0.03;
    ctx.beginPath(); ctx.arc(a.x, a.baseY - a.height, 2, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,50,50,${blink})`; ctx.fill();
  });
  // Rain on rooftop
  rainCS.forEach(r => {
    r.y += r.speed;
    if (r.y > H) { r.y = -r.len; r.x = Math.random() * W; }
    ctx.beginPath(); ctx.moveTo(r.x, r.y); ctx.lineTo(r.x - 0.5, r.y + r.len);
    ctx.strokeStyle = 'rgba(150,170,200,0.04)'; ctx.lineWidth = 0.5; ctx.stroke();
  });
  // Wet surface reflections at bottom
  for (let x = 0; x < W; x += 3) {
    const ref = Math.sin(x * 0.03 + envTime * 0.01) * 0.01 + 0.015;
    ctx.fillStyle = `rgba(200,150,100,${ref})`;
    ctx.fillRect(x, H * 0.85 + Math.sin(x * 0.02) * 3, 2, 1);
  }
}

// ── LAUNCH FACILITY (Launch Pad) ──
let steamParticles = [];
let countdownFlicker = 0;
function initLaunchFacility() {
  steamParticles = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 40; i++) {
    steamParticles.push({
      x: W * 0.3 + Math.random() * W * 0.4,
      y: H * 0.7 + Math.random() * H * 0.3,
      size: 3 + Math.random() * 8,
      speed: 0.3 + Math.random() * 0.8,
      drift: Math.random() * Math.PI * 2,
      alpha: 0.02 + Math.random() * 0.04
    });
  }
}
function drawLaunchFacility(ctx, W, H) {
  // Dark facility gradient
  const facGrad = ctx.createLinearGradient(0, 0, 0, H);
  facGrad.addColorStop(0, 'rgba(8,6,12,0.5)');
  facGrad.addColorStop(0.6, 'rgba(12,8,6,0.3)');
  facGrad.addColorStop(1, 'rgba(25,15,5,0.5)');
  ctx.fillStyle = facGrad; ctx.fillRect(0, 0, W, H);
  // Gantry structure silhouette (right side)
  ctx.strokeStyle = 'rgba(80,90,100,0.06)'; ctx.lineWidth = 3;
  const gx = W * 0.75;
  ctx.beginPath(); ctx.moveTo(gx, H); ctx.lineTo(gx, H * 0.1); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(gx + 30, H); ctx.lineTo(gx + 30, H * 0.1); ctx.stroke();
  // Cross beams
  for (let y = H * 0.15; y < H; y += H * 0.12) {
    ctx.beginPath(); ctx.moveTo(gx, y); ctx.lineTo(gx + 30, y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(gx, y); ctx.lineTo(gx + 30, y + H * 0.06); ctx.strokeStyle = 'rgba(80,90,100,0.03)'; ctx.stroke();
    ctx.strokeStyle = 'rgba(80,90,100,0.06)';
  }
  // Flame glow from below
  countdownFlicker = Math.sin(envTime * 0.08) * 0.3 + 0.7;
  const flameGlow = ctx.createRadialGradient(W * 0.5, H, 0, W * 0.5, H, H * 0.4);
  flameGlow.addColorStop(0, `rgba(255,120,20,${0.04 * countdownFlicker})`);
  flameGlow.addColorStop(0.3, `rgba(255,80,10,${0.02 * countdownFlicker})`);
  flameGlow.addColorStop(1, 'transparent');
  ctx.fillStyle = flameGlow; ctx.fillRect(0, 0, W, H);
  // Steam/vapor rising
  steamParticles.forEach(s => {
    s.y -= s.speed;
    s.drift += 0.01;
    s.x += Math.sin(s.drift) * 0.5;
    s.size += 0.02;
    if (s.y < H * 0.2 || s.size > 20) {
      s.y = H * 0.7 + Math.random() * H * 0.3;
      s.x = W * 0.3 + Math.random() * W * 0.4;
      s.size = 3 + Math.random() * 8;
    }
    ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(200,200,210,${s.alpha * (1 - (H * 0.7 - s.y) / (H * 0.5))})`;
    ctx.fill();
  });
  // Warning lights (blinking amber along bottom)
  const warnBlink = Math.sin(envTime * 0.06) > 0.3;
  if (warnBlink) {
    for (let i = 0; i < 6; i++) {
      ctx.beginPath(); ctx.arc(W * 0.15 + i * W * 0.14, H * 0.92, 3, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,180,40,0.06)'; ctx.fill();
    }
  }
}

// ── WAR ROOM (Roster View) ──
let screenGlows = [];
function initWarRoom() {
  screenGlows = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 8; i++) {
    screenGlows.push({
      x: W * 0.08 + i * W * 0.12,
      y: H * 0.2 + Math.random() * H * 0.15,
      w: W * 0.08, h: H * 0.2,
      hue: [200, 210, 190, 220, 200, 180, 210, 195][i],
      flicker: Math.random() * Math.PI * 2
    });
  }
}
function drawWarRoom(ctx, W, H) {
  // Dark wood / military aesthetic
  const wrGrad = ctx.createLinearGradient(0, 0, 0, H);
  wrGrad.addColorStop(0, 'rgba(8,6,4,0.6)');
  wrGrad.addColorStop(0.5, 'rgba(12,10,6,0.4)');
  wrGrad.addColorStop(1, 'rgba(6,4,2,0.6)');
  ctx.fillStyle = wrGrad; ctx.fillRect(0, 0, W, H);
  // Overhead soft spots
  for (let i = 0; i < 4; i++) {
    const sx = W * 0.2 + i * W * 0.2;
    const spotGrad = ctx.createRadialGradient(sx, 0, 0, sx, 0, H * 0.6);
    spotGrad.addColorStop(0, 'rgba(200,180,140,0.03)');
    spotGrad.addColorStop(0.5, 'rgba(180,160,120,0.015)');
    spotGrad.addColorStop(1, 'transparent');
    ctx.fillStyle = spotGrad; ctx.fillRect(0, 0, W, H);
  }
  // Glass screen panels on walls (profiles displayed)
  screenGlows.forEach(s => {
    s.flicker += 0.02;
    const alpha = 0.02 + Math.sin(s.flicker) * 0.008;
    // Screen glow
    const sGrad = ctx.createRadialGradient(s.x + s.w/2, s.y + s.h/2, 0, s.x + s.w/2, s.y + s.h/2, s.w);
    sGrad.addColorStop(0, `hsla(${s.hue},40%,50%,${alpha})`);
    sGrad.addColorStop(1, 'transparent');
    ctx.fillStyle = sGrad; ctx.fillRect(s.x - 10, s.y - 10, s.w + 20, s.h + 20);
    // Screen border
    ctx.strokeStyle = `hsla(${s.hue},30%,40%,${alpha * 1.5})`;
    ctx.lineWidth = 0.5; ctx.strokeRect(s.x, s.y, s.w, s.h);
    // Scan line effect
    const scanY = s.y + ((envTime * 0.5) % s.h);
    ctx.fillStyle = `hsla(${s.hue},50%,60%,${alpha * 0.5})`;
    ctx.fillRect(s.x, scanY, s.w, 1);
  });
  // Table surface hint (dark oval at bottom)
  ctx.beginPath(); ctx.ellipse(W/2, H * 0.85, W * 0.35, H * 0.06, 0, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(30,25,18,0.15)'; ctx.fill();
  ctx.strokeStyle = 'rgba(80,70,50,0.04)'; ctx.lineWidth = 1; ctx.stroke();
}

// ── ANCIENT LIBRARY + HOLODECK (Curriculum) ──
let holoPages = [];
let candleFlickers = [];
function initLibrary() {
  holoPages = [];
  candleFlickers = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 12; i++) {
    holoPages.push({
      x: Math.random() * W, y: Math.random() * H * 0.7,
      size: 8 + Math.random() * 15, drift: Math.random() * Math.PI * 2,
      speed: 0.003 + Math.random() * 0.006,
      riseSpeed: 0.1 + Math.random() * 0.2,
      alpha: 0.03 + Math.random() * 0.04,
      isHolo: Math.random() > 0.5
    });
  }
  for (let i = 0; i < 6; i++) {
    candleFlickers.push({
      x: W * 0.1 + i * W * 0.17,
      y: H * 0.6 + Math.random() * 20,
      phase: Math.random() * Math.PI * 2
    });
  }
}
function drawLibrary(ctx, W, H) {
  // Dark library gradient — warm at bottom, digital at top
  const libGrad = ctx.createLinearGradient(0, 0, 0, H);
  libGrad.addColorStop(0, 'rgba(5,8,20,0.5)');
  libGrad.addColorStop(0.4, 'rgba(8,6,15,0.4)');
  libGrad.addColorStop(0.7, 'rgba(15,10,5,0.3)');
  libGrad.addColorStop(1, 'rgba(20,15,8,0.5)');
  ctx.fillStyle = libGrad; ctx.fillRect(0, 0, W, H);
  // Bookshelf lines (fading upward into digital space)
  for (let y = H * 0.3; y < H * 0.9; y += H * 0.1) {
    const fade = 1 - (y - H * 0.3) / (H * 0.6);
    ctx.strokeStyle = `rgba(60,45,30,${0.04 * fade + 0.02})`;
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(W * 0.05, y); ctx.lineTo(W * 0.35, y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(W * 0.65, y); ctx.lineTo(W * 0.95, y); ctx.stroke();
    // Vertical shelf dividers
    for (let x = W * 0.05; x < W * 0.35; x += W * 0.06) {
      ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x, y + H * 0.09); ctx.stroke();
    }
  }
  // Data stream lines (digital space at top)
  for (let i = 0; i < 8; i++) {
    const sx = (Math.sin(envTime * 0.005 + i * 0.8) * 0.5 + 0.5) * W;
    const sy = Math.random() * H * 0.3;
    ctx.beginPath(); ctx.moveTo(sx, 0); ctx.lineTo(sx + 20, sy);
    ctx.strokeStyle = `rgba(50,120,200,${0.02 + Math.sin(envTime * 0.02 + i) * 0.01})`;
    ctx.lineWidth = 0.5; ctx.stroke();
  }
  // Candlelight warm glows
  candleFlickers.forEach(c => {
    c.phase += 0.05 + Math.random() * 0.02;
    const flick = Math.sin(c.phase) * 0.3 + 0.7;
    const cGrad = ctx.createRadialGradient(c.x, c.y, 0, c.x, c.y, 40);
    cGrad.addColorStop(0, `rgba(255,180,80,${0.04 * flick})`);
    cGrad.addColorStop(0.5, `rgba(255,140,40,${0.02 * flick})`);
    cGrad.addColorStop(1, 'transparent');
    ctx.fillStyle = cGrad; ctx.fillRect(c.x - 40, c.y - 40, 80, 80);
    // Flame tip
    ctx.beginPath(); ctx.arc(c.x, c.y - 3, 1.5, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,200,100,${0.08 * flick})`; ctx.fill();
  });
  // Floating holographic pages
  holoPages.forEach(p => {
    p.drift += p.speed;
    p.x += Math.sin(p.drift) * 0.3;
    p.y -= p.riseSpeed;
    if (p.y < -p.size * 2) { p.y = H * 0.7; p.x = Math.random() * W; }
    if (p.isHolo) {
      ctx.fillStyle = `rgba(80,160,255,${p.alpha * 0.7})`;
      ctx.fillRect(p.x, p.y, p.size * 0.7, p.size);
      // Holographic scan lines on page
      for (let l = 0; l < 3; l++) {
        ctx.fillStyle = `rgba(100,180,255,${p.alpha * 0.3})`;
        ctx.fillRect(p.x + 1, p.y + 2 + l * (p.size * 0.3), p.size * 0.5, 0.5);
      }
    } else {
      ctx.fillStyle = `rgba(200,180,140,${p.alpha})`;
      ctx.fillRect(p.x, p.y, p.size * 0.7, p.size);
    }
  });
}

// ── ENGINE ROOM (Settings) ──
let gauges = [];
let pipes = [];
function initEngineRoom() {
  gauges = [];
  pipes = [];
  const W = envCanvas.width, H = envCanvas.height;
  for (let i = 0; i < 6; i++) {
    gauges.push({
      x: W * 0.12 + i * W * 0.16,
      y: H * 0.3 + Math.random() * H * 0.15,
      r: 12 + Math.random() * 8,
      needle: Math.random() * Math.PI * 0.8 + Math.PI * 0.6,
      needleSpeed: 0.002 + Math.random() * 0.005,
      needleRange: 0.1 + Math.random() * 0.3
    });
  }
  for (let i = 0; i < 10; i++) {
    pipes.push({
      x1: Math.random() * W, y1: Math.random() * H,
      x2: Math.random() * W, y2: Math.random() * H,
      alpha: 0.02 + Math.random() * 0.03
    });
  }
}
function drawEngineRoom(ctx, W, H) {
  // Industrial dark gradient
  const engGrad = ctx.createLinearGradient(0, 0, 0, H);
  engGrad.addColorStop(0, 'rgba(10,8,5,0.6)');
  engGrad.addColorStop(0.5, 'rgba(15,12,8,0.4)');
  engGrad.addColorStop(1, 'rgba(8,6,3,0.6)');
  ctx.fillStyle = engGrad; ctx.fillRect(0, 0, W, H);
  // Industrial amber lighting from above
  const amberGlow = ctx.createRadialGradient(W/2, 0, 0, W/2, 0, H * 0.7);
  amberGlow.addColorStop(0, 'rgba(200,150,50,0.03)');
  amberGlow.addColorStop(1, 'transparent');
  ctx.fillStyle = amberGlow; ctx.fillRect(0, 0, W, H);
  // Pipe network
  pipes.forEach(p => {
    ctx.beginPath(); ctx.moveTo(p.x1, p.y1);
    // Pipes run in right angles
    ctx.lineTo(p.x1, p.y2); ctx.lineTo(p.x2, p.y2);
    ctx.strokeStyle = `rgba(100,80,50,${p.alpha})`; ctx.lineWidth = 2; ctx.stroke();
    // Joint circles
    ctx.beginPath(); ctx.arc(p.x1, p.y2, 3, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(120,100,60,${p.alpha * 1.5})`; ctx.fill();
  });
  // Gauges
  gauges.forEach(g => {
    g.needle += Math.sin(envTime * g.needleSpeed) * 0.003;
    // Gauge face
    ctx.beginPath(); ctx.arc(g.x, g.y, g.r, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(140,120,80,0.05)'; ctx.lineWidth = 1.5; ctx.stroke();
    ctx.fillStyle = 'rgba(20,15,10,0.08)'; ctx.fill();
    // Tick marks
    for (let t = 0; t < 8; t++) {
      const ta = (t / 8) * Math.PI * 1.5 + Math.PI * 0.75;
      ctx.beginPath();
      ctx.moveTo(g.x + Math.cos(ta) * (g.r - 3), g.y + Math.sin(ta) * (g.r - 3));
      ctx.lineTo(g.x + Math.cos(ta) * g.r, g.y + Math.sin(ta) * g.r);
      ctx.strokeStyle = 'rgba(180,150,80,0.06)'; ctx.lineWidth = 0.5; ctx.stroke();
    }
    // Needle
    const nx = g.x + Math.cos(g.needle) * (g.r - 4);
    const ny = g.y + Math.sin(g.needle) * (g.r - 4);
    ctx.beginPath(); ctx.moveTo(g.x, g.y); ctx.lineTo(nx, ny);
    ctx.strokeStyle = 'rgba(255,100,30,0.08)'; ctx.lineWidth = 1; ctx.stroke();
    // Center dot
    ctx.beginPath(); ctx.arc(g.x, g.y, 2, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(200,150,60,0.1)'; ctx.fill();
  });
  // Steam wisps
  for (let i = 0; i < 5; i++) {
    const sx = (Math.sin(envTime * 0.004 + i * 1.5) * 0.3 + 0.5) * W;
    const sy = H * 0.5 + Math.cos(envTime * 0.003 + i * 2) * H * 0.2;
    const sGrad = ctx.createRadialGradient(sx, sy, 0, sx, sy, 25);
    sGrad.addColorStop(0, `rgba(180,160,130,${0.015 + Math.sin(envTime * 0.01 + i) * 0.01})`);
    sGrad.addColorStop(1, 'transparent');
    ctx.fillStyle = sGrad; ctx.fillRect(sx - 25, sy - 25, 50, 50);
  }
}

function setEnvironment(roomId) {
  if (!envCanvas || !envCtx) return;
  envResize();
  envTime = 0;
  if (envFrame) cancelAnimationFrame(envFrame);
  
  if (roomId === 'lobby') {
    envActive = 'lobby';
    initMeteors();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'dashboard') {
    envActive = 'dashboard';
    initAurora();
    initCity();
    initMeteors();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'vault') {
    envActive = 'vault';
    initDeepSea();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'studio') {
    envActive = 'studio';
    initClouds();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'stats') {
    envActive = 'stats';
    initObservatory();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'royalty') {
    envActive = 'royalty';
    initVault();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'identity') {
    envActive = 'identity';
    initNeonGallery();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'pricing') {
    envActive = 'pricing';
    initMarketplace();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'content') {
    envActive = 'content';
    initBroadcast();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'launch') {
    envActive = 'launch';
    initLaunchFacility();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'roster') {
    envActive = 'roster';
    initWarRoom();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'curriculum') {
    envActive = 'curriculum';
    initLibrary();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'settings') {
    envActive = 'settings';
    initEngineRoom();
    envCanvas.style.opacity = '1';
  } else if (roomId === 'frequency') {
    envActive = 'frequency';
    initGrowRoom();
    envCanvas.style.opacity = '1';
  } else {
    // Other rooms — fade out env for now, will add per-room later
    envActive = null;
    envCanvas.style.opacity = '0';
  }
  if (envActive) envLoop();
}

function envLoop() {
  if (!envActive) return;
  const W = envCanvas.width, H = envCanvas.height;
  envCtx.clearRect(0, 0, W, H);
  envTime++;
  
  if (envActive === 'lobby') {
    drawMeteors(envCtx);
  } else if (envActive === 'dashboard') {
    // Dark gradient sky
    const skyGrad = envCtx.createLinearGradient(0, 0, 0, H * 0.72);
    skyGrad.addColorStop(0, 'rgba(2,4,12,0.6)');
    skyGrad.addColorStop(0.4, 'rgba(5,10,25,0.4)');
    skyGrad.addColorStop(1, 'rgba(8,15,35,0.3)');
    envCtx.fillStyle = skyGrad;
    envCtx.fillRect(0, 0, W, H * 0.72);
    drawAurora(envCtx, W, H);
    drawCity(envCtx, W, H);
    drawMeteors(envCtx); // occasional meteors in penthouse sky too
  } else if (envActive === 'vault') {
    drawDeepSea(envCtx, W, H);
  } else if (envActive === 'studio') {
    drawCloudStudio(envCtx, W, H);
  } else if (envActive === 'stats') {
    drawObservatory(envCtx, W, H);
  } else if (envActive === 'royalty') {
    drawBankVault(envCtx, W, H);
  } else if (envActive === 'identity') {
    drawNeonGallery(envCtx, W, H);
  } else if (envActive === 'pricing') {
    drawMarketplace(envCtx, W, H);
  } else if (envActive === 'content') {
    drawBroadcast(envCtx, W, H);
  } else if (envActive === 'launch') {
    drawLaunchFacility(envCtx, W, H);
  } else if (envActive === 'roster') {
    drawWarRoom(envCtx, W, H);
  } else if (envActive === 'curriculum') {
    drawLibrary(envCtx, W, H);
  } else if (envActive === 'settings') {
    drawEngineRoom(envCtx, W, H);
  } else if (envActive === 'frequency') {
    drawGrowRoom(envCtx, W, H);
  }
  
  envFrame = requestAnimationFrame(envLoop);
}

// ── HOOK INTO ROOM SWITCHING ──

// ── CANNABIS GROW ROOM (The Frequency — DJ Nikka T) ──
let growPlants = [];
let growLights = [];
let growHaze = [];
function initGrowRoom() {
  growPlants = []; growLights = []; growHaze = [];
  const W = envCanvas.width, H = envCanvas.height;
  // Grow lights hanging from ceiling — purple/pink LEDs
  for (let i = 0; i < 5; i++) {
    growLights.push({
      x: W * 0.1 + i * W * 0.2,
      y: H * 0.08,
      width: W * 0.14,
      phase: Math.random() * Math.PI * 2,
      intensity: 0.6 + Math.random() * 0.4
    });
  }
  // Cannabis plants — silhouettes
  for (let i = 0; i < 12; i++) {
    growPlants.push({
      x: W * 0.05 + (i / 12) * W * 0.9 + (Math.random() - 0.5) * 30,
      baseY: H * 0.65 + Math.random() * H * 0.15,
      height: 40 + Math.random() * 60,
      spread: 15 + Math.random() * 25,
      swayPhase: Math.random() * Math.PI * 2,
      leaves: 3 + Math.floor(Math.random() * 4)
    });
  }
  // Haze particles
  for (let i = 0; i < 80; i++) {
    growHaze.push({
      x: Math.random() * W, y: H * 0.3 + Math.random() * H * 0.5,
      vx: (Math.random() - 0.5) * 0.3, vy: -0.1 - Math.random() * 0.2,
      size: 3 + Math.random() * 8, alpha: 0.02 + Math.random() * 0.04
    });
  }
}
function drawGrowRoom(ctx, W, H) {
  // Dark room gradient
  const bg = ctx.createLinearGradient(0, 0, 0, H);
  bg.addColorStop(0, 'rgba(15,5,20,0.7)');
  bg.addColorStop(0.4, 'rgba(20,5,30,0.5)');
  bg.addColorStop(1, 'rgba(10,3,15,0.6)');
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, W, H);

  // Grow lights — cone of purple/pink light
  for (const lt of growLights) {
    const pulse = 0.7 + Math.sin(envTime * 0.015 + lt.phase) * 0.3;
    const grad = ctx.createRadialGradient(lt.x, lt.y, 5, lt.x, lt.y + H * 0.5, lt.width * 2);
    grad.addColorStop(0, `rgba(180,40,200,${0.12 * pulse * lt.intensity})`);
    grad.addColorStop(0.4, `rgba(200,50,160,${0.06 * pulse * lt.intensity})`);
    grad.addColorStop(1, 'rgba(150,30,180,0)');
    ctx.fillStyle = grad;
    ctx.fillRect(lt.x - lt.width * 2, lt.y, lt.width * 4, H);
    // Light fixture
    ctx.fillStyle = `rgba(200,180,220,${0.25 * pulse})`;
    ctx.fillRect(lt.x - lt.width * 0.4, lt.y - 3, lt.width * 0.8, 6);
    // LED dots
    for (let d = 0; d < 3; d++) {
      ctx.beginPath();
      ctx.arc(lt.x - lt.width * 0.25 + d * lt.width * 0.25, lt.y, 2, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(220,50,255,${0.5 * pulse})`;
      ctx.fill();
    }
  }

  // Plants — serrated leaf silhouettes
  for (const p of growPlants) {
    const sway = Math.sin(envTime * 0.008 + p.swayPhase) * 3;
    ctx.save();
    ctx.translate(p.x + sway, p.baseY);
    // Stem
    ctx.strokeStyle = 'rgba(40,100,30,0.3)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(sway * 0.3, -p.height);
    ctx.stroke();
    // Leaves — fan shape
    for (let l = 0; l < p.leaves; l++) {
      const ly = -p.height * 0.3 - l * (p.height * 0.15);
      const angle = (l % 2 === 0 ? -1 : 1) * (0.3 + l * 0.12);
      ctx.save();
      ctx.translate(sway * 0.2, ly);
      ctx.rotate(angle + Math.sin(envTime * 0.01 + l) * 0.05);
      // Leaf shape
      ctx.fillStyle = `rgba(30,${70 + l * 10},20,0.25)`;
      ctx.beginPath();
      ctx.ellipse(0, 0, p.spread * 0.6, 4, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }
    // Top cola — glowing bud
    const glow = 0.15 + Math.sin(envTime * 0.02 + p.swayPhase) * 0.05;
    ctx.beginPath();
    ctx.arc(sway * 0.3, -p.height - 5, 6 + Math.random() * 2, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(100,180,60,${glow})`;
    ctx.fill();
    ctx.restore();
  }

  // Haze particles — slow floating smoke
  for (const h of growHaze) {
    h.x += h.vx + Math.sin(envTime * 0.005 + h.y * 0.01) * 0.15;
    h.y += h.vy;
    if (h.y < H * 0.1) { h.y = H * 0.75 + Math.random() * H * 0.2; h.x = Math.random() * W; }
    if (h.x < -20) h.x = W + 20;
    if (h.x > W + 20) h.x = -20;
    ctx.beginPath();
    ctx.arc(h.x, h.y, h.size, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(180,140,200,${h.alpha})`;
    ctx.fill();
  }

  // Floor — dark reflective surface
  const floorY = H * 0.82;
  ctx.fillStyle = 'rgba(5,2,8,0.4)';
  ctx.fillRect(0, floorY, W, H - floorY);
  ctx.strokeStyle = 'rgba(120,40,160,0.06)';
  ctx.lineWidth = 1;
  for (let i = 0; i < 6; i++) {
    ctx.beginPath();
    ctx.moveTo(0, floorY + i * 8);
    ctx.lineTo(W, floorY + i * 8);
    ctx.stroke();
  }
}

// ── THE FREQUENCY — DJ SHOWCASE ENGINE ──
let _freqDJs = [];
let _freqCurrentDJ = null;
let _freqEnvAnim = null;

async function frequencyInit() {
  // Load DJs from Supabase
  try {
    const { data, error } = await _sb
      .from('dj_features')
      .select('*')
      .eq('is_active', true)
      .order('display_order', { ascending: true });
    if (error) throw error;
    _freqDJs = data || [];
    console.log('[Frequency] Loaded', _freqDJs.length, 'DJs');
  } catch (e) {
    console.error('[Frequency] Load error:', e);
    _freqDJs = [];
  }

  // Render
  if (_freqDJs.length > 0) {
    // Show first DJ (or resident)
    const resident = _freqDJs.find(d => d.is_resident) || _freqDJs[0];
    _freqShowDJ(resident);
    _freqRenderRotation();
    document.getElementById('freqLiveStatus').textContent = _freqDJs.length + ' DJ' + (_freqDJs.length > 1 ? 's' : '') + ' in rotation';
    roomMeta.frequency.status = (resident.dj_name || 'DJ') + ' — Live';
  } else {
    document.getElementById('freqLiveStatus').textContent = 'No DJs featured yet';
    document.getElementById('freqDJName').textContent = 'Coming Soon';
    document.getElementById('freqDJBio').textContent = 'The Frequency is warming up. Featured DJs will appear here.';
  }

  // Start environment canvas for the room-specific canvas
  _freqStartEnv();
}

function _freqShowDJ(dj) {
  _freqCurrentDJ = dj;
  document.getElementById('freqDJName').textContent = dj.dj_name;
  document.getElementById('freqDJBio').textContent = dj.dj_bio || 'No bio available.';
  document.getElementById('freqDJBadge').textContent = dj.is_resident ? 'RESIDENT' : 'FEATURED';
  document.getElementById('freqEnvLabel').textContent = (dj.environment_key || 'unknown').toUpperCase().replace(/_/g, ' ');

  // Links
  const linksEl = document.getElementById('freqDJLinks');
  linksEl.innerHTML = '';
  if (dj.dj_links && typeof dj.dj_links === 'object') {
    Object.entries(dj.dj_links).forEach(([k, v]) => {
      if (v) {
        const a = document.createElement('a');
        a.className = 'freq-link-pill';
        a.href = v.startsWith('http') ? v : 'https://' + v;
        a.target = '_blank';
        a.textContent = k.charAt(0).toUpperCase() + k.slice(1);
        linksEl.appendChild(a);
      }
    });
  }

  // Mix embed
  const embedEl = document.getElementById('freqMixEmbed');
  const titleEl = document.getElementById('freqMixTitle');
  if (dj.mix_embed_url) {
    // SoundCloud or Mixcloud iframe embed
    const isSC = dj.mix_embed_url.includes('soundcloud');
    const isMC = dj.mix_embed_url.includes('mixcloud');
    let embedHTML = '';
    if (isSC) {
      embedHTML = '<iframe width="100%" height="120" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=' + encodeURIComponent(dj.mix_embed_url) + '&color=%239c27b0&auto_play=false&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false" style="border-radius:8px"></iframe>';
    } else if (isMC) {
      embedHTML = '<iframe width="100%" height="120" src="https://www.mixcloud.com/widget/iframe/?hide_cover=1&feed=' + encodeURIComponent(dj.mix_embed_url) + '" frameborder="0" style="border-radius:8px"></iframe>';
    } else {
      embedHTML = '<audio controls style="width:100%" src="' + dj.mix_embed_url + '"></audio>';
    }
    embedEl.innerHTML = embedHTML;
    titleEl.textContent = dj.mix_title || 'Now Playing';
  } else {
    embedEl.innerHTML = '<div style="text-align:center"><div style="font-size:1.5rem;margin-bottom:0.3rem;opacity:0.4">🎵</div><div style="color:rgba(232,234,246,0.25);font-size:0.6rem;font-family:\'Orbitron\',sans-serif">Mix coming soon — check back for ' + dj.dj_name + '\'s set</div></div>';
  }

  // Highlight in rotation
  document.querySelectorAll('.freq-rotation-card').forEach(c => c.classList.toggle('active', c.dataset.djId === String(dj.id)));
}

function _freqRenderRotation() {
  const el = document.getElementById('freqRotation');
  el.innerHTML = '';
  _freqDJs.forEach(dj => {
    const card = document.createElement('div');
    card.className = 'freq-rotation-card' + (dj.id === (_freqCurrentDJ && _freqCurrentDJ.id) ? ' active' : '');
    card.dataset.djId = dj.id;
    card.onclick = () => _freqShowDJ(dj);
    card.innerHTML =
      '<div style="font-size:1.2rem;margin-bottom:0.3rem">🎧</div>' +
      '<div style="font-family:\'Orbitron\',sans-serif;font-size:0.6rem;color:#e8eaf6;margin-bottom:0.15rem">' + dj.dj_name + '</div>' +
      '<div style="font-size:0.45rem;color:rgba(206,147,216,0.5);font-family:\'Space Mono\',monospace">' +
      (dj.is_resident ? '★ RESIDENT' : dj.environment_key ? dj.environment_key.replace(/_/g, ' ').toUpperCase() : 'FEATURED') + '</div>';
    el.appendChild(card);
  });
}

function _freqStartEnv() {
  const canvas = document.getElementById('freqEnvCanvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.offsetWidth * (window.devicePixelRatio || 1);
  canvas.height = canvas.offsetHeight * (window.devicePixelRatio || 1);
  ctx.scale(window.devicePixelRatio || 1, window.devicePixelRatio || 1);
  const W = canvas.offsetWidth, H = canvas.offsetHeight;

  // Mini procedural grow room in the room-specific canvas
  const miniPlants = [];
  for (let i = 0; i < 8; i++) {
    miniPlants.push({ x: W * 0.05 + (i / 8) * W * 0.9, h: 20 + Math.random() * 30, phase: Math.random() * 6 });
  }
  let t = 0;
  function draw() {
    ctx.clearRect(0, 0, W, H);
    // Dark bg
    const bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0, '#0a0312');
    bg.addColorStop(1, '#0d0518');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, W, H);
    t++;
    // Grow lights
    for (let i = 0; i < 4; i++) {
      const lx = W * 0.15 + i * W * 0.23;
      const pulse = 0.5 + Math.sin(t * 0.02 + i) * 0.3;
      const g = ctx.createRadialGradient(lx, 0, 5, lx, H * 0.6, W * 0.15);
      g.addColorStop(0, `rgba(180,40,200,${0.15 * pulse})`);
      g.addColorStop(1, 'rgba(150,30,180,0)');
      ctx.fillStyle = g;
      ctx.fillRect(lx - W * 0.15, 0, W * 0.3, H);
    }
    // Plants
    for (const p of miniPlants) {
      const sway = Math.sin(t * 0.01 + p.phase) * 2;
      ctx.strokeStyle = 'rgba(40,100,30,0.3)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(p.x, H * 0.8);
      ctx.lineTo(p.x + sway, H * 0.8 - p.h);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(p.x + sway, H * 0.8 - p.h - 3, 4, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(100,180,60,${0.15 + Math.sin(t * 0.02 + p.phase) * 0.05})`;
      ctx.fill();
    }
    // Haze
    for (let i = 0; i < 15; i++) {
      const hx = (t * 0.2 + i * W / 15) % W;
      const hy = H * 0.3 + Math.sin(t * 0.005 + i) * H * 0.15;
      ctx.beginPath();
      ctx.arc(hx, hy, 4 + Math.sin(i + t * 0.01) * 2, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(180,140,200,0.04)';
      ctx.fill();
    }
    // DJ Booth silhouette — center
    const bx = W / 2, by = H * 0.6;
    ctx.fillStyle = 'rgba(30,10,40,0.5)';
    ctx.fillRect(bx - 40, by, 80, 30);
    ctx.fillStyle = 'rgba(156,39,176,0.08)';
    ctx.fillRect(bx - 38, by + 2, 76, 26);
    // Turntable circles
    const spin = t * 0.03;
    ctx.strokeStyle = 'rgba(206,147,216,0.15)';
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.arc(bx - 18, by + 15, 8, spin, spin + 4); ctx.stroke();
    ctx.beginPath(); ctx.arc(bx + 18, by + 15, 8, -spin, -spin + 4); ctx.stroke();

    _freqEnvAnim = requestAnimationFrame(draw);
  }
  if (_freqEnvAnim) cancelAnimationFrame(_freqEnvAnim);
  _freqEnvAnim = requestAnimationFrame(draw);
}

// ── HOOK INTO ROOM SWITCHING ──
const origSwitchRoom = switchRoom;
switchRoom = function(roomId, navEl) {
  setEnvironment(roomId);
  origSwitchRoom(roomId, navEl);
};

// ── HOOK INTO LOBBY RETURN ──
const origBackToLobby = typeof backToLobby === 'function' ? backToLobby : null;
if (origBackToLobby) {
  const _btl = backToLobby;
  backToLobby = function() {
    setEnvironment('lobby');
    _btl();
  };
}

// ── INIT: Start with lobby meteors ──
initMeteors();
envActive = 'lobby';
if (envCanvas) { envCanvas.style.opacity = '1'; envLoop(); }

</script>
<div class="orb-confirm" id="orbConfirm"><div class="orb-confirm-inner"><div class="orb-confirm-glow" id="orbGlow"></div><div class="orb-confirm-hline" id="orbHline"></div><div class="orb-confirm-text" id="orbText"><div class="orb-confirm-scanline"></div></div></div></div>
<div id="orbResidue"><canvas id="orbResCanvas"></canvas></div>
</body>
</html>
